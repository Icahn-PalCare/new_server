= V4 Outline MultiLine NoSorting TabWidth=30

H="*******"


H="Annual Elixhauser"
/*

Created by: EBL
Date Created: 4/12/19

Updated by:
Date Updated:




**************************************************

/****************************************************************************/
/* Rename variables macro                                                   */
/****************************************************************************/

%macro rename(lib,dsn,pre);
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "Before Renaming All Variables";
run;
proc sql noprint;
select nvar into :num_vars
from dictionary.tables
where libname="&LIB" and
memname="&DSN";
select distinct(name) into :var1-
:var%TRIM(%LEFT(&num_vars))
from dictionary.columns
where libname="&LIB" and
memname="&DSN";
quit;
run;
proc datasets library=&LIB;
modify &DSN;
rename
%do i=1 %to &num_vars;
&&var&i=&&var&i.._&pre 
%end;
;
quit;
run;
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "After Renaming All Variables";
run;
%mend rename;




/****************************************************************************/
/* Elixhauser comorbidities macro                                           */
/****************************************************************************/
/*Note elixhauser comorbidities diagnosis lists are modified for the 
purposes of this project, do not copy and paste this Elixhauser code 
for use in other projects!!*/

%macro elixhauser(range1=, range2=);

data dx_31_comor;
set proj_int.dx_&range1._&range2.(rename=(diag=dx_0));
dx=trim(left(dx_0));

if dx~="" then do;

comorbi_1=0;
comorbi_2=0;
comorbi_3=0;
comorbi_4=0;
comorbi_5=0;
comorbi_6=0;
comorbi_7=0;
comorbi_8=0;
comorbi_9=0;
comorbi_10=0;
comorbi_11=0;
comorbi_12=0;
comorbi_13=0;
comorbi_14=0;
comorbi_15=0;
comorbi_16=0;
comorbi_17=0;
comorbi_18=0;
comorbi_19=0;
comorbi_20=0;
comorbi_21=0;
comorbi_22=0;
comorbi_23=0;
comorbi_24=0;
comorbi_25=0;
comorbi_26=0;
comorbi_27=0;
comorbi_28=0;
comorbi_29=0;
comorbi_30=0;
*end of intialize of 30 binary variables;
*add dementia and CAD and ALS;
dementia=0;
cad=0;
als=0;
renal_dis=0;

*do over dx;
	*Congestive Heart Failure;
	if (substr(dx,1,5)='39891' or
		substr(dx,1,5)='40211' or
		substr(dx,1,5)='40291' or
		substr(dx,1,5)='40411' or
		substr(dx,1,5)='40413' or
		substr(dx,1,5)='40491' or
		substr(dx,1,5)='40493' or
		substr(dx,1,3)='428') 
		and comorbi_1=0 
		then comorbi_1=1;*add one binary variables here.;
	if (substr(dx,1,4)='I099' or
		substr(dx,1,4)='I110' or
		substr(dx,1,4)='I130' or
		substr(dx,1,4)='I132' or
		substr(dx,1,4)='I255' or
		substr(dx,1,4)='I420' or
		substr(dx,1,4)='I425' or
		substr(dx,1,4)='I426' or
		substr(dx,1,4)='I427' or
		substr(dx,1,4)='I428' or
		substr(dx,1,4)='I429' or
		substr(dx,1,3)='I43' or
		substr(dx,1,4)='P290' or
		substr(dx,1,3)='I50') 
		and comorbi_1=0 
		then comorbi_1=1;

		*Cariac Arrhythmias;
	if (substr(dx,1,5)='42610' or
		substr(dx,1,5)='42611' or
		substr(dx,1,5)='42613' or
		substr(dx,1,4)='4262' or
		substr(dx,1,4)='4263' or
		substr(dx,1,4)='4264' or
		substr(dx,1,5)='42650' or
		substr(dx,1,5)='42651' or
		substr(dx,1,5)='42652' or
		substr(dx,1,5)='42653' or
		substr(dx,1,4)='4266' or
		substr(dx,1,4)='4267' or
		substr(dx,1,4)='4268' or
		substr(dx,1,4)='4270' or
		substr(dx,1,4)='4272' or
		substr(dx,1,5)='42731' or
		substr(dx,1,5)='42760' or
		substr(dx,1,4)='4279' or
		substr(dx,1,4)='7850' or
		substr(dx,1,4)='V450' or
		substr(dx,1,4)='V533')
			and comorbi_2=0 
		then comorbi_2=1;
	if (substr(dx,1,4)='I441' or
		substr(dx,1,4)='I442' or
		substr(dx,1,4)='I443' or
		substr(dx,1,4)='I456' or
		substr(dx,1,4)='I459' or
		substr(dx,1,3)='I47' or
		substr(dx,1,3)='I48' or
		substr(dx,1,3)='I49' or
		substr(dx,1,4)='ROOO' or
		substr(dx,1,4)='ROO1' or
		substr(dx,1,4)='ROO8' or
		substr(dx,1,4)='R000' or
		substr(dx,1,4)='R001' or
		substr(dx,1,4)='R008' or
		substr(dx,1,4)='T821' or
		substr(dx,1,4)='Z450' or
		substr(dx,1,4)='Z950')
			and comorbi_2=0 
		then comorbi_2=1;
	* Valvular Disease ;
	if (substr(dx,1,5)='09320' or
		substr(dx,1,5)='09321' or
		substr(dx,1,5)='09322' or
		substr(dx,1,5)='09323' or
		substr(dx,1,5)='09324' or
		substr(dx,1,3)='394' or
		substr(dx,1,3)='395' or
		substr(dx,1,3)='396' or
		substr(dx,1,4)='3970' or
		substr(dx,1,4)='3971' or
		substr(dx,1,4)='4240' or
		substr(dx,1,4)='4241' or
		substr(dx,1,4)='4242' or
		substr(dx,1,4)='4243' or
		substr(dx,1,4)='4244' or
		substr(dx,1,4)='4245' or
		substr(dx,1,4)='4246' or
		substr(dx,1,4)='4247' or
		substr(dx,1,4)='4248' or
		substr(dx,1,5)='42490' or
		substr(dx,1,5)='42491' or
		substr(dx,1,4)='7463' or
		substr(dx,1,4)='7464' or
		substr(dx,1,4)='7465' or
		substr(dx,1,4)='7466' or
		substr(dx,1,4)='V422' or
		substr(dx,1,4)='V433')
			and comorbi_3=0 
		then comorbi_3=1;
	if (substr(dx,1,4)='A520' or
		substr(dx,1,4)='I05' or
		substr(dx,1,3)='I06' or
		substr(dx,1,3)='I07' or
		substr(dx,1,3)='I08' or
		substr(dx,1,4)='I091' or
		substr(dx,1,4)='I098' or
		substr(dx,1,3)='I34' or
		substr(dx,1,3)='I35' or
		substr(dx,1,3)='I36' or
		substr(dx,1,3)='I37' or
		substr(dx,1,3)='I38' or
		substr(dx,1,3)='I39' or
		substr(dx,1,4)='Q230' or
		substr(dx,1,4)='Q231' or
		substr(dx,1,4)='Q232' or
		substr(dx,1,4)='Q233' or
		substr(dx,1,4)='Z952' or
		substr(dx,1,4)='Z954')
			and comorbi_3=0 
		then comorbi_3=1;
	*Pulmonary Circulation Disorders;
	if (substr(dx,1,3)='416' or
		substr(dx,1,4)='4179')
			and comorbi_4=0 
		then comorbi_4=1;
	if (substr(dx,1,3)='I26' or
		substr(dx,1,3)='I27' or
		substr(dx,1,4)='I280' or
		substr(dx,1,4)='I288' or
		substr(dx,1,4)='I289')
			and comorbi_4=0 
		then comorbi_4=1;
	*Peripheral Vascular Disorders;
	if (substr(dx,1,3)='440' or
		substr(dx,1,4)='4412' or
		substr(dx,1,4)='4414' or
		substr(dx,1,4)='4417' or
		substr(dx,1,4)='4419' or
		substr(dx,1,4)='4431' or
		substr(dx,1,4)='4432' or
		substr(dx,1,4)='4438' or
		substr(dx,1,4)='4439' or
		substr(dx,1,4)='4471' or
		substr(dx,1,4)='5571' or
		substr(dx,1,4)='5579' or
		substr(dx,1,4)='V434')
			and comorbi_5=0 
		then comorbi_5=1;
	if (substr(dx,1,3)='I70' or
		substr(dx,1,3)='I71' or
		substr(dx,1,4)='I731' or
		substr(dx,1,4)='I738' or
		substr(dx,1,4)='I739' or
		substr(dx,1,4)='I771' or
		substr(dx,1,4)='I790' or
		substr(dx,1,4)='I792' or
		substr(dx,1,4)='K551' or
		substr(dx,1,4)='K558' or
		substr(dx,1,4)='K559' or
		substr(dx,1,4)='X958' or
		substr(dx,1,4)='Z959')
			and comorbi_5=0 
		then comorbi_5=1;
	*Hypertension;
	if ((substr(dx,1,4)='4011' or
		substr(dx,1,4)='4019')) or
	   ((substr(dx,1,5)='40210' or
		substr(dx,1,5)='40290' or
		substr(dx,1,5)='40410' or
		substr(dx,1,5)='40490' or
		substr(dx,1,5)='40511' or
		substr(dx,1,5)='40519' or
		substr(dx,1,5)='40591' or
		substr(dx,1,5)='40599')) 
			and comorbi_6=0 
		then comorbi_6=1;
	if (substr(dx,1,3)='I10' or
		substr(dx,1,3)='I11' or
	    substr(dx,1,3)='I12' or
		substr(dx,1,3)='I13' or
		substr(dx,1,3)='I15')
			and comorbi_6=0 
		then comorbi_6=1;
	*Paralysis;	
	if (substr(dx,1,4)='3420' or
		substr(dx,1,5)='34210' or
		substr(dx,1,5)='34211' or
		substr(dx,1,5)='34212' or
		substr(dx,1,4)='3429' or
		substr(dx,1,3)='343' or
		substr(dx,1,3)='344')
			and comorbi_7=0 
		then comorbi_7=1;
	if (substr(dx,1,4)='G041' or
		substr(dx,1,4)='G114' or
		substr(dx,1,4)='G801' or
		substr(dx,1,4)='G802' or
		substr(dx,1,3)='G81' or
		substr(dx,1,3)='G82' or
		substr(dx,1,4)='G830' or 
		substr(dx,1,4)='G831' or 
		substr(dx,1,4)='G832' or 
		substr(dx,1,4)='G833' or 
		substr(dx,1,4)='G834' or 
		substr(dx,1,4)='G839')
			and comorbi_7=0 
		then comorbi_7=1;
	*Other Neurological Disorders;
	if (substr(dx,1,4)='3319' or
		substr(dx,1,4)='3320' or
		substr(dx,1,4)='3334' or
		substr(dx,1,4)='3335' or
		substr(dx,1,3)='334' or
		substr(dx,1,3)='335' or
		substr(dx,1,3)='340' or
		substr(dx,1,4)='3411' or
		substr(dx,1,4)='3418' or
		substr(dx,1,4)='3419' or
		substr(dx,1,5)='34500' or
		substr(dx,1,5)='34501' or
		substr(dx,1,5)='34510' or
		substr(dx,1,5)='34511' or
		substr(dx,1,4)='3454' or
		substr(dx,1,5)='34550' or
		substr(dx,1,5)='34551' or
		substr(dx,1,4)='3458' or
		substr(dx,1,5)='34590' or
		substr(dx,1,5)='34591' or
		substr(dx,1,4)='3481' or
		substr(dx,1,4)='3483' or
		substr(dx,1,4)='7803' or
		substr(dx,1,4)='7843') 
			and comorbi_8=0 
		then comorbi_8=1;	
	if (substr(dx,1,3)='G10' or
		substr(dx,1,3)='G13' or
		substr(dx,1,3)='G20' or
		substr(dx,1,3)='G22' or
		substr(dx,1,4)='G254' or
		substr(dx,1,4)='G255' or
		substr(dx,1,4)='G312' or
		substr(dx,1,4)='G318' or
		substr(dx,1,4)='G319' or
		substr(dx,1,3)='G32' or
		substr(dx,1,3)='G35' or
		substr(dx,1,3)='G36' or
		substr(dx,1,3)='G37' or
		substr(dx,1,3)='G40' or
		substr(dx,1,3)='G41' or
		substr(dx,1,4)='G931' or
		substr(dx,1,4)='G934' or
		substr(dx,1,4)='R470' or
		substr(dx,1,4)='R560') 
			and comorbi_8=0 
		then comorbi_8=1;	
		*Chronic Pulmonary Disease;
	if (substr(dx,1,3)='490' or
		substr(dx,1,3)='491' or
		substr(dx,1,3)='492' or
		substr(dx,1,4)='4930' or
		substr(dx,1,4)='4931' or
		substr(dx,1,4)='4932' or
		substr(dx,1,4)='4938' or
		substr(dx,1,5)='49390' or
		substr(dx,1,5)='49391' or
		substr(dx,1,3)='494' or
		substr(dx,1,3)='495' or
		substr(dx,1,3)='496' or
		substr(dx,1,3)='497' or
		substr(dx,1,3)='498' or
		substr(dx,1,3)='499' or
		substr(dx,1,3)='500' or
		substr(dx,1,3)='501' or
		substr(dx,1,3)='502' or
		substr(dx,1,3)='503' or
		substr(dx,1,3)='504' or
		substr(dx,1,3)='505' or
		substr(dx,1,4)='5064') 
			and comorbi_9=0 
		then comorbi_9=1;	
	if (substr(dx,1,4)='I278' or
		substr(dx,1,4)='I279' or
		substr(dx,1,3)='J40' or
		substr(dx,1,3)='J41' or
		substr(dx,1,3)='J42' or
		substr(dx,1,3)='J43' or
		substr(dx,1,3)='J44' or
		substr(dx,1,3)='J45' or
		substr(dx,1,3)='J46' or
		substr(dx,1,3)='J47' or
		substr(dx,1,3)='J60' or
		substr(dx,1,3)='J61' or
		substr(dx,1,3)='J62' or
		substr(dx,1,3)='J63' or
		substr(dx,1,3)='J64' or
		substr(dx,1,3)='J65' or
		substr(dx,1,3)='J66' or
		substr(dx,1,3)='J67' or
		substr(dx,1,4)='J684' or
		substr(dx,1,4)='J701' or
		substr(dx,1,4)='J703') 
			and comorbi_9=0 
		then comorbi_9=1;	
		*Diabetes, uncomplicated;
	if (substr(dx,1,4)='2500' or
		substr(dx,1,4)='2501' or
		substr(dx,1,4)='2502' or
		substr(dx,1,4)='2503') 
			and comorbi_10=0 
		then comorbi_10=1;
	if (substr(dx,1,4)='E100' or
		substr(dx,1,4)='E101' or
		substr(dx,1,4)='E109' or
		substr(dx,1,4)='E110' or
		substr(dx,1,4)='E111' or
		substr(dx,1,4)='E119' or
		substr(dx,1,4)='E120' or
		substr(dx,1,4)='E121' or
		substr(dx,1,4)='E129' or
		substr(dx,1,4)='E130' or
		substr(dx,1,4)='E131' or
		substr(dx,1,4)='E139' or
		substr(dx,1,4)='E140' or
		substr(dx,1,4)='E141' or
		substr(dx,1,4)='E149') 
			and comorbi_10=0 
		then comorbi_10=1;
	*Diabetes, complicated;
	if (substr(dx,1,4)='2504' or
		substr(dx,1,4)='2505' or
		substr(dx,1,4)='2506' or
		substr(dx,1,4)='2507' or
		substr(dx,1,4)='2509') 
			and comorbi_11=0 
		then comorbi_11=1;
	if (substr(dx,1,4)='E102' or
		substr(dx,1,4)='E103' or
		substr(dx,1,4)='E104' or
		substr(dx,1,4)='E105' or
		substr(dx,1,4)='E106' or
		substr(dx,1,4)='E107' or
		substr(dx,1,4)='E108' or
		substr(dx,1,4)='E112' or
		substr(dx,1,4)='E113' or
		substr(dx,1,4)='E114' or
		substr(dx,1,4)='E115' or
		substr(dx,1,4)='E116' or
		substr(dx,1,4)='E117' or
		substr(dx,1,4)='E118' or
		substr(dx,1,4)='E122' or
		substr(dx,1,4)='E123' or
		substr(dx,1,4)='E124' or
		substr(dx,1,4)='E125' or
		substr(dx,1,4)='E126' or
		substr(dx,1,4)='E127' or
		substr(dx,1,4)='E128' or
		substr(dx,1,4)='E132' or
		substr(dx,1,4)='E133' or
		substr(dx,1,4)='E134' or
		substr(dx,1,4)='E135' or
		substr(dx,1,4)='E136' or
		substr(dx,1,4)='E137' or
		substr(dx,1,4)='E138' or
		substr(dx,1,4)='E142' or
		substr(dx,1,4)='E143' or
		substr(dx,1,4)='E144' or
		substr(dx,1,4)='E145' or
		substr(dx,1,4)='E146' or
		substr(dx,1,4)='E147' or
		substr(dx,1,4)='E148') 
			and comorbi_11=0 
		then comorbi_11=1;
		*Hypothyroidism;
	if (substr(dx,1,3)='243' or
		substr(dx,1,4)='2440' or
		substr(dx,1,4)='2441' or
		substr(dx,1,4)='2442' or
		substr(dx,1,4)='2448' or
		substr(dx,1,4)='2449') 	
			and comorbi_12=0 
		then comorbi_12=1;
	if (substr(dx,1,3)='E00' or
		substr(dx,1,3)='E01' or
		substr(dx,1,3)='E02' or
		substr(dx,1,3)='E03' or
		substr(dx,1,4)='E890') 	
			and comorbi_12=0 
		then comorbi_12=1;
		*Renal Failure;
	*Original list modified to drop 2 codes  585 and V568;
	if (substr(dx,1,5)='40311' or
		substr(dx,1,5)='40391' or
		substr(dx,1,5)='40412' or
		substr(dx,1,5)='40492' or
		substr(dx,1,3)='586' or
		substr(dx,1,4)='V420' or
		substr(dx,1,4)='V451' or
		substr(dx,1,4)='V560') 
			and comorbi_13=0 
		then comorbi_13=1;
	if (substr(dx,1,4)='I120' or
		substr(dx,1,4)='I131' or
		substr(dx,1,4)='N185' or
		substr(dx,1,4)='N186' or
		substr(dx,1,3)='N19' or
		substr(dx,1,4)='N250' or
		substr(dx,1,4)='Z490' or
		substr(dx,1,4)='Z491' or
		substr(dx,1,4)='Z492' or
		substr(dx,1,4)='Z940' or
		substr(dx,1,4)='Z992') 
			and comorbi_13=0 
		then comorbi_13=1;
	*Advanced Liver Disease or Cirrhosis;
	*Code list modified from orig Elix;
	*572.4 hepatorenal syndrome must be added; 
	*Remove '07032' or – chronic hep B, '07033' or – chronic hep B, '07054' or – chronic hep C, '5713' or – 
		alcoholic liver damage, '5714' or – chronic hepatitis;
	if (substr(dx,1,4)='4560' or
		substr(dx,1,4)='4561' or
		substr(dx,1,5)='45620' or
		substr(dx,1,5)='45621' or
		substr(dx,1,4)='5710' or
		substr(dx,1,4)='5712' or
		substr(dx,1,4)='5715' or
		substr(dx,1,4)='5716' or
		substr(dx,1,4)='5718' or
		substr(dx,1,4)='5719' or
		substr(dx,1,4)='5723' or
		substr(dx,1,4)='5724' or
		substr(dx,1,4)='5728' or
		substr(dx,1,4)='V427') 
			and comorbi_14=0 
		then comorbi_14=1;
/*1/25/19--changed liver to reflect just what we want in the ICD-10 codes*/
		if (substr(dx,1,5)='I8500'
		or substr(dx,1,5)='I8501'
		or substr(dx,1,5)='I8510'
		or substr(dx,1,5)='I8511'
		or substr(dx,1,4)='K702'
		or substr(dx,1,5)='K7030'
		or substr(dx,1,5)='K7031'
		or substr(dx,1,5)='K7040'
		or substr(dx,1,5)='K7041'
		or substr(dx,1,5)='K7210'
		or substr(dx,1,5)='K7290'
		or substr(dx,1,4)='K740'
		or substr(dx,1,4)='K741'
		or substr(dx,1,4)='K742'
		or substr(dx,1,4)='K743'
		or substr(dx,1,4)='K744'
		or substr(dx,1,4)='K745'
		or substr(dx,1,5)='K7460'
		or substr(dx,1,5)='K7469'
		or substr(dx,1,4)='K766'
		or substr(dx,1,4)='K767') 
					and comorbi_14=0 
		then comorbi_14=1;
	*Peptic Ulcer Disease excluding bleeding;
	if (substr(dx,1,5)='53170' or
		substr(dx,1,5)='53190' or
		substr(dx,1,5)='53270' or
		substr(dx,1,5)='53290' or
		substr(dx,1,5)='53370' or
		substr(dx,1,5)='53390' or
		substr(dx,1,5)='53470' or
		substr(dx,1,5)='53490' or
		substr(dx,1,5)='V1271') 
			and comorbi_15=0 
		then comorbi_15=1;
	if (substr(dx,1,4)='K257' or
		substr(dx,1,4)='K259' or
		substr(dx,1,4)='K267' or
		substr(dx,1,4)='K269' or
		substr(dx,1,4)='K277' or
		substr(dx,1,4)='K279' or
		substr(dx,1,4)='K287' or
		substr(dx,1,4)='K289') 
			and comorbi_15=0 
		then comorbi_15=1;
		*AIDS;
	if (substr(dx,1,3)='042' or
		substr(dx,1,3)='043' or
		substr(dx,1,3)='044') 
			and comorbi_16=0 
		then comorbi_16=1;
		if (substr(dx,1,3)='B20' or
		substr(dx,1,3)='B21' or
		substr(dx,1,3)='B22' or
		substr(dx,1,3)='B24') 
			and comorbi_16=0 
		then comorbi_16=1;
	*Lymphoma;
	if (substr(dx,1,3)='200' or
		substr(dx,1,3)='201' or
		substr(dx,1,4)='2020' or
		substr(dx,1,4)='2021' or
		substr(dx,1,4)='2022' or
		substr(dx,1,4)='2023' or
		substr(dx,1,4)='2025' or
		substr(dx,1,4)='2026' or
		substr(dx,1,4)='2027' or
		substr(dx,1,4)='2028' or
		substr(dx,1,4)='2029' or
		substr(dx,1,4)='2030' or
		substr(dx,1,4)='2038' or
		substr(dx,1,4)='2386' or
		substr(dx,1,4)='2733' or
		substr(dx,1,5)='V1071' or
		substr(dx,1,5)='V1072' or
		substr(dx,1,5)='V1079')
			and comorbi_17=0 
		then comorbi_17=1;
	if (substr(dx,1,3)='C81' or
		substr(dx,1,3)='C82' or
		substr(dx,1,3)='C83' or
		substr(dx,1,3)='C84' or
		substr(dx,1,3)='C85' or
		substr(dx,1,3)='C88' or
		substr(dx,1,3)='C96' or
		substr(dx,1,4)='C900' or
		substr(dx,1,4)='C902')
			and comorbi_17=0 
		then comorbi_17=1;
		*Metastatic Cancer or Hematologic Cancer;
	*Modified to add lukemias;
	if (substr(dx,1,3)='196' or
		substr(dx,1,3)='197' or
		substr(dx,1,3)='198' or
		substr(dx,1,3)='199' or
		substr(dx,1,3)='204' or
		substr(dx,1,3)='205' or
		substr(dx,1,3)='206' or
		substr(dx,1,3)='207' or
		substr(dx,1,3)='208') 
			and comorbi_18=0 
		then comorbi_18=1;	
	if (substr(dx,1,3)='C77' or
		substr(dx,1,3)='C78' or
		substr(dx,1,3)='C79' or
		substr(dx,1,3)='C80') 
			and comorbi_18=0 
		then comorbi_18=1;	
		*Solid Tumor without Metastisis;
	if (substr(dx,1,2)='14' or
		substr(dx,1,2)='15' or
		substr(dx,1,2)='16' or
		substr(dx,1,3)='170' or
		substr(dx,1,3)='171' or
		substr(dx,1,3)='172' or
		substr(dx,1,3)='174' or
		substr(dx,1,3)='175' or
		substr(dx,1,3)='179' or
		substr(dx,1,2)='18' or
		substr(dx,1,3)='190' or
		substr(dx,1,3)='191' or
		substr(dx,1,3)='192' or
		substr(dx,1,3)='193' or
		substr(dx,1,3)='194' or
		substr(dx,1,3)='195' or
		substr(dx,1,3)='V10')
			and comorbi_19=0 
		then comorbi_19=1;
	if (substr(dx,1,2)='C0' or
		substr(dx,1,2)='C1' or
		substr(dx,1,3)='C20' or
		substr(dx,1,3)='C21' or
		substr(dx,1,3)='C22' or
		substr(dx,1,3)='C23' or
		substr(dx,1,3)='C24' or
		substr(dx,1,3)='C25' or
		substr(dx,1,3)='C26' or
		substr(dx,1,3)='C30' or
		substr(dx,1,3)='C31' or
		substr(dx,1,3)='C32' or
		substr(dx,1,3)='C33' or
		substr(dx,1,3)='C34' or
		substr(dx,1,3)='C37' or
		substr(dx,1,3)='C38' or
		substr(dx,1,3)='C39' or
		substr(dx,1,3)='C40' or
		substr(dx,1,3)='C41' or
		substr(dx,1,3)='C43' or
		substr(dx,1,3)='C45' or
		substr(dx,1,3)='C46' or
		substr(dx,1,3)='C47' or
		substr(dx,1,3)='C48' or
		substr(dx,1,3)='C49' or
		substr(dx,1,3)='C50' or
		substr(dx,1,3)='C51' or
		substr(dx,1,3)='C52' or
		substr(dx,1,3)='C53' or
		substr(dx,1,3)='C54' or
		substr(dx,1,3)='C55' or
		substr(dx,1,3)='C56' or
		substr(dx,1,3)='C57' or
		substr(dx,1,3)='C58' or
		substr(dx,1,3)='C60' or
		substr(dx,1,3)='C61' or
		substr(dx,1,3)='C62' or
		substr(dx,1,3)='C63' or
		substr(dx,1,3)='C64' or
		substr(dx,1,3)='C65' or
		substr(dx,1,3)='C66' or
		substr(dx,1,3)='C67' or
		substr(dx,1,3)='C68' or
		substr(dx,1,3)='C69' or
		substr(dx,1,3)='C70' or
		substr(dx,1,3)='C71' or
		substr(dx,1,3)='C72' or
		substr(dx,1,3)='C73' or
		substr(dx,1,3)='C74' or
		substr(dx,1,3)='C75' or
		substr(dx,1,3)='C76' or
		substr(dx,1,3)='C97')
			and comorbi_19=0 
		then comorbi_19=1;
		*Rheumatoid Arthritis/Collagen Vascular Diseases;
	if (substr(dx,1,4)='7010' or
		substr(dx,1,3)='710' or
		substr(dx,1,3)='714' or
		substr(dx,1,3)='720' or
		substr(dx,1,3)='725') 
			and comorbi_20=0 
		then comorbi_20=1;
	if (substr(dx,1,4)='L940' or
		substr(dx,1,4)='L941' or
		substr(dx,1,4)='L943' or
		substr(dx,1,3)='M05' or
		substr(dx,1,3)='M06' or
		substr(dx,1,3)='M08' or
		substr(dx,1,4)='M120' or
		substr(dx,1,4)='M123' or
		substr(dx,1,3)='M30' or
		substr(dx,1,4)='M310' or
		substr(dx,1,4)='M311' or
		substr(dx,1,4)='M312' or
		substr(dx,1,4)='M313' or
		substr(dx,1,3)='M32' or
		substr(dx,1,3)='M33' or
		substr(dx,1,3)='M34' or
		substr(dx,1,3)='M35' or
		substr(dx,1,3)='M45' or
		substr(dx,1,4)='M461' or
		substr(dx,1,4)='M468' or
		substr(dx,1,4)='M469') 
			and comorbi_20=0 
		then comorbi_20=1;
		*Coagulopathy;
	*Coagulopathy;
	if (substr(dx,1,3)='286' or
		substr(dx,1,4)='2871' or
		substr(dx,1,4)='2873' or
		substr(dx,1,4)='2874' or
		substr(dx,1,4)='2875') 
			and comorbi_21=0 
		then comorbi_21=1;
	if (substr(dx,1,3)='D65' or
		substr(dx,1,3)='D66' or
		substr(dx,1,3)='D67' or
		substr(dx,1,3)='D68' or
		substr(dx,1,4)='D691' or
		substr(dx,1,4)='D693' or
		substr(dx,1,4)='D694' or
		substr(dx,1,4)='D695' or
		substr(dx,1,4)='D696') 
			and comorbi_21=0 
		then comorbi_21=1;
	*Obesity;
	if (substr(dx,1,4)='2780'  or
		substr(dx,1,3)='E66')  
			and comorbi_22=0 
		then comorbi_22=1;
	*Weight Loss;
	if (substr(dx,1,3)='260' or
		substr(dx,1,3)='261' or
		substr(dx,1,3)='262' or
		substr(dx,1,3)='263' or
		substr(dx,1,3)='E40' or
		substr(dx,1,3)='E41' or
		substr(dx,1,3)='E42' or
		substr(dx,1,3)='E43' or
		substr(dx,1,3)='E44' or
		substr(dx,1,3)='E45' or
		substr(dx,1,3)='E46' or
		substr(dx,1,4)='R634' or
		substr(dx,1,3)='R64' ) 
			and comorbi_23=0 
		then comorbi_23=1;	
	*Fluid and Electrolyte Disorders;
	if (substr(dx,1,3)='276' or
		substr(dx,1,4)='E222' or
		substr(dx,1,3)='E86' or
		substr(dx,1,3)='E87' ) 
			and comorbi_24=0 
		then comorbi_24=1;
	*Blood Loss Anemia;
	if (substr(dx,1,4)='2800' or
		substr(dx,1,4)='D500' ) 
			and comorbi_25=0 
		then comorbi_25=1;
	*Deficiency Anemias;
	if (substr(dx,1,4)='2801' or
		substr(dx,1,4)='2808' or
		substr(dx,1,4)='2809' or
		substr(dx,1,4)='2859' or
		substr(dx,1,4)='D508' or
		substr(dx,1,3)='D509' or
		substr(dx,1,3)='D51' or
		substr(dx,1,3)='D52' or
		substr(dx,1,3)='D53' ) 
			and comorbi_26=0 
		then comorbi_26=1;
	*Alcohol Abuse;
	if (substr(dx,1,4)='2911' or
		substr(dx,1,4)='2912' or
		substr(dx,1,4)='2915' or
		substr(dx,1,4)='2918' or
		substr(dx,1,4)='2919' or
		substr(dx,1,4)='3039' or
		substr(dx,1,4)='3050' or
		substr(dx,1,4)='V113' or
		substr(dx,1,3)='F10' or
		substr(dx,1,3)='E52' or
		substr(dx,1,4)='G621' or
		substr(dx,1,4)='I426' or
		substr(dx,1,4)='K292' or
		substr(dx,1,4)='K700' or
		substr(dx,1,4)='K703' or
		substr(dx,1,4)='K709' or
		substr(dx,1,3)='T51' or
		substr(dx,1,4)='Z502' or
		substr(dx,1,4)='Z715' or
		substr(dx,1,4)='Z722') 
			and comorbi_27=0 
		then comorbi_27=1;
	*Drug Abuse;
	if (substr(dx,1,4)='2920' or
		substr(dx,1,5)='29282' or
		substr(dx,1,5)='29283' or
		substr(dx,1,5)='29284' or
		substr(dx,1,5)='29289' or
		substr(dx,1,4)='2929' or
		substr(dx,1,3)='304' or
		substr(dx,1,4)='3052' or
		substr(dx,1,4)='3053' or
		substr(dx,1,4)='3054' or
		substr(dx,1,4)='3055' or
		substr(dx,1,4)='3056' or
		substr(dx,1,4)='3057' or
		substr(dx,1,4)='3058' or
		substr(dx,1,4)='3059' or
		substr(dx,1,3)='F11' or
		substr(dx,1,3)='F12' or
		substr(dx,1,3)='F13' or
		substr(dx,1,3)='F14' or
		substr(dx,1,3)='F15' or
		substr(dx,1,3)='F16' or
		substr(dx,1,3)='F18' or
		substr(dx,1,3)='F19' or
		substr(dx,1,4)='Z715' or
		substr(dx,1,4)='Z722')
			and comorbi_28=0 
		then comorbi_28=1;	
	*Psychoses;
	if (substr(dx,1,3)='295' or
		substr(dx,1,3)='296' or
		substr(dx,1,3)='297' or
		substr(dx,1,3)='298' or
		substr(dx,1,4)='2991' or
		substr(dx,1,3)='F20' or
		substr(dx,1,3)='F22' or
		substr(dx,1,3)='F23' or
		substr(dx,1,3)='F24' or
		substr(dx,1,3)='F25' or
		substr(dx,1,3)='F28' or
		substr(dx,1,3)='F29' or
		substr(dx,1,4)='F302' or
		substr(dx,1,4)='F312' or
		substr(dx,1,4)='F315' ) 
			and comorbi_29=0 
		then comorbi_29=1;
	*Depression;
	if (substr(dx,1,4)='3004' or
		substr(dx,1,5)='30112' or
		substr(dx,1,4)='3090' or
		substr(dx,1,4)='3091' or
		substr(dx,1,3)='311' or
		substr(dx,1,3)='294' or
		substr(dx,1,4)='F313' or
		substr(dx,1,4)='F314' or
		substr(dx,1,4)='F315' or
		substr(dx,1,3)='F32' or
		substr(dx,1,3)='F33' or
		substr(dx,1,4)='F341' or
		substr(dx,1,4)='F412' or
		substr(dx,1,4)='F432' )
			and comorbi_30=0 
		then comorbi_30=1;

	*Dementia;
	if (substr(dx,1,4) in ('3310','3311','3312','2900','2901',
             '2902','2903','2912','2948','2949') or
		substr(dx,1,5) in ('29410','29411','29040','29041','29042','29043')) 
		and dementia=0 
          then dementia=1;
/*dementia*/
if (substr(dx,1,5)='F0150'
or substr(dx,1,5)='F0151'
or substr(dx,1,5)='F0280'
or substr(dx,1,5)='F0281'
or substr(dx,1,5)='F0390'
or substr(dx,1,5)='F0391'
or substr(dx,1,4)='F051'
or substr(dx,1,5)='F1027'
or substr(dx,1,5)='F1097'
or substr(dx,1,4)='G300'
or substr(dx,1,4)='G301'
or substr(dx,1,4)='G308'
or substr(dx,1,4)='G309'
or substr(dx,1,5)='G3101'
or substr(dx,1,5)='G3109'
or substr(dx,1,4)='G311'
or substr(dx,1,5)='G3183'
or substr(dx,1,4)='A811'
or substr(dx,1,4)='A812'
or substr(dx,1,4)='A818'
or substr(dx,1,5)='A8100'
or substr(dx,1,5)='A8101'
or substr(dx,1,5)='A8109'
or substr(dx,1,5)='A8181'
or substr(dx,1,5)='A8182'
or substr(dx,1,5)='A8183'
)  
		and dementia=0 
          then dementia=1;
	*CAD coronary artery disease;
	if (substr(dx,1,4) in ('4140','4142','4143','4148','4149') or 
		substr(dx,1,3) in ('410','411','412','413') or
		substr(dx,1,5) in ('V4581','V4582'))
		and cad=0 
          then cad=1;

	*ALS Amyotrophic lateral sclerosis;
	if (substr(dx,1,5)='33520') and als=0 
		then als=1;

*Renal Disease, new variable;
	*To identify diabetese with complications;
	if (substr(dx,1,5)='40311' or
		substr(dx,1,5)='40391' or
		substr(dx,1,5)='40412' or
		substr(dx,1,5)='40492' or
		substr(dx,1,3)='585' or
		substr(dx,1,3)='586' or
		substr(dx,1,4)='V420' or
		substr(dx,1,4)='V451' or
		substr(dx,1,4)='V560' or
		substr(dx,1,4)='V568') 
			and renal_dis=0 
		then renal_dis=1;

end;

run;

/*get count of each comorbidity for each id-core year combination*/
proc sql;
create table com_test1 as
select distinct bid_hrs_22, index_date,
sum(comorbi_1) as com_1,
sum(comorbi_2) as com_2,
sum(comorbi_3) as com_3,
sum(comorbi_4) as com_4,
sum(comorbi_5) as com_5,
sum(comorbi_6) as com_6,
sum(comorbi_7) as com_7,
sum(comorbi_8) as com_8,
sum(comorbi_9) as com_9,
sum(comorbi_10) as com_10,
sum(comorbi_11) as com_11,
sum(comorbi_12) as com_12,
sum(comorbi_13) as com_13,
sum(comorbi_14) as com_14,
sum(comorbi_15) as com_15,
sum(comorbi_16) as com_16,
sum(comorbi_17) as com_17,
sum(comorbi_18) as com_18,
sum(comorbi_19) as com_19,
sum(comorbi_20) as com_20,
sum(comorbi_21) as com_21,
sum(comorbi_22) as com_22,
sum(comorbi_23) as com_23,
sum(comorbi_24) as com_24,
sum(comorbi_25) as com_25,
sum(comorbi_26) as com_26,
sum(comorbi_27) as com_27,
sum(comorbi_28) as com_28,
sum(comorbi_29) as com_29,
sum(comorbi_30) as com_30,
sum(dementia) as dementia,
sum(cad) as cad,
sum(als) as als,
sum(renal_dis) as renal_dis
from dx_31_comor
group by bid_hrs_22, index_date;
quit;

/*convert counts of diagnoses for each comorbidity to indicator variables*/ 
data comorbidity_1(keep=bid_hrs_22 index_date comorb_1-comorb_34 comorb_all);
set com_test1;
array list_com com_1-com_30 dementia cad als renal_dis;
array list_com_bin comorb_1-comorb_34 ;

do over list_com;
  list_com_bin=0;

  if list_com>0 then do;
    list_com_bin=1;
   end;

end;
/*note this comorb_all count does not include CAD or ALS or Renal disease*/
comorb_all=comorb_1+comorb_2+comorb_3+comorb_4+comorb_5+comorb_6+comorb_7+comorb_8+comorb_9+comorb_10
+comorb_11+comorb_12+comorb_13+comorb_14+comorb_15+comorb_16+comorb_17+comorb_18+comorb_19+comorb_20
+comorb_21+comorb_22+comorb_23+comorb_24+comorb_25+comorb_26+comorb_27+comorb_28+comorb_29+comorb_30
+comorb_31;

run;

/*merge in to list of core ivw dates for those with ffs mc, age=65+ */
proc sort data=comorbidity_1 nodupkey;
by bid_hrs_22 index_date;
run;

data elix_&range1._&range2;
set comorbidity_1 ;

label comorb_1 ="Congestive Heart Failure";
label comorb_2 ="Cardiac Arrhythmias";
label comorb_3 ="Valvular Disease";
label comorb_4 ="Pulmonary Circulation Disorders";
label comorb_5 ="Peripheral Vascular Disorders";
label comorb_6 ="Hypertension";
label comorb_7 ="Paralysis";
label comorb_8 ="Other Neurological Disorders";
label comorb_9 ="Chronic Pulmonary Disease";
label comorb_10 ="Diabetes, uncomplicated";
label comorb_11 ="Diabetes, complicated";
label comorb_12 ="Hypothyroidism";
label comorb_13 ="Renal Failure";
label comorb_14 ="Advanced Liver Disease or Cirrhosis";
label comorb_15 ="Peptic Ulcer Disease excluding bleeding";
label comorb_16 ="AIDS";
label comorb_17 ="Lymphoma";
label comorb_18 ="Metastatic or Hematologic Cancer";
label comorb_19 ="Solid Tumor without Metastisis";
label comorb_20 ="Rheumatoid Arthritis/Collagen Vascular Diseases";
label comorb_21 ="Coagulopathy";
label comorb_22 ="Obesity";
label comorb_23 ="Weight Loss";
label comorb_24 ="Fluid and Electrolyte Disorders";
label comorb_25 ="Blood Loss Anemia";
label comorb_26 ="Deficiency Anemias";
label comorb_27 ="Alcohol Abuse";
label comorb_28 ="Drug Abuse";
label comorb_29 ="Psychoses";
label comorb_30 ="Depression";
label comorb_31 ="Dementia";
label comorb_32 ="CAD";
label comorb_33 ="ALS";
label comorb_34 ="Renal Disease";
label comorb_all ="Count of Elix comorbidities";
run;

data test;
set elix_&range1._&range2;
run;

%rename(WORK,TEST,&range1._&range2);

data elix_&range1._&range2.(rename =(bid_hrs_22_&range1._&range2=bid_hrs_22
index_date_&range1._&range2=index_date));
set test;
keep bid_hrs_22_&range1._&range2 comorb: index_date:;
run;


%mend;








/*I do not understand why this doesn't work
%macro runelix(years=);
%do i=1 %to &years.;
%let l=%eval(&i.-1);

%elixhauser(range1=%eval(&l.*12)m, range2=%eval(&i.*12)m);

%end;
%mend;

%runelix(years=7);

*/

%elixhauser(range1=0m, range2=12m);
%elixhauser(range1=0m, range2=24m);




proc sql; 
create table proj_int.elix as select * from
proj_int.index a
left join 
elix_0m_12m b
on a.bid_hrs_22=b.bid_hrs_22 and a.index_date=b.index_date
left join 
elix_0m_24m c
on a.bid_hrs_22=c.bid_hrs_22 and a.index_date=c.index_date;
quit;


H="Calculate SNF/HH Medicaid cost+days"


H="CCW CCs"
/*

Created by: EBL
Date Created: 4/12/19

Updated by:
Date Updated:




**************************************************

/****************************************************************************/
/* Rename variables macro                                                   */
/****************************************************************************/

%macro rename(lib,dsn,pre);
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "Before Renaming All Variables";
run;
proc sql noprint;
select nvar into :num_vars
from dictionary.tables
where libname="&LIB" and
memname="&DSN";
select distinct(name) into :var1-
:var%TRIM(%LEFT(&num_vars))
from dictionary.columns
where libname="&LIB" and
memname="&DSN";
quit;
run;
proc datasets library=&LIB;
modify &DSN;
rename
%do i=1 %to &num_vars;
&&var&i=&&var&i.._&pre 
%end;
;
quit;
run;
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "After Renaming All Variables";
run;
%mend rename;



%macro ccw(range1=,range2=);

data dx_ccw;
set proj_int.dx_&range1._&range2.(rename=(diag=dx_0));
dx=trim(left(dx_0));

if dx~='' then do;

*initialize variables;
   ccw_1=0;
   ccw_2=0;
   ccw_3=0;
   ccw_4=0;
   ccw_5=0;
   ccw_6=0;
      ccw_7=0;
	     ccw_8=0;
		    ccw_9=0;
			   ccw_10=0;
			      ccw_11=0;
				     ccw_12=0;
					    ccw_13=0;
						   ccw_14=0;
						      ccw_15=0;
							     ccw_16=0;
								    ccw_17=0;
	     ccw_18=0;
		    ccw_19=0;
			   ccw_20=0;
			      ccw_21=0;
				     ccw_22=0;
					    ccw_23=0;
						   ccw_24=0;
						      ccw_25=0;
							     ccw_26=0;
								    ccw_27=0;
*do over dx;
   *Acquired Hypothyroidism;
   if (substr(dx,1,4) =	'2441'
or substr(dx,1,4) =	'2442'
or substr(dx,1,4) =	'2443'
or substr(dx,1,4) =	'2448'
or substr(dx,1,4) =	'2449'
or substr(dx,1,4) =	'2440'
or substr(dx,1,4) =	'E018'
or substr(dx,1,3) =	'E02'
or substr(dx,1,4) =	'E032'
or substr(dx,1,4) =	'E033'
or substr(dx,1,4) =	'E038'
or substr(dx,1,4) =	'E039'
or substr(dx,1,4) =	'E890')

               and ccw_1=0
               then ccw_1=1;
   *AMI;
   if (substr(dx,1,5) =	'41001'
or substr(dx,1,5) =	'41011'
or substr(dx,1,5) =	'41021'
or substr(dx,1,5) =	'41031'
or substr(dx,1,5) =	'41041'
or substr(dx,1,5) =	'41051'
or substr(dx,1,5) =	'41061'
or substr(dx,1,5) =	'41071'
or substr(dx,1,5) =	'41081'
or substr(dx,1,5) =	'41091'
or substr(dx,1,5) =	'I2101'
or substr(dx,1,5) =	'I2102'
or substr(dx,1,5) =	'I2109'
or substr(dx,1,5) =	'I2111'
or substr(dx,1,5) =	'I2119'
or substr(dx,1,5) =	'I2121'
or substr(dx,1,5) =	'I2129'
or substr(dx,1,4) =	'I213'
or substr(dx,1,4) =	'I214'
or substr(dx,1,4) =	'I219'
or substr(dx,1,5) =	'I21A1'
or substr(dx,1,5) =	'I21A9'
or substr(dx,1,4) =	'I220'
or substr(dx,1,4) =	'I221'
or substr(dx,1,4) =	'I222'
or substr(dx,1,4) =	'I228'
or substr(dx,1,4) =	'I229')
               and ccw_2=0
               then ccw_2=1;
   *Alzheimers Disease;
    if (substr(dx,1,4) =	'3310'
or substr(dx,1,4) =	'G300'
or substr(dx,1,4) =	'G301'
or substr(dx,1,4) =	'G308'
or substr(dx,1,4) =	'G309')
               and ccw_3=0
               then ccw_3=1;
    *Alzheimers and Related Disorders or Senile Dementia ;
     if (substr(dx,1,5) =	'29011'
or substr(dx,1,5) =	'29012'
or substr(dx,1,5) =	'29013'
or substr(dx,1,5) =	'29010'
or substr(dx,1,5) =	'29021'
or substr(dx,1,5) =	'29020'
or substr(dx,1,4) =	'2903'
or substr(dx,1,5) =	'29041'
or substr(dx,1,5) =	'29042'
or substr(dx,1,5) =	'29043'
or substr(dx,1,5) =	'29040'
or substr(dx,1,5) =	'2900'
or substr(dx,1,5) =	'29411'
or substr(dx,1,5) =	'29410'
or substr(dx,1,5) =	'29421'
or substr(dx,1,5) =	'29420'
or substr(dx,1,4) =	'2948'
or substr(dx,1,4) =	'2940'
or substr(dx,1,5) =	'33111'
or substr(dx,1,5) =	'33119'
or substr(dx,1,4) =	'3312'
or substr(dx,1,4) =	'3317'
or substr(dx,1,4) =	'3310'
or substr(dx,1,3) =	'797'
or substr(dx,1,5) =	'F0150'
or substr(dx,1,5) =	'F0151'
or substr(dx,1,5) =	'F0280'
or substr(dx,1,5) =	'F0281'
or substr(dx,1,5) =	'F0390'
or substr(dx,1,5) =	'F0391'
or substr(dx,1,3) =	'F04'
or substr(dx,1,3) =	'F05'
or substr(dx,1,4) =	'F061'
or substr(dx,1,4) =	'F068'
or substr(dx,1,4) =	'G138'
or substr(dx,1,4) =	'G300'
or substr(dx,1,4) =	'G301'
or substr(dx,1,4) =	'G308'
or substr(dx,1,4) =	'G309'
or substr(dx,1,5) =	'G3101'
or substr(dx,1,5) =	'G3109'
or substr(dx,1,4) =	'G311'
or substr(dx,1,4) =	'G312'
or substr(dx,1,3) =	'G94'
or substr(dx,1,5) =	'R4181'
or substr(dx,1,3) =	'R54')
               and ccw_4=0
               then ccw_4=1;
   *Anemia ;
       if (substr(dx,1,4) =	'2801'
or substr(dx,1,4) =	'2808'
or substr(dx,1,4) =	'2809'
or substr(dx,1,4) =	'2800'
or substr(dx,1,4) =	'2811'
or substr(dx,1,4) =	'2812'
or substr(dx,1,4) =	'2813'
or substr(dx,1,4) =	'2814'
or substr(dx,1,4) =	'2818'
or substr(dx,1,4) =	'2819'
or substr(dx,1,4) =	'2810'
or substr(dx,1,4) =	'2821'
or substr(dx,1,4) =	'2822'
or substr(dx,1,4) =	'2823'
or substr(dx,1,5) =	'28241'
or substr(dx,1,5) =	'28242'
or substr(dx,1,5) =	'28243'
or substr(dx,1,5) =	'28244'
or substr(dx,1,5) =	'28245'
or substr(dx,1,5) =	'28246'
or substr(dx,1,5) =	'28247'
or substr(dx,1,5) =	'28249'
or substr(dx,1,5) =	'28240'
or substr(dx,1,4) =	'2825'
or substr(dx,1,5) =	'28261'
or substr(dx,1,5) =	'28262'
or substr(dx,1,5) =	'28263'
or substr(dx,1,5) =	'28264'
or substr(dx,1,5) =	'28268'
or substr(dx,1,5) =	'28269'
or substr(dx,1,5) =	'28260'
or substr(dx,1,4) =	'2827'
or substr(dx,1,4) =	'2828'
or substr(dx,1,4) =	'2829'
or substr(dx,1,4) =	'2820'
or substr(dx,1,5) =	'28311'
or substr(dx,1,5) =	'28319'
or substr(dx,1,4) =	'2831'
or substr(dx,1,4) =	'2832'
or substr(dx,1,4) =	'2839'
or substr(dx,1,4) =	'2830'
or substr(dx,1,5) =	'28401'
or substr(dx,1,5) =	'28409'
or substr(dx,1,5) =	'28411'
or substr(dx,1,5) =	'28412'
or substr(dx,1,5) =	'28419'
or substr(dx,1,4) =	'2842'
or substr(dx,1,5) =	'28481'
or substr(dx,1,5) =	'28489'
or substr(dx,1,4) =	'2849'
or substr(dx,1,4) =	'2851'
or substr(dx,1,5) =	'28521'
or substr(dx,1,5) =	'28522'
or substr(dx,1,5) =	'28529'
or substr(dx,1,4) =	'2853'
or substr(dx,1,4) =	'2858'
or substr(dx,1,4) =	'2859'
or substr(dx,1,4) =	'2850'
or substr(dx,1,4) =	'D500'
or substr(dx,1,4) =	'D501'
or substr(dx,1,4) =	'D508'
or substr(dx,1,4) =	'D509'
or substr(dx,1,4) =	'D510'
or substr(dx,1,4) =	'D511'
or substr(dx,1,4) =	'D512'
or substr(dx,1,4) =	'D513'
or substr(dx,1,4) =	'D518'
or substr(dx,1,4) =	'D519'
or substr(dx,1,4) =	'D520'
or substr(dx,1,4) =	'D521'
or substr(dx,1,4) =	'D528'
or substr(dx,1,4) =	'D529'
or substr(dx,1,4) =	'D530'
or substr(dx,1,4) =	'D531'
or substr(dx,1,4) =	'D532'
or substr(dx,1,4) =	'D538'
or substr(dx,1,4) =	'D539'
or substr(dx,1,4) =	'D550'
or substr(dx,1,4) =	'D551'
or substr(dx,1,4) =	'D552'
or substr(dx,1,4) =	'D553'
or substr(dx,1,4) =	'D558'
or substr(dx,1,4) =	'D559'
or substr(dx,1,4) =	'D560'
or substr(dx,1,4) =	'D561'
or substr(dx,1,4) =	'D562'
or substr(dx,1,4) =	'D563'
or substr(dx,1,4) =	'D564'
or substr(dx,1,4) =	'D565'
or substr(dx,1,4) =	'D568'
or substr(dx,1,4) =	'D569'
or substr(dx,1,5) =	'D5700'
or substr(dx,1,5) =	'D5701'
or substr(dx,1,5) =	'D5702'
or substr(dx,1,4) =	'D571'
or substr(dx,1,5) =	'D5720'
or substr(dx,1,6) =	'D57211'
or substr(dx,1,6) =	'D57212'
or substr(dx,1,6) =	'D57219'
or substr(dx,1,4) =	'D573'
or substr(dx,1,5) =	'D5740'
or substr(dx,1,6) =	'D57411'
or substr(dx,1,6) =	'D57412'
or substr(dx,1,6) =	'D57419'
or substr(dx,1,5) =	'D5780'
or substr(dx,1,6) =	'D57811'
or substr(dx,1,6) =	'D57812'
or substr(dx,1,6) =	'D57819'
or substr(dx,1,4) =	'D580'
or substr(dx,1,4) =	'D581'
or substr(dx,1,4) =	'D582'
or substr(dx,1,4) =	'D588'
or substr(dx,1,4) =	'D589'
or substr(dx,1,4) =	'D590'
or substr(dx,1,4) =	'D591'
or substr(dx,1,4) =	'D592'
or substr(dx,1,4) =	'D593'
or substr(dx,1,4) =	'D594'
or substr(dx,1,4) =	'D595'
or substr(dx,1,4) =	'D596'
or substr(dx,1,4) =	'D598'
or substr(dx,1,4) =	'D599'
or substr(dx,1,4) =	'D600'
or substr(dx,1,4) =	'D601'
or substr(dx,1,4) =	'D608'
or substr(dx,1,4) =	'D609'
or substr(dx,1,5) =	'D6101'
or substr(dx,1,5) =	'D6109'
or substr(dx,1,4) =	'D611'
or substr(dx,1,4) =	'D612'
or substr(dx,1,4) =	'D613'
or substr(dx,1,6) =	'D61810'
or substr(dx,1,6) =	'D61811'
or substr(dx,1,6) =	'D61818'
or substr(dx,1,5) =	'D6182'
or substr(dx,1,5) =	'D6189'
or substr(dx,1,4) =	'D619'
or substr(dx,1,3) =	'D62'
or substr(dx,1,4) =	'D630'
or substr(dx,1,4) =	'D631'
or substr(dx,1,4) =	'D638'
or substr(dx,1,4) =	'D640'
or substr(dx,1,4) =	'D641'
or substr(dx,1,4) =	'D642'
or substr(dx,1,4) =	'D643'
or substr(dx,1,4) =	'D644'
or substr(dx,1,5) =	'D6481'
or substr(dx,1,5) =	'D6489'
or substr(dx,1,4) =	'D649')
               and ccw_5=0
               then ccw_5=1;
   *Asthma ;
        if (substr(dx,1,5) =	'49301'
or substr(dx,1,5) =	'49302'
or substr(dx,1,5) =	'49311'
or substr(dx,1,5) =	'49312'
or substr(dx,1,5) =	'49310'
or substr(dx,1,5) =	'49321'
or substr(dx,1,5) =	'49322'
or substr(dx,1,5) =	'49320'
or substr(dx,1,5) =	'49381'
or substr(dx,1,5) =	'49382'
or substr(dx,1,5) =	'49391'
or substr(dx,1,5) =	'49392'
or substr(dx,1,5) =	'49390'
or substr(dx,1,5) =	'49300'
or substr(dx,1,5) =	'J4520'
or substr(dx,1,5) =	'J4521'
or substr(dx,1,5) =	'J4522'
or substr(dx,1,5) =	'J4530'
or substr(dx,1,5) =	'J4531'
or substr(dx,1,5) =	'J4532'
or substr(dx,1,5) =	'J4540'
or substr(dx,1,5) =	'J4541'
or substr(dx,1,5) =	'J4542'
or substr(dx,1,5) =	'J4550'
or substr(dx,1,5) =	'J4551'
or substr(dx,1,5) =	'J4552'
or substr(dx,1,6) =	'J45901'
or substr(dx,1,6) =	'J45902'
or substr(dx,1,6) =	'J45909'
or substr(dx,1,6) =	'J45990'
or substr(dx,1,6) =	'J45991'
or substr(dx,1,6) =	'J45998')
               and ccw_6=0
               then ccw_6=1;
*Atrial Fibrillation;
         if (substr(dx,1,5) =	'42731'
or substr(dx,1,4) =	'I480'
or substr(dx,1,4) =	'I481'
or substr(dx,1,4) =	'I482'
or substr(dx,1,5) =	'I4891')
               and ccw_7=0
               then ccw_7=1;
 *Benign Prostatic Hyperplasia;
         if (substr(dx,1,5) =	'60001'
or substr(dx,1,5) =	'60011'
or substr(dx,1,5) =	'60010'
or substr(dx,1,5) =	'60021'
or substr(dx,1,5) =	'60020'
or substr(dx,1,5) =	'60030'
or substr(dx,1,5) =	'60091'
or substr(dx,1,5) =	'60090'
or substr(dx,1,5) =	'60000'
or substr(dx,1,4) =	'N400'
or substr(dx,1,4) =	'N401'
or substr(dx,1,4) =	'N402'
or substr(dx,1,4) =	'N403'
or substr(dx,1,5) =	'N4283')
               and ccw_8=0
               then ccw_8=1;
*Cataract;
         if (substr(dx,1,5) =	'36601'
or substr(dx,1,5) =	'36602'
or substr(dx,1,5) =	'36603'
or substr(dx,1,5) =	'36604'
or substr(dx,1,5) =	'36609'
or substr(dx,1,5) =	'36612'
or substr(dx,1,5) =	'36613'
or substr(dx,1,5) =	'36614'
or substr(dx,1,5) =	'36615'
or substr(dx,1,5) =	'36616'
or substr(dx,1,5) =	'36617'
or substr(dx,1,5) =	'36618'
or substr(dx,1,5) =	'36619'
or substr(dx,1,5) =	'36610'
or substr(dx,1,5) =	'36621'
or substr(dx,1,5) =	'36622'
or substr(dx,1,5) =	'36623'
or substr(dx,1,5) =	'36620'
or substr(dx,1,5) =	'36630'
or substr(dx,1,5) =	'36645'
or substr(dx,1,5) =	'36646'
or substr(dx,1,5) =	'36651'
or substr(dx,1,5) =	'36652'
or substr(dx,1,5) =	'36653'
or substr(dx,1,5) =	'36650'
or substr(dx,1,4) =	'3668'
or substr(dx,1,4) =	'3669'
or substr(dx,1,5) =	'37926'
or substr(dx,1,5) =	'37931'
or substr(dx,1,5) =	'37939'
or substr(dx,1,5) =	'74331'
or substr(dx,1,5) =	'74332'
or substr(dx,1,5) =	'74333'
or substr(dx,1,4) =	'7433'
or substr(dx,1,4) =	'V431'
or substr(dx,1,6) =	'H25011'
or substr(dx,1,6) =	'H25012'
or substr(dx,1,6) =	'H25013'
or substr(dx,1,6) =	'H25019'
or substr(dx,1,6) =	'H25031'
or substr(dx,1,6) =	'H25032'
or substr(dx,1,6) =	'H25033'
or substr(dx,1,6) =	'H25039'
or substr(dx,1,6) =	'H25041'
or substr(dx,1,6) =	'H25042'
or substr(dx,1,6) =	'H25043'
or substr(dx,1,6) =	'H25049'
or substr(dx,1,6) =	'H25091'
or substr(dx,1,6) =	'H25092'
or substr(dx,1,6) =	'H25093'
or substr(dx,1,6) =	'H25099'
or substr(dx,1,5) =	'H2510'
or substr(dx,1,5) =	'H2511'
or substr(dx,1,5) =	'H2512'
or substr(dx,1,5) =	'H2513'
or substr(dx,1,5) =	'H2520'
or substr(dx,1,5) =	'H2521'
or substr(dx,1,5) =	'H2522'
or substr(dx,1,5) =	'H2523'
or substr(dx,1,6) =	'H25811'
or substr(dx,1,6) =	'H25812'
or substr(dx,1,6) =	'H25813'
or substr(dx,1,6) =	'H25819'
or substr(dx,1,5) =	'H2589'
or substr(dx,1,4) =	'H259'
or substr(dx,1,6) =	'H26011'
or substr(dx,1,6) =	'H26012'
or substr(dx,1,6) =	'H26013'
or substr(dx,1,6) =	'H26019'
or substr(dx,1,6) =	'H26031'
or substr(dx,1,6) =	'H26032'
or substr(dx,1,6) =	'H26033'
or substr(dx,1,6) =	'H26039'
or substr(dx,1,6) =	'H26041'
or substr(dx,1,6) =	'H26042'
or substr(dx,1,6) =	'H26043'
or substr(dx,1,6) =	'H26049'
or substr(dx,1,6) =	'H26051'
or substr(dx,1,6) =	'H26052'
or substr(dx,1,6) =	'H26053'
or substr(dx,1,6) =	'H26059'
or substr(dx,1,6) =	'H26061'
or substr(dx,1,6) =	'H26062'
or substr(dx,1,6) =	'H26063'
or substr(dx,1,6) =	'H26069'
or substr(dx,1,5) =	'H2609'
or substr(dx,1,6) =	'H26101'
or substr(dx,1,6) =	'H26102'
or substr(dx,1,6) =	'H26103'
or substr(dx,1,6) =	'H26109'
or substr(dx,1,6) =	'H26111'
or substr(dx,1,6) =	'H26112'
or substr(dx,1,6) =	'H26113'
or substr(dx,1,6) =	'H26119'
or substr(dx,1,6) =	'H26121'
or substr(dx,1,6) =	'H26122'
or substr(dx,1,6) =	'H26123'
or substr(dx,1,6) =	'H26129'
or substr(dx,1,6) =	'H26131'
or substr(dx,1,6) =	'H26132'
or substr(dx,1,6) =	'H26133'
or substr(dx,1,6) =	'H26139'
or substr(dx,1,5) =	'H2620'
or substr(dx,1,6) =	'H26211'
or substr(dx,1,6) =	'H26212'
or substr(dx,1,6) =	'H26213'
or substr(dx,1,6) =	'H26219'
or substr(dx,1,5) =	'H2630'
or substr(dx,1,5) =	'H2631'
or substr(dx,1,5) =	'H2632'
or substr(dx,1,5) =	'H2633'
or substr(dx,1,5) =	'H2640'
or substr(dx,1,6) =	'H26411'
or substr(dx,1,6) =	'H26412'
or substr(dx,1,6) =	'H26413'
or substr(dx,1,6) =	'H26419'
or substr(dx,1,6) =	'H26491'
or substr(dx,1,6) =	'H26492'
or substr(dx,1,6) =	'H26493'
or substr(dx,1,6) =	'H26499'
or substr(dx,1,4) =	'H268'
or substr(dx,1,4) =	'H269'
or substr(dx,1,4) =	'Q120'
or substr(dx,1,4) =	'Z961')
               and ccw_9=0
               then ccw_9=1;
*CKD ;
         if (substr(dx,1,5) =	'01601'
or substr(dx,1,5) =	'01602'
or substr(dx,1,5) =	'01603'
or substr(dx,1,5) =	'01604'
or substr(dx,1,5) =	'01605'
or substr(dx,1,5) =	'01606'
or substr(dx,1,5) =	'01600'
or substr(dx,1,4) =	'1899'
or substr(dx,1,4) =	'1890'
or substr(dx,1,4) =	'2230'
or substr(dx,1,5) =	'23691'
or substr(dx,1,5) =	'24941'
or substr(dx,1,5) =	'24940'
or substr(dx,1,5) =	'25041'
or substr(dx,1,5) =	'25042'
or substr(dx,1,5) =	'25043'
or substr(dx,1,5) =	'25040'
or substr(dx,1,4) =	'2714'
or substr(dx,1,5) =	'27410'
or substr(dx,1,5) =	'28311'
or substr(dx,1,5) =	'40301'
or substr(dx,1,5) =	'40311'
or substr(dx,1,5) =	'40391'
or substr(dx,1,5) =	'40402'
or substr(dx,1,5) =	'40403'
or substr(dx,1,5) =	'40412'
or substr(dx,1,5) =	'40413'
or substr(dx,1,5) =	'40492'
or substr(dx,1,5) =	'40493'
or substr(dx,1,4) =	'4401'
or substr(dx,1,4) =	'4421'
or substr(dx,1,4) =	'5724'
or substr(dx,1,4) =	'5804'
or substr(dx,1,5) =	'58081'
or substr(dx,1,5) =	'58089'
or substr(dx,1,4) =	'5809'
or substr(dx,1,4) =	'5800'
or substr(dx,1,4) =	'5811'
or substr(dx,1,4) =	'5812'
or substr(dx,1,4) =	'5813'
or substr(dx,1,5) =	'58181'
or substr(dx,1,5) =	'58189'
or substr(dx,1,4) =	'5819'
or substr(dx,1,4) =	'5810'
or substr(dx,1,4) =	'5821'
or substr(dx,1,4) =	'5822'
or substr(dx,1,4) =	'5824'
or substr(dx,1,5) =	'58281'
or substr(dx,1,5) =	'58289'
or substr(dx,1,4) =	'5829'
or substr(dx,1,4) =	'5820'
or substr(dx,1,4) =	'5831'
or substr(dx,1,4) =	'5832'
or substr(dx,1,4) =	'5834'
or substr(dx,1,4) =	'5836'
or substr(dx,1,4) =	'5837'
or substr(dx,1,5) =	'58381'
or substr(dx,1,5) =	'58389'
or substr(dx,1,4) =	'5839'
or substr(dx,1,4) =	'5830'
or substr(dx,1,4) =	'5845'
or substr(dx,1,4) =	'5846'
or substr(dx,1,4) =	'5847'
or substr(dx,1,4) =	'5848'
or substr(dx,1,4) =	'5849'
or substr(dx,1,4) =	'5851'
or substr(dx,1,4) =	'5852'
or substr(dx,1,4) =	'5853'
or substr(dx,1,4) =	'5854'
or substr(dx,1,4) =	'5855'
or substr(dx,1,4) =	'5856'
or substr(dx,1,4) =	'5859'
or substr(dx,1,3) =	'586'
or substr(dx,1,3) =	'587'
or substr(dx,1,4) =	'5881'
or substr(dx,1,5) =	'58881'
or substr(dx,1,5) =	'58889'
or substr(dx,1,4) =	'5889'
or substr(dx,1,4) =	'5880'
or substr(dx,1,3) =	'591'
or substr(dx,1,5) =	'75312'
or substr(dx,1,5) =	'75313'
or substr(dx,1,5) =	'75314'
or substr(dx,1,5) =	'75315'
or substr(dx,1,5) =	'75316'
or substr(dx,1,5) =	'75317'
or substr(dx,1,5) =	'75319'
or substr(dx,1,5) =	'75321'
or substr(dx,1,5) =	'75322'
or substr(dx,1,5) =	'75323'
or substr(dx,1,5) =	'75329'
or substr(dx,1,5) =	'75320'
or substr(dx,1,4) =	'7944'
or substr(dx,1,4) =	'0954'
or substr(dx,1,5) =	'A1811'
or substr(dx,1,5) =	'A5275'
or substr(dx,1,4) =	'B520'
or substr(dx,1,4) =	'C641'
or substr(dx,1,4) =	'C642'
or substr(dx,1,4) =	'C649'
or substr(dx,1,4) =	'C689'
or substr(dx,1,5) =	'D3000'
or substr(dx,1,5) =	'D3001'
or substr(dx,1,5) =	'D3002'
or substr(dx,1,5) =	'D4100'
or substr(dx,1,5) =	'D4101'
or substr(dx,1,5) =	'D4102'
or substr(dx,1,5) =	'D4110'
or substr(dx,1,5) =	'D4111'
or substr(dx,1,5) =	'D4112'
or substr(dx,1,5) =	'D4120'
or substr(dx,1,5) =	'D4121'
or substr(dx,1,5) =	'D4122'
or substr(dx,1,4) =	'D593'
or substr(dx,1,5) =	'E0821'
or substr(dx,1,5) =	'E0822'
or substr(dx,1,5) =	'E0829'
or substr(dx,1,5) =	'E0865'
or substr(dx,1,5) =	'E0921'
or substr(dx,1,5) =	'E0922'
or substr(dx,1,5) =	'E0929'
or substr(dx,1,5) =	'E1021'
or substr(dx,1,5) =	'E1022'
or substr(dx,1,5) =	'E1029'
or substr(dx,1,5) =	'E1065'
or substr(dx,1,5) =	'E1121'
or substr(dx,1,5) =	'E1122'
or substr(dx,1,5) =	'E1129'
or substr(dx,1,5) =	'E1165'
or substr(dx,1,5) =	'E1321'
or substr(dx,1,5) =	'E1322'
or substr(dx,1,5) =	'E1329'
or substr(dx,1,4) =	'E748'
or substr(dx,1,4) =	'I120'
or substr(dx,1,4) =	'I129'
or substr(dx,1,4) =	'I130'
or substr(dx,1,5) =	'I1310'
or substr(dx,1,5) =	'I1311'
or substr(dx,1,4) =	'I132'
or substr(dx,1,4) =	'I701'
or substr(dx,1,4) =	'I722'
or substr(dx,1,4) =	'K767'
or substr(dx,1,5) =	'M1030'
or substr(dx,1,6) =	'M10311'
or substr(dx,1,6) =	'M10312'
or substr(dx,1,6) =	'M10319'
or substr(dx,1,6) =	'M10321'
or substr(dx,1,6) =	'M10322'
or substr(dx,1,6) =	'M10329'
or substr(dx,1,6) =	'M10331'
or substr(dx,1,6) =	'M10332'
or substr(dx,1,6) =	'M10339'
or substr(dx,1,6) =	'M10341'
or substr(dx,1,6) =	'M10342'
or substr(dx,1,6) =	'M10349'
or substr(dx,1,6) =	'M10351'
or substr(dx,1,6) =	'M10352'
or substr(dx,1,6) =	'M10359'
or substr(dx,1,6) =	'M10361'
or substr(dx,1,6) =	'M10362'
or substr(dx,1,6) =	'M10369'
or substr(dx,1,6) =	'M10371'
or substr(dx,1,6) =	'M10372'
or substr(dx,1,6) =	'M10379'
or substr(dx,1,5) =	'M1038'
or substr(dx,1,5) =	'M1039'
or substr(dx,1,5) =	'M3214'
or substr(dx,1,5) =	'M3215'
or substr(dx,1,5) =	'M3504'
or substr(dx,1,4) =	'N000'
or substr(dx,1,4) =	'N001'
or substr(dx,1,4) =	'N002'
or substr(dx,1,4) =	'N003'
or substr(dx,1,4) =	'N004'
or substr(dx,1,4) =	'N005'
or substr(dx,1,4) =	'N006'
or substr(dx,1,4) =	'N007'
or substr(dx,1,4) =	'N008'
or substr(dx,1,4) =	'N009'
or substr(dx,1,4) =	'N010'
or substr(dx,1,4) =	'N011'
or substr(dx,1,4) =	'N012'
or substr(dx,1,4) =	'N013'
or substr(dx,1,4) =	'N014'
or substr(dx,1,4) =	'N015'
or substr(dx,1,4) =	'N016'
or substr(dx,1,4) =	'N017'
or substr(dx,1,4) =	'N018'
or substr(dx,1,4) =	'N019'
or substr(dx,1,4) =	'N020'
or substr(dx,1,4) =	'N021'
or substr(dx,1,4) =	'N022'
or substr(dx,1,4) =	'N023'
or substr(dx,1,4) =	'N024'
or substr(dx,1,4) =	'N025'
or substr(dx,1,4) =	'N026'
or substr(dx,1,4) =	'N027'
or substr(dx,1,4) =	'N028'
or substr(dx,1,4) =	'N029'
or substr(dx,1,4) =	'N030'
or substr(dx,1,4) =	'N031'
or substr(dx,1,4) =	'N032'
or substr(dx,1,4) =	'N033'
or substr(dx,1,4) =	'N034'
or substr(dx,1,4) =	'N035'
or substr(dx,1,4) =	'N036'
or substr(dx,1,4) =	'N037'
or substr(dx,1,4) =	'N038'
or substr(dx,1,4) =	'N039'
or substr(dx,1,4) =	'N040'
or substr(dx,1,4) =	'N041'
or substr(dx,1,4) =	'N042'
or substr(dx,1,4) =	'N043'
or substr(dx,1,4) =	'N044'
or substr(dx,1,4) =	'N045'
or substr(dx,1,4) =	'N046'
or substr(dx,1,4) =	'N047'
or substr(dx,1,4) =	'N048'
or substr(dx,1,4) =	'N049'
or substr(dx,1,4) =	'N050'
or substr(dx,1,4) =	'N051'
or substr(dx,1,4) =	'N052'
or substr(dx,1,4) =	'N053'
or substr(dx,1,4) =	'N054'
or substr(dx,1,4) =	'N055'
or substr(dx,1,4) =	'N056'
or substr(dx,1,4) =	'N057'
or substr(dx,1,4) =	'N058'
or substr(dx,1,4) =	'N059'
or substr(dx,1,4) =	'N060'
or substr(dx,1,4) =	'N061'
or substr(dx,1,4) =	'N062'
or substr(dx,1,4) =	'N063'
or substr(dx,1,4) =	'N064'
or substr(dx,1,4) =	'N065'
or substr(dx,1,4) =	'N066'
or substr(dx,1,4) =	'N067'
or substr(dx,1,4) =	'N068'
or substr(dx,1,4) =	'N069'
or substr(dx,1,4) =	'N070'
or substr(dx,1,4) =	'N071'
or substr(dx,1,4) =	'N072'
or substr(dx,1,4) =	'N073'
or substr(dx,1,4) =	'N074'
or substr(dx,1,4) =	'N075'
or substr(dx,1,4) =	'N076'
or substr(dx,1,4) =	'N077'
or substr(dx,1,4) =	'N078'
or substr(dx,1,4) =	'N079'
or substr(dx,1,3) =	'N08'
or substr(dx,1,4) =	'N131'
or substr(dx,1,4) =	'N132'
or substr(dx,1,5) =	'N1330'
or substr(dx,1,5) =	'N1339'
or substr(dx,1,4) =	'N140'
or substr(dx,1,4) =	'N141'
or substr(dx,1,4) =	'N142'
or substr(dx,1,4) =	'N143'
or substr(dx,1,4) =	'N144'
or substr(dx,1,4) =	'N150'
or substr(dx,1,4) =	'N158'
or substr(dx,1,4) =	'N159'
or substr(dx,1,3) =	'N16'
or substr(dx,1,4) =	'N170'
or substr(dx,1,4) =	'N171'
or substr(dx,1,4) =	'N172'
or substr(dx,1,4) =	'N178'
or substr(dx,1,4) =	'N179'
or substr(dx,1,4) =	'N181'
or substr(dx,1,4) =	'N182'
or substr(dx,1,4) =	'N183'
or substr(dx,1,4) =	'N184'
or substr(dx,1,4) =	'N185'
or substr(dx,1,4) =	'N186'
or substr(dx,1,4) =	'N189'
or substr(dx,1,3) =	'N19'
or substr(dx,1,4) =	'N250'
or substr(dx,1,4) =	'N251'
or substr(dx,1,5) =	'N2581'
or substr(dx,1,5) =	'N2589'
or substr(dx,1,4) =	'N259'
or substr(dx,1,4) =	'N261'
or substr(dx,1,4) =	'N269'
or substr(dx,1,5) =	'Q6102'
or substr(dx,1,5) =	'Q6111'
or substr(dx,1,5) =	'Q6119'
or substr(dx,1,4) =	'Q612'
or substr(dx,1,4) =	'Q613'
or substr(dx,1,4) =	'Q614'
or substr(dx,1,4) =	'Q615'
or substr(dx,1,4) =	'Q618'
or substr(dx,1,4) =	'Q620'
or substr(dx,1,5) =	'Q6210'
or substr(dx,1,5) =	'Q6211'
or substr(dx,1,5) =	'Q6212'
or substr(dx,1,4) =	'Q622'
or substr(dx,1,5) =	'Q6231'
or substr(dx,1,5) =	'Q6232'
or substr(dx,1,5) =	'Q6239'
or substr(dx,1,4) =	'R944')
               and ccw_10=0
               then ccw_10=1;
*COPD/Bronchitectasis;
	if (substr(dx,1,3) =	'490'
or substr(dx,1,4) =	'4911'
or substr(dx,1,5) =	'49121'
or substr(dx,1,5) =	'49122'
or substr(dx,1,4) =	'4912'
or substr(dx,1,4) =	'4918'
or substr(dx,1,4) =	'4919'
or substr(dx,1,4) =	'4910'
or substr(dx,1,4) =	'4928'
or substr(dx,1,4) =	'4920'
or substr(dx,1,4) =	'4941'
or substr(dx,1,4) =	'4940'
or substr(dx,1,3) =	'496'
or substr(dx,1,3) =	'J40'
or substr(dx,1,4) =	'J410'
or substr(dx,1,4) =	'J411'
or substr(dx,1,4) =	'J418'
or substr(dx,1,3) =	'J42'
or substr(dx,1,4) =	'J430'
or substr(dx,1,4) =	'J431'
or substr(dx,1,4) =	'J432'
or substr(dx,1,4) =	'J438'
or substr(dx,1,4) =	'J439'
or substr(dx,1,4) =	'J440'
or substr(dx,1,4) =	'J441'
or substr(dx,1,4) =	'J449'
or substr(dx,1,4) =	'J470'
or substr(dx,1,4) =	'J471'
or substr(dx,1,4) =	'J479')
		and ccw_11=0
                then ccw_11=1;
*Depression ;
	if (substr(dx,1,5) =	'29621'
or substr(dx,1,5) =	'29622'
or substr(dx,1,5) =	'29623'
or substr(dx,1,5) =	'29624'
or substr(dx,1,5) =	'29625'
or substr(dx,1,5) =	'29626'
or substr(dx,1,5) =	'29620'
or substr(dx,1,5) =	'29631'
or substr(dx,1,5) =	'29632'
or substr(dx,1,5) =	'29633'
or substr(dx,1,5) =	'29634'
or substr(dx,1,5) =	'29635'
or substr(dx,1,5) =	'29636'
or substr(dx,1,5) =	'29630'
or substr(dx,1,5) =	'29651'
or substr(dx,1,5) =	'29652'
or substr(dx,1,5) =	'29653'
or substr(dx,1,5) =	'29654'
or substr(dx,1,5) =	'29655'
or substr(dx,1,5) =	'29656'
or substr(dx,1,5) =	'29661'
or substr(dx,1,5) =	'29662'
or substr(dx,1,5) =	'29663'
or substr(dx,1,5) =	'29664'
or substr(dx,1,5) =	'29665'
or substr(dx,1,5) =	'29666'
or substr(dx,1,5) =	'29660'
or substr(dx,1,5) =	'29689'
or substr(dx,1,4) =	'2980'
or substr(dx,1,4) =	'3004'
or substr(dx,1,4) =	'3091'
or substr(dx,1,3) =	'311'
or substr(dx,1,5) =	'F3130'
or substr(dx,1,5) =	'F3131'
or substr(dx,1,5) =	'F3132'
or substr(dx,1,4) =	'F314'
or substr(dx,1,4) =	'F315'
or substr(dx,1,5) =	'F3160'
or substr(dx,1,5) =	'F3161'
or substr(dx,1,5) =	'F3162'
or substr(dx,1,5) =	'F3163'
or substr(dx,1,5) =	'F3164'
or substr(dx,1,5) =	'F3175'
or substr(dx,1,5) =	'F3176'
or substr(dx,1,5) =	'F3177'
or substr(dx,1,5) =	'F3178'
or substr(dx,1,5) =	'F3181'
or substr(dx,1,4) =	'F320'
or substr(dx,1,4) =	'F321'
or substr(dx,1,4) =	'F322'
or substr(dx,1,4) =	'F323'
or substr(dx,1,4) =	'F324'
or substr(dx,1,4) =	'F325'
or substr(dx,1,4) =	'F329'
or substr(dx,1,4) =	'F330'
or substr(dx,1,4) =	'F331'
or substr(dx,1,4) =	'F332'
or substr(dx,1,4) =	'F333'
or substr(dx,1,5) =	'F3340'
or substr(dx,1,5) =	'F3341'
or substr(dx,1,5) =	'F3342'
or substr(dx,1,4) =	'F338'
or substr(dx,1,4) =	'F339'
or substr(dx,1,4) =	'F341'
or substr(dx,1,5) =	'F4321'
or substr(dx,1,5) =	'F4323'
)
		and ccw_12=0
                then ccw_12=1;
* Diabetes;
	if (substr(dx,1,5) =	'24901'
or substr(dx,1,5) =	'24911'
or substr(dx,1,5) =	'24910'
or substr(dx,1,5) =	'24921'
or substr(dx,1,5) =	'24920'
or substr(dx,1,5) =	'24931'
or substr(dx,1,5) =	'24930'
or substr(dx,1,5) =	'24941'
or substr(dx,1,5) =	'24940'
or substr(dx,1,5) =	'24951'
or substr(dx,1,5) =	'24950'
or substr(dx,1,5) =	'24961'
or substr(dx,1,5) =	'24960'
or substr(dx,1,5) =	'24971'
or substr(dx,1,5) =	'24970'
or substr(dx,1,5) =	'24981'
or substr(dx,1,5) =	'24980'
or substr(dx,1,5) =	'24991'
or substr(dx,1,5) =	'24990'
or substr(dx,1,5) =	'24900'
or substr(dx,1,5) =	'25001'
or substr(dx,1,5) =	'25002'
or substr(dx,1,5) =	'25003'
or substr(dx,1,5) =	'25011'
or substr(dx,1,5) =	'25012'
or substr(dx,1,5) =	'25013'
or substr(dx,1,5) =	'25010'
or substr(dx,1,5) =	'25021'
or substr(dx,1,5) =	'25022'
or substr(dx,1,5) =	'25023'
or substr(dx,1,5) =	'25020'
or substr(dx,1,5) =	'25031'
or substr(dx,1,5) =	'25032'
or substr(dx,1,5) =	'25033'
or substr(dx,1,5) =	'25030'
or substr(dx,1,5) =	'25041'
or substr(dx,1,5) =	'25042'
or substr(dx,1,5) =	'25043'
or substr(dx,1,5) =	'25040'
or substr(dx,1,5) =	'25051'
or substr(dx,1,5) =	'25052'
or substr(dx,1,5) =	'25053'
or substr(dx,1,5) =	'25050'
or substr(dx,1,5) =	'25061'
or substr(dx,1,5) =	'25062'
or substr(dx,1,5) =	'25063'
or substr(dx,1,5) =	'25060'
or substr(dx,1,5) =	'25071'
or substr(dx,1,5) =	'25072'
or substr(dx,1,5) =	'25073'
or substr(dx,1,5) =	'25070'
or substr(dx,1,5) =	'25081'
or substr(dx,1,5) =	'25082'
or substr(dx,1,5) =	'25083'
or substr(dx,1,5) =	'25080'
or substr(dx,1,5) =	'25091'
or substr(dx,1,5) =	'25092'
or substr(dx,1,5) =	'25093'
or substr(dx,1,5) =	'25090'
or substr(dx,1,5) =	'25000'
or substr(dx,1,4) =	'3572'
or substr(dx,1,5) =	'36201'
or substr(dx,1,5) =	'36202'
or substr(dx,1,5) =	'36203'
or substr(dx,1,5) =	'36204'
or substr(dx,1,5) =	'36205'
or substr(dx,1,5) =	'36206'
or substr(dx,1,5) =	'36641'
or substr(dx,1,5) =	'E0800'
or substr(dx,1,5) =	'E0801'
or substr(dx,1,5) =	'E0810'
or substr(dx,1,5) =	'E0811'
or substr(dx,1,5) =	'E0821'
or substr(dx,1,5) =	'E0822'
or substr(dx,1,5) =	'E0829'
or substr(dx,1,6) =	'E08311'
or substr(dx,1,6) =	'E08319'
or substr(dx,1,7) =	'E083211'
or substr(dx,1,7) =	'E083212'
or substr(dx,1,7) =	'E083213'
or substr(dx,1,7) =	'E083219'
or substr(dx,1,6) =	'E08321'
or substr(dx,1,7) =	'E083291'
or substr(dx,1,7) =	'E083292'
or substr(dx,1,7) =	'E083293'
or substr(dx,1,7) =	'E083299'
or substr(dx,1,6) =	'E08329'
or substr(dx,1,7) =	'E083311'
or substr(dx,1,7) =	'E083312'
or substr(dx,1,7) =	'E083313'
or substr(dx,1,7) =	'E083319'
or substr(dx,1,6) =	'E08331'
or substr(dx,1,7) =	'E083391'
or substr(dx,1,7) =	'E083392'
or substr(dx,1,7) =	'E083393'
or substr(dx,1,7) =	'E083399'
or substr(dx,1,6) =	'E08339'
or substr(dx,1,7) =	'E083411'
or substr(dx,1,7) =	'E083412'
or substr(dx,1,7) =	'E083413'
or substr(dx,1,7) =	'E083419'
or substr(dx,1,6) =	'E08341'
or substr(dx,1,7) =	'E083491'
or substr(dx,1,7) =	'E083492'
or substr(dx,1,7) =	'E083493'
or substr(dx,1,7) =	'E083499'
or substr(dx,1,6) =	'E08349'
or substr(dx,1,7) =	'E083511'
or substr(dx,1,7) =	'E083512'
or substr(dx,1,7) =	'E083513'
or substr(dx,1,7) =	'E083519'
or substr(dx,1,6) =	'E08351'
or substr(dx,1,7) =	'E083521'
or substr(dx,1,7) =	'E083522'
or substr(dx,1,7) =	'E083523'
or substr(dx,1,7) =	'E083529'
or substr(dx,1,7) =	'E083531'
or substr(dx,1,7) =	'E083532'
or substr(dx,1,7) =	'E083533'
or substr(dx,1,7) =	'E083539'
or substr(dx,1,7) =	'E083541'
or substr(dx,1,7) =	'E083542'
or substr(dx,1,7) =	'E083543'
or substr(dx,1,7) =	'E083549'
or substr(dx,1,7) =	'E083551'
or substr(dx,1,7) =	'E083552'
or substr(dx,1,7) =	'E083553'
or substr(dx,1,7) =	'E083559'
or substr(dx,1,7) =	'E083591'
or substr(dx,1,7) =	'E083592'
or substr(dx,1,7) =	'E083593'
or substr(dx,1,7) =	'E083599'
or substr(dx,1,6) =	'E08359'
or substr(dx,1,5) =	'E0836'
or substr(dx,1,7) =	'E0837X1'
or substr(dx,1,7) =	'E0837X2'
or substr(dx,1,7) =	'E0837X3'
or substr(dx,1,7) =	'E0837X9'
or substr(dx,1,5) =	'E0839'
or substr(dx,1,5) =	'E0840'
or substr(dx,1,5) =	'E0841'
or substr(dx,1,5) =	'E0842'
or substr(dx,1,5) =	'E0843'
or substr(dx,1,5) =	'E0844'
or substr(dx,1,5) =	'E0849'
or substr(dx,1,5) =	'E0851'
or substr(dx,1,5) =	'E0852'
or substr(dx,1,5) =	'E0859'
or substr(dx,1,6) =	'E08610'
or substr(dx,1,6) =	'E08618'
or substr(dx,1,6) =	'E08620'
or substr(dx,1,6) =	'E08621'
or substr(dx,1,6) =	'E08622'
or substr(dx,1,6) =	'E08628'
or substr(dx,1,6) =	'E08630'
or substr(dx,1,6) =	'E08638'
or substr(dx,1,6) =	'E08641'
or substr(dx,1,6) =	'E08649'
or substr(dx,1,5) =	'E0865'
or substr(dx,1,5) =	'E0869'
or substr(dx,1,4) =	'E088'
or substr(dx,1,4) =	'E089'
or substr(dx,1,5) =	'E0900'
or substr(dx,1,5) =	'E0901'
or substr(dx,1,5) =	'E0910'
or substr(dx,1,5) =	'E0911'
or substr(dx,1,5) =	'E0921'
or substr(dx,1,5) =	'E0922'
or substr(dx,1,5) =	'E0929'
or substr(dx,1,6) =	'E09311'
or substr(dx,1,6) =	'E09319'
or substr(dx,1,7) =	'E093211'
or substr(dx,1,7) =	'E093212'
or substr(dx,1,7) =	'E093213'
or substr(dx,1,7) =	'E093219'
or substr(dx,1,6) =	'E09321'
or substr(dx,1,7) =	'E093291'
or substr(dx,1,7) =	'E093292'
or substr(dx,1,7) =	'E093293'
or substr(dx,1,7) =	'E093299'
or substr(dx,1,6) =	'E09329'
or substr(dx,1,7) =	'E093311'
or substr(dx,1,7) =	'E093312'
or substr(dx,1,7) =	'E093313'
or substr(dx,1,7) =	'E093319'
or substr(dx,1,6) =	'E09331'
or substr(dx,1,7) =	'E093391'
or substr(dx,1,7) =	'E093392'
or substr(dx,1,7) =	'E093393'
or substr(dx,1,7) =	'E093399'
or substr(dx,1,6) =	'E09339'
or substr(dx,1,7) =	'E093411'
or substr(dx,1,7) =	'E093412'
or substr(dx,1,7) =	'E093413'
or substr(dx,1,7) =	'E093419'
or substr(dx,1,6) =	'E09341'
or substr(dx,1,7) =	'E093491'
or substr(dx,1,7) =	'E093492'
or substr(dx,1,7) =	'E093493'
or substr(dx,1,7) =	'E093499'
or substr(dx,1,6) =	'E09349'
or substr(dx,1,7) =	'E093511'
or substr(dx,1,7) =	'E093512'
or substr(dx,1,7) =	'E093513'
or substr(dx,1,7) =	'E093519'
or substr(dx,1,6) =	'E09351'
or substr(dx,1,7) =	'E093521'
or substr(dx,1,7) =	'E093522'
or substr(dx,1,7) =	'E093523'
or substr(dx,1,7) =	'E093529'
or substr(dx,1,7) =	'E093531'
or substr(dx,1,7) =	'E093532'
or substr(dx,1,7) =	'E093533'
or substr(dx,1,7) =	'E093539'
or substr(dx,1,7) =	'E093541'
or substr(dx,1,7) =	'E093542'
or substr(dx,1,7) =	'E093543'
or substr(dx,1,7) =	'E093549'
or substr(dx,1,7) =	'E093551'
or substr(dx,1,7) =	'E093552'
or substr(dx,1,7) =	'E093553'
or substr(dx,1,7) =	'E093559'
or substr(dx,1,7) =	'E093591'
or substr(dx,1,7) =	'E093592'
or substr(dx,1,7) =	'E093593'
or substr(dx,1,7) =	'E093599'
or substr(dx,1,6) =	'E09359'
or substr(dx,1,5) =	'E0936'
or substr(dx,1,7) =	'E0937X1'
or substr(dx,1,7) =	'E0937X2'
or substr(dx,1,7) =	'E0937X3'
or substr(dx,1,7) =	'E0937X9'
or substr(dx,1,5) =	'E0939'
or substr(dx,1,5) =	'E0940'
or substr(dx,1,5) =	'E0941'
or substr(dx,1,5) =	'E0942'
or substr(dx,1,5) =	'E0943'
or substr(dx,1,5) =	'E0944'
or substr(dx,1,5) =	'E0949'
or substr(dx,1,5) =	'E0951'
or substr(dx,1,5) =	'E0952'
or substr(dx,1,5) =	'E0959'
or substr(dx,1,6) =	'E09610'
or substr(dx,1,6) =	'E09618'
or substr(dx,1,6) =	'E09620'
or substr(dx,1,6) =	'E09621'
or substr(dx,1,6) =	'E09622'
or substr(dx,1,6) =	'E09628'
or substr(dx,1,6) =	'E09630'
or substr(dx,1,6) =	'E09638'
or substr(dx,1,6) =	'E09641'
or substr(dx,1,6) =	'E09649'
or substr(dx,1,5) =	'E0965'
or substr(dx,1,5) =	'E0969'
or substr(dx,1,4) =	'E098'
or substr(dx,1,4) =	'E099'
or substr(dx,1,5) =	'E1010'
or substr(dx,1,5) =	'E1011'
or substr(dx,1,5) =	'E1021'
or substr(dx,1,5) =	'E1022'
or substr(dx,1,5) =	'E1029'
or substr(dx,1,6) =	'E10311'
or substr(dx,1,6) =	'E10319'
or substr(dx,1,7) =	'E103211'
or substr(dx,1,7) =	'E103212'
or substr(dx,1,7) =	'E103213'
or substr(dx,1,7) =	'E103219'
or substr(dx,1,6) =	'E10321'
or substr(dx,1,7) =	'E103291'
or substr(dx,1,7) =	'E103292'
or substr(dx,1,7) =	'E103293'
or substr(dx,1,7) =	'E103299'
or substr(dx,1,6) =	'E10329'
or substr(dx,1,7) =	'E103311'
or substr(dx,1,7) =	'E103312'
or substr(dx,1,7) =	'E103313'
or substr(dx,1,7) =	'E103319'
or substr(dx,1,6) =	'E10331'
or substr(dx,1,7) =	'E103391'
or substr(dx,1,7) =	'E103392'
or substr(dx,1,7) =	'E103393'
or substr(dx,1,7) =	'E103399'
or substr(dx,1,6) =	'E10339'
or substr(dx,1,7) =	'E103411'
or substr(dx,1,7) =	'E103412'
or substr(dx,1,7) =	'E103413'
or substr(dx,1,7) =	'E103419'
or substr(dx,1,6) =	'E10341'
or substr(dx,1,7) =	'E103491'
or substr(dx,1,7) =	'E103492'
or substr(dx,1,7) =	'E103493'
or substr(dx,1,7) =	'E103499'
or substr(dx,1,6) =	'E10349'
or substr(dx,1,7) =	'E103511'
or substr(dx,1,7) =	'E103512'
or substr(dx,1,7) =	'E103513'
or substr(dx,1,7) =	'E103519'
or substr(dx,1,6) =	'E10351'
or substr(dx,1,6) =	'E10359'
or substr(dx,1,5) =	'E1036'
or substr(dx,1,7) =	'E1037X1'
or substr(dx,1,7) =	'E1037X2'
or substr(dx,1,7) =	'E1037X3'
or substr(dx,1,7) =	'E1037X9'
or substr(dx,1,5) =	'E1039'
or substr(dx,1,5) =	'E1040'
or substr(dx,1,5) =	'E1041'
or substr(dx,1,5) =	'E1042'
or substr(dx,1,5) =	'E1043'
or substr(dx,1,5) =	'E1044'
or substr(dx,1,5) =	'E1049'
or substr(dx,1,5) =	'E1051'
or substr(dx,1,5) =	'E1052'
or substr(dx,1,5) =	'E1059'
or substr(dx,1,6) =	'E10610'
or substr(dx,1,6) =	'E10618'
or substr(dx,1,6) =	'E10620'
or substr(dx,1,6) =	'E10621'
or substr(dx,1,6) =	'E10622'
or substr(dx,1,6) =	'E10628'
or substr(dx,1,6) =	'E10630'
or substr(dx,1,6) =	'E10638'
or substr(dx,1,6) =	'E10641'
or substr(dx,1,6) =	'E10649'
or substr(dx,1,5) =	'E1065'
or substr(dx,1,5) =	'E1069'
or substr(dx,1,4) =	'E108'
or substr(dx,1,4) =	'E109'
or substr(dx,1,5) =	'E1100'
or substr(dx,1,5) =	'E1101'
or substr(dx,1,5) =	'E1110'
or substr(dx,1,5) =	'E1111'
or substr(dx,1,5) =	'E1121'
or substr(dx,1,5) =	'E1122'
or substr(dx,1,5) =	'E1129'
or substr(dx,1,6) =	'E11311'
or substr(dx,1,6) =	'E11319'
or substr(dx,1,7) =	'E113211'
or substr(dx,1,7) =	'E113212'
or substr(dx,1,7) =	'E113213'
or substr(dx,1,7) =	'E113219'
or substr(dx,1,6) =	'E11321'
or substr(dx,1,7) =	'E113291'
or substr(dx,1,7) =	'E113292'
or substr(dx,1,7) =	'E113293'
or substr(dx,1,7) =	'E113299'
or substr(dx,1,6) =	'E11329'
or substr(dx,1,7) =	'E113311'
or substr(dx,1,7) =	'E113312'
or substr(dx,1,7) =	'E113313'
or substr(dx,1,7) =	'E113319'
or substr(dx,1,6) =	'E11331'
or substr(dx,1,7) =	'E113391'
or substr(dx,1,7) =	'E113392'
or substr(dx,1,7) =	'E113393'
or substr(dx,1,7) =	'E113399'
or substr(dx,1,6) =	'E11339'
or substr(dx,1,7) =	'E113411'
or substr(dx,1,7) =	'E113412'
or substr(dx,1,7) =	'E113413'
or substr(dx,1,7) =	'E113419'
or substr(dx,1,6) =	'E11341'
or substr(dx,1,7) =	'E113491'
or substr(dx,1,7) =	'E113492'
or substr(dx,1,7) =	'E113493'
or substr(dx,1,7) =	'E113499'
or substr(dx,1,6) =	'E11349'
or substr(dx,1,7) =	'E113511'
or substr(dx,1,7) =	'E113512'
or substr(dx,1,7) =	'E113513'
or substr(dx,1,7) =	'E113519'
or substr(dx,1,6) =	'E11351'
or substr(dx,1,7) =	'E113521'
or substr(dx,1,7) =	'E113522'
or substr(dx,1,7) =	'E113523'
or substr(dx,1,7) =	'E113529'
or substr(dx,1,7) =	'E113531'
or substr(dx,1,7) =	'E113532'
or substr(dx,1,7) =	'E113533'
or substr(dx,1,7) =	'E113539'
or substr(dx,1,7) =	'E113541'
or substr(dx,1,7) =	'E113542'
or substr(dx,1,7) =	'E113543'
or substr(dx,1,7) =	'E113549'
or substr(dx,1,7) =	'E113551'
or substr(dx,1,7) =	'E113552'
or substr(dx,1,7) =	'E113553'
or substr(dx,1,7) =	'E113559'
or substr(dx,1,7) =	'E113591'
or substr(dx,1,7) =	'E113592'
or substr(dx,1,7) =	'E113593'
or substr(dx,1,7) =	'E113599'
or substr(dx,1,6) =	'E11359'
or substr(dx,1,5) =	'E1136'
or substr(dx,1,7) =	'E1137X1'
or substr(dx,1,7) =	'E1137X2'
or substr(dx,1,7) =	'E1137X3'
or substr(dx,1,7) =	'E1137X9'
or substr(dx,1,5) =	'E1139'
or substr(dx,1,5) =	'E1140'
or substr(dx,1,5) =	'E1141'
or substr(dx,1,5) =	'E1142'
or substr(dx,1,5) =	'E1143'
or substr(dx,1,5) =	'E1144'
or substr(dx,1,5) =	'E1149'
or substr(dx,1,5) =	'E1151'
or substr(dx,1,5) =	'E1152'
or substr(dx,1,5) =	'E1159'
or substr(dx,1,6) =	'E11610'
or substr(dx,1,6) =	'E11618'
or substr(dx,1,6) =	'E11620'
or substr(dx,1,6) =	'E11621'
or substr(dx,1,6) =	'E11622'
or substr(dx,1,6) =	'E11628'
or substr(dx,1,6) =	'E11630'
or substr(dx,1,6) =	'E11638'
or substr(dx,1,6) =	'E11641'
or substr(dx,1,6) =	'E11649'
or substr(dx,1,5) =	'E1165'
or substr(dx,1,5) =	'E1169'
or substr(dx,1,4) =	'E118'
or substr(dx,1,4) =	'E119'
or substr(dx,1,5) =	'E1300'
or substr(dx,1,5) =	'E1301'
or substr(dx,1,5) =	'E1310'
or substr(dx,1,5) =	'E1311'
or substr(dx,1,5) =	'E1321'
or substr(dx,1,5) =	'E1322'
or substr(dx,1,5) =	'E1329'
or substr(dx,1,6) =	'E13311'
or substr(dx,1,6) =	'E13319'
or substr(dx,1,7) =	'E133211'
or substr(dx,1,7) =	'E133212'
or substr(dx,1,7) =	'E133213'
or substr(dx,1,7) =	'E133219'
or substr(dx,1,6) =	'E13321'
or substr(dx,1,7) =	'E133291'
or substr(dx,1,7) =	'E133292'
or substr(dx,1,7) =	'E133293'
or substr(dx,1,7) =	'E133299'
or substr(dx,1,6) =	'E13329'
or substr(dx,1,7) =	'E133311'
or substr(dx,1,7) =	'E133312'
or substr(dx,1,7) =	'E133313'
or substr(dx,1,7) =	'E133319'
or substr(dx,1,6) =	'E13331'
or substr(dx,1,7) =	'E133391'
or substr(dx,1,7) =	'E133392'
or substr(dx,1,7) =	'E133393'
or substr(dx,1,7) =	'E133399'
or substr(dx,1,6) =	'E13339'
or substr(dx,1,7) =	'E133411'
or substr(dx,1,7) =	'E133412'
or substr(dx,1,7) =	'E133413'
or substr(dx,1,7) =	'E133419'
or substr(dx,1,6) =	'E13341'
or substr(dx,1,7) =	'E133491'
or substr(dx,1,7) =	'E133492'
or substr(dx,1,7) =	'E133493'
or substr(dx,1,7) =	'E133499'
or substr(dx,1,6) =	'E13349'
or substr(dx,1,7) =	'E133511'
or substr(dx,1,7) =	'E133512'
or substr(dx,1,7) =	'E133513'
or substr(dx,1,7) =	'E133519'
or substr(dx,1,6) =	'E13351'
or substr(dx,1,7) =	'E133521'
or substr(dx,1,7) =	'E133522'
or substr(dx,1,7) =	'E133523'
or substr(dx,1,7) =	'E133529'
or substr(dx,1,7) =	'E133531'
or substr(dx,1,7) =	'E133532'
or substr(dx,1,7) =	'E133533'
or substr(dx,1,7) =	'E133539'
or substr(dx,1,7) =	'E133541'
or substr(dx,1,7) =	'E133542'
or substr(dx,1,7) =	'E133543'
or substr(dx,1,7) =	'E133549'
or substr(dx,1,7) =	'E133551'
or substr(dx,1,7) =	'E133552'
or substr(dx,1,7) =	'E133553'
or substr(dx,1,7) =	'E133559'
or substr(dx,1,6) =	'E13359'
or substr(dx,1,5) =	'E1336'
or substr(dx,1,5) =	'E1339'
or substr(dx,1,5) =	'E1340'
or substr(dx,1,5) =	'E1341'
or substr(dx,1,5) =	'E1342'
or substr(dx,1,5) =	'E1343'
or substr(dx,1,5) =	'E1344'
or substr(dx,1,5) =	'E1349'
or substr(dx,1,5) =	'E1351'
or substr(dx,1,5) =	'E1352'
or substr(dx,1,5) =	'E1359'
or substr(dx,1,6) =	'E13610'
or substr(dx,1,6) =	'E13618'
or substr(dx,1,6) =	'E13620'
or substr(dx,1,6) =	'E13621'
or substr(dx,1,6) =	'E13622'
or substr(dx,1,6) =	'E13628'
or substr(dx,1,6) =	'E13630'
or substr(dx,1,6) =	'E13638'
or substr(dx,1,6) =	'E13641'
or substr(dx,1,6) =	'E13649'
or substr(dx,1,5) =	'E1365'
or substr(dx,1,5) =	'E1369'
or substr(dx,1,4) =	'E138'
or substr(dx,1,4) =	'E139')
		and ccw_13=0
                then ccw_13=1;
*Glaucoma ;
	if (substr(dx,1,5) =	'36285'
or substr(dx,1,5) =	'36501'
or substr(dx,1,5) =	'36502'
or substr(dx,1,5) =	'36503'
or substr(dx,1,5) =	'36504'
or substr(dx,1,5) =	'36511'
or substr(dx,1,5) =	'36512'
or substr(dx,1,5) =	'36513'
or substr(dx,1,5) =	'36515'
or substr(dx,1,5) =	'36510'
or substr(dx,1,5) =	'36521'
or substr(dx,1,5) =	'36522'
or substr(dx,1,5) =	'36523'
or substr(dx,1,5) =	'36524'
or substr(dx,1,5) =	'36520'
or substr(dx,1,5) =	'36531'
or substr(dx,1,5) =	'36532'
or substr(dx,1,5) =	'36541'
or substr(dx,1,5) =	'36542'
or substr(dx,1,5) =	'36543'
or substr(dx,1,5) =	'36551'
or substr(dx,1,5) =	'36552'
or substr(dx,1,5) =	'36559'
or substr(dx,1,5) =	'36561'
or substr(dx,1,5) =	'36562'
or substr(dx,1,5) =	'36563'
or substr(dx,1,5) =	'36564'
or substr(dx,1,5) =	'36565'
or substr(dx,1,5) =	'36560'
or substr(dx,1,5) =	'36581'
or substr(dx,1,5) =	'36582'
or substr(dx,1,5) =	'36583'
or substr(dx,1,5) =	'36589'
or substr(dx,1,4) =	'3659'
or substr(dx,1,5) =	'36500'
or substr(dx,1,5) =	'37714'
or substr(dx,1,6) =	'H40001'
or substr(dx,1,6) =	'H40002'
or substr(dx,1,6) =	'H40003'
or substr(dx,1,6) =	'H40009'
or substr(dx,1,6) =	'H40011'
or substr(dx,1,6) =	'H40012'
or substr(dx,1,6) =	'H40013'
or substr(dx,1,6) =	'H40019'
or substr(dx,1,6) =	'H40031'
or substr(dx,1,6) =	'H40032'
or substr(dx,1,6) =	'H40033'
or substr(dx,1,6) =	'H40039'
or substr(dx,1,6) =	'H40041'
or substr(dx,1,6) =	'H40042'
or substr(dx,1,6) =	'H40043'
or substr(dx,1,6) =	'H40049'
or substr(dx,1,6) =	'H40051'
or substr(dx,1,6) =	'H40052'
or substr(dx,1,6) =	'H40053'
or substr(dx,1,6) =	'H40059'
or substr(dx,1,7) =	'H4010X0'
or substr(dx,1,7) =	'H4010X1'
or substr(dx,1,7) =	'H4010X2'
or substr(dx,1,7) =	'H4010X3'
or substr(dx,1,7) =	'H4010X4'
or substr(dx,1,7) =	'H401110'
or substr(dx,1,7) =	'H401111'
or substr(dx,1,7) =	'H401112'
or substr(dx,1,7) =	'H401113'
or substr(dx,1,7) =	'H401114'
or substr(dx,1,7) =	'H401120'
or substr(dx,1,7) =	'H401121'
or substr(dx,1,7) =	'H401122'
or substr(dx,1,7) =	'H401123'
or substr(dx,1,7) =	'H401124'
or substr(dx,1,7) =	'H401130'
or substr(dx,1,7) =	'H401131'
or substr(dx,1,7) =	'H401132'
or substr(dx,1,7) =	'H401133'
or substr(dx,1,7) =	'H401134'
or substr(dx,1,7) =	'H401190'
or substr(dx,1,7) =	'H401191'
or substr(dx,1,7) =	'H401192'
or substr(dx,1,7) =	'H401193'
or substr(dx,1,7) =	'H401194'
or substr(dx,1,7) =	'H4011X0'
or substr(dx,1,7) =	'H4011X1'
or substr(dx,1,7) =	'H4011X2'
or substr(dx,1,7) =	'H4011X3'
or substr(dx,1,7) =	'H4011X4'
or substr(dx,1,7) =	'H401210'
or substr(dx,1,7) =	'H401211'
or substr(dx,1,7) =	'H401212'
or substr(dx,1,7) =	'H401213'
or substr(dx,1,7) =	'H401214'
or substr(dx,1,7) =	'H401220'
or substr(dx,1,7) =	'H401221'
or substr(dx,1,7) =	'H401222'
or substr(dx,1,7) =	'H401223'
or substr(dx,1,7) =	'H401224'
or substr(dx,1,7) =	'H401230'
or substr(dx,1,7) =	'H401231'
or substr(dx,1,7) =	'H401232'
or substr(dx,1,7) =	'H401233'
or substr(dx,1,7) =	'H401234'
or substr(dx,1,7) =	'H401290'
or substr(dx,1,7) =	'H401291'
or substr(dx,1,7) =	'H401292'
or substr(dx,1,7) =	'H401293'
or substr(dx,1,7) =	'H401294'
or substr(dx,1,7) =	'H401310'
or substr(dx,1,7) =	'H401311'
or substr(dx,1,7) =	'H401312'
or substr(dx,1,7) =	'H401313'
or substr(dx,1,7) =	'H401314'
or substr(dx,1,7) =	'H401320'
or substr(dx,1,7) =	'H401321'
or substr(dx,1,7) =	'H401322'
or substr(dx,1,7) =	'H401323'
or substr(dx,1,7) =	'H401324'
or substr(dx,1,7) =	'H401330'
or substr(dx,1,7) =	'H401331'
or substr(dx,1,7) =	'H401332'
or substr(dx,1,7) =	'H401333'
or substr(dx,1,7) =	'H401334'
or substr(dx,1,7) =	'H401390'
or substr(dx,1,7) =	'H401391'
or substr(dx,1,7) =	'H401392'
or substr(dx,1,7) =	'H401393'
or substr(dx,1,7) =	'H401394'
or substr(dx,1,7) =	'H401410'
or substr(dx,1,7) =	'H401411'
or substr(dx,1,7) =	'H401412'
or substr(dx,1,7) =	'H401413'
or substr(dx,1,7) =	'H401414'
or substr(dx,1,7) =	'H401420'
or substr(dx,1,7) =	'H401421'
or substr(dx,1,7) =	'H401422'
or substr(dx,1,7) =	'H401423'
or substr(dx,1,7) =	'H401424'
or substr(dx,1,7) =	'H401430'
or substr(dx,1,7) =	'H401431'
or substr(dx,1,7) =	'H401432'
or substr(dx,1,7) =	'H401433'
or substr(dx,1,7) =	'H401434'
or substr(dx,1,7) =	'H401490'
or substr(dx,1,7) =	'H401491'
or substr(dx,1,7) =	'H401492'
or substr(dx,1,7) =	'H401493'
or substr(dx,1,7) =	'H401494'
or substr(dx,1,6) =	'H40151'
or substr(dx,1,6) =	'H40152'
or substr(dx,1,6) =	'H40153'
or substr(dx,1,6) =	'H40159'
or substr(dx,1,7) =	'H4020X0'
or substr(dx,1,7) =	'H4020X1'
or substr(dx,1,7) =	'H4020X2'
or substr(dx,1,7) =	'H4020X3'
or substr(dx,1,7) =	'H4020X4'
or substr(dx,1,6) =	'H40211'
or substr(dx,1,6) =	'H40212'
or substr(dx,1,6) =	'H40213'
or substr(dx,1,6) =	'H40219'
or substr(dx,1,7) =	'H402210'
or substr(dx,1,7) =	'H402211'
or substr(dx,1,7) =	'H402212'
or substr(dx,1,7) =	'H402213'
or substr(dx,1,7) =	'H402214'
or substr(dx,1,7) =	'H402220'
or substr(dx,1,7) =	'H402221'
or substr(dx,1,7) =	'H402222'
or substr(dx,1,7) =	'H402223'
or substr(dx,1,7) =	'H402224'
or substr(dx,1,7) =	'H402230'
or substr(dx,1,7) =	'H402231'
or substr(dx,1,7) =	'H402232'
or substr(dx,1,7) =	'H402233'
or substr(dx,1,7) =	'H402234'
or substr(dx,1,7) =	'H402290'
or substr(dx,1,7) =	'H402291'
or substr(dx,1,7) =	'H402292'
or substr(dx,1,7) =	'H402293'
or substr(dx,1,7) =	'H402294'
or substr(dx,1,6) =	'H40231'
or substr(dx,1,6) =	'H40232'
or substr(dx,1,6) =	'H40233'
or substr(dx,1,6) =	'H40239'
or substr(dx,1,6) =	'H40241'
or substr(dx,1,6) =	'H40242'
or substr(dx,1,6) =	'H40243'
or substr(dx,1,6) =	'H40249'
or substr(dx,1,7) =	'H4030X0'
or substr(dx,1,7) =	'H4030X1'
or substr(dx,1,7) =	'H4030X2'
or substr(dx,1,7) =	'H4030X3'
or substr(dx,1,7) =	'H4030X4'
or substr(dx,1,7) =	'H4031X0'
or substr(dx,1,7) =	'H4031X1'
or substr(dx,1,7) =	'H4031X2'
or substr(dx,1,7) =	'H4031X3'
or substr(dx,1,7) =	'H4031X4'
or substr(dx,1,7) =	'H4032X0'
or substr(dx,1,7) =	'H4032X1'
or substr(dx,1,7) =	'H4032X2'
or substr(dx,1,7) =	'H4032X3'
or substr(dx,1,7) =	'H4032X4'
or substr(dx,1,7) =	'H4033X0'
or substr(dx,1,7) =	'H4033X1'
or substr(dx,1,7) =	'H4033X2'
or substr(dx,1,7) =	'H4033X3'
or substr(dx,1,7) =	'H4033X4'
or substr(dx,1,7) =	'H4040X0'
or substr(dx,1,7) =	'H4040X1'
or substr(dx,1,7) =	'H4040X2'
or substr(dx,1,7) =	'H4040X3'
or substr(dx,1,7) =	'H4040X4'
or substr(dx,1,7) =	'H4041X0'
or substr(dx,1,7) =	'H4041X1'
or substr(dx,1,7) =	'H4041X2'
or substr(dx,1,7) =	'H4041X3'
or substr(dx,1,7) =	'H4041X4'
or substr(dx,1,7) =	'H4042X0'
or substr(dx,1,7) =	'H4042X1'
or substr(dx,1,7) =	'H4042X2'
or substr(dx,1,7) =	'H4042X3'
or substr(dx,1,7) =	'H4042X4'
or substr(dx,1,7) =	'H4043X0'
or substr(dx,1,7) =	'H4043X1'
or substr(dx,1,7) =	'H4043X2'
or substr(dx,1,7) =	'H4043X3'
or substr(dx,1,7) =	'H4043X4'
or substr(dx,1,7) =	'H4050X0'
or substr(dx,1,7) =	'H4050X1'
or substr(dx,1,7) =	'H4050X2'
or substr(dx,1,7) =	'H4050X3'
or substr(dx,1,7) =	'H4050X4'
or substr(dx,1,7) =	'H4051X0'
or substr(dx,1,7) =	'H4051X1'
or substr(dx,1,7) =	'H4051X2'
or substr(dx,1,7) =	'H4051X3'
or substr(dx,1,7) =	'H4051X4'
or substr(dx,1,7) =	'H4052X0'
or substr(dx,1,7) =	'H4052X1'
or substr(dx,1,7) =	'H4052X2'
or substr(dx,1,7) =	'H4052X3'
or substr(dx,1,7) =	'H4052X4'
or substr(dx,1,7) =	'H4053X0'
or substr(dx,1,7) =	'H4053X1'
or substr(dx,1,7) =	'H4053X2'
or substr(dx,1,7) =	'H4053X3'
or substr(dx,1,7) =	'H4053X4'
or substr(dx,1,7) =	'H4060X0'
or substr(dx,1,7) =	'H4060X1'
or substr(dx,1,7) =	'H4060X2'
or substr(dx,1,7) =	'H4060X3'
or substr(dx,1,7) =	'H4060X4'
or substr(dx,1,7) =	'H4061X0'
or substr(dx,1,7) =	'H4061X1'
or substr(dx,1,7) =	'H4061X2'
or substr(dx,1,7) =	'H4061X3'
or substr(dx,1,7) =	'H4061X4'
or substr(dx,1,7) =	'H4062X0'
or substr(dx,1,7) =	'H4062X1'
or substr(dx,1,7) =	'H4062X2'
or substr(dx,1,7) =	'H4062X3'
or substr(dx,1,7) =	'H4062X4'
or substr(dx,1,7) =	'H4063X0'
or substr(dx,1,7) =	'H4063X1'
or substr(dx,1,7) =	'H4063X2'
or substr(dx,1,7) =	'H4063X3'
or substr(dx,1,7) =	'H4063X4'
or substr(dx,1,6) =	'H40811'
or substr(dx,1,6) =	'H40812'
or substr(dx,1,6) =	'H40813'
or substr(dx,1,6) =	'H40819'
or substr(dx,1,6) =	'H40821'
or substr(dx,1,6) =	'H40822'
or substr(dx,1,6) =	'H40823'
or substr(dx,1,6) =	'H40829'
or substr(dx,1,6) =	'H40831'
or substr(dx,1,6) =	'H40832'
or substr(dx,1,6) =	'H40833'
or substr(dx,1,6) =	'H40839'
or substr(dx,1,5) =	'H4089'
or substr(dx,1,4) =	'H409'
or substr(dx,1,3) =	'H42'
or substr(dx,1,6) =	'H44511'
or substr(dx,1,6) =	'H44512'
or substr(dx,1,6) =	'H44513'
or substr(dx,1,6) =	'H44519'
or substr(dx,1,6) =	'H47231'
or substr(dx,1,6) =	'H47232'
or substr(dx,1,6) =	'H47233'
or substr(dx,1,6) =	'H47239'
or substr(dx,1,4) =	'Q150')
		and ccw_14=0
                then ccw_14=1;
* Heart Failure;
	if (substr(dx,1,5) =	'39891'
or substr(dx,1,5) =	'40201'
or substr(dx,1,5) =	'40211'
or substr(dx,1,5) =	'40291'
or substr(dx,1,5) =	'40401'
or substr(dx,1,5) =	'40403'
or substr(dx,1,5) =	'40411'
or substr(dx,1,5) =	'40413'
or substr(dx,1,5) =	'40491'
or substr(dx,1,5) =	'40493'
or substr(dx,1,4) =	'4281'
or substr(dx,1,5) =	'42821'
or substr(dx,1,5) =	'42822'
or substr(dx,1,5) =	'42823'
or substr(dx,1,5) =	'42820'
or substr(dx,1,5) =	'42831'
or substr(dx,1,5) =	'42832'
or substr(dx,1,5) =	'42833'
or substr(dx,1,5) =	'42830'
or substr(dx,1,5) =	'42841'
or substr(dx,1,5) =	'42842'
or substr(dx,1,5) =	'42843'
or substr(dx,1,5) =	'42840'
or substr(dx,1,4) =	'4289'
or substr(dx,1,4) =	'4280'
or substr(dx,1,5) =	'I0981'
or substr(dx,1,4) =	'I110'
or substr(dx,1,4) =	'I130'
or substr(dx,1,4) =	'I132'
or substr(dx,1,4) =	'I501'
or substr(dx,1,5) =	'I5020'
or substr(dx,1,5) =	'I5021'
or substr(dx,1,5) =	'I5022'
or substr(dx,1,5) =	'I5023'
or substr(dx,1,5) =	'I5030'
or substr(dx,1,5) =	'I5031'
or substr(dx,1,5) =	'I5032'
or substr(dx,1,5) =	'I5033'
or substr(dx,1,5) =	'I5040'
or substr(dx,1,5) =	'I5041'
or substr(dx,1,5) =	'I5042'
or substr(dx,1,5) =	'I5043'
or substr(dx,1,6) =	'I50810'
or substr(dx,1,6) =	'I50811'
or substr(dx,1,6) =	'I50812'
or substr(dx,1,6) =	'I50813'
or substr(dx,1,6) =	'I50814'
or substr(dx,1,5) =	'I5082'
or substr(dx,1,5) =	'I5083'
or substr(dx,1,5) =	'I5084'
or substr(dx,1,5) =	'I5089'
or substr(dx,1,4) =	'I509')
		and ccw_15=0
                then ccw_15=1;
  * Hip/Pelvic Fracture ;
	if (substr(dx,1,5) =	'73314'
or substr(dx,1,5) =	'73315'
or substr(dx,1,5) =	'73396'
or substr(dx,1,5) =	'73397'
or substr(dx,1,5) =	'73398'
or substr(dx,1,4) =	'8081'
or substr(dx,1,4) =	'8082'
or substr(dx,1,4) =	'8083'
or substr(dx,1,5) =	'80841'
or substr(dx,1,5) =	'80842'
or substr(dx,1,5) =	'80843'
or substr(dx,1,5) =	'80844'
or substr(dx,1,5) =	'80849'
or substr(dx,1,5) =	'80851'
or substr(dx,1,5) =	'80852'
or substr(dx,1,5) =	'80853'
or substr(dx,1,5) =	'80854'
or substr(dx,1,5) =	'80859'
or substr(dx,1,4) =	'8088'
or substr(dx,1,4) =	'8089'
or substr(dx,1,4) =	'8080'
or substr(dx,1,5) =	'82001'
or substr(dx,1,5) =	'82002'
or substr(dx,1,5) =	'82003'
or substr(dx,1,5) =	'82009'
or substr(dx,1,5) =	'82011'
or substr(dx,1,5) =	'82012'
or substr(dx,1,5) =	'82013'
or substr(dx,1,5) =	'82019'
or substr(dx,1,5) =	'82010'
or substr(dx,1,5) =	'82021'
or substr(dx,1,5) =	'82022'
or substr(dx,1,5) =	'82020'
or substr(dx,1,5) =	'82031'
or substr(dx,1,5) =	'82032'
or substr(dx,1,5) =	'82030'
or substr(dx,1,4) =	'8208'
or substr(dx,1,4) =	'8209'
or substr(dx,1,5) =	'82000'
or substr(dx,1,7) =	'M80051A'
or substr(dx,1,7) =	'M80052A'
or substr(dx,1,7) =	'M80059A'
or substr(dx,1,7) =	'M80851A'
or substr(dx,1,7) =	'M80852A'
or substr(dx,1,7) =	'M80859A'
or substr(dx,1,7) =	'M84350A'
or substr(dx,1,7) =	'M84351A'
or substr(dx,1,7) =	'M84352A'
or substr(dx,1,7) =	'M84353A'
or substr(dx,1,7) =	'M84359A'
or substr(dx,1,7) =	'M84451A'
or substr(dx,1,7) =	'M84452A'
or substr(dx,1,7) =	'M84453A'
or substr(dx,1,7) =	'M84459A'
or substr(dx,1,7) =	'M84550A'
or substr(dx,1,7) =	'M84551A'
or substr(dx,1,7) =	'M84552A'
or substr(dx,1,7) =	'M84553A'
or substr(dx,1,7) =	'M84559A'
or substr(dx,1,7) =	'M84650A'
or substr(dx,1,7) =	'M84651A'
or substr(dx,1,7) =	'M84652A'
or substr(dx,1,7) =	'M84653A'
or substr(dx,1,7) =	'M84659A'
or substr(dx,1,7) =	'S32301A'
or substr(dx,1,7) =	'S32301B'
or substr(dx,1,7) =	'S32302A'
or substr(dx,1,7) =	'S32302B'
or substr(dx,1,7) =	'S32309A'
or substr(dx,1,7) =	'S32309B'
or substr(dx,1,7) =	'S32311A'
or substr(dx,1,7) =	'S32311B'
or substr(dx,1,7) =	'S32312A'
or substr(dx,1,7) =	'S32312B'
or substr(dx,1,7) =	'S32313A'
or substr(dx,1,7) =	'S32313B'
or substr(dx,1,7) =	'S32314A'
or substr(dx,1,7) =	'S32314B'
or substr(dx,1,7) =	'S32315A'
or substr(dx,1,7) =	'S32315B'
or substr(dx,1,7) =	'S32316A'
or substr(dx,1,7) =	'S32316B'
or substr(dx,1,7) =	'S32391A'
or substr(dx,1,7) =	'S32391B'
or substr(dx,1,7) =	'S32392A'
or substr(dx,1,7) =	'S32392B'
or substr(dx,1,7) =	'S32399A'
or substr(dx,1,7) =	'S32399B'
or substr(dx,1,7) =	'S32401A'
or substr(dx,1,7) =	'S32401B'
or substr(dx,1,7) =	'S32402A'
or substr(dx,1,7) =	'S32402B'
or substr(dx,1,7) =	'S32409A'
or substr(dx,1,7) =	'S32409B'
or substr(dx,1,7) =	'S32411A'
or substr(dx,1,7) =	'S32411B'
or substr(dx,1,7) =	'S32412A'
or substr(dx,1,7) =	'S32412B'
or substr(dx,1,7) =	'S32413A'
or substr(dx,1,7) =	'S32413B'
or substr(dx,1,7) =	'S32414A'
or substr(dx,1,7) =	'S32414B'
or substr(dx,1,7) =	'S32415A'
or substr(dx,1,7) =	'S32415B'
or substr(dx,1,7) =	'S32416A'
or substr(dx,1,7) =	'S32416B'
or substr(dx,1,7) =	'S32421A'
or substr(dx,1,7) =	'S32421B'
or substr(dx,1,7) =	'S32422A'
or substr(dx,1,7) =	'S32422B'
or substr(dx,1,7) =	'S32423A'
or substr(dx,1,7) =	'S32423B'
or substr(dx,1,7) =	'S32424A'
or substr(dx,1,7) =	'S32424B'
or substr(dx,1,7) =	'S32425A'
or substr(dx,1,7) =	'S32425B'
or substr(dx,1,7) =	'S32426A'
or substr(dx,1,7) =	'S32426B'
or substr(dx,1,7) =	'S32431A'
or substr(dx,1,7) =	'S32431B'
or substr(dx,1,7) =	'S32432A'
or substr(dx,1,7) =	'S32432B'
or substr(dx,1,7) =	'S32433A'
or substr(dx,1,7) =	'S32433B'
or substr(dx,1,7) =	'S32434A'
or substr(dx,1,7) =	'S32434B'
or substr(dx,1,7) =	'S32435A'
or substr(dx,1,7) =	'S32435B'
or substr(dx,1,7) =	'S32436A'
or substr(dx,1,7) =	'S32436B'
or substr(dx,1,7) =	'S32441A'
or substr(dx,1,7) =	'S32441B'
or substr(dx,1,7) =	'S32442A'
or substr(dx,1,7) =	'S32442B'
or substr(dx,1,7) =	'S32443A'
or substr(dx,1,7) =	'S32443B'
or substr(dx,1,7) =	'S32444A'
or substr(dx,1,7) =	'S32444B'
or substr(dx,1,7) =	'S32445A'
or substr(dx,1,7) =	'S32445B'
or substr(dx,1,7) =	'S32446A'
or substr(dx,1,7) =	'S32446B'
or substr(dx,1,7) =	'S32451A'
or substr(dx,1,7) =	'S32451B'
or substr(dx,1,7) =	'S32452A'
or substr(dx,1,7) =	'S32452B'
or substr(dx,1,7) =	'S32453A'
or substr(dx,1,7) =	'S32453B'
or substr(dx,1,7) =	'S32454A'
or substr(dx,1,7) =	'S32454B'
or substr(dx,1,7) =	'S32455A'
or substr(dx,1,7) =	'S32455B'
or substr(dx,1,7) =	'S32456A'
or substr(dx,1,7) =	'S32456B'
or substr(dx,1,7) =	'S32461A'
or substr(dx,1,7) =	'S32461B'
or substr(dx,1,7) =	'S32462A'
or substr(dx,1,7) =	'S32462B'
or substr(dx,1,7) =	'S32463A'
or substr(dx,1,7) =	'S32463B'
or substr(dx,1,7) =	'S32464A'
or substr(dx,1,7) =	'S32464B'
or substr(dx,1,7) =	'S32465A'
or substr(dx,1,7) =	'S32465B'
or substr(dx,1,7) =	'S32466A'
or substr(dx,1,7) =	'S32466B'
or substr(dx,1,7) =	'S32471A'
or substr(dx,1,7) =	'S32471B'
or substr(dx,1,7) =	'S32472A'
or substr(dx,1,7) =	'S32472B'
or substr(dx,1,7) =	'S32473A'
or substr(dx,1,7) =	'S32473B'
or substr(dx,1,7) =	'S32474A'
or substr(dx,1,7) =	'S32474B'
or substr(dx,1,7) =	'S32475A'
or substr(dx,1,7) =	'S32475B'
or substr(dx,1,7) =	'S32476A'
or substr(dx,1,7) =	'S32476B'
or substr(dx,1,7) =	'S32481A'
or substr(dx,1,7) =	'S32481B'
or substr(dx,1,7) =	'S32482A'
or substr(dx,1,7) =	'S32482B'
or substr(dx,1,7) =	'S32483A'
or substr(dx,1,7) =	'S32483B'
or substr(dx,1,7) =	'S32484A'
or substr(dx,1,7) =	'S32484B'
or substr(dx,1,7) =	'S32485A'
or substr(dx,1,7) =	'S32485B'
or substr(dx,1,7) =	'S32486A'
or substr(dx,1,7) =	'S32486B'
or substr(dx,1,7) =	'S32491A'
or substr(dx,1,7) =	'S32491B'
or substr(dx,1,7) =	'S32492A'
or substr(dx,1,7) =	'S32492B'
or substr(dx,1,7) =	'S32499A'
or substr(dx,1,7) =	'S32499B'
or substr(dx,1,7) =	'S32501A'
or substr(dx,1,7) =	'S32501B'
or substr(dx,1,7) =	'S32502A'
or substr(dx,1,7) =	'S32502B'
or substr(dx,1,7) =	'S32509A'
or substr(dx,1,7) =	'S32509B'
or substr(dx,1,7) =	'S32511A'
or substr(dx,1,7) =	'S32511B'
or substr(dx,1,7) =	'S32512A'
or substr(dx,1,7) =	'S32512B'
or substr(dx,1,7) =	'S32519A'
or substr(dx,1,7) =	'S32519B'
or substr(dx,1,7) =	'S32591A'
or substr(dx,1,7) =	'S32591B'
or substr(dx,1,7) =	'S32592A'
or substr(dx,1,7) =	'S32592B'
or substr(dx,1,7) =	'S32599A'
or substr(dx,1,7) =	'S32599B'
or substr(dx,1,7) =	'S32601A'
or substr(dx,1,7) =	'S32601B'
or substr(dx,1,7) =	'S32602A'
or substr(dx,1,7) =	'S32602B'
or substr(dx,1,7) =	'S32609A'
or substr(dx,1,7) =	'S32609B'
or substr(dx,1,7) =	'S32611A'
or substr(dx,1,7) =	'S32611B'
or substr(dx,1,7) =	'S32612A'
or substr(dx,1,7) =	'S32612B'
or substr(dx,1,7) =	'S32613A'
or substr(dx,1,7) =	'S32613B'
or substr(dx,1,7) =	'S32614A'
or substr(dx,1,7) =	'S32614B'
or substr(dx,1,7) =	'S32615A'
or substr(dx,1,7) =	'S32615B'
or substr(dx,1,7) =	'S32616A'
or substr(dx,1,7) =	'S32616B'
or substr(dx,1,7) =	'S32691A'
or substr(dx,1,7) =	'S32691B'
or substr(dx,1,7) =	'S32692A'
or substr(dx,1,7) =	'S32692B'
or substr(dx,1,7) =	'S32699A'
or substr(dx,1,7) =	'S32699B'
or substr(dx,1,7) =	'S32810A'
or substr(dx,1,7) =	'S32810B'
or substr(dx,1,7) =	'S32811A'
or substr(dx,1,7) =	'S32811B'
or substr(dx,1,7) =	'S3282XA'
or substr(dx,1,7) =	'S3282XB'
or substr(dx,1,7) =	'S3289XA'
or substr(dx,1,7) =	'S3289XB'
or substr(dx,1,7) =	'S329XXA'
or substr(dx,1,7) =	'S329XXB'
or substr(dx,1,7) =	'S72001A'
or substr(dx,1,7) =	'S72001B'
or substr(dx,1,7) =	'S72001C'
or substr(dx,1,7) =	'S72002A'
or substr(dx,1,7) =	'S72002B'
or substr(dx,1,7) =	'S72002C'
or substr(dx,1,7) =	'S72009A'
or substr(dx,1,7) =	'S72009B'
or substr(dx,1,7) =	'S72009C'
or substr(dx,1,7) =	'S72011A'
or substr(dx,1,7) =	'S72011B'
or substr(dx,1,7) =	'S72011C'
or substr(dx,1,7) =	'S72012A'
or substr(dx,1,7) =	'S72012B'
or substr(dx,1,7) =	'S72012C'
or substr(dx,1,7) =	'S72019A'
or substr(dx,1,7) =	'S72019B'
or substr(dx,1,7) =	'S72019C'
or substr(dx,1,7) =	'S72021A'
or substr(dx,1,7) =	'S72021B'
or substr(dx,1,7) =	'S72021C'
or substr(dx,1,7) =	'S72022A'
or substr(dx,1,7) =	'S72022B'
or substr(dx,1,7) =	'S72022C'
or substr(dx,1,7) =	'S72023A'
or substr(dx,1,7) =	'S72023B'
or substr(dx,1,7) =	'S72023C'
or substr(dx,1,7) =	'S72024A'
or substr(dx,1,7) =	'S72024B'
or substr(dx,1,7) =	'S72024C'
or substr(dx,1,7) =	'S72025A'
or substr(dx,1,7) =	'S72025B'
or substr(dx,1,7) =	'S72025C'
or substr(dx,1,7) =	'S72026A'
or substr(dx,1,7) =	'S72026B'
or substr(dx,1,7) =	'S72026C'
or substr(dx,1,7) =	'S72031A'
or substr(dx,1,7) =	'S72031B'
or substr(dx,1,7) =	'S72031C'
or substr(dx,1,7) =	'S72032A'
or substr(dx,1,7) =	'S72032B'
or substr(dx,1,7) =	'S72032C'
or substr(dx,1,7) =	'S72033A'
or substr(dx,1,7) =	'S72033B'
or substr(dx,1,7) =	'S72033C'
or substr(dx,1,7) =	'S72034A'
or substr(dx,1,7) =	'S72034B'
or substr(dx,1,7) =	'S72034C'
or substr(dx,1,7) =	'S72035A'
or substr(dx,1,7) =	'S72035B'
or substr(dx,1,7) =	'S72035C'
or substr(dx,1,7) =	'S72036A'
or substr(dx,1,7) =	'S72036B'
or substr(dx,1,7) =	'S72036C'
or substr(dx,1,7) =	'S72041A'
or substr(dx,1,7) =	'S72041B'
or substr(dx,1,7) =	'S72041C'
or substr(dx,1,7) =	'S72042A'
or substr(dx,1,7) =	'S72042B'
or substr(dx,1,7) =	'S72042C'
or substr(dx,1,7) =	'S72043A'
or substr(dx,1,7) =	'S72043B'
or substr(dx,1,7) =	'S72043C'
or substr(dx,1,7) =	'S72044A'
or substr(dx,1,7) =	'S72044B'
or substr(dx,1,7) =	'S72044C'
or substr(dx,1,7) =	'S72045A'
or substr(dx,1,7) =	'S72045B'
or substr(dx,1,7) =	'S72045C'
or substr(dx,1,7) =	'S72046A'
or substr(dx,1,7) =	'S72046B'
or substr(dx,1,7) =	'S72046C'
or substr(dx,1,7) =	'S72051A'
or substr(dx,1,7) =	'S72051B'
or substr(dx,1,7) =	'S72051C'
or substr(dx,1,7) =	'S72052A'
or substr(dx,1,7) =	'S72052B'
or substr(dx,1,7) =	'S72052C'
or substr(dx,1,7) =	'S72059A'
or substr(dx,1,7) =	'S72059B'
or substr(dx,1,7) =	'S72059C'
or substr(dx,1,7) =	'S72061A'
or substr(dx,1,7) =	'S72061B'
or substr(dx,1,7) =	'S72061C'
or substr(dx,1,7) =	'S72062A'
or substr(dx,1,7) =	'S72062B'
or substr(dx,1,7) =	'S72062C'
or substr(dx,1,7) =	'S72063A'
or substr(dx,1,7) =	'S72063B'
or substr(dx,1,7) =	'S72063C'
or substr(dx,1,7) =	'S72064A'
or substr(dx,1,7) =	'S72064B'
or substr(dx,1,7) =	'S72064C'
or substr(dx,1,7) =	'S72065A'
or substr(dx,1,7) =	'S72065B'
or substr(dx,1,7) =	'S72065C'
or substr(dx,1,7) =	'S72066A'
or substr(dx,1,7) =	'S72066B'
or substr(dx,1,7) =	'S72066C'
or substr(dx,1,7) =	'S72091A'
or substr(dx,1,7) =	'S72091B'
or substr(dx,1,7) =	'S72091C'
or substr(dx,1,7) =	'S72092A'
or substr(dx,1,7) =	'S72092B'
or substr(dx,1,7) =	'S72092C'
or substr(dx,1,7) =	'S72099A'
or substr(dx,1,7) =	'S72099B'
or substr(dx,1,7) =	'S72099C'
or substr(dx,1,7) =	'S72101A'
or substr(dx,1,7) =	'S72101B'
or substr(dx,1,7) =	'S72101C'
or substr(dx,1,7) =	'S72102A'
or substr(dx,1,7) =	'S72102B'
or substr(dx,1,7) =	'S72102C'
or substr(dx,1,7) =	'S72109A'
or substr(dx,1,7) =	'S72109B'
or substr(dx,1,7) =	'S72109C'
or substr(dx,1,7) =	'S72111A'
or substr(dx,1,7) =	'S72111B'
or substr(dx,1,7) =	'S72111C'
or substr(dx,1,7) =	'S72112A'
or substr(dx,1,7) =	'S72112B'
or substr(dx,1,7) =	'S72112C'
or substr(dx,1,7) =	'S72113A'
or substr(dx,1,7) =	'S72113B'
or substr(dx,1,7) =	'S72113C'
or substr(dx,1,7) =	'S72114A'
or substr(dx,1,7) =	'S72114B'
or substr(dx,1,7) =	'S72114C'
or substr(dx,1,7) =	'S72115A'
or substr(dx,1,7) =	'S72115B'
or substr(dx,1,7) =	'S72115C'
or substr(dx,1,7) =	'S72116A'
or substr(dx,1,7) =	'S72116B'
or substr(dx,1,7) =	'S72116C'
or substr(dx,1,7) =	'S72121A'
or substr(dx,1,7) =	'S72121B'
or substr(dx,1,7) =	'S72121C'
or substr(dx,1,7) =	'S72122A'
or substr(dx,1,7) =	'S72122B'
or substr(dx,1,7) =	'S72122C'
or substr(dx,1,7) =	'S72123A'
or substr(dx,1,7) =	'S72123B'
or substr(dx,1,7) =	'S72123C'
or substr(dx,1,7) =	'S72124A'
or substr(dx,1,7) =	'S72124B'
or substr(dx,1,7) =	'S72124C'
or substr(dx,1,7) =	'S72125A'
or substr(dx,1,7) =	'S72125B'
or substr(dx,1,7) =	'S72125C'
or substr(dx,1,7) =	'S72126A'
or substr(dx,1,7) =	'S72126B'
or substr(dx,1,7) =	'S72126C'
or substr(dx,1,7) =	'S72131A'
or substr(dx,1,7) =	'S72131B'
or substr(dx,1,7) =	'S72131C'
or substr(dx,1,7) =	'S72132A'
or substr(dx,1,7) =	'S72132B'
or substr(dx,1,7) =	'S72132C'
or substr(dx,1,7) =	'S72133A'
or substr(dx,1,7) =	'S72133B'
or substr(dx,1,7) =	'S72133C'
or substr(dx,1,7) =	'S72134A'
or substr(dx,1,7) =	'S72134B'
or substr(dx,1,7) =	'S72134C'
or substr(dx,1,7) =	'S72135A'
or substr(dx,1,7) =	'S72135B'
or substr(dx,1,7) =	'S72135C'
or substr(dx,1,7) =	'S72136A'
or substr(dx,1,7) =	'S72136B'
or substr(dx,1,7) =	'S72136C'
or substr(dx,1,7) =	'S72141A'
or substr(dx,1,7) =	'S72141B'
or substr(dx,1,7) =	'S72141C'
or substr(dx,1,7) =	'S72142A'
or substr(dx,1,7) =	'S72142B'
or substr(dx,1,7) =	'S72142C'
or substr(dx,1,7) =	'S72143A'
or substr(dx,1,7) =	'S72143B'
or substr(dx,1,7) =	'S72143C'
or substr(dx,1,7) =	'S72144A'
or substr(dx,1,7) =	'S72144B'
or substr(dx,1,7) =	'S72144C'
or substr(dx,1,7) =	'S72145A'
or substr(dx,1,7) =	'S72145B'
or substr(dx,1,7) =	'S72145C'
or substr(dx,1,7) =	'S72146A'
or substr(dx,1,7) =	'S72146B'
or substr(dx,1,7) =	'S72146C'
or substr(dx,1,7) =	'S7221XA'
or substr(dx,1,7) =	'S7221XB'
or substr(dx,1,7) =	'S7221XC'
or substr(dx,1,7) =	'S7222XA'
or substr(dx,1,7) =	'S7222XB'
or substr(dx,1,7) =	'S7222XC'
or substr(dx,1,7) =	'S7223XA'
or substr(dx,1,7) =	'S7223XB'
or substr(dx,1,7) =	'S7223XC'
or substr(dx,1,7) =	'S7224XA'
or substr(dx,1,7) =	'S7224XB'
or substr(dx,1,7) =	'S7224XC'
or substr(dx,1,7) =	'S7225XA'
or substr(dx,1,7) =	'S7225XB'
or substr(dx,1,7) =	'S7225XC'
or substr(dx,1,7) =	'S7226XA'
or substr(dx,1,7) =	'S7226XB'
or substr(dx,1,7) =	'S7226XC'
or substr(dx,1,7) =	'S79001A'
or substr(dx,1,7) =	'S79002A'
or substr(dx,1,7) =	'S79009A'
or substr(dx,1,7) =	'S79011A'
or substr(dx,1,7) =	'S79012A'
or substr(dx,1,7) =	'S79019A'
or substr(dx,1,7) =	'S79091A'
or substr(dx,1,7) =	'S79092A'
or substr(dx,1,7) =	'S79099A')
		and ccw_16=0
                then ccw_16=1;
  * Hyperlipidemia ;
	if (substr(dx,1,4) =	'2721'
or substr(dx,1,4) =	'2722'
or substr(dx,1,4) =	'2723'
or substr(dx,1,4) =	'2724'
or substr(dx,1,4) =	'2720'
or substr(dx,1,4) =	'E780'
or substr(dx,1,4) =	'E781'
or substr(dx,1,4) =	'E782'
or substr(dx,1,4) =	'E783'
or substr(dx,1,4) =	'E784'
or substr(dx,1,4) =	'E785' )
		and ccw_17=0
                then ccw_17=1;

  * Hypertension ;
	if (substr(dx,1,5) =	'36211'
or substr(dx,1,4) =	'4011'
or substr(dx,1,4) =	'4019'
or substr(dx,1,4) =	'4010'
or substr(dx,1,5) =	'40201'
or substr(dx,1,5) =	'40211'
or substr(dx,1,5) =	'40210'
or substr(dx,1,5) =	'40291'
or substr(dx,1,5) =	'40290'
or substr(dx,1,5) =	'40200'
or substr(dx,1,5) =	'40301'
or substr(dx,1,5) =	'40311'
or substr(dx,1,5) =	'40310'
or substr(dx,1,5) =	'40391'
or substr(dx,1,5) =	'40390'
or substr(dx,1,5) =	'40300'
or substr(dx,1,5) =	'40401'
or substr(dx,1,5) =	'40402'
or substr(dx,1,5) =	'40403'
or substr(dx,1,5) =	'40411'
or substr(dx,1,5) =	'40412'
or substr(dx,1,5) =	'40413'
or substr(dx,1,5) =	'40410'
or substr(dx,1,5) =	'40491'
or substr(dx,1,5) =	'40492'
or substr(dx,1,5) =	'40493'
or substr(dx,1,5) =	'40490'
or substr(dx,1,5) =	'40400'
or substr(dx,1,5) =	'40501'
or substr(dx,1,5) =	'40509'
or substr(dx,1,5) =	'40511'
or substr(dx,1,5) =	'40519'
or substr(dx,1,5) =	'40591'
or substr(dx,1,5) =	'40599'
or substr(dx,1,4) =	'4372'
or substr(dx,1,6) =	'H35031'
or substr(dx,1,6) =	'H35032'
or substr(dx,1,6) =	'H35033'
or substr(dx,1,6) =	'H35039'
or substr(dx,1,3) =	'I10'
or substr(dx,1,4) =	'I110'
or substr(dx,1,4) =	'I119'
or substr(dx,1,4) =	'I120'
or substr(dx,1,4) =	'I129'
or substr(dx,1,4) =	'I130'
or substr(dx,1,5) =	'I1310'
or substr(dx,1,5) =	'I1311'
or substr(dx,1,4) =	'I132'
or substr(dx,1,4) =	'I150'
or substr(dx,1,4) =	'I151'
or substr(dx,1,4) =	'I152'
or substr(dx,1,4) =	'I158'
or substr(dx,1,4) =	'I159'
or substr(dx,1,4) =	'I674'
or substr(dx,1,4) =	'N262' )
		and ccw_18=0
                then ccw_18=1;
  * Ischemic Heart Disease ;
	if (substr(dx,1,5) =	'41001'
or substr(dx,1,5) =	'41002'
or substr(dx,1,5) =	'41011'
or substr(dx,1,5) =	'41012'
or substr(dx,1,5) =	'41010'
or substr(dx,1,5) =	'41021'
or substr(dx,1,5) =	'41022'
or substr(dx,1,5) =	'41020'
or substr(dx,1,5) =	'41031'
or substr(dx,1,5) =	'41032'
or substr(dx,1,5) =	'41030'
or substr(dx,1,5) =	'41041'
or substr(dx,1,5) =	'41042'
or substr(dx,1,5) =	'41040'
or substr(dx,1,5) =	'41051'
or substr(dx,1,5) =	'41052'
or substr(dx,1,5) =	'41050'
or substr(dx,1,5) =	'41061'
or substr(dx,1,5) =	'41062'
or substr(dx,1,5) =	'41060'
or substr(dx,1,5) =	'41071'
or substr(dx,1,5) =	'41072'
or substr(dx,1,5) =	'41070'
or substr(dx,1,5) =	'41081'
or substr(dx,1,5) =	'41082'
or substr(dx,1,5) =	'41080'
or substr(dx,1,5) =	'41091'
or substr(dx,1,5) =	'41092'
or substr(dx,1,5) =	'41090'
or substr(dx,1,5) =	'41000'
or substr(dx,1,4) =	'4111'
or substr(dx,1,5) =	'41181'
or substr(dx,1,5) =	'41189'
or substr(dx,1,4) =	'4110'
or substr(dx,1,3) =	'412'
or substr(dx,1,4) =	'4131'
or substr(dx,1,4) =	'4139'
or substr(dx,1,4) =	'4130'
or substr(dx,1,5) =	'41401'
or substr(dx,1,5) =	'41402'
or substr(dx,1,5) =	'41403'
or substr(dx,1,5) =	'41404'
or substr(dx,1,5) =	'41405'
or substr(dx,1,5) =	'41406'
or substr(dx,1,5) =	'41407'
or substr(dx,1,5) =	'41412'
or substr(dx,1,4) =	'4142'
or substr(dx,1,4) =	'4143'
or substr(dx,1,4) =	'4144'
or substr(dx,1,4) =	'4148'
or substr(dx,1,4) =	'4149'
or substr(dx,1,3) =	'414'
or substr(dx,1,4) =	'I200'
or substr(dx,1,4) =	'I201'
or substr(dx,1,4) =	'I208'
or substr(dx,1,4) =	'I209'
or substr(dx,1,5) =	'I2101'
or substr(dx,1,5) =	'I2102'
or substr(dx,1,5) =	'I2109'
or substr(dx,1,5) =	'I2111'
or substr(dx,1,5) =	'I2119'
or substr(dx,1,5) =	'I2121'
or substr(dx,1,5) =	'I2129'
or substr(dx,1,4) =	'I213'
or substr(dx,1,4) =	'I214'
or substr(dx,1,5) =	'I21A1'
or substr(dx,1,5) =	'I21A9'
or substr(dx,1,4) =	'I220'
or substr(dx,1,4) =	'I221'
or substr(dx,1,4) =	'I222'
or substr(dx,1,4) =	'I228'
or substr(dx,1,4) =	'I229'
or substr(dx,1,4) =	'I230'
or substr(dx,1,4) =	'I231'
or substr(dx,1,4) =	'I232'
or substr(dx,1,4) =	'I233'
or substr(dx,1,4) =	'I234'
or substr(dx,1,4) =	'I235'
or substr(dx,1,4) =	'I236'
or substr(dx,1,4) =	'I237'
or substr(dx,1,4) =	'I238'
or substr(dx,1,4) =	'I240'
or substr(dx,1,4) =	'I241'
or substr(dx,1,4) =	'I248'
or substr(dx,1,4) =	'I249'
or substr(dx,1,5) =	'I2510'
or substr(dx,1,6) =	'I25110'
or substr(dx,1,6) =	'I25111'
or substr(dx,1,6) =	'I25118'
or substr(dx,1,6) =	'I25119'
or substr(dx,1,4) =	'I252'
or substr(dx,1,4) =	'I253'
or substr(dx,1,5) =	'I2541'
or substr(dx,1,5) =	'I2542'
or substr(dx,1,4) =	'I255'
or substr(dx,1,4) =	'I256'
or substr(dx,1,6) =	'I25700'
or substr(dx,1,6) =	'I25701'
or substr(dx,1,6) =	'I25708'
or substr(dx,1,6) =	'I25709'
or substr(dx,1,6) =	'I25710'
or substr(dx,1,6) =	'I25711'
or substr(dx,1,6) =	'I25718'
or substr(dx,1,6) =	'I25719'
or substr(dx,1,6) =	'I25720'
or substr(dx,1,6) =	'I25721'
or substr(dx,1,6) =	'I25728'
or substr(dx,1,6) =	'I25729'
or substr(dx,1,6) =	'I25730'
or substr(dx,1,6) =	'I25731'
or substr(dx,1,6) =	'I25738'
or substr(dx,1,6) =	'I25739'
or substr(dx,1,6) =	'I25750'
or substr(dx,1,6) =	'I25751'
or substr(dx,1,6) =	'I25758'
or substr(dx,1,6) =	'I25759'
or substr(dx,1,6) =	'I25760'
or substr(dx,1,6) =	'I25761'
or substr(dx,1,6) =	'I25768'
or substr(dx,1,6) =	'I25769'
or substr(dx,1,6) =	'I25790'
or substr(dx,1,6) =	'I25791'
or substr(dx,1,6) =	'I25798'
or substr(dx,1,6) =	'I25799'
or substr(dx,1,6) =	'I25810'
or substr(dx,1,6) =	'I25811'
or substr(dx,1,6) =	'I25812'
or substr(dx,1,5) =	'I2582'
or substr(dx,1,5) =	'I2583'
or substr(dx,1,5) =	'I2584'
or substr(dx,1,5) =	'I2589'
or substr(dx,1,4) =	'I259')
		and ccw_19=0
                then ccw_19=1;
  * Osteoporosis ;
	if (substr(dx,1,5) =	'73301'
or substr(dx,1,5) =	'73302'
or substr(dx,1,5) =	'73303'
or substr(dx,1,5) =	'73309'
or substr(dx,1,5) =	'73300'
or substr(dx,1,4) =	'M810'
or substr(dx,1,4) =	'M816'
or substr(dx,1,4) =	'M818')
		and ccw_20=0
                then ccw_20=1;
  * RA/OA ;
	if (substr(dx,1,4) =	'7141'
or substr(dx,1,4) =	'7142'
or substr(dx,1,5) =	'71431'
or substr(dx,1,5) =	'71432'
or substr(dx,1,5) =	'71433'
or substr(dx,1,5) =	'71430'
or substr(dx,1,4) =	'7140'
or substr(dx,1,5) =	'71504'
or substr(dx,1,5) =	'71509'
or substr(dx,1,5) =	'71511'
or substr(dx,1,5) =	'71512'
or substr(dx,1,5) =	'71513'
or substr(dx,1,5) =	'71514'
or substr(dx,1,5) =	'71515'
or substr(dx,1,5) =	'71516'
or substr(dx,1,5) =	'71517'
or substr(dx,1,5) =	'71518'
or substr(dx,1,5) =	'71510'
or substr(dx,1,5) =	'71521'
or substr(dx,1,5) =	'71522'
or substr(dx,1,5) =	'71523'
or substr(dx,1,5) =	'71524'
or substr(dx,1,5) =	'71525'
or substr(dx,1,5) =	'71526'
or substr(dx,1,5) =	'71527'
or substr(dx,1,5) =	'71528'
or substr(dx,1,5) =	'71520'
or substr(dx,1,5) =	'71531'
or substr(dx,1,5) =	'71532'
or substr(dx,1,5) =	'71533'
or substr(dx,1,5) =	'71534'
or substr(dx,1,5) =	'71535'
or substr(dx,1,5) =	'71536'
or substr(dx,1,5) =	'71537'
or substr(dx,1,5) =	'71538'
or substr(dx,1,5) =	'71530'
or substr(dx,1,5) =	'71589'
or substr(dx,1,5) =	'71580'
or substr(dx,1,5) =	'71591'
or substr(dx,1,5) =	'71592'
or substr(dx,1,5) =	'71593'
or substr(dx,1,5) =	'71594'
or substr(dx,1,5) =	'71595'
or substr(dx,1,5) =	'71596'
or substr(dx,1,5) =	'71597'
or substr(dx,1,5) =	'71598'
or substr(dx,1,5) =	'71590'
or substr(dx,1,5) =	'71500'
or substr(dx,1,4) =	'7200'
or substr(dx,1,4) =	'7211'
or substr(dx,1,4) =	'7212'
or substr(dx,1,4) =	'7213'
or substr(dx,1,5) =	'72191'
or substr(dx,1,5) =	'72190'
or substr(dx,1,4) =	'7210'
or substr(dx,1,5) =	'M0500'
or substr(dx,1,6) =	'M05011'
or substr(dx,1,6) =	'M05012'
or substr(dx,1,6) =	'M05019'
or substr(dx,1,6) =	'M05021'
or substr(dx,1,6) =	'M05022'
or substr(dx,1,6) =	'M05029'
or substr(dx,1,6) =	'M05031'
or substr(dx,1,6) =	'M05032'
or substr(dx,1,6) =	'M05039'
or substr(dx,1,6) =	'M05041'
or substr(dx,1,6) =	'M05042'
or substr(dx,1,6) =	'M05049'
or substr(dx,1,6) =	'M05051'
or substr(dx,1,6) =	'M05052'
or substr(dx,1,6) =	'M05059'
or substr(dx,1,6) =	'M05061'
or substr(dx,1,6) =	'M05062'
or substr(dx,1,6) =	'M05069'
or substr(dx,1,6) =	'M05071'
or substr(dx,1,6) =	'M05072'
or substr(dx,1,6) =	'M05079'
or substr(dx,1,5) =	'M0509'
or substr(dx,1,5) =	'M0520'
or substr(dx,1,6) =	'M05211'
or substr(dx,1,6) =	'M05212'
or substr(dx,1,6) =	'M05219'
or substr(dx,1,6) =	'M05221'
or substr(dx,1,6) =	'M05222'
or substr(dx,1,6) =	'M05229'
or substr(dx,1,6) =	'M05231'
or substr(dx,1,6) =	'M05232'
or substr(dx,1,6) =	'M05239'
or substr(dx,1,6) =	'M05241'
or substr(dx,1,6) =	'M05242'
or substr(dx,1,6) =	'M05249'
or substr(dx,1,6) =	'M05251'
or substr(dx,1,6) =	'M05252'
or substr(dx,1,6) =	'M05259'
or substr(dx,1,6) =	'M05261'
or substr(dx,1,6) =	'M05262'
or substr(dx,1,6) =	'M05269'
or substr(dx,1,6) =	'M05271'
or substr(dx,1,6) =	'M05272'
or substr(dx,1,6) =	'M05279'
or substr(dx,1,5) =	'M0529'
or substr(dx,1,5) =	'M0530'
or substr(dx,1,6) =	'M05311'
or substr(dx,1,6) =	'M05312'
or substr(dx,1,6) =	'M05319'
or substr(dx,1,6) =	'M05321'
or substr(dx,1,6) =	'M05322'
or substr(dx,1,6) =	'M05329'
or substr(dx,1,6) =	'M05331'
or substr(dx,1,6) =	'M05332'
or substr(dx,1,6) =	'M05339'
or substr(dx,1,6) =	'M05341'
or substr(dx,1,6) =	'M05342'
or substr(dx,1,6) =	'M05349'
or substr(dx,1,6) =	'M05351'
or substr(dx,1,6) =	'M05352'
or substr(dx,1,6) =	'M05359'
or substr(dx,1,6) =	'M05361'
or substr(dx,1,6) =	'M05362'
or substr(dx,1,6) =	'M05369'
or substr(dx,1,6) =	'M05371'
or substr(dx,1,6) =	'M05372'
or substr(dx,1,6) =	'M05379'
or substr(dx,1,5) =	'M0539'
or substr(dx,1,5) =	'M0540'
or substr(dx,1,6) =	'M05411'
or substr(dx,1,6) =	'M05412'
or substr(dx,1,6) =	'M05419'
or substr(dx,1,6) =	'M05421'
or substr(dx,1,6) =	'M05422'
or substr(dx,1,6) =	'M05429'
or substr(dx,1,6) =	'M05431'
or substr(dx,1,6) =	'M05432'
or substr(dx,1,6) =	'M05439'
or substr(dx,1,6) =	'M05441'
or substr(dx,1,6) =	'M05442'
or substr(dx,1,6) =	'M05449'
or substr(dx,1,6) =	'M05451'
or substr(dx,1,6) =	'M05452'
or substr(dx,1,6) =	'M05459'
or substr(dx,1,6) =	'M05461'
or substr(dx,1,6) =	'M05462'
or substr(dx,1,6) =	'M05469'
or substr(dx,1,6) =	'M05471'
or substr(dx,1,6) =	'M05472'
or substr(dx,1,6) =	'M05479'
or substr(dx,1,5) =	'M0549'
or substr(dx,1,5) =	'M0550'
or substr(dx,1,6) =	'M05511'
or substr(dx,1,6) =	'M05512'
or substr(dx,1,6) =	'M05519'
or substr(dx,1,6) =	'M05521'
or substr(dx,1,6) =	'M05522'
or substr(dx,1,6) =	'M05529'
or substr(dx,1,6) =	'M05531'
or substr(dx,1,6) =	'M05532'
or substr(dx,1,6) =	'M05539'
or substr(dx,1,6) =	'M05541'
or substr(dx,1,6) =	'M05542'
or substr(dx,1,6) =	'M05549'
or substr(dx,1,6) =	'M05551'
or substr(dx,1,6) =	'M05552'
or substr(dx,1,6) =	'M05559'
or substr(dx,1,6) =	'M05561'
or substr(dx,1,6) =	'M05562'
or substr(dx,1,6) =	'M05569'
or substr(dx,1,6) =	'M05571'
or substr(dx,1,6) =	'M05572'
or substr(dx,1,6) =	'M05579'
or substr(dx,1,5) =	'M0559'
or substr(dx,1,5) =	'M0560'
or substr(dx,1,6) =	'M05611'
or substr(dx,1,6) =	'M05612'
or substr(dx,1,6) =	'M05619'
or substr(dx,1,6) =	'M05621'
or substr(dx,1,6) =	'M05622'
or substr(dx,1,6) =	'M05629'
or substr(dx,1,6) =	'M05631'
or substr(dx,1,6) =	'M05632'
or substr(dx,1,6) =	'M05639'
or substr(dx,1,6) =	'M05641'
or substr(dx,1,6) =	'M05642'
or substr(dx,1,6) =	'M05649'
or substr(dx,1,6) =	'M05651'
or substr(dx,1,6) =	'M05652'
or substr(dx,1,6) =	'M05659'
or substr(dx,1,6) =	'M05661'
or substr(dx,1,6) =	'M05662'
or substr(dx,1,6) =	'M05669'
or substr(dx,1,6) =	'M05671'
or substr(dx,1,6) =	'M05672'
or substr(dx,1,6) =	'M05679'
or substr(dx,1,5) =	'M0569'
or substr(dx,1,5) =	'M0570'
or substr(dx,1,6) =	'M05711'
or substr(dx,1,6) =	'M05712'
or substr(dx,1,6) =	'M05719'
or substr(dx,1,6) =	'M05721'
or substr(dx,1,6) =	'M05722'
or substr(dx,1,6) =	'M05729'
or substr(dx,1,6) =	'M05731'
or substr(dx,1,6) =	'M05732'
or substr(dx,1,6) =	'M05739'
or substr(dx,1,6) =	'M05741'
or substr(dx,1,6) =	'M05742'
or substr(dx,1,6) =	'M05749'
or substr(dx,1,6) =	'M05751'
or substr(dx,1,6) =	'M05752'
or substr(dx,1,6) =	'M05759'
or substr(dx,1,6) =	'M05761'
or substr(dx,1,6) =	'M05762'
or substr(dx,1,6) =	'M05769'
or substr(dx,1,6) =	'M05771'
or substr(dx,1,6) =	'M05772'
or substr(dx,1,6) =	'M05779'
or substr(dx,1,5) =	'M0579'
or substr(dx,1,5) =	'M0580'
or substr(dx,1,6) =	'M05811'
or substr(dx,1,6) =	'M05812'
or substr(dx,1,6) =	'M05819'
or substr(dx,1,6) =	'M05821'
or substr(dx,1,6) =	'M05822'
or substr(dx,1,6) =	'M05829'
or substr(dx,1,6) =	'M05831'
or substr(dx,1,6) =	'M05832'
or substr(dx,1,6) =	'M05839'
or substr(dx,1,6) =	'M05841'
or substr(dx,1,6) =	'M05842'
or substr(dx,1,6) =	'M05849'
or substr(dx,1,6) =	'M05851'
or substr(dx,1,6) =	'M05852'
or substr(dx,1,6) =	'M05859'
or substr(dx,1,6) =	'M05861'
or substr(dx,1,6) =	'M05862'
or substr(dx,1,6) =	'M05869'
or substr(dx,1,6) =	'M05871'
or substr(dx,1,6) =	'M05872'
or substr(dx,1,6) =	'M05879'
or substr(dx,1,5) =	'M0589'
or substr(dx,1,4) =	'M059'
or substr(dx,1,5) =	'M0600'
or substr(dx,1,6) =	'M06011'
or substr(dx,1,6) =	'M06012'
or substr(dx,1,6) =	'M06019'
or substr(dx,1,6) =	'M06021'
or substr(dx,1,6) =	'M06022'
or substr(dx,1,6) =	'M06029'
or substr(dx,1,6) =	'M06031'
or substr(dx,1,6) =	'M06032'
or substr(dx,1,6) =	'M06039'
or substr(dx,1,6) =	'M06041'
or substr(dx,1,6) =	'M06042'
or substr(dx,1,6) =	'M06049'
or substr(dx,1,6) =	'M06051'
or substr(dx,1,6) =	'M06052'
or substr(dx,1,6) =	'M06059'
or substr(dx,1,6) =	'M06061'
or substr(dx,1,6) =	'M06062'
or substr(dx,1,6) =	'M06069'
or substr(dx,1,6) =	'M06071'
or substr(dx,1,6) =	'M06072'
or substr(dx,1,6) =	'M06079'
or substr(dx,1,5) =	'M0608'
or substr(dx,1,5) =	'M0609'
or substr(dx,1,4) =	'M061'
or substr(dx,1,5) =	'M0620'
or substr(dx,1,6) =	'M06211'
or substr(dx,1,6) =	'M06212'
or substr(dx,1,6) =	'M06219'
or substr(dx,1,6) =	'M06221'
or substr(dx,1,6) =	'M06222'
or substr(dx,1,6) =	'M06229'
or substr(dx,1,6) =	'M06231'
or substr(dx,1,6) =	'M06232'
or substr(dx,1,6) =	'M06239'
or substr(dx,1,6) =	'M06241'
or substr(dx,1,6) =	'M06242'
or substr(dx,1,6) =	'M06249'
or substr(dx,1,6) =	'M06251'
or substr(dx,1,6) =	'M06252'
or substr(dx,1,6) =	'M06259'
or substr(dx,1,6) =	'M06261'
or substr(dx,1,6) =	'M06262'
or substr(dx,1,6) =	'M06269'
or substr(dx,1,6) =	'M06271'
or substr(dx,1,6) =	'M06272'
or substr(dx,1,6) =	'M06279'
or substr(dx,1,5) =	'M0628'
or substr(dx,1,5) =	'M0629'
or substr(dx,1,5) =	'M0630'
or substr(dx,1,6) =	'M06311'
or substr(dx,1,6) =	'M06312'
or substr(dx,1,6) =	'M06319'
or substr(dx,1,6) =	'M06321'
or substr(dx,1,6) =	'M06322'
or substr(dx,1,6) =	'M06329'
or substr(dx,1,6) =	'M06331'
or substr(dx,1,6) =	'M06332'
or substr(dx,1,6) =	'M06339'
or substr(dx,1,6) =	'M06341'
or substr(dx,1,6) =	'M06342'
or substr(dx,1,6) =	'M06349'
or substr(dx,1,6) =	'M06351'
or substr(dx,1,6) =	'M06352'
or substr(dx,1,6) =	'M06359'
or substr(dx,1,6) =	'M06361'
or substr(dx,1,6) =	'M06362'
or substr(dx,1,6) =	'M06369'
or substr(dx,1,6) =	'M06371'
or substr(dx,1,6) =	'M06372'
or substr(dx,1,6) =	'M06379'
or substr(dx,1,5) =	'M0638'
or substr(dx,1,5) =	'M0639'
or substr(dx,1,5) =	'M0680'
or substr(dx,1,6) =	'M06811'
or substr(dx,1,6) =	'M06812'
or substr(dx,1,6) =	'M06819'
or substr(dx,1,6) =	'M06821'
or substr(dx,1,6) =	'M06822'
or substr(dx,1,6) =	'M06829'
or substr(dx,1,6) =	'M06831'
or substr(dx,1,6) =	'M06832'
or substr(dx,1,6) =	'M06839'
or substr(dx,1,6) =	'M06841'
or substr(dx,1,6) =	'M06842'
or substr(dx,1,6) =	'M06849'
or substr(dx,1,6) =	'M06851'
or substr(dx,1,6) =	'M06852'
or substr(dx,1,6) =	'M06859'
or substr(dx,1,6) =	'M06861'
or substr(dx,1,6) =	'M06862'
or substr(dx,1,6) =	'M06869'
or substr(dx,1,6) =	'M06871'
or substr(dx,1,6) =	'M06872'
or substr(dx,1,6) =	'M06879'
or substr(dx,1,5) =	'M0688'
or substr(dx,1,5) =	'M0689'
or substr(dx,1,4) =	'M069'
or substr(dx,1,5) =	'M0800'
or substr(dx,1,6) =	'M08011'
or substr(dx,1,6) =	'M08012'
or substr(dx,1,6) =	'M08019'
or substr(dx,1,6) =	'M08021'
or substr(dx,1,6) =	'M08022'
or substr(dx,1,6) =	'M08029'
or substr(dx,1,6) =	'M08031'
or substr(dx,1,6) =	'M08032'
or substr(dx,1,6) =	'M08039'
or substr(dx,1,6) =	'M08041'
or substr(dx,1,6) =	'M08042'
or substr(dx,1,6) =	'M08049'
or substr(dx,1,6) =	'M08051'
or substr(dx,1,6) =	'M08052'
or substr(dx,1,6) =	'M08059'
or substr(dx,1,6) =	'M08061'
or substr(dx,1,6) =	'M08062'
or substr(dx,1,6) =	'M08069'
or substr(dx,1,6) =	'M08071'
or substr(dx,1,6) =	'M08072'
or substr(dx,1,6) =	'M08079'
or substr(dx,1,5) =	'M0808'
or substr(dx,1,5) =	'M0809'
or substr(dx,1,4) =	'M081'
or substr(dx,1,5) =	'M0820'
or substr(dx,1,6) =	'M08211'
or substr(dx,1,6) =	'M08212'
or substr(dx,1,6) =	'M08219'
or substr(dx,1,6) =	'M08221'
or substr(dx,1,6) =	'M08222'
or substr(dx,1,6) =	'M08229'
or substr(dx,1,6) =	'M08231'
or substr(dx,1,6) =	'M08232'
or substr(dx,1,6) =	'M08239'
or substr(dx,1,6) =	'M08241'
or substr(dx,1,6) =	'M08242'
or substr(dx,1,6) =	'M08249'
or substr(dx,1,6) =	'M08251'
or substr(dx,1,6) =	'M08252'
or substr(dx,1,6) =	'M08259'
or substr(dx,1,6) =	'M08261'
or substr(dx,1,6) =	'M08262'
or substr(dx,1,6) =	'M08269'
or substr(dx,1,6) =	'M08271'
or substr(dx,1,6) =	'M08272'
or substr(dx,1,6) =	'M08279'
or substr(dx,1,5) =	'M0828'
or substr(dx,1,5) =	'M0829'
or substr(dx,1,4) =	'M083'
or substr(dx,1,5) =	'M0840'
or substr(dx,1,6) =	'M08411'
or substr(dx,1,6) =	'M08412'
or substr(dx,1,6) =	'M08419'
or substr(dx,1,6) =	'M08421'
or substr(dx,1,6) =	'M08422'
or substr(dx,1,6) =	'M08429'
or substr(dx,1,6) =	'M08431'
or substr(dx,1,6) =	'M08432'
or substr(dx,1,6) =	'M08439'
or substr(dx,1,6) =	'M08441'
or substr(dx,1,6) =	'M08442'
or substr(dx,1,6) =	'M08449'
or substr(dx,1,6) =	'M08451'
or substr(dx,1,6) =	'M08452'
or substr(dx,1,6) =	'M08459'
or substr(dx,1,6) =	'M08461'
or substr(dx,1,6) =	'M08462'
or substr(dx,1,6) =	'M08469'
or substr(dx,1,6) =	'M08471'
or substr(dx,1,6) =	'M08472'
or substr(dx,1,6) =	'M08479'
or substr(dx,1,5) =	'M0848'
or substr(dx,1,5) =	'M0880'
or substr(dx,1,6) =	'M08811'
or substr(dx,1,6) =	'M08812'
or substr(dx,1,6) =	'M08819'
or substr(dx,1,6) =	'M08821'
or substr(dx,1,6) =	'M08822'
or substr(dx,1,6) =	'M08829'
or substr(dx,1,6) =	'M08831'
or substr(dx,1,6) =	'M08832'
or substr(dx,1,6) =	'M08839'
or substr(dx,1,6) =	'M08841'
or substr(dx,1,6) =	'M08842'
or substr(dx,1,6) =	'M08849'
or substr(dx,1,6) =	'M08851'
or substr(dx,1,6) =	'M08852'
or substr(dx,1,6) =	'M08859'
or substr(dx,1,6) =	'M08861'
or substr(dx,1,6) =	'M08862'
or substr(dx,1,6) =	'M08869'
or substr(dx,1,6) =	'M08871'
or substr(dx,1,6) =	'M08872'
or substr(dx,1,6) =	'M08879'
or substr(dx,1,5) =	'M0888'
or substr(dx,1,5) =	'M0889'
or substr(dx,1,5) =	'M0890'
or substr(dx,1,6) =	'M08911'
or substr(dx,1,6) =	'M08912'
or substr(dx,1,6) =	'M08919'
or substr(dx,1,6) =	'M08921'
or substr(dx,1,6) =	'M08922'
or substr(dx,1,6) =	'M08929'
or substr(dx,1,6) =	'M08931'
or substr(dx,1,6) =	'M08932'
or substr(dx,1,6) =	'M08939'
or substr(dx,1,6) =	'M08941'
or substr(dx,1,6) =	'M08942'
or substr(dx,1,6) =	'M08949'
or substr(dx,1,6) =	'M08951'
or substr(dx,1,6) =	'M08952'
or substr(dx,1,6) =	'M08959'
or substr(dx,1,6) =	'M08961'
or substr(dx,1,6) =	'M08962'
or substr(dx,1,6) =	'M08969'
or substr(dx,1,6) =	'M08971'
or substr(dx,1,6) =	'M08972'
or substr(dx,1,6) =	'M08979'
or substr(dx,1,5) =	'M0898'
or substr(dx,1,5) =	'M0899'
or substr(dx,1,4) =	'M150'
or substr(dx,1,4) =	'M151'
or substr(dx,1,4) =	'M152'
or substr(dx,1,4) =	'M153'
or substr(dx,1,4) =	'M154'
or substr(dx,1,4) =	'M158'
or substr(dx,1,4) =	'M159'
or substr(dx,1,4) =	'M160'
or substr(dx,1,5) =	'M1610'
or substr(dx,1,5) =	'M1611'
or substr(dx,1,5) =	'M1612'
or substr(dx,1,4) =	'M162'
or substr(dx,1,5) =	'M1630'
or substr(dx,1,5) =	'M1631'
or substr(dx,1,5) =	'M1632'
or substr(dx,1,4) =	'M164'
or substr(dx,1,5) =	'M1650'
or substr(dx,1,5) =	'M1651'
or substr(dx,1,5) =	'M1652'
or substr(dx,1,4) =	'M166'
or substr(dx,1,4) =	'M167'
or substr(dx,1,4) =	'M169'
or substr(dx,1,4) =	'M170'
or substr(dx,1,5) =	'M1710'
or substr(dx,1,5) =	'M1711'
or substr(dx,1,5) =	'M1712'
or substr(dx,1,4) =	'M172'
or substr(dx,1,5) =	'M1730'
or substr(dx,1,5) =	'M1731'
or substr(dx,1,5) =	'M1732'
or substr(dx,1,4) =	'M174'
or substr(dx,1,4) =	'M175'
or substr(dx,1,4) =	'M179'
or substr(dx,1,4) =	'M180'
or substr(dx,1,5) =	'M1810'
or substr(dx,1,5) =	'M1811'
or substr(dx,1,5) =	'M1812'
or substr(dx,1,4) =	'M182'
or substr(dx,1,5) =	'M1830'
or substr(dx,1,5) =	'M1831'
or substr(dx,1,5) =	'M1832'
or substr(dx,1,4) =	'M184'
or substr(dx,1,5) =	'M1850'
or substr(dx,1,5) =	'M1851'
or substr(dx,1,5) =	'M1852'
or substr(dx,1,4) =	'M189'
or substr(dx,1,6) =	'M19011'
or substr(dx,1,6) =	'M19012'
or substr(dx,1,6) =	'M19019'
or substr(dx,1,6) =	'M19021'
or substr(dx,1,6) =	'M19022'
or substr(dx,1,6) =	'M19029'
or substr(dx,1,6) =	'M19031'
or substr(dx,1,6) =	'M19032'
or substr(dx,1,6) =	'M19039'
or substr(dx,1,6) =	'M19041'
or substr(dx,1,6) =	'M19042'
or substr(dx,1,6) =	'M19049'
or substr(dx,1,6) =	'M19071'
or substr(dx,1,6) =	'M19072'
or substr(dx,1,6) =	'M19079'
or substr(dx,1,6) =	'M19111'
or substr(dx,1,6) =	'M19112'
or substr(dx,1,6) =	'M19119'
or substr(dx,1,6) =	'M19121'
or substr(dx,1,6) =	'M19122'
or substr(dx,1,6) =	'M19129'
or substr(dx,1,6) =	'M19131'
or substr(dx,1,6) =	'M19132'
or substr(dx,1,6) =	'M19139'
or substr(dx,1,6) =	'M19141'
or substr(dx,1,6) =	'M19142'
or substr(dx,1,6) =	'M19149'
or substr(dx,1,6) =	'M19171'
or substr(dx,1,6) =	'M19172'
or substr(dx,1,6) =	'M19179'
or substr(dx,1,6) =	'M19211'
or substr(dx,1,6) =	'M19212'
or substr(dx,1,6) =	'M19219'
or substr(dx,1,6) =	'M19221'
or substr(dx,1,6) =	'M19222'
or substr(dx,1,6) =	'M19229'
or substr(dx,1,6) =	'M19231'
or substr(dx,1,6) =	'M19232'
or substr(dx,1,6) =	'M19239'
or substr(dx,1,6) =	'M19241'
or substr(dx,1,6) =	'M19242'
or substr(dx,1,6) =	'M19249'
or substr(dx,1,6) =	'M19271'
or substr(dx,1,6) =	'M19272'
or substr(dx,1,6) =	'M19279'
or substr(dx,1,5) =	'M1990'
or substr(dx,1,5) =	'M1991'
or substr(dx,1,5) =	'M1992'
or substr(dx,1,5) =	'M1993'
or substr(dx,1,4) =	'M450'
or substr(dx,1,4) =	'M451'
or substr(dx,1,4) =	'M452'
or substr(dx,1,4) =	'M453'
or substr(dx,1,4) =	'M454'
or substr(dx,1,4) =	'M455'
or substr(dx,1,4) =	'M456'
or substr(dx,1,4) =	'M457'
or substr(dx,1,4) =	'M458'
or substr(dx,1,4) =	'M459'
or substr(dx,1,6) =	'M47011'
or substr(dx,1,6) =	'M47012'
or substr(dx,1,6) =	'M47013'
or substr(dx,1,6) =	'M47014'
or substr(dx,1,6) =	'M47015'
or substr(dx,1,6) =	'M47016'
or substr(dx,1,6) =	'M47019'
or substr(dx,1,6) =	'M47021'
or substr(dx,1,6) =	'M47022'
or substr(dx,1,6) =	'M47029'
or substr(dx,1,5) =	'M4710'
or substr(dx,1,5) =	'M4711'
or substr(dx,1,5) =	'M4712'
or substr(dx,1,5) =	'M4713'
or substr(dx,1,5) =	'M4720'
or substr(dx,1,5) =	'M4721'
or substr(dx,1,5) =	'M4722'
or substr(dx,1,5) =	'M4723'
or substr(dx,1,5) =	'M4724'
or substr(dx,1,5) =	'M4725'
or substr(dx,1,5) =	'M4726'
or substr(dx,1,5) =	'M4727'
or substr(dx,1,5) =	'M4728'
or substr(dx,1,6) =	'M47811'
or substr(dx,1,6) =	'M47812'
or substr(dx,1,6) =	'M47813'
or substr(dx,1,6) =	'M47814'
or substr(dx,1,6) =	'M47815'
or substr(dx,1,6) =	'M47816'
or substr(dx,1,6) =	'M47817'
or substr(dx,1,6) =	'M47818'
or substr(dx,1,6) =	'M47819'
or substr(dx,1,6) =	'M47891'
or substr(dx,1,6) =	'M47892'
or substr(dx,1,6) =	'M47893'
or substr(dx,1,6) =	'M47894'
or substr(dx,1,6) =	'M47895'
or substr(dx,1,6) =	'M47896'
or substr(dx,1,6) =	'M47897'
or substr(dx,1,6) =	'M47898'
or substr(dx,1,6) =	'M47899'
or substr(dx,1,4) =	'M479'
or substr(dx,1,6) =	'M488X1'
or substr(dx,1,6) =	'M488X2'
or substr(dx,1,6) =	'M488X3'
or substr(dx,1,6) =	'M488X4'
or substr(dx,1,6) =	'M488X5'
or substr(dx,1,6) =	'M488X6'
or substr(dx,1,6) =	'M488X7'
or substr(dx,1,6) =	'M488X8'
or substr(dx,1,6) =	'M488X9')
		and ccw_21=0
                then ccw_21=1;
  * Stroke ;
	if (substr(dx,1,3) =	'430'
or substr(dx,1,3) =	'431'
or substr(dx,1,5) =	'43301'
or substr(dx,1,5) =	'43311'
or substr(dx,1,5) =	'43321'
or substr(dx,1,5) =	'43331'
or substr(dx,1,5) =	'43381'
or substr(dx,1,5) =	'43391'
or substr(dx,1,5) =	'43401'
or substr(dx,1,5) =	'43411'
or substr(dx,1,5) =	'43410'
or substr(dx,1,5) =	'43491'
or substr(dx,1,5) =	'43490'
or substr(dx,1,5) =	'43400'
or substr(dx,1,4) =	'4351'
or substr(dx,1,4) =	'4353'
or substr(dx,1,4) =	'4358'
or substr(dx,1,4) =	'4359'
or substr(dx,1,4) =	'4350'
or substr(dx,1,3) =	'436'
or substr(dx,1,5) =	'99702'
or substr(dx,1,4) =	'G450'
or substr(dx,1,4) =	'G451'
or substr(dx,1,4) =	'G452'
or substr(dx,1,4) =	'G458'
or substr(dx,1,4) =	'G459'
or substr(dx,1,4) =	'G460'
or substr(dx,1,4) =	'G461'
or substr(dx,1,4) =	'G462'
or substr(dx,1,4) =	'G463'
or substr(dx,1,4) =	'G464'
or substr(dx,1,4) =	'G465'
or substr(dx,1,4) =	'G466'
or substr(dx,1,4) =	'G467'
or substr(dx,1,4) =	'G468'
or substr(dx,1,5) =	'G9731'
or substr(dx,1,5) =	'G9732'
or substr(dx,1,5) =	'I6000'
or substr(dx,1,5) =	'I6001'
or substr(dx,1,5) =	'I6002'
or substr(dx,1,5) =	'I6010'
or substr(dx,1,5) =	'I6011'
or substr(dx,1,5) =	'I6012'
or substr(dx,1,5) =	'I6020'
or substr(dx,1,5) =	'I6021'
or substr(dx,1,5) =	'I6022'
or substr(dx,1,5) =	'I6030'
or substr(dx,1,5) =	'I6031'
or substr(dx,1,5) =	'I6032'
or substr(dx,1,4) =	'I604'
or substr(dx,1,5) =	'I6050'
or substr(dx,1,5) =	'I6051'
or substr(dx,1,5) =	'I6052'
or substr(dx,1,4) =	'I606'
or substr(dx,1,4) =	'I607'
or substr(dx,1,4) =	'I608'
or substr(dx,1,4) =	'I609'
or substr(dx,1,4) =	'I610'
or substr(dx,1,4) =	'I611'
or substr(dx,1,4) =	'I612'
or substr(dx,1,4) =	'I613'
or substr(dx,1,4) =	'I614'
or substr(dx,1,4) =	'I615'
or substr(dx,1,4) =	'I616'
or substr(dx,1,4) =	'I618'
or substr(dx,1,4) =	'I619'
or substr(dx,1,5) =	'I6300'
or substr(dx,1,6) =	'I63011'
or substr(dx,1,6) =	'I63012'
or substr(dx,1,6) =	'I63013'
or substr(dx,1,6) =	'I63019'
or substr(dx,1,5) =	'I6302'
or substr(dx,1,5) =	'I6302'
or substr(dx,1,6) =	'I63031'
or substr(dx,1,6) =	'I63032'
or substr(dx,1,6) =	'I63039'
or substr(dx,1,5) =	'I6309'
or substr(dx,1,5) =	'I6310'
or substr(dx,1,6) =	'I63111'
or substr(dx,1,6) =	'I63112'
or substr(dx,1,6) =	'I63119'
or substr(dx,1,5) =	'I6312'
or substr(dx,1,6) =	'I63131'
or substr(dx,1,6) =	'I63132'
or substr(dx,1,6) =	'I63139'
or substr(dx,1,5) =	'I6319'
or substr(dx,1,5) =	'I6320'
or substr(dx,1,6) =	'I63211'
or substr(dx,1,6) =	'I63212'
or substr(dx,1,6) =	'I63213'
or substr(dx,1,6) =	'I63219'
or substr(dx,1,5) =	'I6322'
or substr(dx,1,6) =	'I63231'
or substr(dx,1,6) =	'I63232'
or substr(dx,1,6) =	'I63233'
or substr(dx,1,6) =	'I63239'
or substr(dx,1,5) =	'I6329'
or substr(dx,1,5) =	'I6330'
or substr(dx,1,6) =	'I63311'
or substr(dx,1,6) =	'I63312'
or substr(dx,1,6) =	'I63313'
or substr(dx,1,6) =	'I63319'
or substr(dx,1,6) =	'I63321'
or substr(dx,1,6) =	'I63322'
or substr(dx,1,6) =	'I63323'
or substr(dx,1,6) =	'I63329'
or substr(dx,1,6) =	'I63331'
or substr(dx,1,6) =	'I63332'
or substr(dx,1,6) =	'I63333'
or substr(dx,1,6) =	'I63339'
or substr(dx,1,6) =	'I63341'
or substr(dx,1,6) =	'I63342'
or substr(dx,1,6) =	'I63343'
or substr(dx,1,6) =	'I63349'
or substr(dx,1,5) =	'I6339'
or substr(dx,1,5) =	'I6340'
or substr(dx,1,6) =	'I63411'
or substr(dx,1,6) =	'I63412'
or substr(dx,1,6) =	'I63413'
or substr(dx,1,6) =	'I63419'
or substr(dx,1,6) =	'I63421'
or substr(dx,1,6) =	'I63422'
or substr(dx,1,6) =	'I63423'
or substr(dx,1,6) =	'I63429'
or substr(dx,1,6) =	'I63431'
or substr(dx,1,6) =	'I63432'
or substr(dx,1,6) =	'I63433'
or substr(dx,1,6) =	'I63439'
or substr(dx,1,6) =	'I63441'
or substr(dx,1,6) =	'I63442'
or substr(dx,1,6) =	'I63443'
or substr(dx,1,6) =	'I63449'
or substr(dx,1,5) =	'I6349'
or substr(dx,1,5) =	'I6350'
or substr(dx,1,6) =	'I63511'
or substr(dx,1,6) =	'I63512'
or substr(dx,1,6) =	'I63513'
or substr(dx,1,6) =	'I63519'
or substr(dx,1,6) =	'I63521'
or substr(dx,1,6) =	'I63522'
or substr(dx,1,6) =	'I63523'
or substr(dx,1,6) =	'I63529'
or substr(dx,1,6) =	'I63531'
or substr(dx,1,6) =	'I63532'
or substr(dx,1,6) =	'I63533'
or substr(dx,1,6) =	'I63539'
or substr(dx,1,6) =	'I63541'
or substr(dx,1,6) =	'I63542'
or substr(dx,1,6) =	'I63543'
or substr(dx,1,6) =	'I63549'
or substr(dx,1,5) =	'I6359'
or substr(dx,1,4) =	'I636'
or substr(dx,1,4) =	'I638'
or substr(dx,1,4) =	'I639'
or substr(dx,1,5) =	'I6601'
or substr(dx,1,5) =	'I6602'
or substr(dx,1,5) =	'I6603'
or substr(dx,1,5) =	'I6609'
or substr(dx,1,5) =	'I6611'
or substr(dx,1,5) =	'I6612'
or substr(dx,1,5) =	'I6613'
or substr(dx,1,5) =	'I6619'
or substr(dx,1,5) =	'I6621'
or substr(dx,1,5) =	'I6622'
or substr(dx,1,5) =	'I6623'
or substr(dx,1,5) =	'I6629'
or substr(dx,1,4) =	'I663'
or substr(dx,1,4) =	'I668'
or substr(dx,1,4) =	'I669'
or substr(dx,1,6) =	'I67841'
or substr(dx,1,6) =	'I67848'
or substr(dx,1,5) =	'I6789'
or substr(dx,1,6) =	'I97810'
or substr(dx,1,6) =	'I97811'
or substr(dx,1,6) =	'I97820'
or substr(dx,1,6) =	'I97821')
		and ccw_22=0
                then ccw_22=1;
  * Colorectal Cancer ;
	if (substr(dx,1,4) =	'1531'
or substr(dx,1,4) =	'1532'
or substr(dx,1,4) =	'1533'
or substr(dx,1,4) =	'1534'
or substr(dx,1,4) =	'1535'
or substr(dx,1,4) =	'1536'
or substr(dx,1,4) =	'1537'
or substr(dx,1,4) =	'1538'
or substr(dx,1,4) =	'1539'
or substr(dx,1,4) = '1540'
or substr(dx,1,4) = '1541'
or substr(dx,1,4) =	'1530'
or substr(dx,1,4) =	'2303'
or substr(dx,1,4) =	'2304'
or substr(dx,1,5) =	'V1005'
or substr(dx,1,5) =	'V1006'
or substr(dx,1,4) =	'C180'
or substr(dx,1,4) =	'C181'
or substr(dx,1,4) =	'C182'
or substr(dx,1,4) =	'C183'
or substr(dx,1,4) =	'C184'
or substr(dx,1,4) =	'C185'
or substr(dx,1,4) =	'C186'
or substr(dx,1,4) =	'C187'
or substr(dx,1,4) =	'C188'
or substr(dx,1,4) =	'C189'
or substr(dx,1,3) =	'C19'
or substr(dx,1,3) =	'C20'
or substr(dx,1,4) =	'D010'
or substr(dx,1,4) =	'D011'
or substr(dx,1,4) =	'D012'
or substr(dx,1,6) =	'Z85038'
or substr(dx,1,6) =	'Z85040'
or substr(dx,1,6) =	'Z85048')
		and ccw_23=0
                then ccw_23=1;
  * Endometrial Cancer ;
	if (substr(dx,1,4) =	'1820'
or substr(dx,1,4) =	'2332'
or substr(dx,1,5) =	'V1042'
or substr(dx,1,4) =	'C541'
or substr(dx,1,4) =	'C542'
or substr(dx,1,4) =	'C543'
or substr(dx,1,4) =	'C548'
or substr(dx,1,4) =	'C549'
or substr(dx,1,4) =	'D070'
or substr(dx,1,5) =	'Z8542')
		and ccw_24=0
                then ccw_24=1;
  * Breast Cancer ;
if (substr(dx,1,4) = '1741'
or substr(dx,1,4) =	'1742'
or substr(dx,1,4) =	'1743'
or substr(dx,1,4) =	'1744'
or substr(dx,1,4) =	'1745'
or substr(dx,1,4) =	'1746'
or substr(dx,1,4) =	'1748'
or substr(dx,1,4) =	'1749'
or substr(dx,1,4) =	'1740'
or substr(dx,1,4) =	'1759'
or substr(dx,1,4) =	'1750'
or substr(dx,1,4) =	'2330'
or substr(dx,1,4) =	'V103'
or substr(dx,1,6) =	'C50011'
or substr(dx,1,6) =	'C50012'
or substr(dx,1,6) =	'C50019'
or substr(dx,1,6) =	'C50021'
or substr(dx,1,6) =	'C50022'
or substr(dx,1,6) =	'C50029'
or substr(dx,1,6) =	'C50111'
or substr(dx,1,6) =	'C50112'
or substr(dx,1,6) =	'C50119'
or substr(dx,1,6) =	'C50121'
or substr(dx,1,6) =	'C50122'
or substr(dx,1,6) =	'C50129'
or substr(dx,1,6) =	'C50211'
or substr(dx,1,6) =	'C50212'
or substr(dx,1,6) =	'C50219'
or substr(dx,1,6) =	'C50221'
or substr(dx,1,6) =	'C50222'
or substr(dx,1,6) =	'C50229'
or substr(dx,1,6) =	'C50311'
or substr(dx,1,6) =	'C50312'
or substr(dx,1,6) =	'C50319'
or substr(dx,1,6) =	'C50321'
or substr(dx,1,6) =	'C50322'
or substr(dx,1,6) =	'C50329'
or substr(dx,1,6) =	'C50411'
or substr(dx,1,6) =	'C50412'
or substr(dx,1,6) =	'C50419'
or substr(dx,1,6) =	'C50421'
or substr(dx,1,6) =	'C50422'
or substr(dx,1,6) =	'C50429'
or substr(dx,1,6) =	'C50511'
or substr(dx,1,6) =	'C50512'
or substr(dx,1,6) =	'C50519'
or substr(dx,1,6) =	'C50521'
or substr(dx,1,6) =	'C50522'
or substr(dx,1,6) =	'C50529'
or substr(dx,1,6) =	'C50611'
or substr(dx,1,6) =	'C50612'
or substr(dx,1,6) =	'C50619'
or substr(dx,1,6) =	'C50621'
or substr(dx,1,6) =	'C50622'
or substr(dx,1,6) =	'C50629'
or substr(dx,1,6) =	'C50811'
or substr(dx,1,6) =	'C50812'
or substr(dx,1,6) =	'C50819'
or substr(dx,1,6) =	'C50821'
or substr(dx,1,6) =	'C50822'
or substr(dx,1,6) =	'C50829'
or substr(dx,1,6) =	'C50911'
or substr(dx,1,6) =	'C50912'
or substr(dx,1,6) =	'C50919'
or substr(dx,1,6) =	'C50921'
or substr(dx,1,6) =	'C50922'
or substr(dx,1,6) =	'C50929'
or substr(dx,1,5) =	'D0500'
or substr(dx,1,5) =	'D0501'
or substr(dx,1,5) =	'D0502'
or substr(dx,1,5) =	'D0510'
or substr(dx,1,5) =	'D0511'
or substr(dx,1,5) =	'D0512'
or substr(dx,1,5) =	'D0580'
or substr(dx,1,5) =	'D0581'
or substr(dx,1,5) =	'D0582'
or substr(dx,1,5) =	'D0590'
or substr(dx,1,5) =	'D0591'
or substr(dx,1,5) =	'D0592'
or substr(dx,1,4) =	'Z853' )
		and ccw_25=0
                then ccw_25=1;
  * Lung Cancer ;
	if (substr(dx,1,4) =	'1622'
or substr(dx,1,4) =	'1623'
or substr(dx,1,4) =	'1624'
or substr(dx,1,4) =	'1625'
or substr(dx,1,4) =	'1628'
or substr(dx,1,4) =	'1629'
or substr(dx,1,4) =	'2312'
or substr(dx,1,5) =	'V1011'
or substr(dx,1,5) =	'C3400'
or substr(dx,1,5) =	'C3401'
or substr(dx,1,5) =	'C3402'
or substr(dx,1,5) =	'C3410'
or substr(dx,1,5) =	'C3411'
or substr(dx,1,5) =	'C3412'
or substr(dx,1,4) =	'C342'
or substr(dx,1,5) =	'C3430'
or substr(dx,1,5) =	'C3431'
or substr(dx,1,5) =	'C3432'
or substr(dx,1,5) =	'C3480'
or substr(dx,1,5) =	'C3481'
or substr(dx,1,5) =	'C3482'
or substr(dx,1,5) =	'C3490'
or substr(dx,1,5) =	'C3491'
or substr(dx,1,5) =	'C3492'
or substr(dx,1,5) =	'D0220'
or substr(dx,1,5) =	'D0221'
or substr(dx,1,5) =	'D0222'
or substr(dx,1,6) =	'Z85110'
or substr(dx,1,6) =	'Z85118')
		and ccw_26=0
                then ccw_26=1;
  * Prostate Cancer ;
	if (substr(dx,1,3) =	'185'
or substr(dx,1,4) =	'2334'
or substr(dx,1,5) =	'V1046'
or substr(dx,1,3) =	'C61'
or substr(dx,1,4) =	'D075'
or substr(dx,1,5) =	'Z8546')
		and ccw_27=0
                then ccw_27=1;
end;

run;

/*get count of each comorbidity for each id-core year combination*/
proc sql;
create table cnt_test1 as
select distinct bid_hrs_22,index_date,
sum(ccw_1) as cnt_1,
sum(ccw_2) as cnt_2,
sum(ccw_3) as cnt_3,
sum(ccw_4) as cnt_4,
sum(ccw_5) as cnt_5,
sum(ccw_6) as cnt_6,
sum(ccw_7) as cnt_7,
sum(ccw_8) as cnt_8,
sum(ccw_9) as cnt_9,
sum(ccw_10) as cnt_10,
sum(ccw_11) as cnt_11,
sum(ccw_12) as cnt_12,
sum(ccw_13) as cnt_13,
sum(ccw_14) as cnt_14,
sum(ccw_15) as cnt_15,
sum(ccw_16) as cnt_16,
sum(ccw_17) as cnt_17,
sum(ccw_18) as cnt_18,
sum(ccw_19) as cnt_19,
sum(ccw_20) as cnt_20,
sum(ccw_21) as cnt_21,
sum(ccw_22) as cnt_22,
sum(ccw_23) as cnt_23,
sum(ccw_24) as cnt_24,
sum(ccw_25) as cnt_25,
sum(ccw_26) as cnt_26,
sum(ccw_27) as cnt_27
from dx_ccw
group by bid_hrs_22,index_date;
quit;

/*convert counts of diagnoses for each comorbidity to indicator variables*/ 
data ccw_1(keep=bid_hrs_22 index_date ccw_1-ccw_27 ccw_index);
set cnt_test1;
array list_cha cnt_1-cnt_27;
array list_cnt_bin ccw_1-ccw_27 ;

do over list_cha;
  list_cnt_bin=0;

  if list_cha>0 then do;
    list_cnt_bin=1;
   end;

end;
/*note this ccw_index count count is not weighted for morbidity*/
ccw_index=ccw_1+ccw_2+ccw_3+ccw_4+ccw_5+ccw_6+ccw_7+ccw_8+ccw_9+ccw_10
+ccw_11+ccw_12+ccw_13+ccw_14+ccw_15+ccw_16+ccw_17+ccw_18+ccw_19+ccw_20
+ccw_21+ccw_22+ccw_23+ccw_24+ccw_25+ccw_26+ccw_27;

label ccw_1 ='Acquired Hypothyroidism, CCW';
label ccw_2 ='AMI, CCW';
label ccw_3 ="Alzheimer's";
label ccw_4 ="Alzheimer's & Related/Dementia";
label ccw_5 ='Anemia';
label ccw_6 ='Asthma';
label ccw_7 ='Atrial Fibrillation';
label ccw_8 ='Benign Prostatic Hyperplasia';
label ccw_9 ='Cataract';
label ccw_10 ='CKD';
label ccw_11 ='COPD/Bronchiectasis';
label ccw_12 ='Depression';
label ccw_13 ='Diabetes';
label ccw_14 ='Glaucoma';
label ccw_15 ='Heart Failure';
label ccw_16 ='Hip/Pelvic Fracture';
label ccw_17 ='Hyperlipidemia';
label ccw_18 ='Hypertension';
label ccw_19 ='Ischemic Heart Disease';
label ccw_20 ='Osteoporosis';
label ccw_21 ='RA/OA';
label ccw_22 ='Stroke/Transient Ischemic Attack';
label ccw_23 ='Colorectal Cancer';
label ccw_24 ='Endometrial Cancer';
label ccw_25 ='Breast Cancer';
label ccw_26 ='Lung Cancer';
label ccw_27 ='Prostate Cancer';
label ccw_index ='Count of CCs (out of 27)';

run;

/*merge into list of obs with ffs mc 6m prior to ivw*/
proc sort data=ccw_1 out=test nodupkey;
by bid_hrs_22 index_date;
run;



%rename(WORK,TEST,&range1._&range2);

data ccw_&range1._&range2.(rename =(bid_hrs_22_&range1._&range2=bid_hrs_22
index_date_&range1._&range2=index_date));
set test;
keep bid_hrs_22_&range1._&range2 ccw: index_date:;
run;
proc sort data=ccw_&range1._&range2.;
by bid_hrs_22 index_date;
run;

%mend;


%ccw(range1=0m, range2=12m);
%ccw(range1=0m, range2=24m);




proc sql; 
create table proj_int.ccw as select * from
proj_int.index a
left join 
ccw_0m_12m b
on a.bid_hrs_22=b.bid_hrs_22 and a.index_date=b.index_date
left join 
ccw_0m_24m c
on a.bid_hrs_22=c.bid_hrs_22 and a.index_date=c.index_date;
quit;


H="CCW CCs following actual methodology"


H="Change log"


********************Change Log******************** 



Updates:



12/17/2018 MH
------------
A formal template in Notetab was created with different headings. 

12/13/2018 MH
-------------
Change log conception was first introduced.


*/

H="Charlson"
/*

Created by: EBL
Date Created: 2/8/19

Updated by: EBL
Date Updated: 2/13/19

Notes: Brings in Charlson charlsondities to R01 dataset, including ICD-10 Charlson.  


**************************************************


/*Add indicator variables for the Charlson charlsondities
and Charlson weighted and unweighted index */

/*Charlson code

This program reads through the diagnosis codes of patient abstract records in a hospital
    file and identifies whether the record belongs to one (or more) of 17 different Charlson
    charlsondity Index (CCI) groups.  The groups are identified by using the Enhanced ICD-9-CM
    diagnosis codes listed in Quan et al., "Coding Algorithms for Defining charlsondities
    in ICD-9-CM and ICD-10 Administrative Data", Medical Care:43(11), Nov. 2005 p1130-1139.*/

/*final datasets to be merged are proj_int.charls_0_1yr and proj_int.charls_0_2yr*/

/****************************************************************************/
/* Rename variables macro                                                   */
/****************************************************************************/

%macro rename(lib,dsn,pre);
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "Before Renaming All Variables";
run;
proc sql noprint;
select nvar into :num_vars
from dictionary.tables
where libname="&LIB" and
memname="&DSN";
select distinct(name) into :var1-
:var%TRIM(%LEFT(&num_vars))
from dictionary.columns
where libname="&LIB" and
memname="&DSN";
quit;
run;
proc datasets library=&LIB;
modify &DSN;
rename
%do i=1 %to &num_vars;
&&var&i=&&var&i.._&pre 
%end;
;
quit;
run;
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "After Renaming All Variables";
run;
%mend rename;


%macro charlson(range1=,range2=);

data dx_charlson;
set proj_int.dx_&range1._&range2.(rename=(diag=dx_0));
dx=trim(left(dx_0));

if dx~="" then do;

*initialize variables;
   charlson_1=0;
   charlson_2=0;
   charlson_3=0;
   charlson_4=0;
   charlson_5=0;
   charlson_6=0;
      charlson_7=0;
	     charlson_8=0;
		    charlson_9=0;
			   charlson_10=0;
			      charlson_11=0;
				     charlson_12=0;
					    charlson_13=0;
						   charlson_14=0;
						      charlson_15=0;
							     charlson_16=0;
								    charlson_17=0;



 *Myocardial Infarction;
		if(substr(dx,1,3)='410' or
               substr(dx,1,3)='412' or
			   substr(dx,1,3)='I21' or
               substr(dx,1,3)='I22' or
               substr(dx,1,4)='I252')
			and charlson_1=0 
		then charlson_1=1;
*Congestive Heart Failure;
   if(substr(dx,1,3)='428' or
   			   substr(dx,1,4)='I099' or
               substr(dx,1,4)='I110' or
               substr(dx,1,4)='I130' or
               substr(dx,1,4)='I132' or
               substr(dx,1,4)='I255' or
               substr(dx,1,4)='I420' or
               substr(dx,1,4)='I425' or
               substr(dx,1,4)='I426' or
               substr(dx,1,4)='I427' or
               substr(dx,1,4)='I428' or
               substr(dx,1,4)='I429' or
               substr(dx,1,3)='I43'  or
               substr(dx,1,3)='I50'  or
               substr(dx,1,4)='P290')
		and charlson_2=0 
		then charlson_2=1;*add one binary variables here.;

*Periphral Vascular Disease;
		if(substr(dx,1,4)='0930' or
               substr(dx,1,4)='4373' or
               substr(dx,1,3)='440' or
               substr(dx,1,3)='441' or
               substr(dx,1,4)='4431' or
               substr(dx,1,4)='4432' or
               substr(dx,1,4)='4438' or
               substr(dx,1,4)='4439' or
               substr(dx,1,4)='4471' or
               substr(dx,1,4)='5571' or
               substr(dx,1,4)='5579' or
               substr(dx,1,4)='V434' or
    		   substr(dx,1,3)='I70' or
               substr(dx,1,3)='I71' or
               substr(dx,1,4)='I731' or
               substr(dx,1,4)='I738' or
               substr(dx,1,4)='I739' or
               substr(dx,1,4)='I771' or
               substr(dx,1,4)='I790' or
               substr(dx,1,4)='I792' or
               substr(dx,1,4)='K551' or
               substr(dx,1,4)='K558' or
               substr(dx,1,4)='K559' or
			   substr(dx,1,4)='Z958' or
               substr(dx,1,4)='Z959')
			and charlson_3=0 
		then charlson_3=1;
 *Cerebrovascular Disease ;
        if(substr(dx,1,5)='36234' or
               substr(dx,1,3)='430' or
               substr(dx,1,3)='431' or
               substr(dx,1,3)='432' or
               substr(dx,1,3)='433' or
               substr(dx,1,3)='434' or
               substr(dx,1,3)='435' or
               substr(dx,1,3)='436' or
               substr(dx,1,3)='437' or
               substr(dx,1,3)='438' or
			   substr(dx,1,3)='G45' or
               substr(dx,1,3)='G46' or
               substr(dx,1,4)='H340' or
               substr(dx,1,3)='I60' or
               substr(dx,1,3)='I61' or
               substr(dx,1,3)='I62' or
               substr(dx,1,3)='I63' or
               substr(dx,1,3)='I64' or
               substr(dx,1,3)='I65' or
			   substr(dx,1,3)='I66' or
               substr(dx,1,3)='I67' or
               substr(dx,1,3)='I68' or
               substr(dx,1,3)='I69')
			and charlson_4=0 
		then charlson_4=1;
*Dementia ;
       if(substr(dx,1,3)='290' or
               substr(dx,1,4)='2941' or
               substr(dx,1,4)='3312' or
			   substr(dx,1,3)='F00' or
               substr(dx,1,3)='F01' or
               substr(dx,1,3)='F02' or
               substr(dx,1,3)='F03' or
               substr(dx,1,4)='F051' or
               substr(dx,1,3)='G30' or
               substr(dx,1,4)='G311')
			and charlson_5=0 
		then charlson_5=1;
	*Chronic Pulmonary Disease ;
        if(substr(dx,1,4)='4168' or
               substr(dx,1,4)='4169' or
               substr(dx,1,3)='490' or
               substr(dx,1,3)='491' or
               substr(dx,1,3)='492' or
               substr(dx,1,3)='493' or
               substr(dx,1,3)='494' or
               substr(dx,1,3)='495' or
               substr(dx,1,3)='496' or
               substr(dx,1,3)='500' or
               substr(dx,1,3)='501' or
               substr(dx,1,3)='502' or
               substr(dx,1,3)='503' or
               substr(dx,1,3)='504' or
               substr(dx,1,3)='505' or
               substr(dx,1,4)='5064' or
               substr(dx,1,4)='5081' or
               substr(dx,1,4)='5088' or
			   substr(dx,1,4)='I278' or
               substr(dx,1,4)='I279' or
               substr(dx,1,3)='J40' or
               substr(dx,1,3)='J41' or
               substr(dx,1,3)='J42' or
               substr(dx,1,3)='J43' or
               substr(dx,1,3)='J44' or
               substr(dx,1,3)='J45' or
               substr(dx,1,3)='J46' or
               substr(dx,1,3)='J47' or
               substr(dx,1,3)='J60' or
               substr(dx,1,3)='J61' or
               substr(dx,1,3)='J62' or
               substr(dx,1,3)='J63' or
               substr(dx,1,3)='J64' or
               substr(dx,1,3)='J65' or
               substr(dx,1,3)='J66' or
			   substr(dx,1,3)='J67' or
               substr(dx,1,4)='J684' or
               substr(dx,1,4)='J701' or
               substr(dx,1,4)='J703')
			and charlson_6=0 
		then charlson_6=1;
*Connective Tissue Disease-Rheumatic Disease;
         if(substr(dx,1,4)='4465' or
               substr(dx,1,4)='7100' or
               substr(dx,1,4)='7101' or
               substr(dx,1,4)='7102' or
               substr(dx,1,4)='7103' or
               substr(dx,1,4)='7104' or
               substr(dx,1,4)='7140' or
               substr(dx,1,4)='7141' or
               substr(dx,1,4)='7142' or
               substr(dx,1,4)='7148' or
               substr(dx,1,3)='725' or
			   substr(dx,1,3)='M05' or
               substr(dx,1,3)='M06' or
               substr(dx,1,4)='M315' or
               substr(dx,1,3)='M32' or
               substr(dx,1,3)='M33' or
               substr(dx,1,3)='M34' or
               substr(dx,1,4)='M351' or
               substr(dx,1,4)='M353' or
               substr(dx,1,4)='M360')
			and charlson_7=0 
		then charlson_7=1;
*Peptic Ulcer Disease;
         if(substr(dx,1,3)='531' or
               substr(dx,1,3)='532' or
               substr(dx,1,3)='533' or
               substr(dx,1,3)='534' or
			   substr(dx,1,3)='K25' or
               substr(dx,1,3)='K26' or
               substr(dx,1,3)='K27' or
               substr(dx,1,3)='K28')
			and charlson_8=0 
		then charlson_8=1;	
*Mild Liver Disease ;
         if(substr(dx,1,5)='07022' or
               substr(dx,1,5)='07023' or
               substr(dx,1,5)='07032' or
               substr(dx,1,5)='07033' or
               substr(dx,1,5)='07044' or
               substr(dx,1,5)='07054' or
               substr(dx,1,4)='0706' or
               substr(dx,1,4)='0709' or
               substr(dx,1,3)='570' or
               substr(dx,1,3)='571' or
               substr(dx,1,4)='5733' or
               substr(dx,1,4)='5734' or
               substr(dx,1,4)='5738' or
               substr(dx,1,4)='5739' or
               substr(dx,1,4)='V427' or
			   substr(dx,1,3)='B18' or
               substr(dx,1,4)='K700' or
               substr(dx,1,4)='K701' or
               substr(dx,1,4)='K702' or
               substr(dx,1,4)='K703' or
               substr(dx,1,4)='K709' or
               substr(dx,1,4)='K713' or
               substr(dx,1,4)='K714' or
               substr(dx,1,4)='K715' or
               substr(dx,1,4)='K717' or
               substr(dx,1,3)='K73' or
               substr(dx,1,3)='K74' or
               substr(dx,1,4)='K76' or
               substr(dx,1,4)='K762' or
			   substr(dx,1,4)='K763' or
               substr(dx,1,4)='K764' or
               substr(dx,1,4)='K768' or
			   substr(dx,1,4)='K769' or
               substr(dx,1,4)='Z944')
			and charlson_9=0 
		then charlson_9=1;	
*Diabetes without complications ;
         if(substr(dx,1,4)='2500' or
               substr(dx,1,4)='2501' or
               substr(dx,1,4)='2502' or
               substr(dx,1,4)='2503' or
               substr(dx,1,4)='2508' or
               substr(dx,1,4)='2509' or
			substr(dx,1,4)='E100' or
		substr(dx,1,4)='E101' or
		substr(dx,1,4)='E106' or
		substr(dx,1,4)='E108' or
		substr(dx,1,4)='E109' or
		substr(dx,1,4)='E110' or
        substr(dx,1,4)='E111' or
		substr(dx,1,4)='E116' or
		substr(dx,1,4)='E118' or
		substr(dx,1,4)='E119' or
		substr(dx,1,4)='E120' or
		substr(dx,1,4)='E121' or
		substr(dx,1,4)='E126' or
		substr(dx,1,4)='E128' or
		substr(dx,1,4)='E129' or
		substr(dx,1,4)='E130' or
		substr(dx,1,4)='E131' or
		substr(dx,1,4)='E136' or
		substr(dx,1,4)='E138' or
        substr(dx,1,4)='E139' or
		substr(dx,1,4)='E140' or
		substr(dx,1,4)='E141' or
		substr(dx,1,4)='E146' or
		substr(dx,1,4)='E148' or
		substr(dx,1,4)='E149')
			and charlson_10=0 
		then charlson_10=1;
*Diabetes, complicated;
	if (substr(dx,1,4)='2504' or
		substr(dx,1,4)='2505' or
		substr(dx,1,4)='2506' or
		substr(dx,1,4)='2507' or
        substr(dx,1,4)='E102' or
		substr(dx,1,4)='E103' or
		substr(dx,1,4)='E104' or
		substr(dx,1,4)='E105' or
		substr(dx,1,4)='E107' or
		substr(dx,1,4)='E112' or
		substr(dx,1,4)='E113' or
		substr(dx,1,4)='E114' or
        substr(dx,1,4)='E115' or
		substr(dx,1,4)='E117' or
        substr(dx,1,4)='E122' or
		substr(dx,1,4)='E123' or
		substr(dx,1,4)='E124' or
		substr(dx,1,4)='E125' or
		substr(dx,1,4)='E127' or
		substr(dx,1,4)='E132' or
		substr(dx,1,4)='E133' or
		substr(dx,1,4)='E134' or
        substr(dx,1,4)='E135' or
		substr(dx,1,4)='E137' or
		substr(dx,1,4)='E142' or
		substr(dx,1,4)='E143' or
		substr(dx,1,4)='E144' or
        substr(dx,1,4)='E145' or
		substr(dx,1,4)='E147')
			and charlson_11=0 
		then charlson_11=1;
*Paraplegia and Hemiplegia ;
	if (substr(dx,1,4)='3341' or
		substr(dx,1,3)='342' or
		substr(dx,1,3)='343' or
		substr(dx,1,4)='3440' or
		substr(dx,1,4)='3441' or
		substr(dx,1,4)='3442' or
		substr(dx,1,4)='3443' or
                substr(dx,1,4)='3444' or
		substr(dx,1,4)='3445' or
		substr(dx,1,4)='3446' or
		substr(dx,1,4)='3449' or
		substr(dx,1,4)='G041' or
		substr(dx,1,4)='G114' or
		substr(dx,1,4)='G801' or
		substr(dx,1,4)='G802' or
		substr(dx,1,3)='G81' or
		substr(dx,1,3)='G82' or
		substr(dx,1,4)='G830' or
        substr(dx,1,4)='G834' or
		substr(dx,1,4)='G839')
			and charlson_12=0 
		then charlson_12=1;
* Renal Disease ;
	if (substr(dx,1,5)='40301' or
		substr(dx,1,5)='40311' or
		substr(dx,1,5)='40391' or
		substr(dx,1,5)='40402' or
		substr(dx,1,5)='40403' or
		substr(dx,1,5)='40412' or
		substr(dx,1,5)='40413' or
                substr(dx,1,5)='40492' or
		substr(dx,1,5)='40493' or
		substr(dx,1,3)='582' or
		substr(dx,1,4)='5830' or
                substr(dx,1,4)='5831' or
                substr(dx,1,4)='5832' or
                substr(dx,1,4)='5834' or
                substr(dx,1,4)='5836' or
                substr(dx,1,4)='5837' or
                substr(dx,1,3)='585' or
                substr(dx,1,3)='586' or
                substr(dx,1,4)='5880' or
                substr(dx,1,4)='V420' or
                substr(dx,1,4)='V451' or
                substr(dx,1,3)='V56' or
			substr(dx,1,4)='I120' or
		substr(dx,1,4)='I131' or
		substr(dx,1,4)='N032' or
		substr(dx,1,4)='N033' or
		substr(dx,1,4)='N034' or
		substr(dx,1,4)='N035' or
		substr(dx,1,4)='N036' or
        substr(dx,1,4)='N037' or
		substr(dx,1,4)='N052' or
		substr(dx,1,4)='N053' or
		substr(dx,1,4)='N054' or
                substr(dx,1,4)='N055' or
                substr(dx,1,4)='N056' or
                substr(dx,1,4)='N057' or
                substr(dx,1,3)='N18' or
                substr(dx,1,3)='N19' or
                substr(dx,1,4)='N250' or
                substr(dx,1,4)='Z490' or
                substr(dx,1,4)='Z491' or
                substr(dx,1,4)='Z492' or
                substr(dx,1,4)='Z940' or
                substr(dx,1,4)='Z992' )
			and charlson_13=0 
		then charlson_13=1;
*Cancer ;
	if (substr(dx,1,2)='14' or
		substr(dx,1,2)='15' or
		substr(dx,1,2)='16' or
		substr(dx,1,3)='170' or
		substr(dx,1,3)='171' or
		substr(dx,1,3)='172' or
		substr(dx,1,3)='174' or
		substr(dx,1,3)='175' or
		substr(dx,1,3)='176' or
		substr(dx,1,3)='179' or
		substr(dx,1,2)='18' or
		substr(dx,1,3)='190' or
		substr(dx,1,3)='191' or
		substr(dx,1,3)='192' or
		substr(dx,1,3)='193' or
		substr(dx,1,3)='194' or
		substr(dx,1,3)='195' or
                substr(dx,1,3)='200' or
                substr(dx,1,3)='201' or
                substr(dx,1,3)='202' or
                substr(dx,1,3)='203' or
                substr(dx,1,3)='204' or
                substr(dx,1,3)='205' or
                substr(dx,1,3)='206' or
                substr(dx,1,3)='207' or
                substr(dx,1,3)='208' or
                substr(dx,1,4)='2386' or
			substr(dx,1,3)='C00' or
		substr(dx,1,3)='C01' or
		substr(dx,1,3)='C02' or
		substr(dx,1,3)='C03' or
		substr(dx,1,3)='C04' or
		substr(dx,1,3)='C05' or
		substr(dx,1,3)='C06' or
		substr(dx,1,3)='C07' or
		substr(dx,1,3)='C08' or
		substr(dx,1,3)='C09' or
		substr(dx,1,3)='C10' or
		substr(dx,1,3)='C11' or
		substr(dx,1,3)='C12' or
		substr(dx,1,3)='C13' or
		substr(dx,1,3)='C14' or
		substr(dx,1,3)='C15' or
		substr(dx,1,3)='C16' or
		substr(dx,1,3)='C17' or
		substr(dx,1,3)='C18' or
		substr(dx,1,3)='C19' or
		substr(dx,1,3)='C20' or
		substr(dx,1,3)='C21' or
		substr(dx,1,3)='C22' or
		substr(dx,1,3)='C23' or
		substr(dx,1,3)='C24' or
		substr(dx,1,3)='C25' or
		substr(dx,1,3)='C26' or
		substr(dx,1,3)='C30' or
		substr(dx,1,3)='C31' or
		substr(dx,1,3)='C32' or
		substr(dx,1,3)='C33' or
		substr(dx,1,3)='C34' or
		substr(dx,1,3)='C37' or
		substr(dx,1,3)='C38' or
		substr(dx,1,3)='C39' or
		substr(dx,1,3)='C40' or
		substr(dx,1,3)='C41' or
		substr(dx,1,3)='C43' or
		substr(dx,1,3)='C45' or
		substr(dx,1,3)='C46' or
		substr(dx,1,3)='C47' or
		substr(dx,1,3)='C48' or
		substr(dx,1,3)='C49' or
		substr(dx,1,3)='C50' or
		substr(dx,1,3)='C51' or
		substr(dx,1,3)='C52' or
		substr(dx,1,3)='C53' or
		substr(dx,1,3)='C54' or
		substr(dx,1,3)='C55' or
		substr(dx,1,3)='C56' or
		substr(dx,1,3)='C57' or
		substr(dx,1,3)='C58' or
		substr(dx,1,3)='C60' or
		substr(dx,1,3)='C61' or
		substr(dx,1,3)='C62' or
		substr(dx,1,3)='C63' or
		substr(dx,1,3)='C64' or
		substr(dx,1,3)='C65' or
		substr(dx,1,3)='C66' or
		substr(dx,1,3)='C67' or
		substr(dx,1,3)='C68' or
		substr(dx,1,3)='C69' or
		substr(dx,1,3)='C70' or
		substr(dx,1,3)='C71' or
		substr(dx,1,3)='C72' or
		substr(dx,1,3)='C73' or
		substr(dx,1,3)='C74' or
		substr(dx,1,3)='C75' or
		substr(dx,1,3)='C76' or
                substr(dx,1,3)='C81' or
                substr(dx,1,3)='C82' or
                substr(dx,1,3)='C83' or
                substr(dx,1,3)='C84' or
                substr(dx,1,3)='C85' or
                substr(dx,1,3)='C88' or
                substr(dx,1,3)='C90' or
                substr(dx,1,3)='C91' or
                substr(dx,1,3)='C92' or
                substr(dx,1,3)='C93' or
                substr(dx,1,3)='C94' or
                substr(dx,1,3)='C95' or
                substr(dx,1,3)='C96' or 
                substr(dx,1,3)='C97')
			and charlson_14=0 
		then charlson_14=1;
* Moderate or Severe Liver Disease ;
	if (substr(dx,1,4)='4560' or
		substr(dx,1,4)='4561' or
		substr(dx,1,4)='4562' or
		substr(dx,1,4)='5722' or
		substr(dx,1,4)='5723' or
		substr(dx,1,4)='5724' or
      	substr(dx,1,4)='5728' or
		substr(dx,1,4)='I850' or
		substr(dx,1,4)='I859' or
		substr(dx,1,4)='I864' or
		substr(dx,1,4)='I982' or
		substr(dx,1,4)='K704' or
		substr(dx,1,4)='K711' or
		substr(dx,1,4)='K721' or
        substr(dx,1,4)='K729' or
        substr(dx,1,4)='K765' or
        substr(dx,1,4)='K766' or
        substr(dx,1,4)='K767')
		and charlson_15=0 
		then charlson_15=1;
  * Metastatic Carcinoma ;
	if (substr(dx,1,3)='196' or
		substr(dx,1,3)='197' or
		substr(dx,1,3)='198' or
		substr(dx,1,3)='199' OR
	substr(dx,1,3)='C77' or
		substr(dx,1,3)='C78' or
		substr(dx,1,3)='C79' or
		substr(dx,1,3)='C80' )
			and charlson_16=0 
		then charlson_16=1;
  * AIDS/HIV ;
	if (substr(dx,1,3)='042' or
		substr(dx,1,3)='043' or
		substr(dx,1,3)='044' or
		substr(dx,1,3)='B20' or
		substr(dx,1,3)='B21' or
        substr(dx,1,3)='B22' or
		substr(dx,1,3)='B24')
			and charlson_17=0 
		then charlson_17=1;

end;


run;




/*get count of each charlsondity for each id-core year combination*/
proc sql;
create table cha_test1 as
select distinct bid_hrs_22,index_date,
sum(charlson_1) as cha_1,
sum(charlson_2) as cha_2,
sum(charlson_3) as cha_3,
sum(charlson_4) as cha_4,
sum(charlson_5) as cha_5,
sum(charlson_6) as cha_6,
sum(charlson_7) as cha_7,
sum(charlson_8) as cha_8,
sum(charlson_9) as cha_9,
sum(charlson_10) as cha_10,
sum(charlson_11) as cha_11,
sum(charlson_12) as cha_12,
sum(charlson_13) as cha_13,
sum(charlson_14) as cha_14,
sum(charlson_15) as cha_15,
sum(charlson_16) as cha_16,
sum(charlson_17) as cha_17
from dx_charlson
group by bid_hrs_22,index_date;
quit;

/*convert counts of diagnoses for each charlsondity to indicator variables*/ 
data charlson_1(keep=bid_hrs_22 index_date charls_1-charls_17 charls_index charls_index_wt);
set cha_test1;
array list_cha cha_1-cha_17;
array list_cha_bin charls_1-charls_17 ;

do over list_cha;
  list_cha_bin=0;

  if list_cha>0 then do;
    list_cha_bin=1;
   end;

end;
/*note this charls_index count count is not weighted for morbidity*/
charls_index=charls_1+charls_2+charls_3+charls_4+charls_5+charls_6+charls_7+charls_8+charls_9+charls_10
+charls_11+charls_12+charls_13+charls_14+charls_15+charls_16+charls_17;
/*now morbidity weighted*/
charls_index_wt=charls_1+charls_2+charls_3+charls_4+charls_5+charls_6+charls_7+charls_8+charls_9+charls_10
+2*charls_11+2*charls_12+2*charls_13+2*charls_14+3*charls_15+6*charls_16+6*charls_17;

label charls_1 ="Myocardial infarction, Charlson";
label charls_2 ="Congestive Heart Failure, Charlson";
label charls_3 ="Peripheral Vascular Disease, Charlson";
label charls_4 ="Cerebrovascular disease, Charlson";
label charls_5 ="Dementia, Charlson";
label charls_6 ="Chronic Pulmonary Disease, Charlson";
label charls_7 ="Rheumatic disease, Charlson";
label charls_8 ="Peptic ulcer disease, Charlson";
label charls_9 ="Mild liver disease, Charlson";
label charls_10 ="Diabetes, uncomplicated, Charlson";
label charls_11 ="Diabetes, complicated, Charlson";
label charls_12 ="Hemiplegia or paraplegia, Charlson";
label charls_13 ="Renal disease, Charlson";
label charls_14 ="Any malignancy except neoplasm of skin, Charlson";
label charls_15 ="Mod or severe liver disease, Charlson";
label charls_16 ="Metastatic solid tumor, Charlson";
label charls_17 ="AIDS/HIV, Charlson";
label charls_index ="Charlson score index, not weighted";
label charls_index_wt ="Charlson score index, weighted";

run;

/*merge into list of obs with ffs mc 6m prior to ivw*/
proc sort data=charlson_1 out=test nodupkey;
by bid_hrs_22 index_date;
run;



%rename(WORK,TEST,&range1._&range2);

data proj_int.charls_&range1._&range2.(rename =(bid_hrs_22_&range1._&range2=bid_hrs_22
index_date_&range1._&range2=index_date));
set test;
keep bid_hrs_22_&range1._&range2 charls: index_date:;
run;
proc sort data=proj_int.charls_&range1._&range2.;
by bid_hrs_22 index_date;
run;

%mend;

%charlson(range1=0d, range2=n12m);


proc freq data=proj_int.charls_0d_n12m;
table charls:;
run;





H="Cleaning/Merging/Data aggregation"


H="smi pre util --oxygen"
/*These additional variables are just added to the dataset with the
elixhauser and cc's 1 year preceeding the interview, can add them
later when required to get the 2 year look-back dataset*/

/****************************************************************************/
/*Get indicator of any hospital admission 6 and 12 months pre-core interview*/
/****************************************************************************/

%macro admissions(days=,suffix=);

/*pull list of ip claims from all medpar claims x days pre-interview*/
data ip_meet_&days.;
set proj_int.mp_meet_&suffix.(where=(trim(left(SSLSSNF))~="N"));
run;

data ip_&days._2;
set ip_meet_&days.;
if icarecnt=. then icarecnt=0; /*medpar intensive care day count*/
if CRNRYDAY=. then CRNRYDAY=0; /*medpar coronary day count*/
icu_days=icarecnt+CRNRYDAY;
em_urgent_admit=0; /*Urgent , emergent admissions from admission type*/
if type_adm in (1,2) then em_urgent_admit=1;
em_admit=0;
if type_adm=1 then em_admit=1;
urgent_admit=0;
if type_adm=2 then urgent_admit=1;
elect_admit=0;
if type_adm=3 then elect_admit=1;
ind_ed_charge=0; /*ED charges as another indicator of ED use*/
if ER_AMT>0 & ER_AMT~=. then ind_ed_charge=1;
if ER_AMT=0 | ER_AMT=. then ind_ed_charge=0;

/*truncate stays where the admit is more than x days before interview
or discharge is after the interview date so can get accurate LOS*/
if c_ivw_date-admit_date>&days. then do;
	admit_date=c_ivw_date-&days.;
	admit_trunc=1;
	end;
if c_ivw_date<disch_date then do;
	disch_date=c_ivw_date;
	disch_trunc=1;	
	end;
adj_los=disch_date-admit_date;
if disch_date-admit_date=0 then adj_los=1;
core_year=year(index_date);
run;

proc sort data=ip_&days._2;
by bid_hrs_22 core_year;
run;

proc sql;
create table ip_&days._3 as select distinct bid_hrs_22,core_year,
/*total ICU days*/
sum(icu_days) as icu_days_&suffix. label="total icu days &suffix. pre core ivw",
/*count of IP admissions, all types*/
count(*) as n_ip_admit_&suffix. label="total n of hospital admit &suffix. pre core ivw",
/*total Hospital LOS*/
sum(adj_los) as n_hospd_&suffix. label="total hospital days &suffix. pre core ivw",
/*count urgent or emergency admissions*/
count(case when em_urgent_admit=1 then em_urgent_admit else . end) as n_em_urgent_admit_&suffix. 
	label="total n of urgent/emergent hospital admit &suffix. pre core ivw",
/*count of emergency admissions, from admission type code*/
count(case when em_admit=1 then em_admit else . end) as n_em_admit_&suffix. 
	label="total n of emergent hospital admit &suffix. pre core ivw",
/*count of urgent admissions, from admission type code*/
count(case when urgent_admit=1 then urgent_admit else . end) as n_urgent_admit_&suffix. 
	label="total n of urgent hospital admit &suffix. pre core ivw",
/*count of elective admissions, from admission type code*/
count(case when elect_admit=1 then elect_admit else . end) as n_elect_admit_&suffix. 
	label="total n of elective hospital admit &suffix. pre core ivw",
/*count of admissions with any ED charges*/
count(case when ind_ed_charge=1 then ind_ed_charge else . end) as n_ED_ip_&suffix. 
	label="total n of ED visits with subsequent admit &suffix. pre core ivw"

 from ip_&days._2 group by bid_hrs_22,core_year;
quit;

data ip_&days._4;
set ip_&days._3;
if icu_days_&suffix.>n_hospd_&suffix. then icu_days_&suffix.=n_hospd_&suffix.;
run;

%mend;

%admissions(days=365,suffix=12m);
%admissions(days=730,suffix=24m);

data elective_1;
set ip_365_2;
if elect_admit=1;
run;

/*print to file*/
 /*ods rtf body="E:\data\serious_ill\logs\elective_primary_dxlist.rtf";
 title"Primary dx list for admit type = elective, inpatient claims last 12m pre-core";
proc freq data=elective_1 order=freq; table dgns_cd01;
run;

title"Admission type vs indicator for any ED charges from rev center codes, claims level";
proc freq data=ip_365_2; table ind_ed_charge*type_adm; run;

ods rtf close; 
*/
/*merge the new variables with the list of ivws with ffs mc 1 yr pre and age 65+*/
/*proc sort data=proj_int.core_xwalk_ins_ffs_only out=core_xwalk_ins_ffs_only nodupkey;
by BID_hrs core_year;
run;
*/
proc sort data=ip_365_3 nodupkey;
by bid_hrs_22 core_year;
run;

proc sql;
create table ip_12m as select a.*,b.icu_days_12m,
b.n_ip_admit_12m,b.n_hospd_12m,b.n_em_urgent_admit_12m,b.n_em_admit_12m,
b.n_urgent_admit_12m,b.n_elect_admit_12m,b.n_ED_ip_12m
from proj_int.index a
left join
ip_365_3 b 
on trim(left(a.bid_hrs_22))=trim(left(b.bid_hrs_22)) and year(a.index_date)=b.core_year;
quit;

proc sort data=ip_730_3 nodupkey;
by bid_hrs_22 core_year;
run;

proc sql;
create table ip1 as select a.*,b.icu_days_24m,
b.n_ip_admit_24m,b.n_hospd_24m,b.n_em_urgent_admit_24m,b.n_em_admit_24m,
b.n_urgent_admit_24m,b.n_elect_admit_24m,b.n_ED_ip_24m
from ip_12m a
left join
ip_730_3 b 
on trim(left(a.bid_hrs_22))=trim(left(b.bid_hrs_22)) and year(a.index_date)=b.core_year;
quit;

/*Dataset just contains obs with ffs mc 1yr and age 65+
So if missing, set var to 0*/
 data ip ;
 set ip1 ;
 array list icu_days_12m n_ip_admit_12m n_hospd_12m n_em_urgent_admit_12m 
	n_em_admit_12m n_urgent_admit_12m n_elect_admit_12m n_ED_ip_12m
	icu_days_12m n_ip_admit_12m n_hospd_12m n_em_urgent_admit_12m
	n_em_admit_12m n_urgent_admit_12m n_elect_admit_12m n_ED_ip_12m;
 do over list;
 if list=. then list=0;
 end;

 if n_ip_admit_12m=0 then ind_hosp_adm_12m=0;
 if n_ip_admit_12m>0 & n_ip_admit_12m~=. then ind_hosp_adm_12m=1;
 label ind_hosp_adm_12m="Indicator for any hospital admission 12m pre core";

 if n_em_urgent_admit_12m=0 then ind_em_ur_adm_12m=0;
 if n_em_urgent_admit_12m>0 & n_em_urgent_admit_12m~=. then ind_em_ur_adm_12m=1;
 label ind_em_ur_adm_12m="Ind any urgent or emergent hospital admission 12m pre core";

 if n_em_admit_12m=0 then ind_em_adm_12m=0;
 if n_em_admit_12m>0 & n_em_admit_12m~=. then ind_em_adm_12m=1;
 label ind_em_adm_12m="Ind any emergency hospital admission 12m pre core";

 if n_urgent_admit_12m=0 then ind_ur_adm_12m=0;
 if n_urgent_admit_12m>0 & n_urgent_admit_12m~=. then ind_ur_adm_12m=1;
 label ind_ur_adm_12m="Ind any urgent hospital admission 12m pre core";

 if n_elect_admit_12m =0 then ind_elect_adm_12m=0;
 if n_elect_admit_12m >0 & n_elect_admit_12m ~=. then ind_elect_adm_12m=1;
 label ind_elect_adm_12m="Ind any elective hospital admission 12m pre core";

 if (n_ip_admit_12m - n_elect_admit_12m)=0 then ind_nonelect_adm_12m=0;
 if (n_ip_admit_12m - n_elect_admit_12m)>0 & n_elect_admit_12m~=. then ind_nonelect_adm_12m=1;
 label ind_nonelect_adm_12m="Ind any non-elective hospital admission 12m pre core";

 n_nonelect_adm_12m=(n_ip_admit_12m - n_elect_admit_12m);
 label n_nonelect_adm_12m="total n non-elective ip admit 12m pre core";

 if n_ED_ip_12m=0 then ind_ED_adm_12m=0;
 if n_ED_ip_12m>0 & n_ED_ip_12m~=. then ind_ED_adm_12m=1;
 label ind_ED_adm_12m="Ind ED use with hospital admission 12m pre core, from charges";

 if n_ip_admit_24m=0 then ind_hosp_adm_24m=0;
 if n_ip_admit_24m>0 & n_ip_admit_24m~=. then ind_hosp_adm_24m=1;
 label ind_hosp_adm_24m="Indicator for any hospital admission 24m pre core";

 if n_em_urgent_admit_24m=0 then ind_em_ur_adm_24m=0;
 if n_em_urgent_admit_24m>0 & n_em_urgent_admit_24m~=. then ind_em_ur_adm_24m=1;
 label ind_em_ur_adm_24m="Ind any urgent or emergent hospital admission 24m pre core";

 if n_em_admit_24m=0 then ind_em_adm_24m=0;
 if n_em_admit_24m>0 & n_em_admit_24m~=. then ind_em_adm_24m=1;
 label ind_em_adm_24m="Ind any emergency hospital admission 24m pre core";

 if n_urgent_admit_24m=0 then ind_ur_adm_24m=0;
 if n_urgent_admit_24m>0 & n_urgent_admit_24m~=. then ind_ur_adm_24m=1;
 label ind_ur_adm_24m="Ind any urgent hospital admission 24m pre core";

 if n_elect_admit_24m =0 then ind_elect_adm_24m=0;
 if n_elect_admit_24m >0 & n_elect_admit_24m ~=. then ind_elect_adm_24m=1;
 label ind_elect_adm_24m="Ind any elective hospital admission 24m pre core";

 if (n_ip_admit_24m - n_elect_admit_24m)=0 then ind_nonelect_adm_24m=0;
 if (n_ip_admit_24m - n_elect_admit_24m)>0 & n_elect_admit_24m~=. then ind_nonelect_adm_24m=1;
 label ind_nonelect_adm_24m="Ind any non-elective hospital admission 24m pre core";

 n_nonelect_adm_24m=(n_ip_admit_24m - n_elect_admit_24m);
 label n_nonelect_adm_24m="total n non-elective ip admit 24m pre core";

 if n_ED_ip_24m=0 then ind_ED_adm_24m=0;
 if n_ED_ip_24m>0 & n_ED_ip_24m~=. then ind_ED_adm_24m=1;
 label ind_ED_adm_24m="Ind ED use with hospital admission 24m pre core, from charges";

run;

 proc freq;
 table icu_days_12m n_ip_admit_12m n_hospd_12m ind_hosp_adm_12m n_em_urgent_admit_12m ind_em_ur_adm_12m 
	ind_em_adm_12m ind_ur_adm_12m ind_nonelect_adm_12m n_nonelect_adm_12m n_ED_ip_12m ind_ED_adm_12m 
	ind_em_adm_12m*ind_ED_adm_12m /missprint;
 run;

proc freq;
table icu_days_24m n_ip_admit_24m n_hospd_24m ind_hosp_adm_24m n_em_urgent_admit_24m ind_em_ur_adm_24m
	ind_em_adm_24m ind_ur_adm_24m ind_nonelect_adm_24m n_nonelect_adm_24m n_ED_ip_24m ind_ED_adm_24m 
	ind_em_adm_24m*ind_ED_adm_24m /missprint;
run;

/****************************************************************************/
/****************************************************************************/
/*Get SNF days, indicator for 12 months preceding the interview*/
/****************************************************************************/
/****************************************************************************/

/*pull list of snf claims from all medpar claims 12 months pre-interview*/
data snf_meet_365;
set proj_int.mp_meet_12m(where=(trim(left(SSLSSNF))="N"));
run;

proc sort data=snf_meet_365;
by bid_hrs_22 admit_date;
run;

data snf_meet_365_1a;
set snf_meet_365;
format admit_date date9. disch_date date9.;
c_ivw_date=index_date;
run;

/*3 claim windows are present:
1. SNF stays fully within the 1 year before interview
2. Stays that begin before 1 year pre-core but end within 1 year pre-core
3. Stays that begin within 1 year of core but end after core ivw
4. Stays that begin before 1 year and end after interview, LOS=365!
Get claims that meet 1 *1797*/
proc sql;
create table snf_meet1_pre_365 as select *
from snf_meet_365_1a
where (c_ivw_date - admit_date)<365 & (c_ivw_date - disch_date)>=0; 
quit;


/*meet time window 2 *152*/
proc sql;
create table snf_meet2_pre_365 as select *
from snf_meet_365_1a
where (c_ivw_date - admit_date)>=365 & (c_ivw_date - disch_date)>=0; 
quit;

/*For these claims that start > 1 year before core, truncate start date so 
only count LOS days w/i 1 year
create indicator variable that claim start date is truncated*/
data snf_meet2_pre_365_1;
set snf_meet2_pre_365;
admit_date = c_ivw_date-365;
snf_admit_date_mod = 1;
label snf_admit_date_mod = "Admit date mod; at 12 mo from ivw date";
run;

proc freq;
table snf_admit_date_mod ;
run;

/*meet time window 3 *135 */
proc sql;
create table snf_meet3_pre_365 as select *
from snf_meet_365_1a
where (c_ivw_date - admit_date)<365 & (c_ivw_date-disch_date)<0; 
quit;

/*For these claims that end after core, truncate end date so 
only count LOS days 1 year before the core
create indicator variable that claim end date is truncated*/
data snf_meet3_pre_365_1;
set snf_meet3_pre_365;
disch_date = c_ivw_date;
snf_disch_date_mod = 1;
label snf_disch_date_mod = "Disch date mod; at ivw date";
run;

proc freq;
table snf_disch_date_mod ;
run;

/*meet 4 , overlap both start and end dates n=7*/
proc sql;
create table snf_meet4_pre_365 as select *
from snf_meet_365_1a
where (c_ivw_date - admit_date)>=365 & (c_ivw_date - disch_date)<0; 
quit;

/*truncate both start and end dates so just count 1 year pre interview*/
data snf_meet4_pre_365_1;
set snf_meet4_pre_365;
disch_date = c_ivw_date;
snf_disch_date_mod = 1;
label snf_disch_date_mod = "Disch date mod; at ivw date";
admit_date = c_ivw_date-365;
snf_admit_date_mod = 1;
label snf_admit_date_mod = "Admit date mod; at 12 mo from ivw date";
run;

proc freq;
table snf_disch_date_mod snf_admit_date_mod;
run;


data snf_meet_pre_365;
set snf_meet1_pre_365 snf_meet2_pre_365_1 snf_meet3_pre_365_1 snf_meet4_pre_365_1;
run;

proc freq;
table snf_admit_date_mod snf_disch_date_mod ;
run;

/*save final files to project int_data directory*/
data proj_int.snf_meet_pre_365 ;
set  snf_meet_pre_365;
run;

/*************************************************************/
/*calculate total number of days spent in SNF by BID*/
/*************************************************************/

data pre_snf_days_1;
set proj_int.snf_meet_pre_365;
calc_snf_LOS=disch_date-admit_date;
if calc_snf_LOS=0 then calc_snf_LOS=1;
core_year=year(index_date);
run;

proc sort data=pre_snf_days_1;
by bid_hrs_22 c_ivw_date admit_date;
run;

proc sql;
create table snf_days_pre as select distinct bid_hrs_22,core_year,
sum(calc_snf_LOS)
	as n_snf_days_12m
	from pre_snf_days_1 group by bid_hrs_22,core_year;
quit;

proc freq;
table n_snf_days_12m;
run;

/*merge into full ffs 1yr, age 65+ dataset*/
proc sort data=snf_days_pre nodupkey;
by bid_hrs_22 core_year;
run;
/*
proc sql;
create table core_ids_criteria_2a as select a.*,b.n_snf_days_12m
from core_ids_1yr_criteria a
left join
snf_days_pre b 
on trim(left(a.bid_hrs))=trim(left(b.bid_hrs_22)) and a.core_year=b.core_year;
quit;

 data core_ids_1yr_criteria_2 ;
 set core_ids_criteria_2a ;
 array list n_snf_days_12m;
 do over list;
 if list=. then list=0;
 end; 

if n_snf_days_12m=0 then ind_snf_use_12m=0;
 if n_snf_days_12m>0 & n_snf_days_12m~=. then ind_snf_use_12m=1;
 label ind_snf_use_12m="Indicator for any SNF stay 12m pre core";
 label n_snf_days_12m="SNF Days 12m pre core";

run;

proc freq;
table n_snf_days_12m ind_snf_use_12m /missprint;
run;
*/
 data snf ;
 set snf_days_pre ;
 array list n_snf_days_12m;
 do over list;
 if list=. then list=0;
 end; 

if n_snf_days_12m=0 then ind_snf_use_12m=0;
 if n_snf_days_12m>0 & n_snf_days_12m~=. then ind_snf_use_12m=1;
 label ind_snf_use_12m="Indicator for any SNF stay 12m pre ivw";
 label n_snf_days_12m="SNF Days 12m pre ivw";

run;


proc freq data=snf; tables n_snf_days_12m / missprint; run;
/****************************************************************************/
/****************************************************************************/
/*Get indicator of ESRD codes from the denominator file the year of the interview*/
/****************************************************************************/
/****************************************************************************/
proc sort data=medi.dn_1998_2012 out=dn_2000_20122  nodupkey;
by bid_hrs_22 year;
run;

/*pull ESRD status variable from dn file
for the core interview years*/
proc sql;
create table dn_core_y as select
a.*,b.ESRD_IND from 
proj_int.index a left join
dn_2000_20122 b
on trim(left(a.BID_hrs_22))=trim(left(b.bid_hrs_22))
and year(a.index_date)=b.year;
quit;

proc freq;
table ESRD_IND /missprint;
run;

data esrd;
set dn_core_y ;
if ESRD_IND='Y' then esrd_ind_n=1;
if ESRD_IND='0' then esrd_ind_n=0;
label esrd_ind_n="ESRD indicator from claims denominator file";
drop ESRD_IND;
run;

proc freq;
table esrd_ind_n /missprint;
run;


/****************************************************************************/
/*Get indicator of Home 02 use 12 months pre interview from DME claims*/
/****************************************************************************/
data oxygen_1(keep=bid_hrs_22 core_year home_oxygen);
set proj_int.dm_meet_12m;
home_oxygen=0;
core_year=year(index_date);
label home_oxygen="Home O2 from DME claims";
array list BETOS01:BETOS13;
do over list;
if list = 'D1C' then home_oxygen=1;
end;
run; 

proc sort data=oxygen_1;
by bid_hrs_22 core_year;
run;

proc freq;
table core_year /missprint;
run;

proc sql;
create table oxygen_2 as
select distinct bid_hrs_22,core_year,
sum(home_oxygen) as home_oxygen
from oxygen_1 group by bid_hrs_22,core_year;
quit;

/*convert to binary variables*/
data oxygen_3;
set oxygen_2 ;
if home_oxygen>0 then home_oxygen=1;
if home_oxygen<=0 then home_oxygen=0;
run;

proc freq;
table home_oxygen;
run;

/*merge Oxygen use variable into the overall dataset*/
proc sql;
create table oxy as select
a.*,b.home_oxygen
from proj_int.index a left join
oxygen_3 b
on trim(left(a.BID_hrs_22))=trim(left(b.bid_hrs_22))
and year(a.index_date)=b.core_year;
quit;

data oxy;
set oxy;
if home_oxygen=. then home_oxygen=0;
label home_oxygen="Home O2 use from DME claims 1yr pre ivw";
run;

proc freq;
table home_oxygen /missprint;
run;

/*pull in new variables to overall interview dataset*/
/*proc sort data=core_ids_1yr_criteria_4 nodupkey;
by bid_hrs core_year;
run;

proc sort data=proj_int.core_ids_elix_cc_1yr_2 out=core_ids_elix_cc_1yr_2;
by bid_hrs core_year;
run;

proc sql;
create table proj_int.core_ids_1yr_criteria_4(drop=bid_hrs2 core_year2) as select a.*,b.* from
core_ids_elix_cc_1yr_2 a left join
core_ids_1yr_criteria_4(rename=(bid_hrs=bid_hrs2) rename=(core_year=core_year2)
     drop=c_ivw_year c_ivw_date age_ge_65 part_ab_12m hmo_d_12m )
 	 b
on a.bid_hrs=b.bid_hrs2 and a.core_year=b.core_year2;
quit;
*/
/*proc printto new log='&logdir.\sas_8_sic_op_ed_log.log'
	print='&logdir.\sas_8_sic_op_ed_out.lst' 
run;*/

data op_meet_365;
set proj_int.op_meet_12m(keep=bid_hrs_22 admit_date disch_date index_date RVCNTR01-RVCNTR45);
core_year=year(index_date);
run;

proc sort data=op_meet_365;
by bid_hrs_22 admit_date;
run;

data ed_op_1;
	set op_meet_365;
	ed_op=0;
	array list RVCNTR01-RVCNTR45;
	do over list;
	if list >= 450 and list < 460 and ed_op=0 then  
	ed_op = 1;
	end;
run;

proc freq;
table ed_op;
run;

proc sql;
create table ed_op_2 as select distinct bid_hrs_22,core_year,
count(case when ed_op=1 then ed_op else . end)
	as n_ed_op_visits_12m
	from ed_op_1 group by bid_hrs_22,core_year;
quit;

proc freq;
table n_ed_op_visits_12m;
run;
/*
proc sort data=proj_int.core_ids_1yr_criteria_4 out=core_ids_1yr_criteria_4;
by bid_hrs core_year;
run;

proc sort data=ed_op_2 nodupkey;
by bid_hrs_22 core_year;
run;
*/
/*merge into dataset*/
/*
proc sql;
create table core_ids_1yr_criteria_4a as select a.*,b.n_ed_op_visits_12m
from core_ids_1yr_criteria_4 a
left join
ed_op_2 b 
on trim(left(a.bid_hrs))=trim(left(b.bid_hrs_19)) and a.core_year=b.core_year;
quit;
*/
data ed;
set ed_op_2;
if n_ed_op_visits_12m=. and comorb_1_0_1yr~=. then n_ed_op_visits_12m=0;
label n_ed_op_visits_12m="Count ED OP visits, 1yr pre ivw";

if n_ed_op_visits_12m=0 then ind_ed_op_12m=0;
if n_ed_op_visits_12m>0 & n_ed_op_visits_12m~=. then ind_ed_op_12m=1;
label ind_ed_op_12m="Indicator any ED OP visits, 1 yr pre ivw";
run;

proc freq;
table n_ed_op_visits_12m*ind_ed_op_12m;
run;

proc sql;
create table proj_int.utilization_pre as select * 
from proj_int.index a 
left join
ip b
on trim(left(a.bid_hrs_22))=trim(left(b.bid_hrs_22)) and year(a.index_date)=b.index_year
left join 
snf c
on trim(left(a.bid_hrs_22))=trim(left(c.bid_hrs_22)) and year(a.index_date)=c.core_year
left join 
esrd d
on trim(left(a.bid_hrs_22))=trim(left(d.bid_hrs_22)) and year(a.index_date)=d.index_year
left join
oxy e
on trim(left(a.bid_hrs_22))=trim(left(e.bid_hrs_22)) and year(a.index_date)=e.index_year
left join 
ed f
on trim(left(a.bid_hrs_22))=trim(left(f.bid_hrs_22)) and year(a.index_date)=e.index_year;
quit;


H="smi pre 2"
/*

Created by: MH
Date Created: 10/15/19

Updated by:
Date Updated:




**************************************************

/****************************************************************************/
/* Rename variables macro                                                   */
/****************************************************************************/

%macro rename(lib,dsn,pre);
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "Before Renaming All Variables";
run;
proc sql noprint;
select nvar into :num_vars
from dictionary.tables
where libname="&LIB" and
memname="&DSN";
select distinct(name) into :var1-
:var%TRIM(%LEFT(&num_vars))
from dictionary.columns
where libname="&LIB" and
memname="&DSN";
quit;
run;
proc datasets library=&LIB;
modify &DSN;
rename
%do i=1 %to &num_vars;
&&var&i=&&var&i.._&pre 
%end;
;
quit;
run;
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "After Renaming All Variables";
run;
%mend rename;




/****************************************************************************/
/* Serious Medical Illness comorbidities macro                                           */
/****************************************************************************/
/*Note elixhauser comorbidities diagnosis lists are modified for the 
purposes of this project, do not copy and paste this Elixhauser code 
for use in other projects!!*/

%macro smi(range1=, range2=);

data dx_smi;
set proj_int.dx_&range1._&range2.(rename=(diag=dx_0));
dx=trim(left(dx_0));

if dx~="" then do;

smi_1=0;
smi_2=0;
smi_3=0;
smi_4=0;
smi_5=0;
smi_6=0;
smi_7=0;
smi_8=0;
smi_9=0;
smi_10=0;
smi_11=0;
smi_12=0;
smi_13=0;



*do over dx;
	*Dementia;
	if (substr(dx,1,3)='290' or
substr(dx,1,4)='2901' or
substr(dx,1,5)='29011' or
substr(dx,1,5)='29012' or
substr(dx,1,5)='29013' or
substr(dx,1,4)='2902' or
substr(dx,1,5)='29021' or
substr(dx,1,4)='2903' or
substr(dx,1,4)='2904' or
substr(dx,1,5)='29041' or
substr(dx,1,5)='29042' or
substr(dx,1,5)='29043' or
substr(dx,1,4)='2912' or
substr(dx,1,4)='2941' or
substr(dx,1,5)='29411' or
substr(dx,1,4)='2948' or
substr(dx,1,4)='2949' or
substr(dx,1,3)='331' or
substr(dx,1,5)='33111' or
substr(dx,1,5)='33119' or
substr(dx,1,4)='3312') 
		and smi_1=0 
		then smi_1=1;
		*Cancer ;
	if (substr(dx,1,3)='150' or
substr(dx,1,4)='1501' or
substr(dx,1,4)='1502' or
substr(dx,1,4)='1503' or
substr(dx,1,4)='1504' or
substr(dx,1,4)='1505' or
substr(dx,1,4)='1508' or
substr(dx,1,4)='1509' or
substr(dx,1,3)='151' or
substr(dx,1,4)='1511' or
substr(dx,1,4)='1512' or
substr(dx,1,4)='1513' or
substr(dx,1,4)='1514' or
substr(dx,1,4)='1515' or
substr(dx,1,4)='1516' or
substr(dx,1,4)='1518' or
substr(dx,1,4)='1519' or
substr(dx,1,3)='155' or
substr(dx,1,4)='1551' or
substr(dx,1,4)='1552' or
substr(dx,1,3)='157' or
substr(dx,1,4)='1571' or
substr(dx,1,4)='1572' or
substr(dx,1,4)='1573' or
substr(dx,1,4)='1574' or
substr(dx,1,4)='1578' or
substr(dx,1,4)='1579' or
substr(dx,1,3)='158' or
substr(dx,1,4)='1588' or
substr(dx,1,4)='1589' or
substr(dx,1,3)='162' or
substr(dx,1,4)='1622' or
substr(dx,1,4)='1623' or
substr(dx,1,4)='1624' or
substr(dx,1,4)='1625' or
substr(dx,1,4)='1628' or
substr(dx,1,4)='1629' or
substr(dx,1,3)='163' or
substr(dx,1,4)='1631' or
substr(dx,1,4)='1638' or
substr(dx,1,4)='1639' or
substr(dx,1,3)='183' or
substr(dx,1,4)='1832' or
substr(dx,1,4)='1833' or
substr(dx,1,4)='1834' or
substr(dx,1,4)='1835' or
substr(dx,1,4)='1838' or
substr(dx,1,4)='1839' or
substr(dx,1,3)='191' or
substr(dx,1,4)='1911' or
substr(dx,1,4)='1912' or
substr(dx,1,4)='1913' or
substr(dx,1,4)='1914' or
substr(dx,1,4)='1915' or
substr(dx,1,4)='1916' or
substr(dx,1,4)='1917' or
substr(dx,1,4)='1918' or
substr(dx,1,4)='1919' or
substr(dx,1,3)='196' or
substr(dx,1,4)='1961' or
substr(dx,1,4)='1962' or
substr(dx,1,4)='1963' or
substr(dx,1,4)='1965' or
substr(dx,1,4)='1966' or
substr(dx,1,4)='1968' or
substr(dx,1,4)='1969' or
substr(dx,1,3)='197' or
substr(dx,1,4)='1971' or
substr(dx,1,4)='1972' or
substr(dx,1,4)='1973' or
substr(dx,1,4)='1974' or
substr(dx,1,4)='1975' or
substr(dx,1,4)='1976' or
substr(dx,1,4)='1977' or
substr(dx,1,4)='1978' or
substr(dx,1,3)='198' or
substr(dx,1,4)='1981' or
substr(dx,1,4)='1982' or
substr(dx,1,4)='1983' or
substr(dx,1,4)='1984' or
substr(dx,1,4)='1985' or
substr(dx,1,4)='1986' or
substr(dx,1,4)='1987' or
substr(dx,1,5)='19881' or
substr(dx,1,5)='19882' or
substr(dx,1,5)='19889' or
substr(dx,1,3)='199' or
substr(dx,1,4)='1991' or
substr(dx,1,4)='1992' or
substr(dx,1,3)='204' or
substr(dx,1,5)='20401' or
substr(dx,1,5)='20402' or
substr(dx,1,4)='2041' or
substr(dx,1,5)='20411' or
substr(dx,1,5)='20412' or
substr(dx,1,4)='2042' or
substr(dx,1,5)='20421' or
substr(dx,1,5)='20422' or
substr(dx,1,4)='2048' or
substr(dx,1,5)='20481' or
substr(dx,1,5)='20482' or
substr(dx,1,4)='2049' or
substr(dx,1,5)='20491' or
substr(dx,1,5)='20492' or
substr(dx,1,3)='205' or
substr(dx,1,5)='20501' or
substr(dx,1,5)='20502' or
substr(dx,1,4)='2051' or
substr(dx,1,5)='20511' or
substr(dx,1,5)='20512' or
substr(dx,1,4)='2052' or
substr(dx,1,5)='20521' or
substr(dx,1,5)='20522' or
substr(dx,1,4)='2053' or
substr(dx,1,5)='20531' or
substr(dx,1,5)='20532' or
substr(dx,1,4)='2058' or
substr(dx,1,5)='20581' or
substr(dx,1,5)='20582' or
substr(dx,1,4)='2059' or
substr(dx,1,5)='20591' or
substr(dx,1,5)='20592' or
substr(dx,1,3)='206' or
substr(dx,1,5)='20601' or
substr(dx,1,5)='20602' or
substr(dx,1,4)='2061' or
substr(dx,1,5)='20611' or
substr(dx,1,5)='20612' or
substr(dx,1,4)='2062' or
substr(dx,1,5)='20621' or
substr(dx,1,5)='20622' or
substr(dx,1,4)='2068' or
substr(dx,1,5)='20681' or
substr(dx,1,5)='20682' or
substr(dx,1,4)='2069' or
substr(dx,1,5)='20691' or
substr(dx,1,5)='20692' or
substr(dx,1,3)='207' or
substr(dx,1,5)='20701' or
substr(dx,1,5)='20702' or
substr(dx,1,4)='2071' or
substr(dx,1,5)='20711' or
substr(dx,1,5)='20712' or
substr(dx,1,4)='2072' or
substr(dx,1,5)='20721' or
substr(dx,1,5)='20722' or
substr(dx,1,4)='2078' or
substr(dx,1,5)='20781' or
substr(dx,1,5)='20782' or
substr(dx,1,3)='208' or
substr(dx,1,5)='20801' or
substr(dx,1,5)='20802' or
substr(dx,1,4)='2081' or
substr(dx,1,5)='20811' or
substr(dx,1,5)='20812' or
substr(dx,1,4)='2082' or
substr(dx,1,5)='20821' or
substr(dx,1,5)='20822' or
substr(dx,1,4)='2088' or
substr(dx,1,5)='20881' or
substr(dx,1,5)='20882' or
substr(dx,1,4)='2089' or
substr(dx,1,5)='20891' or
substr(dx,1,5)='20892' or
substr(dx,1,3)='289') 
		and smi_2=0 
		then smi_2=1;

		*ESRD;
	if (substr(dx,1,5)='40311' or
substr(dx,1,5)='40391' or
substr(dx,1,5)='40412' or
substr(dx,1,5)='40492' or
substr(dx,1,3)='586' or
substr(dx,1,4)='V420' or
substr(dx,1,5)='V4511' or
substr(dx,1,5)='V4512' or
substr(dx,1,4)='V560')
			and smi_3=0 
		then smi_3=1;

		*CHF;
	if (substr(dx,1,5)='39891' or
substr(dx,1,5)='40211' or
substr(dx,1,5)='40291' or
substr(dx,1,5)='40411' or
substr(dx,1,5)='40413' or
substr(dx,1,5)='40491' or
substr(dx,1,5)='40493' or
substr(dx,1,3)='428' or
substr(dx,1,4)='4281' or
substr(dx,1,4)='4282' or
substr(dx,1,5)='42821' or
substr(dx,1,5)='42822' or
substr(dx,1,5)='42823' or
substr(dx,1,4)='4283' or
substr(dx,1,5)='42831' or
substr(dx,1,5)='42832' or
substr(dx,1,5)='42833' or
substr(dx,1,4)='4284' or
substr(dx,1,5)='42841' or
substr(dx,1,5)='42842' or
substr(dx,1,5)='42843' or
substr(dx,1,4)='4289')
			and smi_4=0 
		then smi_4=1;

		* COPD ;
	if (substr(dx,1,3)='490' or
substr(dx,1,3)='491' or
substr(dx,1,3)='492' or
substr(dx,1,4)='4928' or
substr(dx,1,3)='493' or
substr(dx,1,5)='49301' or
substr(dx,1,5)='49302' or
substr(dx,1,4)='4931' or
substr(dx,1,5)='49311' or
substr(dx,1,5)='49312' or
substr(dx,1,4)='4932' or
substr(dx,1,5)='49321' or
substr(dx,1,5)='49322' or
substr(dx,1,5)='49381' or
substr(dx,1,5)='49382' or
substr(dx,1,4)='4939' or
substr(dx,1,5)='49391' or
substr(dx,1,3)='494' or
substr(dx,1,3)='495' or
substr(dx,1,3)='496' or
substr(dx,1,3)='497' or
substr(dx,1,3)='498' or
substr(dx,1,3)='499' or
substr(dx,1,3)='500' or
substr(dx,1,3)='501' or
substr(dx,1,3)='502' or
substr(dx,1,3)='503' or
substr(dx,1,3)='504' or
substr(dx,1,3)='505' or
substr(dx,1,4)='5064')
			and smi_5=0 
		then smi_5=1;

		*Diabetes*;
	if (substr(dx,1,4)='2504' or
substr(dx,1,5)='25041' or
substr(dx,1,5)='25042' or
substr(dx,1,5)='25043' or
substr(dx,1,4)='2505' or
substr(dx,1,5)='25051' or
substr(dx,1,5)='25052' or
substr(dx,1,5)='25053' or
substr(dx,1,4)='2506' or
substr(dx,1,5)='25061' or
substr(dx,1,5)='25062' or
substr(dx,1,5)='25063' or
substr(dx,1,4)='2507' or
substr(dx,1,5)='25071' or
substr(dx,1,5)='25072' or
substr(dx,1,5)='25073' or
substr(dx,1,4)='2509' or
substr(dx,1,5)='25091' or
substr(dx,1,5)='25092' or
substr(dx,1,5)='25093')
			and smi_6=0 
		then smi_6=1;
		*ALD ;
	if (substr(dx,1,3)='456' or
substr(dx,1,4)='4561' or
substr(dx,1,4)='4562' or
substr(dx,1,5)='45621' or
substr(dx,1,3)='571' or
substr(dx,1,4)='5712' or
substr(dx,1,4)='5715' or
substr(dx,1,4)='5716' or
substr(dx,1,4)='5718' or
substr(dx,1,4)='5719' or
substr(dx,1,4)='5723' or
substr(dx,1,4)='5724' or
substr(dx,1,4)='5728' or
substr(dx,1,4)='V427')
			and smi_7=0 
		then smi_7=1;
		*HIV with AIDS;
	if (substr(dx,1,3)='042' or
substr(dx,1,3)='043' or
substr(dx,1,3)='044')
			and smi_8=0 
		then smi_8=1;

		*ALS;
	if (substr(dx,1,4)='3352')
			and smi_9=0 
		then smi_9=1;

		*Hip Fracture;
	if (substr(dx,1,3)='820')
			and smi_10=0 
		then smi_10=1;

		*Renal Disease;
	if (substr(dx,1,5)='40311' or
substr(dx,1,5)='40391' or
substr(dx,1,5)='40412' or
substr(dx,1,5)='40492' or
substr(dx,1,4)='5851' or
substr(dx,1,4)='5852' or
substr(dx,1,4)='5853' or
substr(dx,1,4)='5854' or
substr(dx,1,4)='5855' or
substr(dx,1,4)='5856' or
substr(dx,1,4)='5859' or
substr(dx,1,3)='586' or
substr(dx,1,4)='V420' or
substr(dx,1,5)='V4511' or
substr(dx,1,5)='V4512' or
substr(dx,1,4)='V560' or
substr(dx,1,4)='V568')
			and smi_11=0 
		then smi_11=1;


		*Ischemic Heart;
	if (substr(dx,1,3)='410' or
substr(dx,1,5)='41001' or
substr(dx,1,5)='41002' or
substr(dx,1,4)='4101' or
substr(dx,1,5)='41011' or
substr(dx,1,5)='41012' or
substr(dx,1,4)='4102' or
substr(dx,1,5)='41021' or
substr(dx,1,5)='41022' or
substr(dx,1,4)='4103' or
substr(dx,1,5)='41031' or
substr(dx,1,5)='41032' or
substr(dx,1,4)='4104' or
substr(dx,1,5)='41041' or
substr(dx,1,5)='41042' or
substr(dx,1,4)='4105' or
substr(dx,1,5)='41051' or
substr(dx,1,5)='41052' or
substr(dx,1,4)='4106' or
substr(dx,1,5)='41061' or
substr(dx,1,5)='41062' or
substr(dx,1,4)='4107' or
substr(dx,1,5)='41071' or
substr(dx,1,5)='41072' or
substr(dx,1,4)='4108' or
substr(dx,1,5)='41081' or
substr(dx,1,5)='41082' or
substr(dx,1,4)='4109' or
substr(dx,1,5)='41091' or
substr(dx,1,5)='41092' or
substr(dx,1,3)='411' or
substr(dx,1,4)='4111' or
substr(dx,1,5)='41181' or
substr(dx,1,5)='41189' or
substr(dx,1,3)='412' or
substr(dx,1,3)='413' or
substr(dx,1,4)='4131' or
substr(dx,1,4)='4139' or
substr(dx,1,3)='414' or
substr(dx,1,5)='41401' or
substr(dx,1,5)='41402' or
substr(dx,1,5)='41403' or
substr(dx,1,5)='41404' or
substr(dx,1,5)='41405' or
substr(dx,1,5)='41406' or
substr(dx,1,5)='41407' or
substr(dx,1,4)='4141' or
substr(dx,1,5)='41411' or
substr(dx,1,5)='41412' or
substr(dx,1,5)='41419' or
substr(dx,1,4)='4142' or
substr(dx,1,4)='4143' or
substr(dx,1,4)='4148' or
substr(dx,1,4)='4149')
			and smi_12=0 
		then smi_12=1;

		*PVD;
	if (substr(dx,1,3)='440' or
substr(dx,1,4)='4412' or
substr(dx,1,4)='4414' or
substr(dx,1,4)='4417' or
substr(dx,1,4)='4419' or
substr(dx,1,4)='4431' or
substr(dx,1,4)='4432' or
substr(dx,1,4)='4438' or
substr(dx,1,4)='4439' or
substr(dx,1,4)='4471' or
substr(dx,1,4)='5571' or
substr(dx,1,4)='5579' or
substr(dx,1,4)='V434')
			and smi_13=0 
		then smi_13=1;

	end;

run;

/*get count of each comorbidity for each id-core year combination*/
proc sql;
create table smi_test1 as
select distinct bid_hrs_22, index_date,
sum(smi_1) as smi_i9_1,
sum(smi_2) as smi_i9_2,
sum(smi_3) as smi_i9_3,
sum(smi_4) as smi_i9_4,
sum(smi_5) as smi_i9_5,
sum(smi_6) as smi_i9_6,
sum(smi_7) as smi_i9_7,
sum(smi_8) as smi_i9_8,
sum(smi_9) as smi_i9_9,
sum(smi_10) as smi_i9_10,
sum(smi_11) as smi_i9_11,
sum(smi_12) as smi_i9_12,
sum(smi_13) as smi_i9_13
from dx_smi
group by bid_hrs_22, index_date;
quit;

/*convert counts of diagnoses for each comorbidity to indicator variables*/ 
data smi_1(keep=bid_hrs_22 index_date smi_icd9_1-smi_icd9_13 );
set smi_test1;
array list_com smi_i9_2-smi_i9_13;
array list_com_bin smi_icd9_2-smi_icd9_13 ;

smi_icd9_1=0;
if smi_i9_1>1 then smi_icd9_1=1;

do over list_com;
  list_com_bin=0;

  if list_com>0 then do;
    list_com_bin=1;
   end;

end;
run;
/*note this comorb_all count does not include CAD or ALS or Renal disease*/

/*merge in to list of core ivw dates for those with ffs mc, age=65+ */
proc sort data=smi_1 nodupkey;
by bid_hrs_22 index_date;
run;

data smi_&range1._&range2;
set smi_1 ;

label smi_icd9_1 ="Dementia";
label smi_icd9_2 ="Cancer";
label smi_icd9_3 ="ESRD";
label smi_icd9_4 ="CHF";
label smi_icd9_5 ="COPD";
label smi_icd9_6 ="Diabetes";
label smi_icd9_7 ="ALD";
label smi_icd9_8 ="HIV";
label smi_icd9_9 ="ALS";
label smi_icd9_10 ="Hip Fracture";
label smi_icd9_11 ="Renal Disease";
label smi_icd9_12 ="Ischemic Heart Disease";
label smi_icd9_13 ="Peripheral vascular Disease";

run;

data test;
set smi_&range1._&range2;
run;

%rename(WORK,TEST,&range1._&range2);

data smi_&range1._&range2.(rename =(bid_hrs_22_&range1._&range2=bid_hrs_22
index_date_&range1._&range2=index_date));
set test;
keep bid_hrs_22_&range1._&range2 smi_: index_date:;
run;


%mend;








/*I do not understand why this doesn't work
%macro runelix(years=);
%do i=1 %to &years.;
%let l=%eval(&i.-1);

%elixhauser(range1=%eval(&l.*12)m, range2=%eval(&i.*12)m);

%end;
%mend;

%runelix(years=7);

*/

%smi(range1=0m, range2=12m);
%smi(range1=0m, range2=24m);


proc sql; 
create table proj_int.smi as select * from
proj_int.index a
left join 
smi_0m_12m b
on a.bid_hrs_22=b.bid_hrs_22 and a.index_date=b.index_date
left join 
smi_0m_24m c
on a.bid_hrs_22=c.bid_hrs_22 and a.index_date=c.index_date;
quit;


H="diag hip"
/*recoded as a macro and use either the primary diagnosis or admitting diagnoses AD_DGNS */

/*start with IP claim list, 1 year before interview*/
%macro admissions(month=,days=,suffix=);
%macro singledx(dxvar=,name=);

data dx_1_&name._&month.;
set proj_int.mp_meet_&month.(where=(trim(left(SSLSSNF))~="N"));

&name._dx=trim(left(&dxvar.));

if &name._dx~="" then do;

chf_&name._dx=0;
copd_&name._dx=0;
hip_&name._dx=0;


/*CHF*/
if (substr(&name._dx,1,5)='39891' or
		substr(&name._dx,1,5)='40211' or
		substr(&name._dx,1,5)='40291' or
		substr(&name._dx,1,5)='40411' or
		substr(&name._dx,1,5)='40413' or
		substr(&name._dx,1,5)='40491' or
		substr(&name._dx,1,5)='40493' or
		substr(&name._dx,1,3)='428') 
		and chf_&name._dx=0 
		then chf_&name._dx=1;*add one binary variables here.;
/*COPD*/
	if (substr(dx,1,3)='490' or
substr(dx,1,3)='491' or
substr(dx,1,3)='492' or
substr(dx,1,4)='4928' or
substr(dx,1,3)='493' or
substr(dx,1,5)='49301' or
substr(dx,1,5)='49302' or
substr(dx,1,4)='4931' or
substr(dx,1,5)='49311' or
substr(dx,1,5)='49312' or
substr(dx,1,4)='4932' or
substr(dx,1,5)='49321' or
substr(dx,1,5)='49322' or
substr(dx,1,5)='49381' or
substr(dx,1,5)='49382' or
substr(dx,1,4)='4939' or
substr(dx,1,5)='49391' or
substr(dx,1,3)='494' or
substr(dx,1,3)='495' or
substr(dx,1,3)='496' or
substr(dx,1,3)='497' or
substr(dx,1,3)='498' or
substr(dx,1,3)='499' or
substr(dx,1,3)='500' or
substr(dx,1,3)='501' or
substr(dx,1,3)='502' or
substr(dx,1,3)='503' or
substr(dx,1,3)='504' or
substr(dx,1,3)='505' or
substr(dx,1,4)='5064')
			and copd_&name._dx=0 
		then copd_&name._dx=1;	
*hip fracture;
if (substr(&name._dx,1,3)='820' ) 
		and hip_&name._dx=0 
		then hip_&name._dx=1;*add one binary variables here.;
end;
run;

proc sql;
create table &name._dx_2_&month. as
select distinct BID_hrs_22,admit_year,
sum(chf_&name._dx) as chf_&name.,
sum(copd_&name._dx) as copd_&name.,
sum(hip_&name._dx) as hip_&name.
from dx_1_&name._&month.
group by bid_hrs_22,admit_year;
quit;


/*convert counts of diagnoses for each comorbidity to indicator variables*/ 
data &name._dx_3_&month.(keep=BID_hrs_22 admit_year chf_&name._dx copd_&name._dx hip_&name._dx);
set &name._dx_2_&month. ;
array list_com chf_&name. copd_&name. hip_&name.;
array list_com_bin chf_&name._dx copd_&name._dx hip_&name._dx;

do over list_com;
  list_com_bin=0;

  if list_com>0 then do;
    list_com_bin=1;
   end;

end;

run;

proc freq;
table chf_&name._dx copd_&name._dx hip_&name._dx;
run;

%mend;

/*use primary diagnosis code*/
%singledx(dxvar=dgns_cd01,name=pri);
/*use admitting diagnosis code*/
%singledx(dxvar=AD_DGNS,name=adm);



/*merge into the dataset that is just ffs 1 yr, 65+ age*/
/*
proc sql;
create table core_ids_1yr_criteria_4c as select a.*,b.chf_pri_dx,
b.copd_pri_dx,b.hip_pri_dx
from sic_int.core_xwalk_ins_ffs_only a
left join
pri_dx_3 b 
on trim(left(a.bid_hrs))=trim(left(b.bid_hrs_21)) and a.core_year=b.core_year;
quit;

proc sql;
create table core_ids_1yr_criteria_4d as select a.*,b.chf_adm_dx,
b.copd_adm_dx,b.hip_adm_dx
from core_ids_1yr_criteria_4c a
left join
adm_dx_3 b 
on trim(left(a.bid_hrs))=trim(left(b.bid_hrs_21)) and a.core_year=b.core_year;
quit;

data core_ids_1yr_criteria_4e;
set core_ids_1yr_criteria_4d;

array list chf_pri_dx copd_pri_dx hip_pri_dx chf_adm_dx copd_adm_dx hip_adm_dx;
do over list;
	if list = .  then list=0;
end;
label chf_pri_dx="CHF as primary dx from IP claim, 1yr pre ivw";
label copd_pri_dx="COPD as primary dx from IP claim, 1yr pre ivw";
label hip_pri_dx="Hip fracture as primary dx from IP claim, 1yr pre ivw";

label chf_adm_dx="CHF as admitting dx from IP claim, 1yr pre ivw";
label copd_adm_dx="COPD as admitting dx from IP claim, 1yr pre ivw";
label hip_adm_dx="Hip fracture as admitting dx from IP claim, 1yr pre ivw";

run;

proc freq;
table chf_pri_dx*chf_adm_dx copd_pri_dx*copd_adm_dx hip_pri_dx*hip_adm_dx ;
run;

/*Hip fracture criteria, method  by Covinsky
One of the (2) criteria met:
(1) Subject was admitted to a hospital with admitting diagnosis of “820.xx”.
(2) There is a physician record of “HF procedure” (defined by CPT code of 27230-27248) that is supported by either: 
a. Another physician record within 2 days OR 2
b. Relevant surgery during hospitalization. (Relevant surgery is defined by ICD9 codes 785.5, 790.5, 791.5, 792.5). 
(1) variable hip_adm_dx defined in macro above
(2) HF procedure: carrier claims 	(HCPCS_YR specifies the year of CPT coding used)
					HCPSCD01-HCPSCD13 The level 1 HCPCS code is the CPT code
Then a)from carrier claims or 
     b) from IP claims
	

For item (2) checked inpatient claims variables HCPSCD01-45 but none had any of the CPT codes in the list
Next step, try running with carrier files...
*/

/********************************************************************/
/*Physican record of HF procedure, check IP claims
There are no observations with the HF procedure codes in the IP claims, this method isn't
used in creating the final variable*/
data ip_meet_&month.;
set proj_int.ip_meet_&month.;
run;

proc contents data=ip_meet_&month.;
run;

data testhf_&month.;
set ip_meet_&month.;
if HCPSCD01~='';
run;

data hfproc_ip_&month.;
set ip_meet_&month.;
hf_proc_ind=0;
array list HCPSCD01-HCPSCD45;
do over list;
if list~='' then do;
	if (list='27230' or
		list='27231' or
		list='27232' or
		list='27233' or
		list='27234' or
		list='27235' or
		list='27236' or
		list='27237' or
		list='27238' or
		list='27239' or
		list='27240' or
		list='27241' or
		list='27242' or
		list='27243' or
		list='27244' or
		list='27245' or
		list='27246' or
		list='27247' or
		list='27248')
		/*and hf_proc_ind=0*/
		then hf_proc_ind=1;
	end;
end;


run;

proc freq; table hf_proc_ind;
run;

/********************************************************************/
/*Physican record of HF procedure, check carrier claims*/
/********************************************************************/

data hfproc_carr_&month.;
set proj_int.pb_meet_&month.;
hf_proc_ind=0;
array list HCPSCD01-HCPSCD13;
do over list;
if list~='' then do;
	if (list='27230' or
		list='27231' or
		list='27232' or
		list='27233' or
		list='27234' or
		list='27235' or
		list='27236' or
		list='27237' or
		list='27238' or
		list='27239' or
		list='27240' or
		list='27241' or
		list='27242' or
		list='27243' or
		list='27244' or
		list='27245' or
		list='27246' or
		list='27247' or
		list='27248')
		/*and hf_proc_ind=0*/
		then hf_proc_ind=1;
	end;
end;


run;

proc freq; table hf_proc_ind;
run;
/********************************************************************/
/*is there also a physican record within 2 days?*/
proc sort data=hfproc_carr_&month.; by BID_HRS_22 FROM_DT THRU_DT hf_proc_ind;
run;

data hfproc_carr_2_&month.;
set hfproc_carr_&month.;
if eof1=0 then
	set hfproc_carr_&month. (firstobs=2 keep=admit_date disch_date rename=(admit_date=lead1admit disch_date=lead1disch)) end=eof1;
else do; lead1admit=.;  lead1disch=.; end;
run;

data hfproc_carr_3_&month.;
set hfproc_carr_2_&month.;
days_next_visit=lead1admit-disch_date;
days_next_disch=lead1disch-disch_date;
if hf_proc_ind=1 and days_next_visit<=2 and days_next_visit~=. & days_next_disch>0 then hf_w_visit_2d=1;
else hf_w_visit_2d=0;
run;

data hfproc_carr_4_&month.;
set hfproc_carr_3_&month.;
if hf_proc_ind=1;
run;

proc freq data=hfproc_carr_3_&month.;
table hf_proc_ind hf_w_visit_2d admit_year; run;

/*if have hf CPT code from carrier, but no subsequent carrier claim,
do they have a surgery code from the inpatient claims?*/
data hfproc_carr_5_&month.;
set hfproc_carr_4_&month.;
if hf_proc_ind=1 and hf_w_visit_2d=0;
run;




/*for b) identify relevant surgeries from IP claims CPT codes and surgery dates*/

/*This section of code for just checking For Surgeries*/
data ip_meet_&month.;
set proj_int.mp_meet_&month.(where=(trim(left(SSLSSNF))~="N"));
run;

proc contents data=ip_meet_&month.;
run;

data proc_long_&month.(keep=BID_hrs_22 TYPE_ADM procedure procedure_date date_imp_yes AD_DGNS DGNS_CD01-DGNS_CD25
	 admit_date disch_date admit_year);
set ip_meet_&month.;
array list PRCDR_CD01-PRCDR_CD25;
array date PRCDR_DT01-PRCDR_DT25;
do over list;
if list~="" then do;
	procedure=list;
	if date=0000000 then do;
		procedure_date=admit_date;
		date_imp_yes=1;
		end;
	if date~=0000000 then do;
	procedure_date=datejul(date);
	end;
	output;
end;
end;

format procedure_date date10.;
format admit_date date10.;
format disch_date date10.;

run;

proc freq; table date_imp_yes; run;

/* Identify surgeries that meet the criteria
Indicator variable surgery_meet = 1 if yes, include in sample 
79 surgeries meet the criteria*/
data surgery_meet_&month.;
set proc_long_&month.;
if length(compress(procedure))>3 then do;

if compress(procedure)+0 in (7855, 7905, 7915, 7925) then surgery_meet=1;

end;
/*only keep observations in work.surgery_meet that meet criteria*/
if surgery_meet then output;

run;
/*End surgery section 1*/

/*who has surgery that meets criteria AND hf CPT code from carrier?*/
proc sql;
create table cpt_and_surg_&month. as select a.*,b.admit_date as carr_hf_admit, b.disch_date as carr_hf_disch,
b.hf_proc_ind, b.hf_w_visit_2d from 
surgery_meet_&month. a inner join
hfproc_carr_5_&month. b
on a.bid_hrs_22=b.bid_hrs_22;
quit;

data cpt_and_surg_1_&month.;
set cpt_and_surg_&month.;
format carr_hf_admit carr_hf_disch date9.;
hf_w_surgery=1;
run;

/*now merge in lists to get a list of bid's that meet criteria 1 or 2*/
data cpt_and_surg_2_&month.;
set cpt_and_surg_1_&month.;
keep bid_hrs_22 hf_proc_ind hf_w_surgery admit_year;
run;

proc sort data=cpt_and_surg_2_&month. nodupkey; by bid_hrs_22 admit_year ; run;

data hfproc_carr_6_&month.;
set hfproc_carr_4_&month.;
keep bid_hrs_22 hf_proc_ind hf_w_visit_2d admit_year;
if hf_proc_ind=1 and hf_w_visit_2d=1;
run;

proc sort data=hfproc_carr_6_&month. nodupkey; by bid_hrs_22 admit_year ; run;

*merge the datasets;
data hf_meet_&month.;
merge hfproc_carr_6_&month. cpt_and_surg_2_&month. ;
by bid_hrs_22 admit_year;
run;

proc sort data=hf_meet_&month. out=hf_meet2_&month. nodupkey; by bid_hrs_22 admit_year; run;


%mend;

%admissions(month=12m,days=365,suffix=12m);
%admissions(month=24m,days=730,suffix=24m);
%admissions(month=36m,days=1095,suffix=36m);
%admissions(month=48m,days=1460,suffix=48m);
%admissions(month=60m,days=1825,suffix=60m);
%admissions(month=72m,days=2190,suffix=72m);
%admissions(month=84m,days=2555,suffix=84m);



proc sql; 
create table proj_int.smi_plus as select * from
proj_int.index a
left join 
adm_dx_3_12m b
on a.bid_hrs_22=b.bid_hrs_22 and a.index_year=b.admit_year
left join 
adm_dx_3_24m c
on a.bid_hrs_22=c.bid_hrs_22 and a.index_year=c.admit_year
left join 
adm_dx_3_36m d
on a.bid_hrs_22=d.bid_hrs_22 and a.index_year=d.admit_year
left join 
adm_dx_3_48m e
on a.bid_hrs_22=e.bid_hrs_22 and a.index_year=e.admit_year
left join 
adm_dx_3_60m f
on a.bid_hrs_22=f.bid_hrs_22 and a.index_year=f.admit_year
left join 
adm_dx_3_72m g
on a.bid_hrs_22=g.bid_hrs_22 and a.index_year=g.admit_year
left join 
adm_dx_3_84m h
on a.bid_hrs_22=h.bid_hrs_22 and a.index_year=h.admit_year
left join 
pri_dx_3_12m i
on a.bid_hrs_22=i.bid_hrs_22 and a.index_year=i.admit_year
left join 
pri_dx_3_24m j
on a.bid_hrs_22=j.bid_hrs_22 and a.index_year=j.admit_year
left join 
pri_dx_3_36m k
on a.bid_hrs_22=k.bid_hrs_22 and a.index_year=k.admit_year
left join 
pri_dx_3_48m l
on a.bid_hrs_22=l.bid_hrs_22 and a.index_year=l.admit_year
left join 
pri_dx_3_60m m
on a.bid_hrs_22=m.bid_hrs_22 and a.index_year=m.admit_year
left join 
pri_dx_3_72m n
on a.bid_hrs_22=n.bid_hrs_22 and a.index_year=n.admit_year
left join 
pri_dx_3_84m o
on a.bid_hrs_22=o.bid_hrs_22 and a.index_year=o.admit_year
left join 
hf_meet_12m p
on a.bid_hrs_22=p.bid_hrs_22 and a.index_year=p.admit_year
left join 
hf_meet_24m q
on a.bid_hrs_22=q.bid_hrs_22 and a.index_year=q.admit_year
left join 
hf_meet_36m r
on a.bid_hrs_22=r.bid_hrs_22 and a.index_year=r.admit_year
left join 
hf_meet_48m s
on a.bid_hrs_22=s.bid_hrs_22 and a.index_year=s.admit_year
left join 
hf_meet_60m t
on a.bid_hrs_22=t.bid_hrs_22 and a.index_year=t.admit_year
left join 
hf_meet_72m u
on a.bid_hrs_22=u.bid_hrs_22 and a.index_year=u.admit_year
left join 
hf_meet_84m v
on a.bid_hrs_22=v.bid_hrs_22 and a.index_year=v.admit_year;
quit;


/*merge in these hip fracture variables*/
/*
proc sql;
create table core_ids_1yr_criteria_4f
as select a.*,b.hf_w_visit_2d,b.hf_w_surgery from
core_ids_1yr_criteria_4e a left join
hf_meet2 b
on a.bid_hrs=b.bid_hrs_21 and a.core_year=b.core_year;
quit;

proc freq; table hf_w_visit_2d*hf_w_surgery /missprint;
run;

data core_ids_1yr_criteria_4g;
set core_ids_1yr_criteria_4f;

array list hf_w_visit_2d hf_w_surgery ;
do over list;
	if list = .  then list=0;
end;
label hf_w_visit_2d ="HF CPT + Dr visit within 2 days, 1yr pre ivw";
label hf_w_surgery ="HF CPT + Surgery, 1yr pre ivw";

run;

proc freq; table hf_w_visit_2d hf_w_surgery; run;

/*Another idea is to check IP claims
if CPT code (in fields HCPCSCD01-HCPCSCD45 in list then if PRCDRCD1-PRCDRCD25 in list = hip frature = yes*/

/*merge new variables into full interview dataset*/
/*
proc sql;
create table sic_int.core_ids_1yr_criteria_4g(drop=bid_hrs2 core_year2) as select a.*,b.* from
sic_int.core_ids_1yr_criteria_4b a left join
core_ids_1yr_criteria_4g(rename=(bid_hrs=bid_hrs2) rename=(core_year=core_year2)
     drop=c_ivw_year c_ivw_date age_ge_65 part_ab_12m hmo_d_12m )
 	 b
on a.bid_hrs=b.bid_hrs2 and a.core_year=b.core_year2;
quit;

H="combine with interviews into 1 dataset"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/
data proj_int.index;
set proj_int.index;
if index_date = . then delete;
run;


data proj_int.index;
set proj_int.index;
if bid_hrs_22 =" " then delete;
run;


proc sql; 
create table tomerge as select * from
proj_int.index a 
left join
proj_int.ffs_before b 
on a.bid_hrs_22=b.bid_hrs_22 and a.index_year=b.index_year
left join 
proj_int.elix c
on a.bid_hrs_22=c.bid_hrs_22 and a.index_year=c.index_year
left join 
proj_int.charls_0d_n12m d
on a.bid_hrs_22=d.bid_hrs_22 and a.index_year=year(d.index_date)
left join
proj_int.ccw e
on a.bid_hrs_22=e.bid_hrs_22 and a.index_year=e.index_year
left join 
proj_int.utilization_pre f
on a.bid_hrs_22=f.bid_hrs_22 and a.index_year=f.index_year
left join
proj_int.smi k
on a.bid_hrs_22=k.bid_hrs_22 and a.index_year=k.index_year
left join
proj_int.dx_both2 l
on a.bid_hrs_22=l.bid_hrs_22 and a.index_year=l.index_year
left join
proj_int.mental m
on a.bid_hrs_22=m.bid_hrs_22 and a.index_year=m.index_year;
quit;

proc sql;
create table proj_int.hm_mental_int_dataset as select * from
proj_int.index a 
left join
tomerge b 
on a.bid_hrs_22=b.bid_hrs_22 and a.index_year=b.index_year;
quit;

proc export data=proj_int.hm_mental_int_dataset outfile="D:\HRS\Projects\exploratory\hm_smi_mental_ill\data\int_data\hm_mental_int_dataset.dta" 
replace;
run;

H="table creation"
use "D:\HRS\Projects\exploratory\hm_smi_mental_ill\data\int_data\hm_mental_int_dataset.dta", clear
gen c_ivw_date=index_date 

merge 1:1 id c_ivw_date using "D:\HRS\Shared\base_data\hrs_cleaned\core_00_to_14.dta", force keep(match) nogen

merge 1:1 hhid pn using "D:\HRS\Shared\base_data\hrs_cleaned\restr_tracker_v2014.dta", force nogen keep(match)

format %td birth_date
gen age=floor((index_date-birth_date)/365.25)

gen hisp_oth=0
replace hisp_oth=1 if hisp_eth==1 | other_race==1
label var hisp_oth "Hispanic or Other Ethnicity"

keep if cont_ffs_n_mos>=24
keep if age>=65

gen adl_diff=0
replace adl_diff=1 if adl_index_core>0
label var adl_diff "ADL Indicator"
//chf, copd
foreach i in 12 24{
gen smi_icd9_15_0m_`i'm=0
replace smi_icd9_15_0m_`i'm=1 if smi_icd9_4_0m_`i'm==1 & home_oxygen==1

gen smi_icd9_16_0m_`i'm=0
replace smi_icd9_16_0m_`i'm=1 if smi_icd9_5_0m_`i'm==1 & home_oxygen==1
}

gen smi_icd9_14_0m_12m=.
replace smi_icd9_14_0m_12m=0 
replace smi_icd9_14_0m_12m=1 if smi_icd9_6_0m_12m==1 & (smi_icd9_11_0m_12m==1 | smi_icd9_12_0m_12m==1 | smi_icd9_13_0m_12m==1)
label var smi_icd9_14_0m_12m "Diabetes Comp. 12 months"

gen smi_icd9_14_0m_24m=.
replace smi_icd9_14_0m_24m=0
replace smi_icd9_14_0m_24m=1 if (smi_icd9_6_0m_24m==1 & (smi_icd9_11_0m_24m==1 | smi_icd9_12_0m_24m==1 | smi_icd9_13_0m_24m==1)) & smi_icd9_14_0m_12m==1
label var smi_icd9_14_0m_24m "Diabetes Comp. 24 months"

foreach i in 12 24{
rename smi_icd9_4_0m_`i'm chf_`i'm
rename smi_icd9_5_0m_`i'm copd_`i'm
rename smi_icd9_6_0m_`i'm diab_`i'm
rename smi_icd9_11_0m_`i'm renal_`i'm
rename smi_icd9_12_0m_`i'm ihd_`i'm
rename smi_icd9_13_0m_`i'm pvd_`i'm
}


egen smi_icd9_all_12m=rowtotal(smi_icd9_*_0m_12m)

egen smi_icd9_all_24m=rowtotal(smi_icd9_*_0m_24m)

egen ment_cnt_n_12m=rowtotal(ment_1_0m_12m ment_2_0m_12m ment_3_0m_12m ment_4_0m_12m ment_5_0m_12m ment_6_0m_12m ment_7_0m_12m ment_8_0m_12m )

egen ment_cnt_n_12m_sev=rowtotal(ment_1_0m_12m ment_2_0m_12m ment_3_0m_12m ment_4_0m_12m)

egen ment_cnt_n_24m=rowtotal(ment_*_0m_24m )

egen ment_cnt_n_24m_sev=rowtotal(ment_1_0m_24m ment_2_0m_24m ment_3_0m_24m ment_4_0m_24m)

gen group1=0
replace group1=1 if smi_icd9_all_12m>0 & ment_cnt_n_24m_sev==0
gen group2=0
replace group2=1 if smi_icd9_all_12m>0 & ment_cnt_n_24m_sev>0 

gen group3=0
replace group3=1 if smi_icd9_all_12m>0 & ment_cnt_n_24m==0
gen group4=0
replace group4=1 if smi_icd9_all_12m>0 & ment_cnt_n_24m>0 

gen group6=1

gen educ_hs_ind=0 if degree==0
replace educ_hs_ind=1 if degree>0 & !missing(degree)

foreach i in 12 24{
label var smi_icd9_1_0m_`i'm "Dementia, `i'm"
label var smi_icd9_2_0m_`i'm "Cancer, `i'm"
label var smi_icd9_3_0m_`i'm "ESRD, `i'm"
label var smi_icd9_15_0m_`i'm "CHF, `i'm"
label var smi_icd9_16_0m_`i'm "COPD, `i'm"
label var smi_icd9_7_0m_`i'm "ALD, `i'm"
label var smi_icd9_8_0m_`i'm "HIV, `i'm"
label var smi_icd9_9_0m_`i'm "ALS, `i'm"
label var smi_icd9_10_0m_`i'm "Hip Fracture, `i'm"
}
label var educ_hs_ind "HS+ Education"

replace ment_5_0m_12m=1 if ment_6_0m_12m==1


gen n=1

local cvars1 age 
local ivars1 female white black hisp_oth married educ_hs_ind pain_hrs ind_ed_adm_12m ind_ed_adm_24m
local cvars2 n_ip_admit_12m n_ip_admit_24m 
local smi12 smi_icd9_1_0m_12m smi_icd9_2_0m_12m smi_icd9_3_0m_12m smi_icd9_15_0m_12m smi_icd9_16_0m_12m smi_icd9_7_0m_12m smi_icd9_8_0m_12m smi_icd9_9_0m_12m smi_icd9_10_0m_12m smi_icd9_14_0m_12m
local smi24 smi_icd9_1_0m_24m smi_icd9_2_0m_24m smi_icd9_3_0m_24m smi_icd9_15_0m_24m smi_icd9_16_0m_24m smi_icd9_7_0m_24m smi_icd9_8_0m_24m smi_icd9_9_0m_24m smi_icd9_10_0m_24m smi_icd9_14_0m_24m
local mental24 ment_1_0m_24m ment_2_0m_24m ment_3_0m_24m ment_4_0m_24m ment_5_0m_24m  ment_7_0m_24m ment_8_0m_24m 
local adl adl_dr_core adl_bh_core adl_wk_core adl_e_core adl_tx_core adl_t_core adl_diff

local vars: word count `cvars1' `ivars1' `cvars2' `smi12' `smi24' `mental24' `adl' 1

mat tab=J(`vars',9,.)
mat stars=J(`vars',9,0)
local r=1
local c=1

foreach i in 1 2 6{
	foreach x in `cvars1' `cvars2'{
		sum `x' if group`i'==1
		if `r(N)'>=11 | `r(N)'==0{
		mat tab[`r',`c']=r(N)
		mat tab[`r',`c'+2]=r(mean)
		if inlist("`i'", "2") {
			reg `x' group`i' if group`i'==1 | group1==1
			test group`i'
			mat stars[`r',`c'+2]=(r(p)<.01) + (r(p)<.05) 
			}
		}
		local r=`r'+1
	}
	foreach x in `adl' `ivars1' `smi12' `smi24' `mental24'{
		sum `x' if group`i'==1
		if `r(mean)'*`r(N)'>=11 | `r(mean)'*`r(N)'==0{
		mat tab[`r',`c']=r(N)
		mat tab[`r',`c'+1]=`r(mean)'*`r(N)' 
		mat tab[`r',`c'+2]=r(mean)*100
		if inlist("`i'","2") {
			tab `x' group`i' if group`i'==1 | group1==1, chi2
			mat stars[`r',`c'+2]=(r(p)<.01) + (r(p)<.05) 
			}
		}
		local r=`r'+1
	}
	
	sum n if group`i'==1
	mat tab[`r',`c']=r(N)
	local c=`c'+3
	local r=1
	}
	

mat rownames tab=`cvars1' `cvars2' `adl' `ivars1' `smi12' `smi24' `mental24'  "N"
mat colnames tab= "SMI 12 months only, N" "SMI 12 months only, n" "SMI 12 months only, mean/%" "SMI12 & Sev Mental w/24 months,N" "SMI12 & Sev Mental w/24 months,n" "SMI12 & Sev Mental,mean/%" "Total, N" "Total, n" "Total, mean/%"
mat list tab

frmttable using "D:\HRS\Projects\exploratory\hm_smi_mental_ill\output\logs\table1.rtf", statmat(tab) title("Comparisons between SMI and Severe Mental Illness") replace varlabels note("24-Month FFs" "Age restricted to 65+" "HRS 2014 interview" "P-value between SMI only and SMI+Mental") annotate(stars) asymbol(*,**)




local vars: word count `cvars1' `ivars1' `adl' `cvars2' `smi12' `smi24' `mental24' 1

mat tab=J(`vars',9,.)
mat stars=J(`vars',9,0)
local r=1
local c=1

foreach i in 3 4 6{
	foreach x in `cvars1' `cvars2'{
		sum `x' if group`i'==1
		if `r(N)'>=11 | `r(N)'==0{
		mat tab[`r',`c']=r(N)
		mat tab[`r',`c'+2]=r(mean)
		if inlist("`i'","4") {
			reg `x' group`i' if group`i'==1 | group3==1
			test group`i'
			mat stars[`r',`c'+2]=(r(p)<.01) + (r(p)<.05) 
			}
		}
		local r=`r'+1
	}
	foreach x in `adl' `ivars1' `smi12' `smi24' `mental24'{
		sum `x' if group`i'==1
		if `r(mean)'*`r(N)'>=11 | `r(mean)'*`r(N)'==0{
		mat tab[`r',`c']=r(N)
		mat tab[`r',`c'+1]=`r(mean)'*`r(N)' 
		mat tab[`r',`c'+2]=r(mean)*100
		if inlist("`i'","4") {
			tab `x' group`i' if group`i'==1 | group3==1, chi2
			mat stars[`r',`c'+2]=(r(p)<.01) + (r(p)<.05) 
			}
		}
		local r=`r'+1
	}
	
	sum n if group`i'==1
	mat tab[`r',`c']=r(N)
	local c=`c'+3
	local r=1
	}
	

mat rownames tab=`cvars1' `cvars2' `adl' `ivars1' `smi12' `smi24' `mental24' "N"
mat colnames tab= "SMI 12 months only, N" "SMI 12 months only, n" "SMI 12 months only, mean/%" "SMI12 & Mental w/24 months,N" "SMI12 & Mental w/24 months,n" "SMI12 & Mental,mean/%" "Total, N" "Total, mean/%"
mat list tab

frmttable using "D:\HRS\Projects\exploratory\hm_smi_mental_ill\output\logs\table1.rtf", statmat(tab) title("Comparisons between SMI and Mental Illness") replace varlabels addtable note("24-Month FFs" "Age restricted to 65+" "HRS 2014 interview" "P-value between SMI only and SMI+Mental") annotate(stars) asymbol(*,**)



H="Changelog"


********************Change Log******************** 



Updates:

10/23/2019 MH
-------------
Created datasets and table. 

H="*******************"


H="Heading"
/*HRS variables are processed in file HRS_Processing.txt
1998-2014 Core interviews
2002-2014 Exit interviews
Restricted data received in March 2015

Note elixhauser comorbidities diagnosis lists are modified for the 
purposes of this project, do not copy and paste this Elixhauser code 
for use in other projects!!

******************************************************************

/*hrs cleaned path*/
libname clean 'D:\HRS\Shared\base_data\hrs_cleaned';

/*medicare xwalk and claims path*/
libname medi 'D:\HRS\Shared\base_data\hrs_cms\SAS';

/*project data paths*/
libname proj_int 'D:\HRS\Projects\exploratory\hm_smi_mental_ill\output\logs';
libname proj_fin 'D:\HRS\Projects\exploratory\hm_smi_mental_ill\output\final';
/*libname proj_ref 'D:\HRS\Projects\exploratory\hm_smi_mental_ill\output\logs';*/

H="Mental illness paper"
data core_04_14;
set clean.core_00_to_14;
if core_year>=2004 and core_year<=2014;
run;

proc sql;
create table hrs as select * from 
core_04_14 a
left join 
medi.xref2015medicare b
on a.hhid=b.hhid and a.pn=b.pn
left join clean.restr_tracker_v2014 c
on a.hhid=c.hhid and a.pn=b.pn;
quit;

proc sort data=hrs out=hrs1;
by bid_hrs_22 core_year;
run;

data hrs2;
set hrs1;
count+1;
by bid_hrs_22;
if first.bid_hrs_22 then count=1;
run;

/* want to keep frist 2 observations and then drop the rest 
Then want to make sure they are consecutive interviews. 
Then keep the first interview and look 12 months prior to see if any smi's.
*/

data hrs3;
set hrs2;
if 

data hrs2;
set hrs1;
age_at_core=(c_ivw_date-birth_date)/365.25;
run;

data proj_int.hrs;
set hrs2;
run;

data proj_int.index(keep=id bid_hrs_22 index_date index_year);
set hrs2;
index_date=c_ivw_date;
index_year=c_ivw_year;
run;