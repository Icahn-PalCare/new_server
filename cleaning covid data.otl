= V4 Outline MultiLine NoSorting TabWidth=30

H="Intro"


H="merging files"
*merging all covid data files into on

use "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20cova_r.dta" 
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covb_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covc_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covcov_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covd_r.dta", nogen

merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20cove_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covf_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covg_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covh_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covj_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covj3_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covlb_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covm1_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covm2_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covn_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covp_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covpr_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covq_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covr_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covs_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covt_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covtn_r.dta", nogen
merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covw_r.dta", nogen



/*the below files were not merged:
*merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20cove_fc.dta", nogen
*merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20cove_mc.dta", nogen
*merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20cove_tc.dta", nogen
*merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covf_sb.dta", nogen
*merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covj2_p.dta", nogen
*merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covpr_mc.dta", nogen
*merge 1:1 hhid pn cvwgtr rvdate rversion using "D:\HRS\Projects\coronavirus\data\raw\coviddta\h20covpr_sb.dta", nogen

*/

save "D:\HRS\Projects\coronavirus\data\merged\covid merged.dta", replace

H="Step 1: basic demographics"
*STEP 1 BASIC DEMOGRAPHICS 
/*variable cleaning for coronavirus data drop november 2020
adapted from "variable cleaning for HRS core 2006-2014"
Most code is taken from the HRS Outline_11_22_11.txt file
and modified to clean 2006-2012 core dataset


*capture log close

clear all
set mem 1g
set matsize 800
set more off
*/

//Amy's PC
*local logpath D:\HRS\Projects\coronavirus\logs
*local datapath D:\HRS\Projects\coronavirus\data\merged


//RG PC
//local logpath C:\HRS\hrs_cleaned\logs
//local datapath C:\HRS\hrs_cleaned\working

*log using "`logpath'\covid clean log.txt", text replace

*cd `datapath'

use "D:\HRS\Projects\coronavirus\data\merged\covid_merged.dta"

/*
merge 1:1 id core_year using "D:\HRS\Shared\base_data\hrs_cleaned\working\ivw_9814.dta", keepus(c_ivw_date)
drop if _m==2
drop _m


gsort id -core_year
by id: gen days_be_core = c_ivw_date - c_ivw_date[_n+1]
*/

*********************************************************************************
// Proxy for core interview
*********************************************************************************
generate proxy_core = .
replace  proxy_core = 1 if (RA009==2)|(RA009==3)
replace  proxy_core = 0 if RA009==1
label variable proxy_core "Proxy Respondent for Core Interview"
//label define proxy_core 0 "No" 1 "Proxy", modify
//label values proxy_core proxy_core
*tab proxy_core core_year, missing

*********************************************************************************
// Gender - from core interview
*********************************************************************************


generate female = .
replace female = 1 if RX060_R==2
replace female = 0 if RX060_R==1
label variable female "Female"
//label define female 0 "Male" 1 "Female", modify
//label values female female

*********************************************************************************
//Education variables
*********************************************************************************
// Education: categorical, dummies or dichotomous (>highschool vs <=highschool) - from core
// Education variables only complete 2004 and earlier
*******************************************************************************************
generate educ = .
replace educ = 0 if RB014==0
replace educ = 1 if ((RB014>=1)& (RB014<=11))


replace educ = 2 if RB014==12

replace educ = 3 if ((RB014>=13)& (RB014<=15))


replace educ = 4 if RB014==16
replace educ = 5 if RB014==17
label variable educ "Eduction, Highest Level"
label define educ 0 "No Formal Education" 1 "Grades 1-11" 2 "High School" 3 "Some College" 4 "College" ///
      5 "Post College", modify
label values educ educ
tab educ, missing 

*********************************************************************************
// Marital status from core interview
// Note: There are also marital status variables generated in the 
// exit interview cleaning
*********************************************************************************
gen marital = .
replace marital = 1 if(RB063==1) //married
replace marital = 2 if(RB063==3) //separated
replace marital = 3 if(RB063==4) //divorced
replace marital = 4 if(RB063==5) //widowed
replace marital = 5 if(RB063==6) //never married

//unknown or other
replace marital = 6 if (inlist(RB063,2,7,8,9,.)  )

label variable marital "Marital Status"
label define marital 1 "Married" 2 "Separated" 3 "Divorced" 4 "Widowed" 5 "Never Married" 6 "Other/Don't Know", modify
label values marital marital
tab marital, missing

generate byte married = .
replace married = 1 if (marital==1)
replace married = 0 if (marital!=1 & marital <.)
label variable married "Married"
//label define married 1 "Married" 0 "Not Married", modify
//label values married married
tab married , missing 


*********************************************************************************
// Ethnicity from core interview
// Maybe use restricted file for race and ethnicity?
*********************************************************************************
generate hisp = .
replace hisp = 1 if (RB028==1)
replace hisp = 0 if (RB028==5)
label variable hisp "Hispanic Ethnicity"
//label define hisp 1 "Hispanic- yes" 0 "Non-Hispanic", modify
//label values hisp hisp
tab hisp, missing 

*********************************************************************************
*********************************************************************************
// Religious preference and importance from core interview
*********************************************************************************
*********************************************************************************
**Religion: this variable is of limited value because many did not answer due to a skip pattern that is unclear**
*********************************************************************************
// Religious preference from core interview
*********************************************************************************

generate relig = .
replace relig = 1 if (RB050==1)
replace relig = 2 if (RB050==2)
replace relig = 3 if (RB050==3)
replace relig = 4 if (RB050==4)
replace relig = 5 if (RB050==7)
label variable relig "Religion"
label define relig 1 "Protestant" 2 "Catholic" 3 "Jewish" 4 "No Pref" 5 "Other", modify
label values relig relig
tab relig, missing 

*********************************************************************************
// Importance of religion from core interview
// 2014 discontinued
*********************************************************************************


*********************************************************************************
// Good Friends Nearby from core interview, for covid coded missing as missingcode missing as no
*********************************************************************************
generate friend = .
replace friend = 1 if (RF175==1)
replace friend = 0 if (RF175==5)
label variable friend "Good Friends Nearby"
label define friend 0 "No" 1 "Yes", modify
label values friend friend
tab friend , missing

*********************************************************************************
// Number of social visits, code missing as no
*********************************************************************************
/*How often do you get together with  (/people in or near the facility/any of
        your neighbors) just to chat or for a social visit? 
1998 Core 	F2246
2000 Core 	G2497
2002 Core 	HF176
2004 Core 	JF176
2006 Core 	KF176
2008 Core 	LF176
2010 Core 	MF176
2012 Core 	NF176
2014 Core 	OF176

Next question clarifies contact per xxx
D156A.FREQ OF CONTACT PER                 
          Section: D            Level: Household       CAI Reference: Q2498
          Type: Numeric         Width: 1               Decimals: 0
          ................................................................................
           2343         1. DAY
           4675         2. WEEK
            547         3. EVERY TWO WEEKS
           1367         4. MONTH
            364         5. YEAR
           3613         6. ALMOST NEVER
            120         7. OTHER (SPECIFY) (**other = 97 in 1998)
              1         8. DK (don't know); NA (not ascertained) (**1998: 98, 99 for dk, rf)
              1         9. RF (refused)
*/
//only asked in alternate waves for 2004 and later

//indicator for any visits
generate soc_visit = .
replace soc_visit = 1 if (0<RF176 & RF176 <998) 
replace soc_visit = 0 if RF176==0 
//if reported almost never, then set to 0
replace soc_visit = 0 if soc_visit==. & RF177==6 

label variable soc_visit "Social visits with neighbors?"
//label define soc_visit 0 "No" 1 "Yes", modify
//label values soc_visit friend
tab soc_visit , missing


//convert values to a common number of visits per year
//this is then split into categories to get the categorical variable
gen soc_visit_yr = .

replace soc_visit_yr = RF176*365 if RF177==1 //daily response
replace soc_visit_yr = RF176*52 if  RF177==2 //weekly
replace soc_visit_yr = RF176*26 if RF177==3 //bi weekly
replace soc_visit_yr = RF176*12 if  RF177==4 //monthly
replace soc_visit_yr = RF176 if RF177==5 //year

replace soc_visit_yr = . if soc_visit==.

tab soc_visit_yr , missing

//categorical variable
gen soc_visit_cat = .
replace soc_visit_cat = 3 if (364)<=soc_visit_yr & soc_visit_yr!=. //every day or more
replace soc_visit_cat = 2 if 52<=soc_visit_yr & soc_visit_yr<364 //less than every day up to 1x/week
replace soc_visit_cat = 1 if 0<soc_visit_yr & soc_visit_yr<52 // less than 1/week 
replace soc_visit_cat = 0 if soc_visit ==0 | RF177==6  //none or almost never
la var soc_visit_cat "Frequency of social visits, categorical"
tab soc_visit_cat , missing
tab soc_visit_cat soc_visit, missing

//some are missing the categorical variable because units weren't provided
tab  soc_visit_cat if soc_visit==1, missing



*********************************************************************************
// Relatives Nearby from core interview, code missing as no
*********************************************************************************
gen rel_nb = .
replace rel_nb = 1 if (RF174==1)
replace rel_nb = 0 if (RF174==5)
label variable rel_nb "Relatives Nearby"
//label define rel_nb 0 "No" 1 "Yes", modify
//label values rel_nb rel_nb
tab rel_nb , missing 

*********************************************************************************
// Overnight hospital stay in past 2 years core interview
*********************************************************************************
gen byte hosp_last_2yr = .
replace hosp_last_2yr = 1 if (RN099==1)
replace hosp_last_2yr = 0 if (RN099==5)
label variable hosp_last_2yr "Overnight hospitalization since previous core interview"
//label define hosp_last_2yr 0 "No" 1 "Yes", modify
//label values hosp_last_2yr hosp_last_2yr 
tab hosp_last_2yr  , missing 

*********************************************************************************
//  Insurance status information - from coreinterview
*********************************************************************************
// Covered by Medicare currently?
// r2585
generate byte medicare = .
replace medicare= 1 if (RN001==1) //yes
replace medicare= 0 if (RN001==5) //no
label variable medicare "Medicare, 1=yes"

//Covered by Medicare Part B currently?
// r2587
generate byte medicareb = .
replace medicareb= 1 if  (RN004==1) //yes
replace medicareb= 0 if  (RN004==5) //no
replace medicareb= 0 if ((medicare== 0))
label variable medicareb "Medicare Part B, 1=yes"

//Medicaid coverage any time since last core interview or last 2 years ?
// r2588 r2589
generate byte medicaid = .
replace medicaid= 1 if (RN005==1) //yes
replace medicaid= 0 if (RN005==5) //no
label variable medicaid "Medicaid, 1=yes"

// CHAMPUS or other veterans health care at time of death?
// r2598
generate byte champus = .
replace champus = 1 if (RN007==1) //yes
replace champus = 0 if (RN007==5) //no
label variable champus "CHAMPUS, 1=yes"

// HMO for Medicare / Medicaid coverage?
// r2601
//only asked if report medicare or medicaid coverage
generate byte hmo = .
replace hmo = 1 if (RN009==1) //yes
replace hmo = 0 if (RN009==5) //no
label variable hmo "HMO, 1=yes"

// Private health insurance plans?
// r2623

generate medigap = .
replace medigap= 1 if (RN023>=1&RN023<98) //yes
replace medigap= 0 if (RN023==0) //no
label variable medigap "Medigap, 1=yes"
tab medigap, missing


tab medicare , missing
tab medicareb , missing
tab medicaid , missing
tab champus , missing
tab hmo , missing
tab medigap , missing

egen catinsur= concat(medicare medicareb medicaid champus hmo medigap)
tab catinsur

*********************************************************************************
//LTC Insurance
/* Not including government programs, do you now have any insurance which 
specifically covers any part of personal or medical care in your home or in a 
nursing home for a year or more?
1. Yes
5. No
8. DK/NA
9. RF
Blank.*/
gen ltc_ins=.
replace ltc_ins=0 if RN071==5  
replace ltc_ins=1 if RN071==1 
replace ltc_ins=8 if RN071==8 
replace ltc_ins=. if RN071==9 
label var ltc_ins "LTC Insurance, 1=yes"

*********************************************************************************
//LTC Benefits Received
/* Have you ever received benefits under your long-term care policy?
1. Yes
5. No
8. DK/NA
9. RF
Blank.*/
gen ltc_bene=.
replace ltc_bene=0 if RN077==5 
replace ltc_bene=1 if RN077==1 
replace ltc_bene=8 if RN077==8 
replace ltc_bene=. if RN077==9 
label var ltc_bene "LTC Benefits Recd., 1=yes"

*********************************************************************************
*********************************************************************************
//Nursing home use variables - core interview
*********************************************************************************
*********************************************************************************

*********************************************************************************
// Nursing home residence currently - core interview
*********************************************************************************
//coding changes 1=yes, 5=no
//different from exit interview which asks about hospice for some years
generate nhres = .
replace nhres = 1 if (RA028==1)
replace nhres = 0 if (RA028==5)
label variable nhres "Nursing Home Resident"
//label define nhres 0 "No" 1 "Yes", modify
//label values nhres nhres
tab nhres , missing

*********************************************************************************
// Nursing home residence currently - start month, year
*********************************************************************************
/*
Month:
1998 Core 	F718
2000 Core 	G789
2002-10 Core 	xA065
Year:
1998 Core 	F719
2000 Core 	G790
2002-10 Core 	xA066
*/
gen nhres_start_mo = .
replace nhres_start_mo = RA065 
replace nhres_start_mo = . if inlist(nhres_start_mo,98,99)
la var nhres_start_mo "Start month for curr. NH residents"
tab nhres_start_mo , missing

gen nhres_start_yr = .
replace nhres_start_yr = RA066 
replace nhres_start_yr = . if inlist(nhres_start_yr,9998,9999)
la var nhres_start_yr "Start year for curr. NH residents"
tab nhres_start_yr , missing



*********************************************************************************
// Nursing home in past 2 years - core interview
// If responded currently in nh, this is coded as yes
*********************************************************************************
/*
2000 Core 	G2571
2002 Core 	HN114
2004 Core 	JN114
2006 Core 	KN114
2008 Core 	LN114
2010 Core 	MN114
2012 Core 	NN114
2014 Core 	ON114
*/
generate nhres_2yr = .
replace nhres_2yr = 1 if (RN114==1)
replace nhres_2yr = 0 if (RB114==5)
label variable nhres_2yr "Nursing Home Resident in the past 2 years"
//label define nhres_2yr 0 "No" 1 "Yes", modify
//label values nhres_2yr nhres
tab nhres_2yr  , missing
tab nhres_2yr nhres, missing
*********************************************************************************
// Number of times in a nursing home in past 2 years - core interview
*********************************************************************************
/*
2000 Core 	G2572
2002 Core 	HN115
2004 Core 	JN115
2006 Core 	KN115
2008 Core 	LN115
2010 Core 	MN115
2012 Core 	NN115
2014 Core 	ON115
*/
generate nh_stays = .
replace nh_stays = RN115 
replace nh_stays = 0 if nhres_2yr ==0
replace nh_stays = . if inlist(nh_stays,98,99)
label variable nh_stays "Number of times a patient in NH past 2 years"
tab nh_stays ,missing

*********************************************************************************
// Total nursing home nights in the past 2 years - core interview
*********************************************************************************
/*Nights response:
2000 Core 	G2573
2002 Core 	HN116
2004 Core 	JN116
2006 Core 	KN116
2008 Core 	LN116
2010 Core 	MN116
2012 Core 	NN116
2014 Core 	ON116
996 = continuous since last core interview; 998, 999 = dont know / refused
Months response:
2000 Core 	G2574
2002 Core 	HN117
2004 Core 	JN117
2006 Core 	KN117
2008 Core 	LN117
2010 Core 	MN117
2012 Core 	NN117
2014 Core 	ON117
998, 999 = dont know / refused
Variable coded here is in nights, convert months * 30.5 = number of nights,
continuous = 365*2 = 730
Some respondants report values greater than 2 years, in those cases, cap at 730 days / 2 years
*/
gen nh_nights=.
replace nh_nights= RN116 if RN117==.
replace nh_nights=730 if nh_nights==996
replace nh_nights=. if inlist(RN116,998,999)
sum nh_nights, detail

gen nh_start = mdy(nhres_start_mo,1,nhres_start_yr)

gen nh_mos=.
replace nh_mos= RN117 if RN116==.
replace nh_mos=. if inlist(RN117,98,99)
tab nh_mos , missing
sum nh_mos, detail

/*
I DIDN'T DO THIS FOR COVID BC I DIDN'T HAVE THE INTERVIEW DATE....
replace nh_nights=ceil(30.5*nh_mos) if nh_mos!=.
replace nh_nights=days_be_core if nh_nights>days_be_core  & nh_nights!=. // capping nh_nights by maximum number of days since last ivw
replace nh_nights = c_ivw_date - nh_start if nh_nights==.
replace nh_nights=0 if nhres_2yr==0
sum nh_nights, detail
sum nh_nights if(nhres_2yr==1), detail
tab nh_nights core_year, missing
*/
drop nh_mos

*********************************************************************************
// Nursing home covered by insurance - core interview
// missing if no nursing home
*********************************************************************************
/*
I DIDN'T DO THIS FOR COVID BC DON'T SEEM TO HAVE THESE VARIABLES.
gen nh_ins = .
replace nh_ins = 1 if ((kn118==1)|(ln118==1)|(mn118==1)|(nn118==1)/*|(on118==1)*/)
replace nh_ins = 2 if (inlist(kn118,2,3)|inlist(ln118,2,3)|inlist(mn118,2,3)| ///
   inlist(nn118,2,3) /*| inlist(on118,2,3)*/)
replace nh_ins = 3 if ((kn118==5)|(ln118==5)|(mn118==5)|(nn118==5)/*|(on118==5)*/)
replace nh_ins = 4 if (inlist(kn118,7,8,9)| inlist(ln118,7,8,9)| inlist(mn118,7,8,9)| ///     
   inlist(nn118,7,8,9) /*| inlist(on118,7,8,9)*/)
la var nh_ins "Nursing home covered by insurance"
// la define nh_ins 1 "Fully covered by insurance" 2 "Partially covered (or covered w/ copay)" 3 ///
//	"Not covered" 4 "Unknown, not provided"
// la val nh_ins nh_ins
tab nh_ins core_year, missing
tab nh_ins core_year if nhres_2yr ==1, missing
*/

*********************************************************************************
// Living with spouse - core interview
*********************************************************************************
generate resspouse = .
replace resspouse = 0 if ((RA030==5) |(married==0))
replace resspouse = 1 if RA030==1
label variable resspouse "Living with Spouse/Partner"
//label define resspouse 1 "Live with Spouse" 0 "No", modify
tab resspouse , missing

*********************************************************************************
// Number of household members - core interview
*********************************************************************************
generate hhm = .
replace hhm = RA098 

label variable hhm "Number of Household Members"
sum hhm, detail
tab hhm, missing
*********************************************************************************
// Number of Children - core interview
*********************************************************************************
generate child = .
replace child = RA101
label variable child "Number of Children, not their children's spouses"
sum child, detail

*********************************************************************************
// Number of Grandchildren - core
*********************************************************************************
//var = 95 if none assumed, otherwise 0-80 max
generate gchil = .
replace gchil = RE046 
replace gchil = 0 if inlist(gchil,95,995)
replace gchil = . if inlist(gchil,98,99,998,999)
label variable gchil "Number of Grandchildren (capped at 80)"
sum gchil, detail

*********************************************************************************
// Total Number of Children, Children-in-law, and Grandchildren
*********************************************************************************
/*
DO NOT SEEM TO HAVE THIS IN COVID***
generate allchil = .
replace allchil = ka113 if (core_year==2006)
replace allchil = la113 if (core_year==2008)
replace allchil = ma113 if (core_year==2010)
replace allchil = na113 if (core_year==2012)
replace allchil = oa113 if (core_year==2014)
replace allchil = pa113 if (core_year==2016)
label variable allchil "Total Number of Children, Children-in-law, and Grandchildren"
sum allchil, detail
*/
*********************************************************************************
// Number of Resident Children
*********************************************************************************
generate reschil = .
replace reschil = RA099
label variable reschil "Number of Resident Children"
sum reschil, detail

/*******************************************************************************************
** Self reported health status
*******************************************************************************************/

/**Self Rated Health "Don't Know/Refused" (only 2 cases) included with missing 
Cross-Wave Equivalents for:
C001 RATE HEALTH 
2000 Core 	G1226
2002 Core 	HC001
2004 Core 	JC001
2006 Core 	KC001
2008 Core 	LC001
2010 Core 	MC001
2012 Core 	NC001
2014 Core 	OC001
*/

gen srh = .
replace srh = RC001 
replace srh = . if inlist(srh,8,9)
label var srh "Self Rated Health"
//label define srh 1 "Excellent" 2 "Very Good" 3 "Good" 4 "Fair" 5 "Poor"
//label val srh srh
tab srh ,missing

/**********************************************************************/
// CESD - depression scale, from katherine
/**********************************************************************/
/*variable list used:
cesd questions:
g169 / 110 depressed
g1670 / 111 effort
g1671 / 112 restless sleep
g1672 / 113 happy (this is a switch happy=yes=1 - not depressed)
g1673 / 114 lonely
g1674 / 115 enjoyed life (yes=1=not depressed)
g1675 / 116 sad
g1676 / 117 unmotivated - could not get going
other questions:
psych treatment 1=yes 5=no, only asked if reported having psych problems (psych_hrs==1)
2000 Core 	G1324
2002 Core 	HC067
2004 Core 	JC067
2006 Core 	KC067
2008 Core 	LC067
2010 Core 	MC067
2012 Core 	NC067
2014 Core 	OC067
psych medications 1=yes 5 = no, only asked if reported having psych problems (psych_hrs==1)
2000 Core 	G1325
2002 Core 	HC068
2004 Core 	JC068
2006 Core 	KC068
2008 Core 	LC068
2010 Core 	MC068
2012 Core 	NC068
2014 Core 	OC068
Note: the above 2 variables are processed in the section on HRS comorbidities and not here
because of their skip pattern! Different from spouse_data_mar11_2013 code
ever drink alcohol 1 = yes ; 3,5 =no
2000 Core 	G1415
2002 Core 	HC128
2004 Core 	JC128
2006 Core 	KC128
2008 Core 	LC128
2010 Core 	MC128
2012 Core 	NC128
2014 Core 	OC128
number of drinks per day in past 3 months; 98-99=dont know or refused
2000 Core 	G1417
2002 Core 	HC130
2004 Core 	JC130
2006 Core 	KC130
2008 Core 	LC130
2010 Core 	MC130
2012 Core 	NC130
2014 Core 	OC130
//days per week drink if 0 don't ask above question re drinks/day
2000 Core 	G1416
2002 Core 	HC129
2004 Core 	JC129
2006 Core 	KC129
2008 Core 	LC129
2010 Core 	MC129
2012 Core 	NC129
2014 Core 	OC129

2000: g1669-g1677 (1= yes, 5=no) section c
2002: h110-117 section d
*/
//cesd1 - depressed in the last week
gen byte cesd1 = .
replace cesd1 = 1 if (RD110==1)
replace cesd1 = 0 if (RD110==5)
la var cesd1 "CESD - Depressed in last week"
tab cesd1 ,missing

//cesd2 - felt activities were effort in the last week
gen byte cesd2 = .
replace cesd2 = 1 if RD111==1
replace cesd2 = 0 if RD111==5
la var cesd2 "CESD - Activities were effort in last week"
tab cesd2 ,missing

//cesd3 - restless sleep in the last week
gen byte cesd3 = .
replace cesd3 = 1 if RD112==1
replace cesd3 = 0 if RD112==5
la var cesd3 "CESD - Restless Sleep in last week"
tab cesd3 ,missing

//cesd4 - was happy in the last week
//this one is reversed 0 = was happy 1 = was not happy
gen byte cesd4 = .
replace cesd4 = 0 if (RD113==1)
replace cesd4 = 1 if (RD113==5)
la var cesd4 "CESD - Was not happy in last week"
tab cesd4 ,missing

//cesd5 - lonely in the last week
gen byte cesd5 = .
replace cesd5 = 1 if (RD114==1)
replace cesd5 = 0 if (RD114==5)
la var cesd5 "CESD - Lonely in last week"
tab cesd5 ,missing

//cesd6 - enjoyed life in the last week
gen byte cesd6 = .
replace cesd6 = 0 if (RD115==1)
replace cesd6 = 1 if (RD115==5)
la var cesd6 "CESD - Did not enjoy life in last week"
tab cesd6 ,missing

//cesd7 - felt sad in the last week
gen byte cesd7 = .
replace cesd7 = 1 if (RD116==1)
replace cesd7 = 0 if (RD116==5)
la var cesd7 "CESD - Sad in last week"
tab cesd7 ,missing

//cesd8 - unmotivated in the last week
gen byte cesd8 = .
replace cesd8 = 1 if (RD117==1)
replace cesd8 = 0 if (RD117==5)
la var cesd8 "CESD - Unmotivated in last week"
tab cesd8 ,missing

//ever drink alcohol
gen byte ever_drink = .
replace ever_drink = 1 if (RC128==1)
replace ever_drink = 0 if inlist(RC128,3,5)
la var ever_drink "Ever drink alcoholic beverages"
tab ever_drink ,missing

//days per week drink
gen days_drink = .
replace days_drink = RC129 
replace days_drink = . if inlist(days_drink,8,9)
replace days_drink = 0 if ever_drink==0
la var days_drink "Days per week drink alcoholic beverages"
tab days_drink ,missing


//number of drinks per day, coded to 0 if don't drink, . if missing
//different from how Ling had it initally coded where . = missing or don't drink (not asked)
gen n_drinks_3m = .
replace n_drinks_3m = RC130 
replace n_drinks_3m = . if inlist(n_drinks_3m,98,99)
replace n_drinks_3m = 0 if (ever_drink==0 | days_drink==0)
la var n_drinks_3m "Number of alcoholic drinks per day"
tab n_drinks_3m ,missing

/**********************************************************************/
// Smoker status variables
/**********************************************************************/

// Ever smoked?
gen smoke_ever=.
replace smoke_ever=.
replace smoke_ever=0 if (RZ205==5 | RC116==5)
replace smoke_ever=1 if (RZ205==1 | RC116==1)


la var smoke_ever "Ever smoked?"
tab smoke_ever , missing

// Currently smoke
/* JC117    SMOKE CIGARETTES NOW
         Section: C     Level: Respondent      Type: Numeric    Width: 1   Decimals: 0
         CAI Reference: SecC.Smoking.C117_
         2000 Link: G1400 2002 Link: HC117

        Do you smoke cigarettes now?
        ..................................................................................
         3012           1. YES
         8460           5. NO
            1           8. DK (Don't Know); NA (Not Ascertained)
            1           9. RF (Refused)
         8655       Blank. INAP (Inapplicable)


2000 core: G1400
2002 core: HC117
2004 core: JC117
2006 core: KC117
2008 core: LC117
2010 core: MC117
2012 core: NC117
2014 core: OC117
Only ask if reported ever smoked in previous question or past wave
*/
gen smoke_curr=.
replace smoke_curr = 0 if RC117==5
replace smoke_curr = 1 if RC117==1

replace smoke_curr = 0 if smoke_ever==0
la var smoke_curr "Currently smoke cigarettes?"
tab smoke_curr ,missing

/**********************************************************************/
//Vigorous exercise
/**********************************************************************/
/*question in 2000,2002: Do you do vigorous physical activity 3x per
week or more? 1=yes, 5=no
Question changed in 2004-2014: How often do you do vigorous
physical activity? 
1=more than 1xper week
2=1xper week
3=1-3 times a month
4 = hardly ever or never
7 = every day
8 = dont know
9 = refused
Here coded as every day or more than 1x per week = yes*/
gen byte vig_phy_act=.
replace vig_phy_act=1 if inlist(RC223,1,7)
replace vig_phy_act=0 if inlist(RC223,2,3,4)
la var vig_phy_act "Vigorous physical activity more than 1x per week"
tab vig_phy_act ,missing



/**********************************************************************/
// Body mass index variables, calculated from height and weight
// These variables have a lot of missingness, need to
// clean up for each beneficiary if required for analysis
/**********************************************************************/
//current weight, lbs, asked every interview
gen wgt_curr = .
replace wgt_curr = RC139 
replace wgt_curr = . if inlist(wgt_curr,998,999)
la var wgt_curr "Weight current wave, in pounds"
sum wgt_curr

//current height, ft, only asked first interview
gen height_ft_temp = .
replace height_ft_temp = RC141
replace height_ft_temp = . if inlist(height_ft,8,9)
la var height_ft_temp "Height, feet"
tab height_ft_temp , missing

//current height, inches, only asked first interview
gen height_in_temp = .
replace height_in_temp = RC142 
replace height_in_temp = . if (height_in_temp >12)
la var height_in_temp "Height, inches"
tab height_in_temp , missing

/********************************************************************/
// Hours spent helping relatives or friends
/********************************************************************/
/*
Refer to codebooks as questions changed between waves 2000, 2002 and 2004
2006:
G198: Have you spent any time in the past 12 months helping friends, neighbors, or
         relatives who did not live with you and did not pay you for the help?0-9000 = hours
1 = Yes, 5 = No, 8,9 Don't know, refused

G199: If G198=Yes, then ask:
Altogether, would you say the time amounted to less than 100 hours, more than
         100 hours or what?
1 = Less than 100 hours
3 = About 100 hours
5 = More than 100 hours
8,9 = DK, Refused

G200: If G199 = more than 100 hours, then ask:
Would it be less than 200 hours, more than 200 hours or what?

G201: If G199 = less than 100 hours, then ask:
Would it be less than 50 hours, more than 50 hours or what?
*/
//indicator variable
//note that for 1998-2002 if response was not provided as 0 in first question, code
//as being a helper for response < 100 hours
//this likely overestimates the number of people who are helpers in these years
gen help_friends = .
replace help_friends = 1 if RG198==1 
replace help_friends = 0 if RG198==5 
tab help_friends , missing

//categorical variable, driven by 2004 and later survey format
gen help_friends_hours = .
replace help_friends_hours = 0 if help_friends ==0 //none

replace help_friends_hours = 1 if inlist(RG199,1,3)
replace help_friends_hours = 2 if inlist(RG200,1,3)
replace help_friends_hours = 3 if RG200==5 

tab help_friends_hours, missing
tab help_friends, missing
tab help_friends_hours ,missing
tab help_friends ,missing
tab help_friends help_friends_hours, missing

*drop c_ivw_date days_be_core nh_start

save "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 1.dta", replace

H="Step 2: cleaning ADL/IADLs"
***CLEANING PART 2: ADLs and IADLs***
*Modified by HRS core survey cleaning code.
/*variable cleaning for HRS core 2006-2012
Most code is taken from the HRS Outline_11_22_11.txt file
and modified to clean 2006-2014 core dataset

2nd part of core variable cleaning

capture log close
clear all
set more off


//Amy's PC
local logpath D:\HRS\Shared\base_data\hrs_cleaned\logs
local datapath D:\HRS\Shared\base_data\hrs_cleaned\working

//RG PC
//local logpath C:\HRS\hrs_cleaned\logs
//local datapath C:\HRS\hrs_cleaned\working

log using "`logpath'\2_HRS_Core_06_16_clean2-LOG.txt", text replace

cd `datapath'

use core_06_16_clean1.dta

*/
use "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 1.dta"

*************************************************************************
//   ADLs from core interviews
*************************************************************************

*******************************************************************************************
** These variables are drawn from the Core interview. In general the questions 
** were framed "Because of a health or memory problem, do you have any difficulty...
** .. Does anyone ever help you...?"
** " Each ADL is coded "Yes- need help" if the 
** response was "Yes"; and "No" if the item was skipped in the interview.  ADL questions 
** were skipped if respondents were able to do all higher level function in the 
** preceding series of questions, such as climb stairs. "Don't Know" "Not Ascertained" 
** and "Refused" responses are coded as missing. 
*******************************************************************************************

** ADLs **
//Exit interviews include variable for adl_bedbound, not present in core interviews
//so not included here

/*ADL questions are skipped if the adl check variable indicates no difficulty
with first set of questions asked, therefore assign an adl_core_check variable to capture this 
This variable = 0 if the ADL questions are NOT asked because person assumed
to have no adl difficulties

For 2002-2014 - ADL questions only asked if G013TNagiCkpt_A > 0
So assign ADL = 0 if G013TNagiCkpt_A=0

2002 Core 	HG013
2002 Exit 	N/A
2004 Core 	JG013
2004 Exit 	N/A
2006 Core 	KG013
2006 Exit 	N/A
2008 Core 	LG013
2008 Exit 	N/A
2010 Core 	MG013
2012 Core 	NG013
2014 Core 	OG013
*/

/* KMCK FL prefix difficulty data coded 7 = 'don't do' added to the summary variables coded 'YES' 05142015 */

//create adl count flag variable, values = 0-10

//create combined count variable for all years
gen adl_core_check=.
replace adl_core_check=RG013 
tab adl_core_check , missing
sum adl_core_check, detail

/**Dressing, g2724 hg015 jg015
Help dressing?
2000 Core 	G2724
2002 Core 	HG015
2002 Exit 	SG015
2004 Core 	JG015
2004 Exit 	TG015
2006 Core 	KG015
2006 Exit 	UG015
2008 Core 	LG015
2008 Exit 	VG015
2010 Core 	MG015
2012 Core 	NG015
2014 Core 	OG015

Difficulty dressing?
2000 Core 	G2723
2002 Core 	HG014
2002 Exit 	N/A
2004 Core 	JG014
2004 Exit 	N/A
2006 Core 	KG014
2006 Exit 	N/A
2008 Core 	LG014
2008 Exit 	N/A
2010 Core 	MG014
2012 Core 	NG014
2014 Core 	OG014
1 = yes
5 = no
6 = can't do
7 = don't do
8,9 = refused, not asked

1 = if need help (only asked report having difficulty)
0 if don't need help
0 if report don't have difficulty
*/ 

//report no difficulty dressing, used as flag for asking other adl questions
//can't do set to yes, don't do set to missing
gen byte adl_diff_dr = .
replace adl_diff_dr = 1 if (RG014==1)|(RG014==6)
replace adl_diff_dr = 0 if (RG014==5)
replace adl_diff_dr = 0 if adl_core_check==0
la var adl_diff_dr "Difficulty dressing 1=yes"
tab adl_diff_dr , missing

generate adl_dr_core = .
//not asked if need help but report no difficulty dressing
replace adl_dr_core = 0 if adl_diff_dr==0
//not asked because adl check flag = 0
replace adl_dr_core = 0 if adl_core_check==0
//report need help
replace adl_dr_core = 1 if (RG015==1)
//asked if need help, say no
replace adl_dr_core = 0 if (RG015==5)
//asked if need help, refused, don't respond
replace adl_dr_core = . if (RG015==8)|(RG015==9)
label variable adl_dr_core "Help Dressing - Core int."
//label define adl_dr_core 0 "No" 1 "Yes", modify
//label values adl_dr_core adl_dr_core
tab adl_dr_core , missing

//Walking, g2729 hg020 jg020 
/*not asked if adl_core_check==1 and adl_dr_core==0
so not asked if have an adl difficulty but report no difficulty getting dressed*/
gen adl_diff_wk = .
replace adl_diff_wk = 1 if (RG016==1)|(RG016==6)
replace adl_diff_wk = 0 if (RG016==5)
replace adl_diff_wk = 0 if (adl_diff_dr==0 & adl_core_check==1) | adl_core_check==0
la var adl_diff_wk "Difficulty walking? 1=yes"
tab adl_diff_wk , missing

gen adl_equip_wk = .
replace adl_equip_wk = 1 if (RG017==1)
replace adl_equip_wk = 0 if (RG017==5)
la var adl_equip_wk "Use equipment to walk? 1=yes"
tab adl_equip_wk , missing

generate adl_wk_core = .
//set = 0 if not asked because of adl flags
replace adl_wk_core = 0 if adl_core_check==0
replace adl_wk_core = 0 if (adl_core_check==1 & adl_diff_dr==0)
tab adl_wk_core, missing 
// set = 0 if not asked b/c report no difficulty walking
replace adl_wk_core = 0 if adl_diff_wk==0
// set based on repsonses
replace adl_wk_core = 1 if (RG020==1)
replace adl_wk_core = 0 if (RG020==5)
replace adl_wk_core = . if ((RG020==8)|(RG020==9))
label var adl_wk_core "Help Walking - core"
//label define adl_wk_core 0 "No" 1 "Yes", modify
//label values adl_wk_core adl_wk_core
tab adl_wk_core , missing 
tab adl_wk_core adl_equip_wk, missing

//Bathing, g2745 hg022 jg022 
/*Cross-Wave Equivalents for:
G022 ADL BATHE HELP 
1995 Core D1897 
1996 Core E1921 
1998 Core F2447 
2000 Core G2745 
2002 Core HG022 
2002 Exit SG022 
2004 Core JG022 
2004 Exit TG022 
2006 Core KG022 
2006 Exit UG022 
2008 Core LG022 
2008 Exit VG022 
2010 Core MG022 
2010 Exit WG022 
2012 Core NG022 
2012 Exit XG022 
2014 Core OG022 
2014 Exit YG022 
Not asked if adl_count_flag = 1 and difficulty dressing = no
*/

gen byte adl_diff_bh = .
replace adl_diff_bh = 1 if (RG021==1)|(RG021==6)
replace adl_diff_bh = 0 if (RG021==5)
replace adl_diff_bh = 0 if (adl_diff_dr==0 & adl_core_check==1) |  adl_core_check==0
la var adl_diff_bh "Difficulty bathing? 1=yes"
tab adl_diff_bh , missing

generate adl_bh_core = .
//set = 0 if not asked because of adl flags or no difficulty reported
replace adl_bh_core = 0 if adl_core_check==0
replace adl_bh_core = 0 if (adl_core_check==1 & adl_diff_dr==0)
// set based on responses
replace adl_bh_core = 1 if RG022==1
replace adl_bh_core = 0 if RG022==5
replace adl_bh_core = . if ((RG022==8)|(RG022==9))
replace adl_bh_core = 0 if adl_diff_bh==0
label var adl_bh_core "Help Bathing - core"
//label define adl_bh_core 0 "No" 1 "Yes", modify
//label values adl_bh_core adl_bh_core
tab adl_bh_core , missing 

/*
**Eating, g2755 hg024 jg024 
Cross-Wave Equivalents for:
G024 ADL EAT HELP 
1995 Core D1907 
1996 Core E190 
1998 Core F2457 
2000 Core G2755 
2002 Core HG024 
2002 Exit SG024 
2004 Core JG024 
2004 Exit TG024 
2006 Core KG024 
2006 Exit UG024 
2008 Core LG024 
2008 Exit VG024 
2010 Core MG024 
2010 Exit WG024 
2012 Core NG024 
2012 Exit XG024 
2014 Core OG024 
2014 Exit YG024 
*/

gen byte adl_diff_e = .
replace adl_diff_e = 1 if (RG023==1)|(RG023==6)
replace adl_diff_e = 0 if (RG023==5)
replace adl_diff_e = 0 if (adl_diff_dr==0 & adl_core_check==1) |  adl_core_check==0
la var adl_diff_e "Difficulty eating? 1=yes"
tab adl_diff_e , missing

generate adl_e_core = .
//set = 0 if not asked because of adl flags or no difficulty reported
replace adl_e_core = 0 if adl_core_check==0
replace adl_e_core = 0 if (adl_core_check==1 & adl_diff_dr==0)
//set based on responses
replace adl_e_core = 1 if (RG024==1)
replace adl_e_core = 0 if (RG024==5)
replace adl_e_core = . if (RG024==8)|(RG024==9)
replace adl_e_core = 0 if adl_diff_e==0
label var adl_e_core "Help Eating - core"
//label define adl_e_core 0 "No" 1 "Yes", modify
//label values adl_e_core adl_e_core
tab adl_e_core , missing

//Transfers to Bed, g2768 hg029 jg029
gen byte adl_diff_tx = .
replace adl_diff_tx = 1 if (RG025==1)|(RG025==6)
replace adl_diff_tx = 0 if (RG025==5)
replace adl_diff_tx = 0 if (adl_diff_dr==0 & adl_core_check==1) |  adl_core_check==0
la var adl_diff_tx "Difficulty transfers to bed? 1=yes"
tab adl_diff_tx , missing

gen byte adl_equip_tx = .
replace adl_equip_tx = 1 if (RG026==1)
replace adl_equip_tx = 0 if (RG026==5)
la var adl_equip_tx "Use equipment transfers to bed? 1=yes"
tab adl_equip_tx , missing

generate adl_tx_core = .
//set = 0 if not asked because of adl flags or no difficulty reported
replace adl_tx_core = 0 if adl_core_check==0
replace adl_tx_core = 0 if (adl_core_check==1 & adl_diff_dr==0)
//set based on responses
replace adl_tx_core = 1 if (RG029==1)
replace adl_tx_core = 0 if (RG029==5)
replace adl_tx_core = . if ((RG029==8)|(RG029==9))
replace adl_tx_core = 0 if adl_diff_tx == 0
label var adl_tx_core "Help with Transfers to Bed - core"
//label define adl_tx_core 0 "No" 1 "Yes", modify
//label values adl_tx_core adl_tx_core
tab adl_tx_core , missing

//Toileting, g2778 hg00 jg00 
/*2000 Core 	G2778
2002 Core 	HG031
2002 Exit 	SG031
2004 Core 	JG031
2004 Exit 	TG031
2006 Core 	KG031
2006 Exit 	UG031
2008 Core 	LG031
2008 Exit 	VG031
2010 Core 	MG031
2010 Exit 	WG031 
2012 Core 	NG031
2012 Exit 	XG031
2014 Core 	OG031
2014 Exit 	YG031
*/

gen byte adl_diff_t = .
replace adl_diff_t = 1 if ((RG030==1)|(RG030==6))
replace adl_diff_t = 0 if (RG030==5)
replace adl_diff_t = 0 if (adl_diff_dr==0 & adl_core_check==1) |  adl_core_check==0
la var adl_diff_t "Difficulty toileting? 1=yes"
tab adl_diff_t , missing

generate adl_t_core = .
//set = 0 if not asked because of adl flags or no difficulty reported
replace adl_t_core = 0 if adl_core_check==0
replace adl_t_core = 0 if (adl_core_check==1 & adl_diff_dr==0)

//set based on responses
replace adl_t_core = 1 if (RG031==1)
replace adl_t_core = 0 if (RG031==5)
replace adl_t_core = . if ((RG031==8)|(RG031==9))
replace adl_t_core = 0 if (RG030==5)
replace adl_t_core = 0 if adl_core_check==0
label var adl_t_core "Help Toileting - core"
//label define adl_t_core 0 "No" 1 "Yes", modify
//label values adl_t_core adl_t_core
tab adl_t_core , missing

/**********************************************************************************/
/**********************************************************************************/
// IADLs
/**********************************************************************************/
/**********************************************************************************/

/*Difficulty using maps
1998 Core 	F2553
2000 Core 	G2851
2002-2014 	HG040-OG040*/
gen byte iadl_diff_map = .
replace iadl_diff_map = 1 if (RG040==1)|(RG040==6)
replace iadl_diff_map = 0 if (RG040==5)
la var iadl_diff_map "Difficulty using maps? 1=yes"
tab iadl_diff_map , missing

/*Meal Prep, r2002 
Cross-Wave Equivalents for:

G043 IADL MEAL PREPARATION HELP 
1998 Core F2565 
2000 Core G2863 
2002 Core HG043 
2002 Exit SG043 
2004 Core JG043 
2004 Exit TG043 
2006 Core KG043 
2006 Exit UG043 
2008 Core LG043 
2008 Exit VG043 
2010 Core MG043 
2010 Exit WG043 
2012 Core NG043 
2012 Exit XG043 
2014 Core OG043 
2014 Exit YG043 
Not asked if
1. Live in nursing home g558 / _a028
2. Report no difficulty with task g2860 or
3. Report can't / don't do task (g2860) but that its not because of a health problem
Assign yes, need help, if live in nursing home
Assign no, no help meeded, if no difficulty or can't / don't do but not b/c of health prob.
*/
//difficulty with task b/c of health or memory problem?
gen byte iadl_diff_mp=.
replace iadl_diff_mp = 1 if (RG041==1)
replace iadl_diff_mp = 1 if inlist(RG041,6,7) & RG042==1	
replace iadl_diff_mp = 0 if (RG041==5)
replace iadl_diff_mp = 0 if inlist(RG041,6,7) & RG042==5


la var iadl_diff_mp "Difficulty meal prep? 1=yes"
tab iadl_diff_mp , missing

gen byte iadl_mp_core=.
//set for those that report no difficulty with task
replace iadl_mp_core = 0 if iadl_diff_mp==0
//set yes for if live in nursing home
replace iadl_mp_core = 1 if	nhres ==1
// set for response help = no
replace iadl_mp_core = 0 if (RG043==5)
//set for response help = yes
replace iadl_mp_core = 1 if (RG043==1)
label var iadl_mp_core "Help with Meal Prep"
// la def iadl_mp_core 0 "No" 1 "Yes", modify
// la val iadl_mp_core iadl_mp_core 
tab iadl_mp_core ,missing

//Grocery Shopping, r2012
/*Cross-Wave Equivalents for:
G046 IADL GROC SHOP HELP 
1995 Core D2029 
1996 Core E2044 
1998 Core F2570 
2000 Core G2868 
2002 Core HG046 
2002 Exit SG046 
2004 Core JG046 
2004 Exit TG046 
2006 Core KG046 
2006 Exit UG046 
2008 Core LG046 
2008 Exit VG046 
2010 Core MG046 
2010 Exit WG046
2012 Core NG046 
2012 Exit XG046
2014 Core OG046 
2014 Exit YG046
*/

//difficulty with task b/c of health or memory problem?
gen byte iadl_diff_gr=.
replace iadl_diff_gr = 1 if (RG044==1)
replace iadl_diff_gr = 1 if inlist(RG044,6,7) & RG045==1	
replace iadl_diff_gr = 0 if (RG044==5)
replace iadl_diff_gr = 0 if inlist(RG044,6,7) & RG045==5	
la var iadl_diff_gr "Difficulty grocery shopping? 1=yes"
tab iadl_diff_gr , missing

gen byte iadl_gr_core=.
//set for those that report no difficulty with task
replace iadl_gr_core = 0 if iadl_diff_gr==0
//set yes for if live in nursing home
replace iadl_gr_core = 1 if nhres ==1
//set for response help = yes
replace iadl_gr_core = 1 if (RG046==1)
// set for response help = no
replace iadl_gr_core = 0 if (RG046==5)
//set for response help = yes
replace iadl_gr_core = 1 if (RG046==1)
label var iadl_gr_core "Help with Grocery Shopping"
// la def iadl_gr_core 0 "No" 1 "Yes", modify
// la val iadl_gr_core iadl_gr_core 
tab iadl_gr_core ,missing

/*Phone Calls, r2022
Cross-Wave Equivalents for:
G049 IADL MAKING PHONE CALLS HELP 
1995 Core D2034 
1996 Core E2049 
1998 Core F2575 
2000 Core G2873 
2002 Core HG049 
2002 Exit SG049 
2004 Core JG049 
2004 Exit TG049 
2006 Core KG049 
2006 Exit UG049 
2008 Core LG049 
2008 Exit VG049 
2010 Core MG049 
2010 Exit WG049 
2012 Core NG049 
2012 Exit XG049 
2014 Core OG049 
2014 Exit YG049 
This one is different from other iadls because ask regardless of 
nursing home resident status
*/

//difficulty with task b/c of health or memory problem?
gen byte iadl_diff_ph=.
replace iadl_diff_ph = 1 if (RG047==1)
replace iadl_diff_ph = 1 if inlist(RG047,6,7) & RG048==1	
replace iadl_diff_ph = 0 if (RG047==5)
replace iadl_diff_ph = 0 if inlist(RG047,6,7) & RG048==5
la var iadl_diff_ph "Difficulty phone calls? 1=yes"
tab iadl_diff_ph , missing

gen byte iadl_ph_core=.
//set for those that report no difficulty with task
replace iadl_ph_core = 0 if (RG047==5)
//set for those that report cant / dont do but not bc of health problem
replace iadl_ph_core = 0 if (inlist(RG047,6,7) & RG048==5)
// set for response help = no
replace iadl_ph_core = 0 if (RG049==5)
//set for response help = yes
replace iadl_ph_core = 1 if (RG049==1)
label var iadl_ph_core "Help Making Phone Calls"
// la def iadl_ph_core 0 "No" 1 "Yes", modify
// la val iadl_ph_core iadl_ph_core 
tab iadl_ph_core ,missing

/*Medications, r2032
Cross-Wave Equivalents for:
G053 IADL TAKING MEDICATIONS HELP 
1995 Core D2039 
1996 Core E2054 
1998 Core F2580 
2000 Core G2878 
2002 Core HG053 
2002 Exit SG053 
2004 Core JG053 
2004 Exit TG053 
2006 Core KG053 
2006 Exit UG053 
2008 Core LG053 
2008 Exit VG053 
2010 Core MG053 
2010 Exit WG053 
2012 Core NG053 
2012 Exit XG053 
2014 Core OG053 
2014 Exit YG053 

Different than other iadls because question sequence has addltional question
1. Difficulty taking meds? g050 / g2875
2. If dont take(7), if had to take, anticipate difficulty? g051 / g2876
3. Difficulty b/c of health problem (if g050 = 6 OR [g050=7 and g051=1] )
4. Help with medications? 
5. Not asked if nursing home (like others)
*/

//difficulty with task b/c of health or memory problem?
gen byte iadl_diff_rx=.
//yes, difficulty
replace iadl_diff_rx = 1 if (RG050==1)
//can't do, b/c of health problems
replace iadl_diff_rx = 1 if RG050==6 & RG052==1
//don't do, if had to take, yes would have difficulty b/c of health prob.
replace iadl_diff_rx = 1 if RG050==7 & RG051==1 & RG052==1
//no, no difficulty	
replace iadl_diff_rx = 0 if (RG050==5)
//can't do, not b/c of health problems
replace iadl_diff_rx = 0 if RG050==6 & RG052==5
//don't do, if had to take, no difficulty anticipated
replace iadl_diff_rx = 0 if RG050==7 & RG051==5
la var iadl_diff_rx "Difficulty taking medications? 1=yes"
tab iadl_diff_rx , missing

gen byte iadl_rx_core=.
//set for those that report no difficulty with task
replace iadl_rx_core = 0 if iadl_diff_rx==0
//set yes for if live in nursing home
replace iadl_rx_core = 1 if nhres ==1
// set for response help = no
replace iadl_rx_core = 0 if (RG053==5)
//set for response help = yes
replace iadl_rx_core = 1 if (RG053==1)
label var iadl_rx_core "Help with Medications"
// la def iadl_rx_core 0 "No" 1 "Yes", modify
// la val iadl_rx_core iadl_rx_core 
tab iadl_rx_core ,missing

/*Money, r2077
Cross-Wave Equivalents for:
G061 IADL MANAGING MONEY HELP 
1995 Core D2102 
1996 Core E2096 
1998 Core F2620 
2000 Core G2918 
2002 Core HG061 
2002 Exit SG061 
2004 Core JG061 
2004 Exit TG061 
2006 Core KG061 
2006 Exit UG061 
2008 Core LG061 
2008 Exit VG061 
2010 Core MG061 
2010 Exit WG061 
2012 Core NG061 
2012 Exit XG061 
2014 Core OG061 
2014 Exit YG061 
Asked for those in nursing home*/

//difficulty with task b/c of health or memory problem?
gen byte iadl_diff_m = .
replace iadl_diff_m = 1 if (RG059==1)
replace iadl_diff_m = 1 if inlist(RG059,6,7) & RG060==1
replace iadl_diff_m = 0 if (RG059==5)
replace iadl_diff_m = 0 if inlist(RG059,6,7) & RG060==5
la var iadl_diff_m "Difficulty managing money? 1=yes"
tab iadl_diff_m , missing

gen byte iadl_m_core=.
//set for those that report no difficulty with task
replace iadl_m_core = 0 if (RG059==5)
//set for those that report cant / dont do but not bc of health problem
replace iadl_m_core = 0 if (inlist(RG059,6,7) & RG060==5)
// set for response help = no
replace iadl_m_core = 0 if (RG061==5)
//set for response help = yes
replace iadl_m_core = 1 if (RG061==1)
label var iadl_m_core "Help with Money"
// la def iadl_m_core 0 "No" 1 "Yes", modify
// la val iadl_m_core iadl_m_core 
tab iadl_m_core ,missing

*************************************************************************
//   Functional limitations from core interviews
*************************************************************************
/*Responses of difficulty = yes or can't do coded as 1
difficulty = no = 0; don't do left missing since no follow up question is asked
to verify why don't do*/

/*Difficulty walking several blocks?
1998 Core 	F2391
2000 Core 	G2689
2002 Core 	HG001
2004 Core 	JG001
2006 Core 	KG001
2008 Core 	LG001
2010 Core 	MG001
2012 Core 	NG001
2014 Core 	OG001
*/

gen byte fl_diff_wk_many = .
replace fl_diff_wk_many = 1 if RG001==1 | RG001==6 | RG001==7 
replace fl_diff_wk_many = 0 if RG001==5 
la var fl_diff_wk_many "Difficulty walking several blocks? 1=yes"
tab fl_diff_wk_many , missing

/*Difficulty walking 1 block?
Only asked if do not report no difficulty walking many blocks
1998 Core 	F2394
2000 Core 	G2692
2002 Core 	HG003
2004 Core 	JG003
2006 Core 	KG003
2008 Core 	LG003
2010 Core 	MG003
2012 Core 	NG003
2014 Core 	OG003
*/

gen byte fl_diff_wk_one = .
replace fl_diff_wk_one = 1 if RG003==1 | RG003==6 | RG003==7 
replace fl_diff_wk_one = 0 if RG003==5 
replace fl_diff_wk_one = 0 if fl_diff_wk_many==0
la var fl_diff_wk_one "Difficulty walking one block? 1=yes"
tab fl_diff_wk_one , missing 

/*Difficulty sitting for 2 hours?
1998 Core 	F2397
2000 Core	G2695
2002 Core 	HG004
2004 Core 	JG004
2006 Core 	KG004
2008 Core 	LG004
2010 Core 	MG004
2012 Core 	NG004
2014 Core 	OG004
*/
gen byte fl_diff_sit = .
replace fl_diff_sit = 1 if RG004==1 | RG004==6 | RG004==7 
replace fl_diff_sit = 0 if RG004==5 
la var fl_diff_sit "Difficulty sitting 2 hours? 1=yes"
tab fl_diff_sit , missing

/*Difficulty getting up from a chair after sitting?
1998 Core 	F2400
2000 Core 	G2698
2002 Core 	HG005
2004 Core 	JG005
2006 Core 	KG005
2008 Core 	LG005
2010 Core 	MG005
2012 Core 	NG005
2014 Core 	OG005
*/
gen byte fl_diff_gu = .
replace fl_diff_gu = 1 if RG005==1 | RG005==6 | RG005==7 
replace fl_diff_gu = 0 if RG005==5 
la var fl_diff_gu "Difficulty standing up after sitting? 1=yes"
tab fl_diff_gu , missing

/*Difficutly climbing up many flights of stairs?
1998 Core 	F2403
2000 Core 	G2701
2002 Core 	HG006
2004 Core 	JG006
2006 Core 	KG006
2008 Core 	LG006
2010 Core 	MG006
2012 Core 	NG006
2014 Core 	OG006
*/
gen byte fl_diff_sta_many = .
replace fl_diff_sta_many = 1 if RG006==1 | RG006==6 | RG006==7 
replace fl_diff_sta_many = 0 if RG006==5 
la var fl_diff_sta_many "Difficulty climbing stairs - many flights? 1=yes"
tab fl_diff_sta_many , missing

/*Difficulty climbing one flight of stairs?
Only asked if response to many stairs is not no
1998 Core 	F2406
2000 Core 	G2704
2002 Core 	HG007
2004 Core 	JG007
2006 Core 	KG007
2008 Core 	LG007
2010 Core 	MG007
2012 Core 	NG007
2014 Core 	OG007
*/
gen byte fl_diff_sta_one = .
replace fl_diff_sta_one = 1 if RG007==1 | RG007==6 | RG007==7 
replace fl_diff_sta_one = 0 if RG007==5
replace fl_diff_sta_one = 0 if fl_diff_sta_many==0
la var fl_diff_sta_one "Difficulty climbing stairs - one flight? 1=yes"
tab fl_diff_sta_one , missing

/*Difficulty stooping, kneeling or crouching?
1998 Core 	F2409
2000 Core 	G2707
2002 Core 	HG008
2004 Core 	JG008
2006 Core 	KG008
2008 Core 	LG008
2010 Core 	MG008
2012 Core 	NG008
20142 Core 	OG008
*/
gen byte fl_diff_stp = .
replace fl_diff_stp = 1 if RG008==1 | RG008==6 | RG008==7 
replace fl_diff_stp = 0 if RG008==5 
la var fl_diff_stp "Difficulty stooping? 1=yes"
tab fl_diff_stp , missing

/*Difficulty reaching or extending arms above shoulder level?
1998 Core 	F2412
2000 Core 	G2710
2002 Core 	HG009
2004 Core 	JG009
2006 Core 	KG009
2008 Core 	LG009
2010 Core 	MG009
2012 Core 	NG009
2014 Core 	OG009
*/
gen byte fl_diff_reach = .
replace fl_diff_reach = 1 if RG009==1 | RG009==6 | RG009==7
replace fl_diff_reach = 0 if RG009==5 
la var fl_diff_reach "Difficulty reaching with arms? 1=yes"
tab fl_diff_reach , missing

/*Difficulty pulling or pushing large objects?
1998 Core 	F2415
2000 Core 	G2713
2002 Core 	HG010
2004 Core 	JG010
2006 Core 	KG010
2008 Core 	LG010
2010 Core 	MG010
2012 Core 	NG010
2014 Core 	OG010
*/
gen byte fl_diff_push = .
replace fl_diff_push = 1 if RG010==1 | RG010==6 | RG010==7
replace fl_diff_push = 0 if RG010==5 
la var fl_diff_push "Difficulty pushing/pulling large objects? 1=yes"
tab fl_diff_push , missing

/*Difficulty lifting weights over 10lbs?
1998 Core 	F2418
2000 Core 	G2716
2002 Core 	HG011
2004 Core 	JG011
2006 Core 	KG011
2008 Core 	LG011
2010 Core 	MG011
2012 Core 	NG011
2014 Core 	OG011
*/
gen byte fl_diff_lift = .
replace fl_diff_lift = 1 if RG011==1 | RG011==6 | RG011==7 
replace fl_diff_lift = 0 if RG011==5
la var fl_diff_lift "Difficulty lifting weights over 10lb? 1=yes"
tab fl_diff_lift , missing

/*Difficulty picking up a dime?
1998 Core 	F2421
2000 Core 	G2719
2002 Core 	HG012
2004 Core 	JG012
2006 Core 	KG012
2008 Core 	LG012
2010 Core 	MG012
2012 Core 	NG012
2014 Core 	OG012
assign can't do = yes, don't do = .*/
gen fl_diff_dime = .
replace fl_diff_dime = 1 if inlist(RG012,1,6,7) 
replace fl_diff_dime = 0 if RG012==5 
la var fl_diff_dime "Any difficulty picking up a dime? 1=yes"
tab fl_diff_dime , missing

*************************************************************
//Helper information for ADLs and IADLs
*************************************************************

/*ADL Helper relationship to R
1998 Core 	F2508
2000 Core 	G2806
2002 Core 	HG033_1
2004 Core 	JG033_1
2006 Core 	KG033_1
2008 Core 	LG033_1
2010 Core 	MG033_1
2012 Core 	NG033_1
2014 Core 	OG033_1
*/
gen byte adl_sp_helper = 0
replace adl_sp_helper = 1 if RG033_1==2
la var adl_sp_helper "ADL Spouse Main Helper, 1=yes"
tab adl_sp_helper , missing

gen byte adl_oth_helper = 0
replace adl_oth_helper = 1 if (2< RG033_1 & RG033_1<21)
la var adl_oth_helper "ADL Other Main Helper, 1=yes"
tab adl_oth_helper , missing

//max number of helpers = 7
//create common helper variables across all years
/*LEFT OUT BECAUSE DON'T HAVE RG032 to ID PN of helper*
forvalues i = 1/7{
gen adl_helper_`i' = kg032_`i' if (core_year==2006)
replace adl_helper_`i' = lg032_`i' if (core_year==2008)
replace adl_helper_`i' = mg032_`i' if (core_year==2010)
replace adl_helper_`i' = ng032_`i' if (core_year==2012)
replace adl_helper_`i' = og032_`i' if (core_year==2014)
replace adl_helper_`i' = pg032_`i' if (core_year==2016)
la var adl_helper_`i' "ADL Helper `i' PN"
}
*/

/*IADL Helpers*/
gen byte iadl_sp_helper = 0
replace iadl_sp_helper = 1 if (RG055_1==2)
la var iadl_sp_helper "IADL Spouse Main Helper, 1=yes"
tab iadl_sp_helper , missing

gen byte iadl_oth_helper = 0
replace iadl_oth_helper = 1 if (2< RG055_1 & RG055_1<21)
la var iadl_oth_helper "IADL Other Main Helper, 1=yes"
tab iadl_oth_helper , missing

//max number of helpers = 6
//create common helper variables across all years
/*

NOT AVAIL IN COVID 
forvalues i = 1/6{
gen iadl_helper_`i' = kg054_`i' if (core_year==2006)
replace iadl_helper_`i' = lg054_`i' if (core_year==2008)
replace iadl_helper_`i' = mg054_`i' if (core_year==2010)
replace iadl_helper_`i' = ng054_`i' if (core_year==2012)
replace iadl_helper_`i' = og054_`i' if (core_year==2014)
replace iadl_helper_`i' = pg054_`i' if (core_year==2016)
la var iadl_helper_`i' "IADL Helper `i' PN"
}

*/
// Home health worker
/*
(Since [PREV WAVE IW MONTH], [PREV WAVE IW YEAR]/Since [PREV WAVE IW YEAR]/In
        the last two years), has any medically-trained person come to your home to
        help you, yourself?
1998 Core 	F2357
2000 Core 	G2634
2002 Core 	HN189
2002 Exit 	SN189
2004 Core 	JN189
2004 Exit 	TN189
2006 Core 	KN189
2006 Exit 	UN189
2008 Core 	LN189
2008 Exit 	VN189
2010 Core 	MN189
2010 Exit 	WN189
2012 Core 	NN189
2012 Exit 	XN189
2014 Core 	ON189
2014 Exit 	YN189
*/
gen hh_worker = .
replace hh_worker=1 if RN189==1 
replace hh_worker=0 if RN189==5 
la var hh_worker "Home health worker help? 1=yes"
tab hh_worker , missing

save "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 2.dta", replace

H="Step 3: cleaning comorbidities"
*COVID DATASET CLEAN: COMORBIDITIES
*ADAPTED FROM HRS DATA CLEANING FILE*
*STEP 3: COMORBIDITIES

/*variable cleaning for HRS core 2006-2014
Most code is taken from the HRS Outline_11_22_11.txt file
and modified to clean 2006-2014 core dataset

3rd part of core variable cleaning - comorbidities from core interviews

See notes re. variable chf_hrs - criteria for asking this quesiton
changed in 2010/12 and this results in a lot more missing-ness for 2010/12 
core year, need to address if need to use this variable for final analysis
*/
*capture log close

*clear all
*set more off

//Amy's PC
*local logpath D:\HRS\Shared\base_data\hrs_cleaned\logs
*local datapath D:\HRS\Shared\base_data\hrs_cleaned\working

//RG PC
//local logpath C:\HRS\hrs_cleaned\logs
//local datapath C:\HRS\hrs_cleaned\working

*log using "`logpath'\2_HRS_Core_06_16_clean3-LOG.txt", text replace

*cd `datapath'
use "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 2.dta"
*use core_06_16_clean2.dta

/************************************************************/
/* Comorbidities from core interviews  */
/************************************************************/

/*Cancer
2000 Core 	G1262
2002 Core 	HC018
2002 Exit 	SC018
2004 Core 	JC018
2004 Exit 	TC018
2006 Core 	KC018
2006 Exit 	UC018
2008 Core 	LC018
2008 Exit 	VC018
2010 Core 	MC018
2010 Exit 	WC018 
2012 Core 	NC018
2012 Exit 	XC018 
2014 Core 	OC018
2014 Exit 	YC018 
*/
generate byte cancer_hrs = .
replace cancer_hrs = 1 if inlist(RC018,1,3)
replace cancer_hrs = 0 if inlist(RC018,4,5)
label variable cancer_hrs "Cancer - core"
//label define cancer_hrs 0 "No" 1 "Yes", modify
//label values cancer_hrs cancer_hrs
tab cancer_hrs , missing 

/*Cancer treatment - HRS core
These questions are only asked for new r's and alternate waves (2002,2006,2010, 2012)
2 levels of questions, only asked if cancer_hrs=yes:
1. Since last interview, received any treatment for cancer?
2000 Core 	G1264
2002 Core 	HC020
2002 Exit 	SC020
2004 Core 	JC020
2004 Exit 	TC020
2006 Core 	KC020
2006 Exit 	UC020
2008 Core 	LC020
2008 Exit 	VC020
2010 Core 	MC020
2010 Exit 	WC020
2012 Core 	NC020
2012 Exit 	XC020
2014 Core 	OC020
2014 Exit 	YC020
2. Type of treatment,
2000 Core	G1265M1-M4 (note only 4 for 2000)
2002 Core 	HC021M1-M5 (5 in 2002) 
2002 Exit 	SC021M1-M6
2004 Core 	JC021M1-M4 (4 in 2004)
2004 Exit 	TC021M1-M6
2006 Core 	KC021M1-M6 (6 in 2006)
2006 Exit 	UC021M1-M6
2008 Core 	LC021M1-M4 (4 in 2008)
2008 Exit 	VC021M1-M6
2010 Core 	MC021M1-M6 (6 in 2010)
2010 Exit 	WC021M1-M6
 			 1.  CHEMOTHERAPY OR MEDICATION
                         2.  SURGERY OR BIOPSY
                         3.  RADIATION/ X-RAY
                         4.  MEDICATIONS/TREATMENT FOR SYMPTOMS (PAIN, NAUSEA, RASHES)
                         5.  NONE
                         7.  OTHER (SPECIFY)
                         8.  DK (Don't Know); NA (Not Ascertained)
                         9.  RF (Refused)
                     Blank.  INAP (Inapplicable); Partial Interview
NOTE: Greater number of values at 2012
2012 Core 	NC021M1-M6 (6 in 2012)
2012 Exit 	XC021M1-M6
2014 Core 	OC021M1-M6 (6 in 2012)
2014 Exit 	YC021M1-M6
              1.  CHEMOTHERAPY or other therapies (e.g., adjuvant therapies)
                             that are either intended to treat a tumor or prevent its
                             recurrence.
              2.  SURGERY
              3.  RADIATION
              4.  MEDICATIONS/TREATMENT FOR SYMPTOMS (PAIN, NAUSEA, RASHES)
              5.  BIOPSY
              6.  X-RAY
              7.  OTHER (SPECIFY)
              8.  NONE
             98.  DK (Don't Know); NA (Not Ascertained)
             9.  RF (Refused)
         Blank.  INAP (Inapplicable); Partial Interview

*/
//cancer treatment in last 2 years indicator variable
****THIS IS ALL MISSING
/*
gen byte cancer_treat_hrs=.
replace cancer_treat_hrs=1 if ( RC020==1 )
replace cancer_treat_hrs=0 if ( RC020==5)
replace cancer_treat_hrs=0 if (cancer_hrs==0) //if no cancer, show no cancer treatment
tab cancer_treat_hrs , missing
*/
//create empty variables for 2008 so can run through for loop
*gen lc021m5=.
*gen lc021m6=.

/* condense 2012 values to be consistent with other years
          2 Surgery AND 5 Biopsy = 2 Surgery/Biopsy 
          3 Radiation AND 6 Xray = 3 Radiation/Xray
*/
*recode nc021m1-nc021m6 (5=2) (6=3) 
//cancer treatment type variables, not not mutually exclusive
gen byte cancer_chemo_med=.
gen byte cancer_surg=.
gen byte cancer_xray=.
gen byte cancer_symp=.
gen byte cancer_other_treat=.
/*local waves k l m n o p
foreach i of numlist 1/6 {
foreach w of local waves{
	replace cancer_chemo_med=1 if `w'c021m`i'==1
	replace cancer_surg=1 if `w'c021m`i'==2
	replace cancer_xray=1 if `w'c021m`i'==3
	replace cancer_symp=1 if `w'c021m`i'==4
	replace cancer_other_treat=1 if `w'c021m`i'==7
	}
}

*/
foreach i of numlist 1/6 {
replace cancer_chemo_med=1 if RC021M`i'==1
	replace cancer_surg=1 if RC021M`i'==2
	replace cancer_xray=1 if RC021M`i'==3
	replace cancer_symp=1 if RC021M`i'==4
	replace cancer_other_treat=1 if RC021M`i'==7
}

local cancertreat cancer_chemo_med cancer_surg cancer_xray cancer_symp cancer_other_treat
foreach var of local cancertreat{
replace `var'=0 if `var'==. 
tab `var' ,missing
}

/*Lung Disease, r1191
Cross-Wave Equivalents for:
C030 LUNG DISEASE 
1995 Core D818 
1996 Core E818 
1998 Core F1146 
2000 Core G1279 
2002 Core HC030 
2002 Exit SC030 
2004 Core JC030 
2004 Exit TC030 
2006 Core KC030 
2006 Exit UC030 
2008 Core LC030 
2008 Exit VC030 
2010 Core MC030 
2010 Exit WC030
2012 Core NC030 
2012 Exit XC030
2014 Core OC030 
2014 Exit YC030
*/
generate lung_hrs = .
replace lung_hrs = 1 if (inlist(RC030,1,3))
replace lung_hrs = 0 if (inlist(RC030,4,5))
label variable lung_hrs "Lung Disease - core"
//label define lung_hrs 0 "No" 1 "Yes" , modify
//label values lung_hrs lung_hrs
tab lung_hrs , missing 

/*Oxygen for lung condition - c033
2000 Core 	G1285
2002 Core 	HC033
2002 Exit 	SC033
2004 Core 	JC033
2004 Exit 	TC033
2006 Core 	KC033
2006 Exit 	UC033
2008 Core 	LC033
2008 Exit 	VC033
2010 Core 	MC033
2010 Exit 	WC033
2012 Core 	NC033
2012 Exit 	XC033
2014 Core 	OC033
2014 Exit 	YC033
*/
gen byte lung_o2_hrs = .
replace lung_o2_hrs = 0 if lung_hrs==0
replace lung_o2_hrs = 0 if RC033==5
replace lung_o2_hrs = 1 if RC033==1
la var lung_o2_hrs "Oxygen for lung condition"
tab lung_o2_hrs ,missing

/*Lung condition limit activities?
2000 Core 	G1287
2002 Core 	HC035
2004 Core 	JC035
2006 Core 	KC035
2008 Core 	LC035
2010 Core 	MC035
2012 Core 	NC035
2014 discontiued
*/
/*NOT IN COVID QUESTIONS
gen byte lung_lim_hrs = .
replace lung_lim_hrs = 0 if lung_hrs==0 & core_year!=2014
replace lung_lim_hrs = 0 if (core_year==2006 & kc035==5)
replace lung_lim_hrs = 0 if (core_year==2008 & lc035==5)
replace lung_lim_hrs = 0 if (core_year==2010 & mc035==5)
replace lung_lim_hrs = 0 if (core_year==2012 & nc035==5)
replace lung_lim_hrs = 1 if (core_year==2006 & kc035==1)
replace lung_lim_hrs = 1 if (core_year==2008 & lc035==1)
replace lung_lim_hrs = 1 if (core_year==2010 & mc035==1)
replace lung_lim_hrs = 1 if (core_year==2012 & nc035==1)
la var lung_lim_hrs "Activity limited due to lung condition (no 2014)"
tab lung_lim_hrs core_year,missing

*/
/*Heart Condition: "heart attack, coronary heart disease, angina, congestive heart failure, or other heart problems?", r1201
Cross-Wave Equivalents for:
C036 HEART CONDITION 
1995 Core D828 
1996 Core E828 
1998 Core F1156 
2000 Core G1289 
2002 Core HC036 
2002 Exit SC036 
2004 Core JC036 
2004 Exit TC036 
2006 Core KC036 
2006 Exit UC036 
2008 Core LC036 
2008 Exit VC036 
2010 Core MC036 
2010 Exit WC036 
2012 Core NC036 
2012 Exit XC036 
2014 Core OC036 
2014 Exit YC036 
*/
generate heart_hrs = .
replace heart_hrs = 1 if inlist(RC036,1,3)
replace heart_hrs = 0 if inlist(RC036,4,5)

label variable heart_hrs "Heart Condition - core"
//label define heart_hrs 0 "No" 1 "Yes" 9 "Don't Know/Refused", modify
//label values heart_hrs heart_hrs
tab heart_hrs , missing 

/**CHF: Criteria for asking this question:
1. heart_hrs = yes (1)
2. c037 <> no OR c038 <> no
r1216
Ask if criteria change in 2010 so coded differently here to match, otherwise, if just match
on heart_hrs, get many more missing responses in 2010
If this variable is used in the analysis, may want to review this code with Amy since
2010 results in much lower rates of chf being reported than other years.

Cross-Wave Equivalents for:
C048 CONGESTIVE HEART FAILURE 
1995 Core D843 
1996 Core E843 
1998 Core F1171 
2000 Core G1304 
2002 Core HC048 
2002 Exit SC048 
2004 Core JC048 
2004 Exit TC048 
2006 Core KC048 
2006 Exit UC048 
2008 Core LC048 
2008 Exit VC048
2010 Core MC048
2010 Exit WC048
2012 Core NC048
2012 Exit XC048
2014 Core OC048
2014 Exit YC048

addl 2010 variables (2012 follows similar pattern)
mc263 - has a doctor ever told you you've had chf? if reply no = don't ask mc048 
mc264 - year chf first diagnosed 9998, 9999 are non responses
mz093 - previous wave interview year
mz255 - baseline heart disease (1=yes, 5=no)
ma501 - current interview year (to get 2 years ago year)
{PREVIOUS ASK} SecC.Heartattack.C036_ 

         IF SecC.Heartattack.C036_ IN [YES, DISPUTPWRECORDHASCOND] THEN 

         IF (SecC.Heartattack.C036_ IN [YES, DISPUTPWRECORDHASCOND]) AND 
         ((SecC.Heartattack.C037_HeartMeds <> NO) OR (SecC.Heartattack.C038_ <> NO)) 
         THEN 

         IF (SecC.Heartattack.C263_EverHadHeartFailure <> NO) AND 
         SecC.Heartattack.C263_EverHadHeartFailure <> NONRESPONSE THEN 

         IF ((SecC.Heartattack.C264_YrFirstHeartFailure = NONRESPONSE OR 
         (((piRVarsZ076_ReIwR_V = REIWR) AND (SecC.Heartattack.C264_YrFirstHeartFailure 
         < piRvarsZ093_IwYr_V)) OR ((piRVarsZ076_ReIwR_V <> REIWR) AND 
         (SecC.Heartattack.C264_YrFirstHeartFailure < piINITA062T2YrsAgo_A)))) OR 
         ((piRVarsZ076_ReIwR_V = REIWR) AND (piRVarsZ255_HrtDiseaseBsline <> 
         Blinewaveprior))) OR ((ACTIVELANGUAGE = EXTENG) AND (ACTIVELANGUAGE = EXTSPN)) 
         THEN 
Note: Not sure how to get the Blinewaveprior variable since there is no
lz255 in 2008, so that or statement is missing from the code below
Something to investigate further if this missingness becomes a problem
in future analysis

generate chf_hrs = .
//code for c036 response, no heart problems
replace chf_hrs =0 if (heart_hrs==0)
//code for heart_hrs==1 but c037 and c038 == no
replace chf_hrs = 0 if core_year==2006 & heart_hrs==1 & ///
	(kc037==5 & kc038==5) | (kz105!=1 & kz076==1)
replace chf_hrs = 0 if core_year==2008 & heart_hrs==1 & ///
	(lc037==5 & lc038==5) | (lz105!=1 & lz076==1)
replace chf_hrs = 0 if core_year==2010 & heart_hrs==1 & ///
	(mc037==5 & mc038==5) & (mc263==5) 
replace chf_hrs = 0 if core_year==2012 & heart_hrs==1 & ///
	(nc037==5 & nc038==5) & (nc263==5) 
replace chf_hrs = 0 if core_year==2014 & heart_hrs==1 & ///
	(oc037==5 & oc038==5) & (oc263==5) 

//2010 ask...
gen chf_ask_10 = 0
replace chf_ask_10 = 1 if (inlist(mc264,9998,9999,.) | (mz076 == 1 & ///
	(mc264 < mz093) | (mz076!=1 & mc264 < (ma501-2))))
tab chf_ask_10
replace chf_hrs = 0 if chf_ask_10 ==0

//code for c048 responses
replace chf_hrs = 0 if (core_year==2006 & kc048==5)
replace chf_hrs = 0 if (core_year==2008 & lc048==5)
replace chf_hrs = 0 if (core_year==2010 & mc048==5)
replace chf_hrs = 0 if (core_year==2012 & nc048==5)
replace chf_hrs = 0 if (core_year==2014 & oc048==5)

replace chf_hrs = 1 if (core_year==2006 & kc048==1)
replace chf_hrs = 1 if (core_year==2008 & lc048==1)
replace chf_hrs = 1 if (core_year==2010 & mc048==1)
replace chf_hrs = 1 if (core_year==2012 & nc048==1)
replace chf_hrs = 1 if (core_year==2014 & oc048==1)
label variable chf_hrs "CHF"
//label define chf_hrs 0 "No" 1 "Yes" , modify
//label values chf_hrs chf_hrs
tab chf_hrs core_year, missing
*/
//code for c036 response, no heart problems
gen chf_hrs=.
replace chf_hrs =0 if (heart_hrs==0)
//code for heart_hrs==1 but c037 and c038 == no
replace chf_hrs = 0 if heart_hrs==1 & (RC037==5 & RC038==5) | (RZ105!=1 & RZ076==1)

//code for c048 responses
replace chf_hrs = 0 if (RC048==5)
replace chf_hrs = 1 if (RC048==1)

tab chf_hrs , missing

/*Hospitalized for CHF?
2000 Core 	G1305
2002 Core 	HC049
2002 Exit 	N/A
2004 Core 	JC049
2004 Exit 	N/A
2006 Core 	KC049
2006 Exit 	N/A
2008 Core 	LC049
2008 Exit 	N/A
2010 Core 	MC049
2012 Core 	NC049
2014 Core 	OC049
Ask if chf reported, ie if chf_hrs ==1
*/
gen byte chfadmit_ask = 0

gen byte chfadmit_hrs = .
replace chfadmit_hrs = 0 if chfadmit_ask == 0
replace chfadmit_hrs = 0 if RC049 ==5
replace chfadmit_hrs = 1 if RC049 ==1

la var chfadmit_hrs "Hospital admission due to CHF"
tab chfadmit_hrs ,missing

/*CHF Ever? c263
Only asked in 2010,12, 14
Ask criteria:
         IF SecC.Heartattack.C036_ IN [YES, DISPUTPWRECORDHASCOND] THEN 
         IF (piRVarsZ076_ReIwR_V <> REIWR) OR (piRVarsZ255_HrtDiseaseBsline = 
         Blinewaveprior) THEN
Has a doctor ever told you that you have congestive heart failure?
Again, can't get Blinewaveprior so don't include that in coding variable = 0*/

*****weirdly, RC263 is all missing in COVID dataset...
gen byte chfdrever_hrs = .
replace chfdrever_hrs = 0 if heart_hrs == 0
replace chfdrever_hrs = 0 if (RC263==5)
replace chfdrever_hrs = 1 if (RC263==1)
la var chfdrever_hrs "Ever diagnosed with chf?"
tab chfdrever_hrs , missing

/**Stroke, missing r1221
generate stroke_hrs = .
 then stroke_hrs = 1; 
if ((sc053=1)|(tc053=1)|(uc053=1)| (vc053=1)|(wc053=1)|(xc053=1)|(yc053=1)| ///
    (sc053=3)|(tc053=3)|(uc053=3)| (vc053=3)|(wc053=3)|(xc053=3)|(yc053=3))
    then stroke_hrs = 0; 
if ((sc053=5)|(tc053=5)|(uc053=5)| (vc053=5)|(wc053=5)|(xc053=5)|(yc053=5)| ///
    (sc053=4)|(tc053=4)|(uc053=4)| (vc053=4)|(wc053=4)|(xc053=4)|(yc053=4))
label stroke_hrs "Stroke"
Cross-Wave Equivalents for:
C053 STROKE 
1995 Core D848 
1996 Core E848 
1998 Core F1176 
2000 Core G1309 
2002 Core HC053 
2002 Exit SC053 
2004 Core JC053 
2004 Exit TC053 
2006 Core KC053 
2006 Exit UC053 
2008 Core LC053 
2008 Exit VC053 
2010 Core MC053 
2010 Exit WC053 
2012 Core NC053 
2012 Exit XC053 
2014 Core OC053 
2014 Exit YC053 
*/
generate stroke_hrs = .
replace stroke_hrs = 1 if (inlist(RC053,1,2,3))
replace stroke_hrs = 0 if (inlist(RC053,4,5))

label variable stroke_hrs "Stroke / TIA - core"
//label define stroke_hrs 0 "No" 1 "Yes", modify
//label values stroke_hrs stroke_hrs
tab stroke_hrs , missing

/*Memory Disease (diagnosed by a doctor, per the proxy report) r1240
Question not asked in 2010-2014 core interviews, so just use previous wave
memory disease for 2010-2014 core, may want to check this against
other variables if it is a problem.
2010-2014 ask specifically Alzheimers (MC272-OC272) or Dementia (MC273-OC273)

Cross-Wave Equivalents for:
C069 MEMORY RELATED DISEASE 
1995 Core N/A 
1996 Core N/A 
1998 Core F1193 
2000 Core G1326 
2002 Core HC069 
2002 Exit SC069 
2004 Core JC069 
2004 Exit TC069 
2006 Core KC069 
2006 Exit UC069 
2008 Core LC069 
2008 Exit VC069 
2010 Core N/A
2012 Exit WC069 
2012 Core N/A 
2012 Exit XC069 
2014 Core N/A 
2014 Exit YC069 

Cross-Wave Equivalents for:
Z117 PREV WAVE R HAS MEMORY DISEASE 
1995 Core N/A 
1996 Core N/A 
1998 Core N/A 
2000 Core g262 
2002 Core HZ117 
2002 Exit SZ117 
2004 Core JZ117 
2004 Exit TZ117 
2006 Core KZ117 
2006 Exit UZ117 
2008 Core LZ117 
2008 Exit VZ117 
2010 Core MZ117 
2010 Exit WZ117 
2012 Core NZ117 
2012 Exit XZ117 
2014 Core OZ117 
2014 Exit YZ117 
Set memory_hrs = yes if current survey or previous survey (via z117 var) indicates
memory disease
*/
generate memory_hrs = .
*replace memory_hrs = 0 if (core_year==2006 & kc069==5)
*replace memory_hrs = 0 if (core_year==2008 & inlist(lc069,4,5))
*replace memory_hrs = 0 if (core_year==2010 & mz117==5)
*replace memory_hrs = 0 if (core_year==2012 & (nc272==5 & nc273==5) & (nz117==5 | nz117==.))
replace memory_hrs = 0 if ((RC272==5 & RC273==5) & (RZ117==5 | RZ117==.))
*replace memory_hrs = 1 if (core_year==2006 & (kc069==1 | kz117==1 ))
*replace memory_hrs = 1 if (core_year==2008 & (inlist(lc069,1,3) | lz117==1 ))
*replace memory_hrs = 1 if (core_year==2010 & (mc272==1 | mc273==1 | mz117==1 ))
*replace memory_hrs = 1 if (core_year==2012 & (inlist(nc272,1,3) | inlist(nc273,1,3) | nz117==1 ))
*replace memory_hrs = 1 if (core_year==2014 & (inlist(oc272,1,3) | inlist(oc273,1,3) | oz117==1 ))
replace memory_hrs = 1 if ((inlist(RC272,1,3) | inlist(RC273,1,3) | RZ117==1 ))
label variable memory_hrs "Memory Disease - core"
//label define memory_hrs 0 "No" 1 "Yes", modify
//label values memory_hrs memory_hrs
tab memory_hrs , missing

/*Alzheimer's disease
2010-2014 HRS survey only
MC272
Not included in overall comorbidity index
           343           1.  YES
         21648           5.  NO
            20           7.  [VOL] NOT ALZHEIMER'S DISEASE
            24           8.  DK (Don't Know); NA (Not Ascertained)
             2           9.  RF (Refused)
                     Blank.  INAP (Inapplicable); Partial Interview

gen alz_hrs = .
replace alz_hrs = 1 if (core_year==2016 & RC272==1)
replace alz_hrs = 0 if (core_year==2016 & inlist(RC272,5,7))
la var alz_hrs "Alzheimer's disease - core, 2010-2014 only"
tab alz_hrs , missing
*/
/*Dementia
2010-2014 HRS survey only
MC273, not asked if report having alzheimer's
Not included in overall comorbidity index
    436           1.  YES
         21206           5.  NO
            28           8.  DK (Don't Know); NA (Not Ascertained)
             4           9.  RF (Refused)
           363       Blank.  INAP (Inapplicable); Partial Interview
*/
gen dem_hrs = .
replace dem_hrs = 1 if (RC273==1)
replace dem_hrs = 1 if (RC272==1)
replace dem_hrs = 0 if (RC273==5 & RC272==5)

la var dem_hrs "Dementia - core, 2010+ only"
tab dem_hrs , missing

/* Falls r1230
generate falls_hrs = .
 then falls_hrs = 1 ; if ((sc079=1)|(tc079=1)|(uc079=1)| (vc079=1)|(wc079=1)|(xc079=1)|(yc079=1)|
                          (sc079=3)|(tc079=3)|(uc079=3)| (vc079=3)|(wc079=3)|(xc079=3)|(yc079=3))
 then falls_hrs = 0 ; if ((sc079=5)|(tc079=5)|(uc079=5)| (vc079=5)|(wc079=5)|(xc079=5)|(yc079=5)|
                          (sc079=4)|(tc079=4)|(uc079=4)| (vc079=4)|(wc079=4)|(xc079=4)|(yc079=4))
label falls_hrs "Falls"
Cross-Wave Equivalents for:
C079 FALLEN IN PAST TWO YEARS 
1995 Core D878 
1996 Core E878 
1998 Core F1206 
2000 Core G1339 
2002 Core HC079 
2002 Exit SC079 
2004 Core JC079 
2004 Exit TC079 
2006 Core KC079 
2006 Exit UC079 
2008 Core LC079 
2008 Exit VC079 
2010 Core MC079 
2010 Exit WC079 
2012 Core NC079 
2012 Exit XC079 
2014 Core OC079 
2014 Exit YC079 
 only asked for those who were greater than 65 when interviewed
 not compared to previous interview response
*/
generate falls_hrs = .
replace falls_hrs = 1 if (RC079==1)
replace falls_hrs = 0 if (RC079==5)

label variable falls_hrs "Falls - core"
//label define falls_hrs 0 "No" 1 "Yes", modify
//label values falls_hrs falls_hrs
tab falls_hrs , missing

/** Incontinence
C087 INCONTINENCE 
2000 Core 	G1353
2002 Core 	HC087
2002 Exit 	N/A
2004 Core 	JC087
2004 Exit 	N/A
2006 Core 	KC087
2006 Exit 	N/A
2008 Core 	LC087
2008 Exit 	N/A
2010 Core 	MC087
2010 Exit 	N/A
2012 Core 	NC087
2012 Exit 	N/A
2014 Core 	OC087
2014 Exit 	N/A
*/
generate incont_hrs = .
replace incont_hrs = 1 if (RC087==1)
replace incont_hrs = 0 if (RC087==5)
label var incont_hrs "Incontinence"
tab incont_hrs , missing

/* 
Pain r1246
Cross-Wave Equivalents for:
C104 TROUBLED WITH PAIN 
2000 Core 	G1372
2002 Core 	HC104
2002 Exit 	SC104
2004 Core 	JC104
2004 Exit 	TC104
2006 Core 	KC104
2006 Exit 	UC104
2008 Core 	LC104
2008 Exit 	VC104
2010 Core 	MC104
2010 Exit 	WC104
2012 Core 	NC104
2012 Exit 	XC104
2014 Core 	OC104
2014 Exit 	YC104
*/
gen byte pain_hrs = .
replace pain_hrs=1 if (RC104==1)
replace pain_hrs=0 if (RC104==5)
label var pain_hrs "Pain"
tab pain_hrs , missing

/*How bad is pain if yes above?
1 = mild, 2 = moderate, 3 = severe, 8,9 = don't know, refused
1998 Core 	F1241
2000 Core 	G1374
2002 Core 	HC105
2002 Exit 	SC105
2004 Core 	JC105
2004 Exit 	TC105
2006 Core 	KC105
2006 Exit 	UC105
2008 Core 	LC105
2008 Exit 	VC105
2010 Core 	MC105
2010 Exit 	WC105 
2012 Core 	NC105
2012 Exit 	XC105 
2014 Core 	OC105
2014 Exit 	YC105 
*/
gen pain_level_hrs = .
replace pain_level_hrs = RC105 
replace pain_level_hrs = . if inlist(pain_level_hrs,8,9)
la var pain_level_hrs "How bad was pain? 1=mild, 2=mod, 3=severe"
tab pain_level_hrs  , missing

/*Does pain limit activities?
1998 Core 	F1242
2000 Core 	G1375
2002 Core 	HC106
2004 Core 	JC106
2006 Core 	KC106
2008 Core 	LC106
2010 Core 	MC106
2012 Core 	NC106
2014 Core 	OC106
Coded as 0 if answer=no or if not applicable b/c no pain
*/
gen pain_limit_act_hrs = .
replace pain_limit_act_hrs =1 if RC106==1
replace pain_limit_act_hrs =0 if RC106==5
replace pain_limit_act_hrs =0 if pain_hrs==0
la var pain_limit_act_hrs "Does pain limit usual activities?"
tab pain_limit_act_hrs , missing

/** HTN
Ever had high blood pressure?
2000 Core 	G1238
2002 Core 	HC005
2002 Exit 	N/A
2004 Core 	JC005
2004 Exit 	N/A
2006 Core 	KC005
2006 Exit 	N/A
2008 Core 	LC005
2008 Exit 	N/A
2010 Core 	MC005
2010 Exit 	N/A
2012 Core 	NC005
2012 Exit 	N/A
2014 Core 	OC005
2014 Exit 	N/A
*/
generate byte htn_hrs = .
replace htn_hrs = 1 if (inlist(RC005,1,3))
replace htn_hrs = 0 if (inlist(RC005,4,5))
label var htn_hrs "Hypertension"
tab htn_hrs , missing

/** Diabetes
Cross-Wave Equivalents for:
C010 DIABETES 
2000 Core 	G1245
2002 Core 	HC010
2002 Exit 	N/A
2004 Core 	JC010
2004 Exit 	N/A
2006 Core 	KC010
2006 Exit 	N/A
2008 Core 	LC010
2008 Exit 	N/A
2010 Core 	MC010
2010 Exit 	N/A
2012 Core 	NC010
2012 Exit 	N/A
2014 Core 	NC010
2014 Exit 	N/A
*/
generate byte dm_hrs = .
replace dm_hrs = 1 if (inlist(RC010,1,3))
replace dm_hrs = 0 if (inlist(RC010,4,5))

label var dm_hrs "Diabetes"
tab dm_hrs , missing

/* Taking Insulin for Diabetes
Cross-Wave Equivalents for:
2000 Core 	G1249
2002 Core 	HC012
2002 Exit 	N/A
2004 Core 	JC012
2004 Exit 	N/A
2006 Core 	KC012
2006 Exit 	N/A
2008 Core 	LC012
2008 Exit 	N/A
2010 Core 	MC012
2010 Exit 	N/A
2012 Core 	NC012
2012 Exit 	N/A
2014 Core 	NC012
2014 Exit 	N/A
*/
generate byte dm_ins_hrs = .
replace dm_ins_hrs = 0 if dm_hrs ==0
replace dm_ins_hrs = 1 if (RC012==1)
replace dm_ins_hrs = 0 if (RC012==5)
label var dm_ins_hrs "Insulin for diabetes"
tab dm_ins_hrs , missing

/*Kidney trouble due to diabetes
2000 Core 	G1256
2002 Core 	HC017
2004 Core 	JC017
2006 Core 	KC017
2008 Core 	LC017
2010 Core 	MC017
2012 Core 	NC017
2014 discontinued
*/
/*NOT IN COVID
generate byte dm_kidn_hrs = .
replace dm_kidn_hrs = 0 if dm_hrs ==0 
replace dm_kidn_hrs = 1 if (RC017==1)
replace dm_kidn_hrs = 0 if (RC017==5)
label var dm_kidn_hrs "Kidney trouble due to diabetes (no 2014)"
tab dm_kidn_hrs , missing

*/

/** Psychiatric Condition ("doctor ever told... emotional, nervous or psychiatric problems?")
Cross-Wave Equivalents for:
C065 EMOTIONAL/PSYCHIATRIC PROBLEMS 
2000 Core 	G1322
2002 Core 	HC065
2002 Exit 	N/A
2004 Core 	JC065
2004 Exit 	N/A
2006 Core 	KC065
2006 Exit 	N/A
2008 Core 	LC065
2008 Exit 	N/A
2010 Core 	MC065
2010 Exit 	N/A
2012 Core 	NC065
2012 Exit 	N/A
2014 Core 	OC065
2014 Exit 	N/A
*/
generate psych_hrs = .
replace psych_hrs = 1 if (inlist(RC065,1,3))
replace psych_hrs = 0 if (inlist(RC065,4,5))
label var psych_hrs "Psychiatric Condition"
tab psych_hrs , missing

/*additional psych questions, not part of comorbidities but cleaned here anyway
psych treatment 1=yes 5=no, only asked if reported having psych problems (psych_hrs==1)
2000 Core 	G1324
2002 Core 	HC067
2004 Core 	JC067
2006 Core 	KC067
2008 Core 	LC067
2010 Core 	MC067
2012 Core 	NC067
2014 Core 	OC067
psych medications 1=yes 5 = no, only asked if reported having psych problems (psych_hrs==1)
2000 Core 	G1325
2002 Core 	HC068
2004 Core 	JC068
2006 Core 	KC068
2008 Core 	LC068
2010 Core 	MC068
2012 Core 	NC068
2014 discontinued
*/
/*NOT IN COVID DATA
gen byte PSYCH_treat = .
replace PSYCH_treat = 0 if psych_hrs==0 
replace PSYCH_treat = 0 if (RC067==5)
replace PSYCH_treat = 1 if (RC067==1)
la var PSYCH_treat "Receives Psychiatric treatment"
tab PSYCH_treat, missing

gen byte PSYCH_med = .
replace PSYCH_med = 0 if psych_hrs==0 & core_year!=2014
replace PSYCH_med = 0 if (kc068==5)|(lc068==5)|(mc068==5)|(nc068==5)
replace PSYCH_med = 1 if (kc068==1)|(lc068==1)|(mc068==1)|(nc068==1)
la var PSYCH_med "Psychiatric medication (no 2014)"
tab PSYCH_med core_year,missing
*/

/** Arthritis
C070 ARTHRITIS 
2000 Core 	G1327
2002 Core 	HC070
2004 Core 	JC070
2006 Core 	KC070
2008 Core 	LC070
2010 Core 	MC070
2012 Core 	NC070
2014 Core 	OC070
*/
generate arth_hrs = .
replace arth_hrs = 1 if (inlist(RC070,1,3))
replace arth_hrs = 0 if (inlist(RC070,4,5))

label var arth_hrs "Arthritis"
tab arth_hrs , missing

/*Hip fracture since last interview
Only asked for those 65 and older
1998 Core 	F1215
2000 Core 	G1348
2002 Core 	HC082
2002 Exit 	SC082
2004 Core 	JC082
2004 Exit 	TC082
2006 Core 	KC082
2006 Exit 	UC082
2008 Core 	LC082
2008 Exit 	VC082
2010 Core 	MC082
2010 Exit 	WC082 
2012 Core 	NC082
2012 Exit 	XC082 
2014 Core 	OC082
2014 Exit 	YC082 
*/
gen byte hip_frac_hrs = .
replace hip_frac_hrs=1 if RC082==1 
replace hip_frac_hrs=0 if RC082==5 
la var hip_frac_hrs "Hip fracture"
tab hip_frac_hrs  , missing

*********************************************************************
//Questions re other symptoms since last intervew
*********************************************************************

/*Shortness of breath since last interview?
1998 Core 	F1305
2000 Core 	G1438
2002 Core 	HC144
2004 Core 	JC144
2006 Core 	KC144
2008 Core 	LC144
2010 Core 	MC144
2012 Core 	NC144
2014 Core 	OC144
*/
gen byte dyspnea_hrs = .
replace dyspnea_hrs = 1 if RC144==1 
replace dyspnea_hrs = 0 if RC144==5 
la var dyspnea_hrs "Dyspnea since last interview? 1=yes"
tab dyspnea_hrs , missing

/* Persistant swelling in feet or ankles?
1998 Core 	F1304
2000 Core 	G1437
2002 Core 	HC143
2004 Core 	JC143
2006 Core 	KC143
2008 Core 	LC143
2010 Core 	MC143
2012 Core 	NC143
2014 Core 	OC143
*/
gen byte swelling_feet_hrs = .
replace swelling_feet_hrs = 1 if RC143==1 
replace swelling_feet_hrs = 0 if RC143==5 
la var swelling_feet_hrs "Swelling feet or ankles since last interview? 1=yes"
tab swelling_feet_hrs , missing

/* Persistant dizziness or lightheadedness
1998 Core 	F1306
2000 Core 	G1439
2002 Core 	HC145
2004 Core 	JC145
2006 Core 	KC145
2008 Core 	LC145
2010 Core 	MC145
2012 Core 	NC145
2014 Core 	OC145
*/
gen byte dizzy_hrs = .
replace dizzy_hrs = 1 if RC145==1 
replace dizzy_hrs = 0 if RC145==5 
la var dizzy_hrs "Dizziness or lightheadedness since last interview? 1=yes"
tab dizzy_hrs , missing

/* Back pain or problems
1998 Core 	F1307
2000 Core 	G1440
2002 Core 	HC146
2004 Core 	JC146
2006 Core 	KC146
2008 Core 	LC146
2010 Core 	MC146
2012 Core 	NC146
2014 Core 	OC146
*/
gen byte back_pain_hrs = .
replace back_pain_hrs = 1 if RC146==1 
replace back_pain_hrs = 0 if RC146==5 
la var back_pain_hrs "Back pain or problems since last interview? 1=yes"
tab back_pain_hrs , missing

/* Persisent headaches
1998 Core 	F1308
2000 Core 	G1441
2002 Core 	HC147
2004 Core 	JC147
2006 Core 	KC147
2008 Core 	LC147
2010 Core 	MC147
2012 Core 	NC147
2014 Core 	OC147
*/
gen byte headache_hrs = .
replace headache_hrs = 1 if RC147==1 
replace headache_hrs = 0 if RC147==5
la var headache_hrs "Persistent headaches since last interview? 1=yes"
tab headache_hrs , missing

/* Severe fatigue or exhaustion
1998 Core 	F1309
2000 Core 	G1442
2002 Core 	HC148
2004 Core 	JC148
2006 Core 	KC148
2008 Core 	LC148
2010 Core 	MC148
2012 Core 	NC148
2014 Core 	OC148
*/
gen byte fatigue_hrs = .
replace fatigue_hrs = 1 if RC148==1
replace fatigue_hrs = 0 if RC148==5
la var fatigue_hrs "Severe fatigue or exhaustion since last interview? 1=yes"
tab fatigue_hrs , missing

/* Persistent wheezing, cough or phlegm
1998 Core 	F1310
2000 Core 	G1443
2002 Core 	HC149
2004 Core 	JC149
2006 Core 	KC149
2008 Core 	LC149
2010 Core 	MC149
2012 Core 	NC149
2014 Core 	OC149
*/
gen byte cough_hrs = .
replace cough_hrs = 1 if RC149==1 
replace cough_hrs = 0 if RC149==5 
la var cough_hrs "Persistent wheezing, coughing since last interview? 1=yes"
tab cough_hrs , missing

********************************************************************************
//Insomnia symptoms
********************************************************************************
/*How often trouble falling asleep?  xC083
1=most of the time, 2=sometimes, 3=rarely or never
Not asked before 2002
*/
gen insom_falling_asleep = .
replace insom_falling_asleep = 1 if RC083==1 
replace insom_falling_asleep = 2 if RC083==2
replace insom_falling_asleep = 3 if RC083==3 
la var insom_falling_asleep "Trouble falling asleep? 1=Most of the time, 2=Sometimes, 3=Rarely,Never"
tab insom_falling_asleep , missing

/*How often trouble waking up during the night?  xC084
1=most of the time, 2=sometimes, 3=rarely or never
Not asked before 2002
*/
gen insom_waking_up = .
replace insom_waking_up = 1 if RC084==1 
replace insom_waking_up = 2 if RC084==2 
replace insom_waking_up = 3 if RC084==3 
la var insom_waking_up "Trouble waking up during night? 1=Most of the time, 2=Sometimes, 3=Rarely,Never"
tab insom_waking_up , missing

/*How often trouble waking up too early and not being able to fall asleep again?  xC085
1=most of the time, 2=sometimes, 3=rarely or never
Not asked before 2002
*/
gen insom_too_early = .
replace insom_too_early = 1 if RC085==1
replace insom_too_early = 2 if RC085==2 
replace insom_too_early = 3 if RC085==3
la var insom_too_early "Trouble waking up too early? 1=Most of the time, 2=Sometimes, 3=Rarely,Never"
tab insom_too_early , missing

/*How often feel really rested when you wake up in the morning?  xC086
1=most of the time, 2=sometimes, 3=rarely or never
Not asked before 2002
Note when create overall insomnia variable, this one is opposite, 1,most of the time==good
*/
gen insom_rested = .
replace insom_rested = 1 if RC086==1 
replace insom_rested = 2 if RC086==2
replace insom_rested = 3 if RC086==3 
la var insom_rested "Feel rested when wake up? 1=Most of the time, 2=Sometimes, 3=Rarely,Never"
tab insom_rested , missing

/*In the past 2 weeks, taken medication or treatment to help sleep?
xc232u2 - 1=yes, 5=no
Not asked before 2006*/
/*
****COULDN'T GET THIS TO RUN IN COVID
gen byte insom_med_sleep = .
replace insom_med_sleep = 1 if RC232U2==1 
replace insom_med_sleep = 0 if RC232U2==5 
la var insom_med_sleep "Take medic. or other treatment to help sleep, no 2016"
tab insom_med_sleep , missing
*/
/*Medication recommended by a doctor?
xc233 - 1=yes, 5=no (asked if yes above, left missing if no medication taken)
Not asked before 2006*/
/*COULDN'T GET THIS TO RUN IN COVID*******
gen byte insom_med_dr = .
replace insom_med_dr = 1 if RC233==1
replace insom_med_dr = 0 if RC233==5
la var insom_med_dr "Medications or treatment to help sleep recommended by a doctor, no 2016"
tab insom_med_dr , missing
*/


/*depression, period of 2 weeks in the last year when felt sad, blue or depressed?
Skip pattern changed after 1998, if find need to backfill, then need to check 1998 variable
1998 Core 	F1323
2000 Core 	G1456
2002 Core 	HC150
2004 Core 	JC150
2006 Core 	KC150
2008 Core 	LC150
2010 Core 	MC150
2012 Core 	NC150
2014 Core 	OC150
not asked for proxy interviews
*/
gen byte depr_2_wks_hrs = .
replace depr_2_wks_hrs = 1 if RC150==1 | RC150==3 
replace depr_2_wks_hrs = 0 if  RC150==5 
la var depr_2_wks_hrs "Depressed 2 week period in last year? 1=yes"
tab depr_2_wks_hrs  , missing
tab depr_2_wks_hrs  if proxy_core==0, missing



save "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 3.dta", replace

H="STEP 4: cognition, memory"
***STEP 4- COGNITION, DEMENTIA

//RG PC
//local logpath C:\HRS\hrs_cleaned\logs
//local datapath C:\HRS\hrs_cleaned\working

use "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 3.dta"

/*Rate memory
2002-2012: d101
1 = excellent, 5=poor*/
gen sr_memory = .
replace sr_memory = RD101 

replace sr_memory = . if inlist(sr_memory,8,9)
la var sr_memory "Self rated memory, 1=Excel, 5=Poor"
tab sr_memory  if proxy_core==0

/*Compare memory now to self rating at last interview
1=better, 2=same, 3=worse
2002-2014: d102*/
gen sr_mem_change = .
replace sr_mem_change = RD102
replace sr_mem_change = . if inlist(sr_mem_change,8,9)
la var sr_mem_change "Self rated memory now vs last ivw, 1=Better,2=Same,3=Worse"
tab sr_mem_change  if proxy_core==0

/*Proxy Rate memory
2002-2012: d151
1 = excellent, 5=poor*/
gen pr_memory = .
replace pr_memory = RD501 
replace pr_memory = . if inlist(pr_memory,8,9)
la var pr_memory "Proxy rated memory, 1=Excel, 5=Poor"
tab pr_memory , missing
tab pr_memory proxy_core, missing

/*Proxy Compare memory now to self rating at last interview
1=better, 2=same, 3=worse
2002-2012: d152
Only asked if R age >65*/
gen pr_mem_change = .
replace pr_mem_change = RD502 
replace pr_mem_change = . if inlist(pr_mem_change,8,9)
la var pr_mem_change "Proxy rated memory now vs last ivw, 1=Better,2=Same,3=Worse"
tab pr_mem_change , missing
tab pr_mem_change proxy_core, missing
tab pr_mem_change  if proxy_core==1, missing

 save "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 4.dta", replace

H="Step 5: cleaning covid module data"
*****STEP 5: CLEANING COVID MODULE DATA*******
use  "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 4.dta"


gen level_concern=.
replace level_concern= RCOVW550 if (RCOVW550>0 & RCOVW550<11)
tab level_concern, m

gen had_covid=.
replace had_covid=RCOVW551 if (RCOVW551>0 & RCOVW551<8)
label define hc1 1 "YES" 2 "PROBABLY YES" 5 "NO" 6 "PROBABLY NO" 7 "UNSURE" 
label values had_covid hc1
tab had_covid, m

recode had_covid (1/2=1) (5/7=0), gen(prob_def_covid)
tab prob_def_covid, m

gen tested_covid=RCOVW552
gen md_confirm= RCOVW557
gen ed_covid= RCOVW558
gen hosp_covid= RCOVW559
gen ling_sxs= RCOVW565
gen wanted_test= RCOVW567
gen ask_test= RCOVW568
gen hh_covid= RCOVW574
gen known_covid= RCOVW577
gen died_covid= RCOVW578
gen delay_care= RCOVW579
gen delay_surg= RCOVW582
gen delay_doc= RCOVW584
gen delay_rx= RCOVW586
gen delay_dent= RCOVW587
gen delay_other= RCOVW588
gen moved_covid= RCOVW625
gen movein_covid= RCOVW628
gen finhlp_cvd= RCOVW631
gen chrhlp_cvd= RCOVW634
gen hlpd_fin= RCOVW637
gen hlpd_chr= RCOVW640


foreach var of varlist tested_covid md_confirm ed_covid hosp_covid ling_sxs wanted_test ask_test hh_covid known_covid died_covid delay_care delay_surg delay_doc delay_rx delay_dent delay_other moved_covid movein_covid finhlp_cvd chrhlp_cvd hlpd_fin hlpd_chr {
replace `var'= 0 if `var'==5
replace `var'= . if `var'==8 | `var'==9
tab `var', m
}

*make every var for care delay type= 0 if they report no care delays
foreach var of varlist delay_surg delay_doc delay_rx delay_dent delay_other {
replace `var'=0 if delay_care==0
}

*FINANCIAL HARDSHIP VARIABLES 

recode RCOVW623M1 (1/6=1)(7=0)(97=1)(98/99=.), gen(hrdshp_any)
*two ppl say no hardship but then say had trouble getting food regardless of money
replace hrdshp_any=1 if RCOVW623M2==6

gen hrdshp_rent=0
replace hrdshp_rent=. if hrdshp_any==.
replace hrdshp_rent=1 if ((RCOVW623M1==1)|(RCOVW623M2==1)|(RCOVW623M3==1)|(RCOVW623M4==1)|(RCOVW623M5==1)|(RCOVW623M6==1)|(RCOVW623M7==1))

gen hrdshp_debt=0
replace hrdshp_debt=. if hrdshp_any==.
replace hrdshp_debt=1 if ((RCOVW623M1==2)|(RCOVW623M2==2)|(RCOVW623M3==2)|(RCOVW623M4==2)|(RCOVW623M5==2)|(RCOVW623M6==2)|(RCOVW623M7==2))

gen hrdshp_utils=0
replace hrdshp_utils=. if hrdshp_any==.
replace hrdshp_utils=1 if ((RCOVW623M1==3)|(RCOVW623M2==3)|(RCOVW623M3==3)|(RCOVW623M4==3)|(RCOVW623M5==3)|(RCOVW623M6==3)|(RCOVW623M7==3))

gen hrdshp_medbls=0
replace hrdshp_medbls=. if hrdshp_any==.
replace hrdshp_medbls=1 if ((RCOVW623M1==4)|(RCOVW623M2==4)|(RCOVW623M3==4)|(RCOVW623M4==4)|(RCOVW623M5==4)|(RCOVW623M6==4)|(RCOVW623M7==4))

gen hrdshp_food=0
replace hrdshp_food=. if hrdshp_any==.
replace hrdshp_food=1 if ((RCOVW623M1==5)|(RCOVW623M2==5)|(RCOVW623M3==5)|(RCOVW623M4==5)|(RCOVW623M5==5)|(RCOVW623M6==5)|(RCOVW623M7==5))

gen hrdshp_getfood=0
replace hrdshp_getfood=. if hrdshp_any==.
replace hrdshp_getfood=1 if ((RCOVW623M1==6)|(RCOVW623M2==6)|(RCOVW623M3==6)|(RCOVW623M4==6)|(RCOVW623M5==6)|(RCOVW623M6==6)|(RCOVW623M7==6))

gen hrdshp_other=0
replace hrdshp_other=. if hrdshp_any==.
replace hrdshp_other=1 if ((RCOVW623M1==97)|(RCOVW623M2==97)|(RCOVW623M3==97)|(RCOVW623M4==97)|(RCOVW623M5==97)|(RCOVW623M6==97)|(RCOVW623M7==97))


foreach var of varlist hrdshp_any hrdshp_debt hrdshp_food hrdshp_getfood hrdshp_medbls hrdshp_other hrdshp_rent hrdshp_utils {
tab `var'
}

gen any_hrdshp_food=0
replace any_hrdshp_food=. if hrdshp_any==.
replace any_hrdshp_food=1 if (hrdshp_food==1) | (hrdshp_getfood)


*NOW RECODING OTHER VARIABLES THAT AREN'T 0/1
recode RCOVW566 (1=1 "physical") (2=2 "mental")(3=3 "both")(8/9=.), gen(type_ling_sxs)

*reasons for delaying care
gen why_delay_afford=0
replace why_delay_afford=. if (delay_care==0)|(RCOVW580M1==8)|(RCOVW580M1==9)
replace why_delay_afford=1 if (RCOVW580M1==1)|(RCOVW580M2==1)|(RCOVW580M3==1)|(RCOVW580M4==1)|(RCOVW580M5==1)|(RCOVW580M6==1)
tab why_delay_afford, m

gen why_delay_avail=0
replace why_delay_avail=. if (delay_care==0)|(RCOVW580M1==8)|(RCOVW580M1==9)
replace why_delay_avail=1 if (RCOVW580M1==2)|(RCOVW580M2==2)|(RCOVW580M3==2)|(RCOVW580M4==2)|(RCOVW580M5==2)|(RCOVW580M6==2)
tab why_delay_avail, m

gen why_delay_advised=0
replace why_delay_advised=. if (delay_care==0)|(RCOVW580M1==8)|(RCOVW580M1==9)
replace why_delay_advised=1 if (RCOVW580M1==3)|(RCOVW580M2==3)|(RCOVW580M3==3)|(RCOVW580M4==3)|(RCOVW580M5==3)|(RCOVW580M6==3)
tab why_delay_advised, m

gen why_delay_nonurgent=0
replace why_delay_nonurgent=. if (delay_care==0)|(RCOVW580M1==8)|(RCOVW580M1==9)
replace why_delay_nonurgent=1 if (RCOVW580M1==4)|(RCOVW580M2==4)|(RCOVW580M3==4)|(RCOVW580M4==4)|(RCOVW580M5==4)|(RCOVW580M6==4)
tab why_delay_nonurgent, m

gen why_delay_fear=0
replace why_delay_fear=. if (delay_care==0)|(RCOVW580M1==8)|(RCOVW580M1==9)
replace why_delay_fear=1 if (RCOVW580M1==5)|(RCOVW580M2==5)|(RCOVW580M3==5)|(RCOVW580M4==5)|(RCOVW580M5==5)|(RCOVW580M6==5)
tab why_delay_fear, m

gen why_delay_other=0
replace why_delay_other=. if (delay_care==0)|(RCOVW580M1==8)|(RCOVW580M1==9)
replace why_delay_other=1 if (RCOVW580M1==7)|(RCOVW580M2==7)|(RCOVW580M3==7)|(RCOVW580M4==7)|(RCOVW580M5==7)|(RCOVW580M6==7)
tab why_delay_other, m

*income change
recode RCOVW619 (1=1 "went up")(3=2 "same")(2=3 "went down") (8/9=.), gen(covid_inc_chng)
tab covid_inc_chng

*spend change
recode RCOVW622 (1=1 "went up")(3=2 "same")(2=3 "went down") (8/9=.), gen(covid_spend_chng)
tab covid_spend_chng

tab covid_spend_chng covid_inc_chng, column




save "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 5.dta", replace

H="Step 6: cleaning additional variables"
use "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 5.dta", clear

***STEP 6:  CLEANING/MERGING ADDITIONAL VARIABLES

gen food_stamps=.
replace food_stamps=1 if RQ400==1
replace food_stamps=0 if RQ400==5

gen food_stamps_curr=.
replace food_stamps=1 if RQ532==1
replace food_stamps=0 if RQ532==5

gen food_del_door=.
replace food_stamps=1 if RQ421==1
replace food_stamps=0 if RQ421==5

gen year=2018

merge 1:1 hhid pn year using "D:\HRS\Shared\base_data\hrs_cleaned\helper_hours_2018.dta", keep(master matched) nogen

rename year core_year

merge 1:1 hhid pn core_year using "D:\HRS\Shared\base_data\hrs_cleaned\core_00_to_18.dta", keepusing(hhid pn) keep(master matched) 

preserve

keep if _merge==1
drop _merge
replace core_year=2016
rename core_year year 
drop id-hlphrs
merge 1:1 hhid pn year using "D:\HRS\Shared\base_data\hrs_cleaned\helper_hours_2016.dta", keep(master matched) nogen 
rename year core_year

//2016 adds in 148 of the 181 missing in 2018. 
merge 1:1 hhid pn core_year using "D:\HRS\Shared\base_data\hrs_cleaned\core_00_to_18.dta", keepusing(hhid pn) keep(master matched)
replace n_hp=0 if _merge==3 & n_hp==.

drop _merge
tempfile v2016
save `v2016'
restore
drop if _merge==1

append using "`v2016'"

replace n_hp=0 if _merge==3 & n_hp==.
drop _merge

rename hhid pn, u

merge 1:1 HHID PN using "D:\HRS\Shared\raw\HRS\hrs_tracking_2018\trk2018tr_r.dta", keepusing(BIRTHMO BIRTHYR HISPANIC RACE) keep(master matched) 

rename HHID PN, l

gen white=.
replace white=0 if RACE!=0
replace white=1 if RACE==1 & HISPANIC==5
label var white "White, Non-Hispanic"

gen black=.
replace black=0 if RACE!=0
replace black=1 if RACE==2 & HISPANIC==5
label var black "Black, Non-Hispanic"

gen other=.
replace other=0 if RACE!=0
replace other=1 if RACE==7 & HISPANIC==5
label var other "Other, Non-Hispanic"

gen hisp_eth=.
replace hisp_eth=0 if HISPANIC!=0
replace hisp_eth=1 if inlist(HISPANIC, 1,2,3)
label var hisp_eth "Hispanic Ethnicity"

gen birth_date=mdy(BIRTHMO,1,BIRTHYR)

drop BIRTHMO BIRTHYR HISPANIC RACE

gen covid_ivw_date=mdy(7,1,2020)
gen age=floor((covid_ivw_date-birth_date)/365.25)
replace age=2020-RX067_R if age==.

/*****NEXT SECTION IS FROM HRS CLEANING SECTION AROUND HELPER FILES (NOT ADDRESSED HERE) AND ADLS, IADLS)

variable cleaning for HRS core 2000-2016
Most code is taken from the HRS Outline_11_22_11.txt file
and modified to clean 2000-2016 core dataset

Adds variables from the helper files for the primary adl and iadl helpers for 2002-2016

Creates indices and other variables from cleaned 2000-2016 dataset

capture log close

clear all
set more off

//Amy's PC
local logpath D:\HRS\Shared\base_data\hrs_cleaned\logs
local datapath D:\HRS\Shared\base_data\hrs_cleaned\working

//RG PC
//local logpath C:\HRS\hrs_cleaned\logs
//local datapath C:\HRS\hrs_cleaned\working

log using "`logpath'\2_HRS_Core_00_16_clean5-LOG.txt", text replace

cd `datapath'
*/

****************************************************************************************
//Bring in helpers dataset from 2002-2016 core interviews
****************************************************************************************
/* NOT DONE FOR COVID UPDATE YET
egen id= concat(hhid pn)
la var id "Respondent ID (HHID+PN)"

//clean up helper file variables

//indicators for adl and iadl helper information present in helper files
replace adl_help_ind=0 if adl_help_ind==.
tab adl_help_ind, missing
replace iadl_help_ind=0 if iadl_help_ind==.
tab iadl_help_ind, missing
tab adl_help_ind iadl_help_ind, missing

//adl helper frequency variables
replace adl_hlp_freq_mo = . if inlist(adl_hlp_freq_mo,96,98,99)
replace adl_hlp_freq_wk = . if adl_hlp_freq_wk==8
replace adl_hlp_freq_ed = . if adl_hlp_freq_ed==8
replace adl_help_hours = . if inlist(adl_help_hours,98,99)



/*Commented out code to look at missingness across frequency variables
gen adl_mo = 1 if adl_hlp_freq_mo~=.
replace adl_mo = 0 if adl_hlp_freq_mo==.
tab adl_mo if adl_help_ind==1
gen adl_wk = 1 if adl_hlp_freq_wk~=.
replace adl_wk = 0 if adl_hlp_freq_wk==.
tab adl_wk if adl_help_ind==1
gen adl_ed = 1 if adl_hlp_freq_ed~=.
replace adl_ed = 0 if adl_hlp_freq_ed==.
tab adl_ed if adl_help_ind==1
la var adl_mo "Month"
la var adl_wk "Week"
la var adl_ed "Every day"
table adl_mo adl_wk adl_ed if adl_help_ind==1*/

//create imputed adl helper frequency variables, days per month and every day indicator
gen adl_hlp_freq_imp_mo = .
replace adl_hlp_freq_imp_mo = adl_hlp_freq_mo if adl_hlp_freq_mo~=.
replace adl_hlp_freq_imp_mo = adl_hlp_freq_wk*4 if adl_hlp_freq_imp_mo==. & adl_hlp_freq_wk!=.
replace adl_hlp_freq_imp_mo = 28 if adl_hlp_freq_ed==1
la var adl_hlp_freq_imp_mo "Imputed days/month ADL helper"
tab adl_hlp_freq_imp_mo if adl_help_ind==1, missing

gen adl_hlp_freq_imp_ed = .
replace adl_hlp_freq_imp_ed = 1 if adl_hlp_freq_imp_mo>27 & adl_hlp_freq_imp_mo~=.
replace adl_hlp_freq_imp_ed = 0 if adl_hlp_freq_imp_mo<28 & adl_hlp_freq_imp_mo~=.
la var adl_hlp_freq_imp_ed "Imputed ADL helper every day ind, 1=yes"
tab adl_hlp_freq_imp_ed if adl_help_ind==1, missing

//iadl helper frequency variables
replace iadl_hlp_freq_mo = . if inlist(iadl_hlp_freq_mo,96,98,99)
replace iadl_hlp_freq_wk = . if iadl_hlp_freq_wk==8
replace iadl_hlp_freq_ed = . if iadl_hlp_freq_ed==8
replace iadl_help_hours = . if inlist(iadl_help_hours,98,99)

/*Commented out code to look at missingness across frequency variables
gen iadl_mo = 1 if iadl_hlp_freq_mo~=.
replace iadl_mo = 0 if iadl_hlp_freq_mo==.
tab iadl_mo if iadl_help_ind==1
gen iadl_wk = 1 if iadl_hlp_freq_wk~=.
replace iadl_wk = 0 if iadl_hlp_freq_wk==.
tab iadl_wk if iadl_help_ind==1
gen iadl_ed = 1 if iadl_hlp_freq_ed~=.
replace iadl_ed = 0 if iadl_hlp_freq_ed==.
tab iadl_ed if iadl_help_ind==1
la var iadl_mo "Month"
la var iadl_wk "Week"
la var iadl_ed "Every day"
table iadl_mo iadl_wk iadl_ed if iadl_help_ind==1*/

//create imputed helper frequency variables, days per month and every day indicator
gen iadl_hlp_freq_imp_mo = .
replace iadl_hlp_freq_imp_mo = iadl_hlp_freq_mo if iadl_hlp_freq_mo~=.
replace iadl_hlp_freq_imp_mo = iadl_hlp_freq_wk*4 if iadl_hlp_freq_imp_mo==. & iadl_hlp_freq_wk!=.
replace iadl_hlp_freq_imp_mo = 28 if iadl_hlp_freq_ed==1
la var iadl_hlp_freq_imp_mo "Imputed days/month IADL helper"
tab iadl_hlp_freq_imp_mo if iadl_help_ind==1, missing

gen iadl_hlp_freq_imp_ed = .
replace iadl_hlp_freq_imp_ed = 1 if iadl_hlp_freq_imp_mo>27 & iadl_hlp_freq_imp_mo~=.
replace iadl_hlp_freq_imp_ed = 0 if iadl_hlp_freq_imp_mo<28 & iadl_hlp_freq_imp_mo~=.
la var iadl_hlp_freq_imp_ed "Imputed IADL helper every day ind, 1=yes"
tab iadl_hlp_freq_imp_ed if iadl_help_ind==1, missing

save helpers_core_0218_tomerge.dta, replace

clear
use core_98_18_clean_merge.dta

//check for duplicate ids
sort id core_year
quietly by id core_year: gen dup = cond(_N==1,0,_n)
tab dup
drop if dup>1 
drop dup

merge 1:1 id core_year using helpers_core_0218_tomerge.dta 

drop if _merge==2

drop _merge

*/
*******************************************************************************************
** Dummies for Education categories
*******************************************************************************************
/*NOT DONE IN COVID BECAUSE SEEMS TO ALREADY BE DONE FOR MOST
** Grade 0 - 11**
generate byte ed_less_hs = 0
replace ed_less_hs = 0 if ((educ==2) | (educ==3)| (educ==4)| (educ==5))
replace ed_less_hs = 1 if ((educ==0) | (educ==1))
label variable ed_less_hs "No Formal Education-Grade 11"
//label define ed_less_hs 1 "No Formal Education-Grade 11", modify
//label values ed_less_hs ed_less_hs
tab ed_less_hs, missing 

** HS Grad or Some College **
generate byte ed_hs_plus = 0
replace ed_hs_plus = 0 if ((educ==0) | (educ==1)|(educ==4)| (educ==5))
replace ed_hs_plus = 1 if ((educ==2) | (educ==3))
label variable ed_hs_plus "High School Grad or Some College"
//label define ed_hs_plus 1 "High School Grad or Some College", modify
//label values ed_hs_plus ed_hs_plus
tab ed_hs_plus, missing 

** College Grad or Higher **
generate byte ed_coll = 0
replace ed_coll = 0 if ((educ==0) | (educ==1)|(educ==2) | (educ==3))
replace ed_coll = 1 if ((educ==4) | (educ==5))
label variable ed_coll "College Grad or Higher"
//label define ed_coll 1 "College Grad or Higher", modify
//label values ed_coll ed_coll
tab ed_coll, missing 

** Education info missing **
generate byte ed_missing = 0
replace ed_missing = 1 if (educ>=.) 
label variable ed_missing "Education info missing "
//label define ed_missing 1 "Education info missing ", modify
//label values ed_missing ed_missing
tab ed_missing, missing 

*******************************************************************************************
** Dichotomized at High School
** 2/8 code changed to define missings as 0 for preliminary models, will impute missing values in final model
*******************************************************************************************
generate byte hseduc = 0
replace hseduc = 0 if (educ <=1)
replace hseduc = 1 if (educ >1) & (educ <.)
label variable hseduc "Eduction, High School"
//label define hseduc 0 "Less than HS Education or missing" 1 "HS Education or Higher", modify
//label values hseduc hseduc 
tab educ hseduc, missing
*/
*******************************************************************************************
** Marital status dichotomous variables
*******************************************************************************************

tab marital, gen(marital)

rename marital2 marital_sep
label variable marital_sep "Separated 1=yes"
tab marital_sep, missing 

rename marital3 marital_div
label variable marital_div "Divorced 1=yes"
tab marital_div, missing 

rename marital4 marital_wid
label variable marital_wid "Widowed 1=yes"
tab marital_wid, missing 

rename marital5 marital_nev
label variable marital_nev "Never Married 1=yes"
tab marital_nev, missing 

generate byte marital_sd = .
replace marital_sd = 1 if (marital_sep==1 | marital_div==1)
replace marital_sd = 0 if (marital_sep==0 & marital_div==0)
label variable marital_sd "Separated or Divorced"
//label define marital_sd 1 "Separated or Divorced" 0 "Not Separated or Divorced", modify
//label values marital_sd marital_sd
tab marital_sd, missing

generate byte marital_missing = 0
replace marital_missing = 1 if ((marital >=.)|(marital==6))
label variable marital_missing "Marital Status Missing"
//label define marital_missing 1 "Marital Status Missing" 0 "Not Missing", modify
//label values marital_missing marital_missing
tab marital_missing, missing

drop marital1 marital6

*******************************************************************************************
** Resident Children as indicator variable
*******************************************************************************************
generate reschil_d = .
replace reschil_d = 0 if ((reschil==0) & (reschil<.))|(nhres==1)
replace reschil_d = 1 if ((reschil>0) & (reschil<.))&(nhres!=1)
label variable reschil_d "Living with Children"
//label define reschil_d 1 "Live with 1 or more Children" 0 "Not Resident Children", modify
//label val reschil_d reschil_d 
tab reschil_d, missing

/**********************************************************************/
// Dummies for 3 categories self-reported health status: Poor/Fair, Good, Very Good /Excellent**
/**********************************************************************/
gen byte srh_pf = .
replace srh_pf = 0 if inlist(srh,1,2,3)
replace srh_pf = 1 if inlist(srh,4,5)
label var srh_pf "Self Rated Health: Poor/Fair"

gen byte srh_g = .
replace srh_g = 0 if inlist(srh,1,2,4,5)
replace srh_g = 1 if srh==3
label var srh_g "Self Rated Health: Good"

gen byte srh_ve = .
replace srh_ve = 0 if inlist(srh,3,4,5)
replace srh_ve = 1 if inlist(srh,1,2)
label var srh_ve "Self Rated Health: Very Good /Excellent"

/**********************************************************************/
// CESD and Alcohol use variables 
/**********************************************************************/
//total cesd indicators
gen cesd_tot=cesd1 + cesd2 + cesd3 + cesd4 + cesd5 + cesd6 + cesd7 + cesd8
tab cesd_tot , missing
la var cesd_tot "Total CESD count"

//cesd total >=3 indicator
gen byte cesd_tot_ge3=.
replace cesd_tot_ge3=1 if (cesd_tot>=3 & cesd_tot!=.)
replace cesd_tot_ge3=0 if (cesd_tot<3 & cesd_tot!=.)
la var cesd_tot_ge3 "CESD Count 3 or higher"
tab cesd_tot_ge3 ,missing

gen byte Alcohol_mis = .
replace Alcohol_mis=1 if (ever_drink==1 & n_drinks_3m>4 & n_drinks_3m!=.)
replace Alcohol_mis=0 if (ever_drink==1 & n_drinks_3m<=4 )
replace Alcohol_mis=0 if ever_drink==0 | days_drink==0
la var Alcohol_mis "Alcohol mis-use"
tab Alcohol_mis , missing


/**********************************************************************/
// BMI variables calculated from height and weight **
/**********************************************************************/

gen height_in=.
replace height_in=(height_ft_temp *12)+height_in_temp
la var height_in "Height, inches"
tab height_in , missing

drop height_ft_temp height_in_temp 

//BMI calculated
gen bmi = .
replace bmi = wgt_curr / (height_in * height_in) * 703
la var bmi "Body mass index - calculated"
sum bmi

//bmi categories
gen bmi_cat = .
replace bmi_cat = 0 if (bmi<=18.5)
replace bmi_cat = 1 if (18.5 <= bmi & bmi<25)
replace bmi_cat = 2 if (25<= bmi & bmi<30)
replace bmi_cat = 3 if (bmi >= 30) & bmi!=.
// la def bmi_cat 0 "Underweight" 1"Normal weight" 2 "Overweight" 3 "Obese"
// la val bmi_cat bmi_cat
la var bmi_cat "BMI - categorical"
tab bmi_cat, missing

/*************************************************************************/
/* Index of ADLs: First step is a simple count
** Then the index is divided by categoies: 
** independent (0 ADL deficiencies), partial dependence (1-3 ),
** severe dependence (>=4).
*/
/*************************************************************************/

generate adl_index_core = .
replace adl_index_core = adl_dr_core + adl_wk_core + adl_bh_core + adl_e_core + adl_tx_core + adl_t_core
label var adl_index_core "Index of ADLs - core"
tab adl_index_core, missing 

generate adl_cat_core = .
replace adl_cat_core = 0 if (adl_index_core ==0)
replace adl_cat_core = 1 if inlist(adl_index_core,1,2,3)
replace adl_cat_core = 2 if inlist(adl_index_core,4,5,6)
label var adl_cat_core "ADLs, Categorical"
//label define adl_cat_core 0 "Independent" 1 "Partial Dependence" 2 "Severe Dependence", modify
//label values adl_cat_core adl_cat_core 
tab adl_cat_core, missing 

//Create dummy variables for ADL Categories
tab adl_cat_core, gen(adlcat)
rename adlcat1 adl_independent_core
rename adlcat2 adl_partial_core
rename adlcat3 adl_severe_core

label var adl_independent_core "Independent for ADLs"
label var adl_partial_core "Partial Dependence for ADLs"
label var adl_severe_core "Severe Dependence for ADLs"

tab adl_cat_core adl_independent_core, missing
tab adl_cat_core adl_partial_core, missing
tab adl_cat_core adl_severe_core, missing

//indicator for adl main helper details present in the helper file
/*replace adl_help_ind=0 if adl_help_ind==.
tab adl_help_ind, missing
tab adl_help_ind if inlist(adl_cat_core,1,2) & core_year>2000, missing


//get count of unique helpers using their person number id's
//used code from stata faq website here: 
//http://www.stata.com/support/faqs/data-management/counting-distinct-strings/
gen adl_helper_count = 0
qui forval i = 1/`=_N' {
	foreach v of var adl_helper_1-adl_helper_7 {
		if `v'[`i'] != "" & `v'[`i'] != " " {
			local all `"`all' `"`=`v'[`i']'"'"'
		}
	}
	local all : list uniq all
	replace adl_helper_count = `: list sizeof all' in `i'
	local all
}
la var adl_helper_count "Count of unique ADL helpers"
tab adl_helper_count, missing
*/

/******************************************************************************/
/******************************************************************************/
/* Index of IADLs: First step is a simple count
 Then the index is divided by categoies: 
 independent (0 IADL deficiencies), partial dependence (1-3 ),
 severe dependence (>4).   */
/******************************************************************************/
/******************************************************************************/

generate iadl_ind_core = .
replace iadl_ind_core= iadl_mp_core + iadl_gr_core + iadl_ph_core + iadl_rx_core + iadl_m_core
label var iadl_ind_core "Index of IADLs"
tab iadl_ind_core, missing 

generate iadl_cat_core = .
replace iadl_cat_core = 0 if iadl_ind_core==0
replace iadl_cat_core = 1 if inlist(iadl_ind_core,1,2,3)
replace iadl_cat_core = 2 if inlist(iadl_ind_core,4,5)
label var iadl_cat_core "IADLs, Categorical"
//label define iadl_cat_core 0 "Independent" 1 "Partial Dependence" 2 "Severe Dependence", modify
//label values iadl_cat_core iadl_cat_core 
tab iadl_cat_core , missing 

**Create dummy variables for IADL Categories
tab iadl_cat_core, gen(iadlcat)
rename iadlcat1 iadl_independent_core
rename iadlcat2 iadl_partial_core
rename iadlcat3 iadl_severe_core

label var iadl_independent_core "Independent for IADLs"
label var iadl_partial_core "Partial Dependence for IADLs"
label var iadl_severe_core "Severe Dependence for IADLs"

tab iadl_cat_core iadl_independent_core, missing
tab iadl_cat_core iadl_partial_core, missing
tab iadl_cat_core iadl_severe_core, missing

//indicator for iadl main helper details present in the helper file
/*
replace iadl_help_ind=0 if iadl_help_ind==.
tab iadl_help_ind, missing
tab iadl_help_ind if inlist(iadl_cat_core,1,2) & core_year>2000, missing

//get count of unique helpers using their person number id's
gen iadl_helper_count = 0
qui forval i = 1/`=_N' {
	foreach v of var iadl_helper_1-iadl_helper_6 {
		if `v'[`i'] != "" & `v'[`i'] != " " {
			local all `"`all' `"`=`v'[`i']'"'"'
		}
	}
	local all : list uniq all
	replace iadl_helper_count = `: list sizeof all' in `i'
	local all
}
la var iadl_helper_count "Count of unique IADL helpers"
tab iadl_helper_count core_year, missing
*/

/*******************************************************************/
// Index of Comorbidities: First step is a simple count
// Then the index is divided by categoies: 
// None (0), Mild (1-3), Moderate (4-6), Severe (>7).
/*******************************************************************/

gen comor_in_hrs = .
replace comor_in_hrs = (cancer_hrs + lung_hrs + heart_hrs + chf_hrs + stroke_hrs + ///
	memory_hrs + htn_hrs + dm_hrs + psych_hrs)
label var comor_in_hrs "Index of Comorbidities"
tab comor_in_hrs , missing  
 
//categorical variable
generate comor_c_hrs = .
replace comor_c_hrs = 0  if (comor_in_hrs==0)
replace comor_c_hrs = 1  if inlist(comor_in_hrs,1,2,3)
replace comor_c_hrs = 2  if inlist(comor_in_hrs,4,5,6)
replace comor_c_hrs = 3  if inlist(comor_in_hrs,7,8,9)
label var comor_c_hrs "Comorbidity Index, Categorical"
//label define comor_c_hrs 0 "None (0)" 1 "Mild (1-3)" 2 "Moderate (4-6)" 3 "Severe (>7)", modify
//label values comor_c_hrs comor_c_hrs
tab comor_c_hrs , missing 

//overall psychiatric problems variable
gen psych_overall_hrs = .
replace psych_overall_hrs = 1 if psych_hrs==1
replace psych_overall_hrs = 0 if psych_hrs==0 
la var psych_overall_hrs "Indicator for any psychiatric problems from HRS"
tab psych_overall_hrs ,missing


 save "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 6.dta", replace

H="Step 7: drop raw vars and merge in prior HRS and tracker data"
*STEP 7: keep only cleaned variables and merge in weights and prior HRS data
use "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 6.dta"


keep hhid pn cvwgtr rversion adl_bh_core adl_core_check adl_diff_bh adl_diff_dr adl_diff_e adl_diff_t adl_diff_tx adl_diff_wk adl_dr_core adl_e_core adl_equip_tx adl_equip_wk adl_oth_helper adl_sp_helper adl_t_core adl_tx_core adl_wk_core any_hrdshp_food arth_hrs ask_test back_pain_hrs cancer_chemo_med cancer_hrs cancer_other_treat cancer_surg cancer_symp cancer_xray catinsur cesd2 cesd3 cesd4 cesd5 cesd6 cesd7 cesd8 champus chf_hrs chfadmit_ask chfadmit_hrs chfdrever_hrs child chrhlp_cvd cough_hrs covid_inc_chng covid_spend_chng cvwgtr days_drink delay_care delay_dent delay_doc delay_other delay_rx delay_surg dem_hrs depr_2_wks_hrs died_covid dizzy_hrs dm_hrs dm_ins_hrs dyspnea_hrs ed_covid educ ever_drink falls_hrs fatigue_hrs female finhlp_cvd fl_diff_dime fl_diff_lift fl_diff_push fl_diff_reach fl_diff_sit fl_diff_sta_many fl_diff_sta_one fl_diff_stp fl_diff_wk_many fl_diff_wk_one friend gchil had_covid headache_hrs heart_hrs   help_friends help_friends_hours hh_covid hh_worker hhid hhm hip_frac_hrs hisp hlpd_chr hlpd_fin hmo hosp_covid hosp_last_2yr hrdshp_any hrdshp_debt hrdshp_food hrdshp_getfood hrdshp_medbls hrdshp_other hrdshp_rent hrdshp_utils htn_hrs iadl_diff_gr iadl_diff_m iadl_diff_map iadl_diff_mp iadl_diff_ph iadl_diff_rx iadl_gr_core iadl_m_core iadl_mp_core iadl_oth_helper iadl_ph_core iadl_rx_core iadl_sp_helper incont_hrs insom_falling_asleep insom_rested insom_too_early insom_waking_up known_covid level_concern ling_sxs ltc_bene ltc_ins lung_hrs lung_o2_hrs marital married md_confirm medicaid medicare medicareb medigap memory_hrs moved_covid movein_covid n_drinks_3m  nh_nights nh_start nh_stays nhres nhres_2yr nhres_start_mo nhres_start_yr pain_hrs pain_level_hrs pain_limit_act_hrs pn pr_mem_change pr_memory prob_def_covid proxy_core psych_hrs rel_nb relig reschil resspouse rewidowed rvdate rversion smoke_curr smoke_ever soc_visit soc_visit_cat soc_visit_yr sr_mem_change sr_memory srh stroke_hrs swelling_feet_hrs tested_covid type_ling_sxs vig_phy_act wanted_test wgt_curr why_delay_advised why_delay_afford why_delay_avail why_delay_fear why_delay_nonurgent why_delay_other food_stamps food_stamps_curr food_del_door marital_sep marital_div marital_wid marital_nev marital_sd marital_missing reschil_d srh_pf srh_g srh_ve cesd_tot cesd_tot_ge3 Alcohol_mis height_in bmi bmi_cat adl_index_core adl_cat_core adl_independent_core adl_partial_core adl_severe_core iadl_ind_core iadl_cat_core iadl_independent_core iadl_partial_core iadl_severe_core comor_in_hrs comor_c_hrs psych_overall_hrs


gen core_year=2020

append using "D:\HRS\Shared\base_data\hrs_cleaned\core_00_to_18.dta" 
sort hhid pn core_year
by hhid pn: egen maxyear=max(core_year)

keep if maxyear==2020
gen HHID= hhid
gen PN=  pn
merge m:1 HHID PN using "D:\HRS\Shared\raw\HRS\hrs_tracking_2018\trk2018tr_r.dta" , keepusing(SECU STRATUM RACE HISPANIC BIRTHYR BIRTHMO)
keep if _merge==3

gen age=.
replace age=2020-BIRTHYR if BIRTHMO<8
replace age=2019-BIRTHYR if BIRTHMO>7
replace age=. if BIRTHYR==0

drop BIRTHYR BIRTHMO


*make keep variable
gen keep=0
replace keep=1 if core_year==2020 & cvwgtr!=.

*make race variable
gen race_eth=.
replace race_eth=1 if RACE==1
replace race_eth=2 if RACE==2
replace race_eth=3 if RACE==7
replace race_eth=4 if (HISPANIC==1) | (HISPANIC==2) | (HISPANIC==3)
label define re1 1 "White, non-Hispanic" 2 "Black, non-Hispanic" 3 "Other, non-Hispanic" 4 "Hispanic"
label values race_eth re1
tab race_eth





 save "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 7.dta", replace



H="STEP 8: variable cleaning for analysis"
*STEP 8: CLEANING VARIABLES FOR ANALYSIS


use "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 7.dta"

*FILLING IN MISSING DEMOGRAPHICS WITH PRIOR SURVEY WHEN NOT HIGHLY TIME-VARIANT

sort hhid pn core_year
by hhid pn: replace educ= educ[_n-1] if educ==.


*age cat
recode age (0/65=1 "less than 65")(65/75=2 "65-74")(75/85=3 "75-84")(85/999=4 "85+"), gen(age_4cat)
recode age (0/60=1 "less than 60")(60/65=2 "60-64")(65/75=3 "65-74")(75/85=4 "75-84")(85/999=5 "85+"), gen(age_5cat)

*education
recode educ (0/2=0)(3/5=1), gen(educ_morethanhs) 


*adl impairment, any
*first recode as impairment if needs help with dressing or walking, 0 if doesn't for both, then replace with prior year status if missing
replace adl_independent_core = 0 if ((adl_dr_core==1)|(adl_wk_core==1))& keep==1 & adl_independent_core==.
sort hhid pn core_year
by hhid pn: replace adl_independent_core =0 if (adl_independent_core[_n-1]==0) & adl_independent_core==. & keep==1
by hhid pn: replace adl_independent_core = 1 if (adl_independent_core[_n-1]==1)& keep==1 & adl_independent_core==.

*foodstamps: Replace household value if missing
sort hhid pn
by hhid: replace food_stamps= food_stamps[_n-1] if food_stamps==. & keep==1 & food_stamps[_n-1]!=.
egen n_yesfs=total(food_stamps==1), by(hhid)
egen n_nofs=total(food_stamps==0), by(hhid)
replace food_stamps=1 if keep==1 & food_stamps==. & ((n_yesfs==1)|(n_yesfs==2))
replace food_stamps=0 if keep==1 & food_stamps==. & ((n_nofs==1)|(n_nofs==2)|(n_nofs==3))
tab food_stamps if keep==1, m



recode child (0=0)(1/999=1), gen(any_child)



gen live_alone=0 if (resspouse==1 | reschil_d==1 | (hhm>0 & hhm!=.))
replace live_alone=1 if (resspouse==0 & reschil_d==0 & hhm==0)
sort hhid pn core_year
by hhid pn: replace live_alone= live_alone[_n-1] if live_alone==. & keep==1 

*new stratum
gen stratum_n= STRATUM
replace stratum_n= 53 if STRATUM==54
replace stratum_n= 15 if STRATUM==14


*further edit keep variable to exclude nhres
replace keep=0 if nhres==1

save "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 8.dta", replace

H="ANALYSIS ON HARDSHIP"
use "D:\HRS\Projects\coronavirus\data\merged\covid_clean_post step 8.dta"


svyset SECU [pweight=cvwgtr], strata(STRATUM) vce(linearized)


tab keep

putexcel set "D:\HRS\Projects\coronavirus\output\table1_nov23.xls", replace
putexcel A1:C1= "Table 1. Characteristics of those in COVID survey (N=3,102)", merge bold border(bottom)
putexcel A2= "Characteristic",  bold border(bottom)
putexcel B2= "Label",  bold border(bottom)
putexcel C2= "%",  bold border(bottom)

putexcel A3="Age"
putexcel B4="less than 65"
putexcel B5="65-74"
putexcel B6= "75-84"
putexcel B7= "85+"
svy, subpop(keep): tab age_4cat
mat a=e(b)'
putexcel C4=matrix(a), nformat(percent_d2)
svy, subpop(keep): mean age


putexcel A8="Female"
putexcel B9="0"
putexcel B10="1"
svy, subpop(keep): tab female
mat a=e(b)'
putexcel C9=matrix(a), nformat(percent_d2)

putexcel A11= "Race"
putexcel B12= "White, non-Hispanic"
putexcel B13= "Black, non-Hispanic"
putexcel B14= "Other, non-Hispanic"
putexcel B15= "Hispanic"
svy, subpop(keep): tab race_eth
mat a=e(b)'
putexcel C12=matrix(a), nformat(percent_d2)

putexcel A16= "More than HS education"
putexcel B17="0"
putexcel B18="1"
svy, subpop(keep): tab educ_morethanhs
mat a=e(b)'
putexcel C17=matrix(a), nformat(percent_d2)

putexcel A19= "Married"
putexcel B20="0"
putexcel B21="1"
svy, subpop(keep): tab married
mat a=e(b)'
putexcel C20=matrix(a), nformat(percent_d2)


putexcel A22= "Any children"
putexcel B23="0"
putexcel B24="1"
svy, subpop(keep): tab any_child
mat a=e(b)'
putexcel C23=matrix(a), nformat(percent_d2)

putexcel A25= "Lives with children"
putexcel B26="0"
putexcel B27="1"
svy, subpop(keep): tab  reschil_d
mat a=e(b)'
putexcel C26=matrix(a), nformat(percent_d2)

putexcel A28= "Lives alone"
putexcel B29="0"
putexcel B30="1"
svy, subpop(keep): tab live_alone
mat a=e(b)'
putexcel C29=matrix(a), nformat(percent_d2)

putexcel A31= "Medicaid"
putexcel B32="0"
putexcel B33="1"
svy, subpop(keep): tab medicaid
mat a=e(b)'
putexcel C32=matrix(a), nformat(percent_d2)

putexcel A34= "Received food stamps in last year"
putexcel B35="0"
putexcel B36="1"
svy, subpop(keep): tab food_stamps
mat a=e(b)'
putexcel C35=matrix(a), nformat(percent_d2)

putexcel A37= "Independent in ADLs"
putexcel B38="0"
putexcel B39="1"
svy, subpop(keep): tab adl_independent_core
mat a=e(b)'
putexcel C38=matrix(a), nformat(percent_d2)


putexcel A40= "Independent in IADLs"
putexcel B41="0"
putexcel B42="1"
svy, subpop(keep): tab iadl_independent_core
mat a=e(b)'
putexcel C41=matrix(a), nformat(percent_d2)

putexcel A43= "Fair/poor health"
putexcel B44="0"
putexcel B45="1"
svy, subpop(keep): tab srh_pf
mat a=e(b)'
putexcel C44=matrix(a), nformat(percent_d2)

putexcel A46= "Dementia or memory problems"
putexcel B47="0"
putexcel B48="1"
svy, subpop(keep): tab memory_hrs
mat a=e(b)'
putexcel C47=matrix(a), nformat(percent_d2)







putexcel A49= "COVID questions"

putexcel A50= "Probably or definitely had covid"
putexcel B51="0"
putexcel B52="1"
svy, subpop(keep): tab prob_def_covid
mat a=e(b)'
putexcel C51=matrix(a), nformat(percent_d2)

putexcel A53= "Known someone who had covid"
putexcel B54="0"
putexcel B55="1"
svy, subpop(keep): tab known_covid
mat a=e(b)'
putexcel C54=matrix(a), nformat(percent_d2)

putexcel A56= "Known someone who died of covid"
putexcel B57="0"
putexcel B58="1"
svy, subpop(keep): tab died_covid
mat a=e(b)'
putexcel C57=matrix(a), nformat(percent_d2)

putexcel A59= "Needed financial help because of COVID, as receiving money or others paying bills"
putexcel B60="0"
putexcel B61="1"
svy, subpop(keep): tab hlpd_fin
mat a=e(b)'
putexcel C60=matrix(a), nformat(percent_d2)

putexcel A62= "Missed rent or mortgage payments bc covid"
putexcel B63="0"
putexcel B64="1"
svy, subpop(keep): tab hrdshp_rent
mat a=e(b)'
putexcel C63=matrix(a), nformat(percent_d2)

putexcel A65= "Missed payments on cc or other debt bc covid"
putexcel B66="0"
putexcel B67="1"
svy, subpop(keep): tab hrdshp_debt
mat a=e(b)'
putexcel C66=matrix(a), nformat(percent_d2)

putexcel A68= "Missed utility or insurance payments bc covid"
putexcel B69="0"
putexcel B70="1"
svy, subpop(keep): tab hrdshp_medbls
mat a=e(b)'
putexcel C69=matrix(a), nformat(percent_d2)

putexcel A71= "Didn't have money for food bc covid"
putexcel B72="0"
putexcel B73="1"
svy, subpop(keep): tab hrdshp_food
mat a=e(b)'
putexcel C72=matrix(a), nformat(percent_d2)

putexcel A74= "Any of the above financial hardships"
putexcel B75="0"
putexcel B76="1"
svy, subpop(keep): tab hrdshp_any
mat a=e(b)'
putexcel C75=matrix(a), nformat(percent_d2)

putexcel A77= "Trouble buying food despite having money for it"
putexcel B78="0"
putexcel B79="1"
svy, subpop(keep): tab hrdshp_getfood
mat a=e(b)'
putexcel C78=matrix(a), nformat(percent_d2)

putexcel A80= "Trouble accessing food, financial or otherwise"
putexcel B81="0"
putexcel B82="1"
svy, subpop(keep): tab any_hrdshp_food
mat a=e(b)'
putexcel C81=matrix(a), nformat(percent_d2)


*TABLE 2
*Factors associated with any trouble accessing food or any financial hardship
putexcel set "D:\HRS\Projects\coronavirus\output\table2_nov23.xls", replace
svyset SECU [pweight=cvwgtr], strata(stratum_n) vce(linearized)

putexcel A1:G1= "Table 2. Proportion of Older Adults in Each Demographic Category Describing Financial or Food Hardship", merge bold border(bottom)
putexcel A2= "Demographics",  bold border(bottom)
putexcel B2= "No Financial Hardship",  bold border(bottom)
putexcel C2= "Any Financial Hardship",  bold border(bottom)
putexcel D2= "P-value",  bold border(bottom)
putexcel E2= "No Food Hardship",  bold border(bottom)
putexcel F2= "Any Food Hardship",  bold border(bottom)
putexcel G2= "P-value",  bold border(bottom)


putexcel A3="Age"
putexcel A4="less than 65"
putexcel A5="65-74"
putexcel A6= "75-84"
putexcel A7= "85+"
svy, subpop(keep): tab  hrdshp_any if age_4cat==1
mat a=e(b)
putexcel B4=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if age_4cat==2
mat a=e(b)
putexcel B5=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if age_4cat==3
mat a=e(b)
putexcel B6=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if age_4cat==4
mat a=e(b)
putexcel B7=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any age_4cat, column ci
mat p=e(p_Pear)
putexcel D4=matrix(p)

svy, subpop(keep): tab  hrdshp_food if age_4cat==1
mat a=e(b)
putexcel E4=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if age_4cat==2
mat a=e(b)
putexcel E5=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if age_4cat==3
mat a=e(b)
putexcel E6=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if age_4cat==4
mat a=e(b)
putexcel E7=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food age_4cat, column ci
mat p=e(p_Pear)
putexcel G4=matrix(p)


putexcel A8="Female"
putexcel A9="0"
putexcel A10="1"

svy, subpop(keep): tab  hrdshp_any if female==0
mat a=e(b)
putexcel B9=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if female==1
mat a=e(b)
putexcel B10=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any female, column ci
mat p=e(p_Pear)
putexcel D9=matrix(p)

svy, subpop(keep): tab  hrdshp_food if female==0
mat a=e(b)
putexcel E9=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if female==1
mat a=e(b)
putexcel E10=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food female, column ci
mat p=e(p_Pear)
putexcel G9=matrix(p)


putexcel A11= "Race"
putexcel A12= "White, non-Hispanic"
putexcel A13= "Black, non-Hispanic"
putexcel A14= "Other, non-Hispanic"
putexcel A15= "Hispanic"

svy, subpop(keep): tab  hrdshp_any if race_eth==1
mat a=e(b)
putexcel B12=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if race_eth==2
mat a=e(b)
putexcel B13=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if race_eth==3
mat a=e(b)
putexcel B14=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if race_eth==4
mat a=e(b)
putexcel B15=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any race_eth, column ci
mat p=e(p_Pear)
putexcel D12=matrix(p)

svy, subpop(keep): tab  hrdshp_food if race_eth==1
mat a=e(b)
putexcel E12=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if race_eth==2
mat a=e(b)
putexcel E13=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if race_eth==3
mat a=e(b)
putexcel E14=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if race_eth==4
mat a=e(b)
putexcel E15=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food race_eth, column ci
mat p=e(p_Pear)
putexcel G12=matrix(p)

putexcel A16= "More than HS education"
putexcel A17="0"
putexcel A18="1"
svy, subpop(keep): tab  hrdshp_any if educ_morethanhs==0
mat a=e(b)
putexcel B17=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if educ_morethanhs==1
mat a=e(b)
putexcel B18=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any educ_morethanhs, column ci
mat p=e(p_Pear)
putexcel D17=matrix(p)

svy, subpop(keep): tab  hrdshp_food if educ_morethanhs==0
mat a=e(b)
putexcel E17=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if educ_morethanhs==1
mat a=e(b)
putexcel E18=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food educ_morethanhs, column ci
mat p=e(p_Pear)
putexcel G17=matrix(p)


putexcel A19= "Married"
putexcel A20="0"
putexcel A21="1"
svy, subpop(keep): tab  hrdshp_any if married==0
mat a=e(b)
putexcel B20=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if married==1
mat a=e(b)
putexcel B21=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any married, column ci
mat p=e(p_Pear)
putexcel D20=matrix(p)

svy, subpop(keep): tab  hrdshp_food if married==0
mat a=e(b)
putexcel E20=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if married==1
mat a=e(b)
putexcel E21=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food married, column ci
mat p=e(p_Pear)
putexcel G20=matrix(p)


putexcel A22= "Any children"
putexcel A23="0"
putexcel A24="1"
svy, subpop(keep): tab  hrdshp_any if any_child==0
mat a=e(b)
putexcel B23=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if any_child==1
mat a=e(b)
putexcel B24=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any any_child, column ci
mat p=e(p_Pear)
putexcel D23=matrix(p)

svy, subpop(keep): tab  hrdshp_food if any_child==0
mat a=e(b)
putexcel E23=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if any_child==1
mat a=e(b)
putexcel E24=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food any_child, column ci
mat p=e(p_Pear)
putexcel G23=matrix(p)


putexcel A25= "Lives with children"
putexcel A26="0"
putexcel A27="1"
svy, subpop(keep): tab  hrdshp_any if reschil_d==0
mat a=e(b)
putexcel B26=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if reschil_d==1
mat a=e(b)
putexcel B27=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any reschil_d, column ci
mat p=e(p_Pear)
putexcel D26=matrix(p)

svy, subpop(keep): tab  hrdshp_food if reschil_d==0
mat a=e(b)
putexcel E26=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if reschil_d==1
mat a=e(b)
putexcel E27=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food reschil_d, column ci
mat p=e(p_Pear)
putexcel G26=matrix(p)


putexcel A28= "Lives alone"
putexcel A29="0"
putexcel A30="1"
svy, subpop(keep): tab  hrdshp_any if live_alone==0
mat a=e(b)
putexcel B29=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if live_alone==1
mat a=e(b)
putexcel B30=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any live_alone, column ci
mat p=e(p_Pear)
putexcel D29=matrix(p)

svy, subpop(keep): tab  hrdshp_food if live_alone==0
mat a=e(b)
putexcel E29=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if live_alone==1
mat a=e(b)
putexcel E30=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food live_alone, column ci
mat p=e(p_Pear)
putexcel G29=matrix(p)


putexcel A31= "Medicaid"
putexcel A32="0"
putexcel A33="1"
svy, subpop(keep): tab  hrdshp_any if medicaid==0
mat a=e(b)
putexcel B32=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if medicaid==1
mat a=e(b)
putexcel B33=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any medicaid, column ci
mat p=e(p_Pear)
putexcel D32=matrix(p)

svy, subpop(keep): tab  hrdshp_food if medicaid==0
mat a=e(b)
putexcel E32=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if medicaid==1
mat a=e(b)
putexcel E33=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food medicaid, column ci
mat p=e(p_Pear)
putexcel G32=matrix(p)


putexcel A34= "Received food stamps in last year"
putexcel A35="0"
putexcel A36="1"
svy, subpop(keep): tab  hrdshp_any if food_stamps==0
mat a=e(b)
putexcel B35=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if food_stamps==1
mat a=e(b)
putexcel B36=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any food_stamps, column ci
mat p=e(p_Pear)
putexcel D35=matrix(p)

svy, subpop(keep): tab  hrdshp_food if food_stamps==0
mat a=e(b)
putexcel E35=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if food_stamps==1
mat a=e(b)
putexcel E36=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food food_stamps, column ci
mat p=e(p_Pear)
putexcel G35=matrix(p)


putexcel A37= "Independent in ADLs"
putexcel A38="0"
putexcel A39="1"
svy, subpop(keep): tab  hrdshp_any if adl_independent_core==0
mat a=e(b)
putexcel B38=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if adl_independent_core==1
mat a=e(b)
putexcel B39=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any adl_independent_core, column ci
mat p=e(p_Pear)
putexcel D38=matrix(p)

svy, subpop(keep): tab  hrdshp_food if adl_independent_core==0
mat a=e(b)
putexcel E38=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if adl_independent_core==1
mat a=e(b)
putexcel E39=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food adl_independent_core, column ci
mat p=e(p_Pear)
putexcel G38=matrix(p)



putexcel A40= "Independent in IADLs"
putexcel A41="0"
putexcel A42="1"
svy, subpop(keep): tab  hrdshp_any if iadl_independent_core==0
mat a=e(b)
putexcel B41=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if iadl_independent_core==1
mat a=e(b)
putexcel B42=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any iadl_independent_core, column ci
mat p=e(p_Pear)
putexcel D41=matrix(p)

svy, subpop(keep): tab  hrdshp_food if iadl_independent_core==0
mat a=e(b)
putexcel E41=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if iadl_independent_core==1
mat a=e(b)
putexcel E42=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food iadl_independent_core, column ci
mat p=e(p_Pear)
putexcel G41=matrix(p)

putexcel A43= "Fair/poor health"
putexcel A44="0"
putexcel A45="1"
svy, subpop(keep): tab  hrdshp_any if srh_pf==0
mat a=e(b)
putexcel B44=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if srh_pf==1
mat a=e(b)
putexcel B45=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any srh_pf, column ci
mat p=e(p_Pear)
putexcel D44=matrix(p)

svy, subpop(keep): tab  hrdshp_food if srh_pf==0
mat a=e(b)
putexcel E44=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if srh_pf==1
mat a=e(b)
putexcel E45=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food srh_pf, column ci
mat p=e(p_Pear)
putexcel G44=matrix(p)


putexcel A46= "Dementia or memory problems"
putexcel A47="0"
putexcel A48="1"

svy, subpop(keep): tab  hrdshp_any if memory_hrs==0
mat a=e(b)
putexcel B47=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if memory_hrs==1
mat a=e(b)
putexcel B48=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any memory_hrs, column ci
mat p=e(p_Pear)
putexcel D47=matrix(p)

svy, subpop(keep): tab  hrdshp_food if memory_hrs==0
mat a=e(b)
putexcel E47=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if memory_hrs==1
mat a=e(b)
putexcel E48=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food memory_hrs, column ci
mat p=e(p_Pear)
putexcel G47=matrix(p)


putexcel A49= "Knew anyone who had COVID"
putexcel A50="0"
putexcel A51="1"

svy, subpop(keep): tab  hrdshp_any if known_covid==0
mat a=e(b)
putexcel B50=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if known_covid==1
mat a=e(b)
putexcel B51=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any known_covid, column ci
mat p=e(p_Pear)
putexcel D50=matrix(p)

svy, subpop(keep): tab  hrdshp_food if known_covid==0
mat a=e(b)
putexcel E50=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if known_covid==1
mat a=e(b)
putexcel E51=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food known_covid, column ci
mat p=e(p_Pear)
putexcel G50=matrix(p)

putexcel A52= "Knew anyone who died of COVID"
putexcel A53="0"
putexcel A54="1"

svy, subpop(keep): tab  hrdshp_any if died_covid==0
mat a=e(b)
putexcel B53=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any if died_covid==1
mat a=e(b)
putexcel B54=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_any died_covid, column ci
mat p=e(p_Pear)
putexcel D53=matrix(p)

svy, subpop(keep): tab  hrdshp_food if died_covid==0
mat a=e(b)
putexcel E53=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food if died_covid==1
mat a=e(b)
putexcel E54=matrix(a), nformat(percent_d2)
svy, subpop(keep): tab  hrdshp_food died_covid, column ci
mat p=e(p_Pear)
putexcel G53=matrix(p)



